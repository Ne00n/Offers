{"id": "5140", "post": "<div class=\"post-5140 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-5140\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/setup-mysql-master-slave-replication/\" rel=\"bookmark\">How to setup MySQL master slave replication</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> May 3, 2014 @ 1:00 pm, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\">&nbsp;<img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\" data-was-processed=\"true\"></p><p>Over the past few years, databases have become increasingly important. Not only for businesses, but also for personal purposes. Almost every website requires a database these days, as the information we want to share is mostly dynamic. But also because the tools are freely available to just set up a website with a script and a database and get going. These databases usually keep running, but what happens if the server crashes? Or even worse, when the provider disappears? And what if you want to make a backup of your huge database without having it affect your server\u2019s performance?</p><p><strong>In my opinion, master-slave replication for MySQL is a solution for all those things</strong>. It gives you two copies of your database: the \u201clive\u201d one and the backup one. You always write your data to your master and read from the master too, but you will always have an up-to-date copy on your slave. In case everything goes south, you can easily switch to the slave and make it your master.</p><p><span id=\"more-5140\"></span></p><p>I\u2019m going to show you how to set up master-slave replication for MySQL with an existing database. If you don\u2019t have an existing database, you can skip some steps, which I\u2019ll indicate. I\u2019ve written this tutorial for Ubuntu 12.04 LTS or higher. It should work on other Linux distributions as well, though the installation of MySQL will be different and the config files may be in a different position. I\u2019m also assuming MySQL 5.5 or higher.</p><h2>A few things you need to know about master slave replication</h2><p>Replication is not hard, it\u2019s actually quite easy. But there are some things you need to know about master-slave replication:</p><ul><li>Once you\u2019ve set up your replication, you shouldn\u2019t be writing data to the slave. This will get everything out of sync and could seriously break your databases.</li><li>Once you\u2019ve had the situation where your master was unavailable and you\u2019ve switched to your slave, your slave has become your master. There is no turning back from that point. In such a case you could make your old master your new slave (just follow the steps for setting up your slave while there\u2019s existing data on your master).</li><li>You can write to your master and read from your slave. Just keep in mind that when there\u2019s a lot of queries, replication could theoretically slow down. This means that there could be a small period where you\u2019ve added the data to the master but it\u2019s not visible on the slave yet.</li></ul><p>Anyway, now you know this, let\u2019s get working on the real thing!</p><h2>Setting up the master</h2><p>If you have a brand new server, update the APT caches and install the MySQL server:</p><blockquote><p>sudo apt-get update; sudo apt-get install mysql-server</p></blockquote><p>During the installation you may be asked for a root password several times. Pick a strong one and fill it in during the first request. Just press ENTER for rest of the requests, as it will just keep the password you\u2019ve first filled in.</p><p>Now, open up the my.cnf file,&nbsp;which contains your database configuration:</p><blockquote><p>sudo vim /etc/mysql/my.cnf</p></blockquote><p>Change this line:</p><blockquote><p>bind_address = 127.0.0.1</p></blockquote><p>To this:</p><blockquote><p>bind_address = 0.0.0.0</p></blockquote><p>This ensures MySQL is listening on \u201call IP addresses\u201d, or actually, not on a specific one. This <em>does</em> allow any host to connect to the server, just not log in. If you want to limit the host allowed to connect to MySQL you could set up some IPtable rules.</p><p>Also, uncomment the following lines:</p><blockquote><p>server-id = 1<br>\nlog_bin = /var/log/mysql/mysql-bin.log</p></blockquote><p>The \u2018server-id\u2019 option indicates which server this is within the \u201creplication network\u201d. Your slave will get number 2. The \u2018log_bin\u2019 option tells MySQL to maintain a binary log, which contains all your queries in binary format. This is the log used for replication. MySQL cycles the log automatically and it is limited to 100MB in size, so it will never get bigger than that. That shouldn\u2019t be necessary anyway.</p><p>After having changed these options, restart the MySQL server:</p><blockquote><p>sudo service mysql restart</p></blockquote><p>And log into it and root with the password you\u2019ve just picked:</p><blockquote><p>mysql -u root -p</p></blockquote><p>The final step on the master is adding a user account for the slave server. The slave uses that account to log in to the master in order to perform the replication. Look up your slave\u2019s IPv4 address for this, as you want to limit the logins from that account to just your slave server. Now, execute the following query:</p><blockquote><p>GRANT REPLICATION SLAVE ON *.* to \u2018replication\u2019@192.0.2.100 IDENTIFIED BY \u2018yourpassword\u2019;</p></blockquote><p>Replace the IP address with your slave\u2019s IPv4 address and replace \u2018yourpassword\u2019 with a strong password. Execute the query. It should say \u2018Query OK\u2019.</p><p>Now, that\u2019s that for the master. Let\u2019s head on to the slave. We\u2019ll return to the master when the slave is done.</p><h2>Setting up the slave replication</h2><p>On the slave, update the APT caches and install the MySQL server:</p><blockquote><p>sudo apt-get update; sudo apt-get install mysql-server</p></blockquote><p>During the installation you may be asked for a root password several times. Pick a strong one and fill it in during the first request. Just press ENTER for rest of the requests, as it will just keep the password you\u2019ve first filled in.</p><p>Now, open up the my.cnf file,&nbsp;which contains your database configuration:</p><blockquote><p>sudo vim /etc/mysql/my.cnf</p></blockquote><p>And uncomment the following line:</p><blockquote><p>server-id = 2</p></blockquote><p>This number can be any number, just not the same as the one on your slave.</p><p>Save the file and restart the MySQL server:</p><blockquote><p>sudo service mysql restart</p></blockquote><p>And log into it with the root password you\u2019ve just picked:</p><blockquote><p>mysql -u root -p</p></blockquote><p><strong>If you already have data on the master, follow these steps:</strong></p><p>I\u2019m using plain mysqldump to migrate data in my example. In certain situations this may not be a good option, as not all data can be properly migrated using mysqldump. A tool like xtrabackup () is a solution for that, as it works a lot better than mysqldump. For simple cases, though,&nbsp; mysqldump should suffice.</p><p>Before we start migrating data, we should note the current status of the master. On the master, run the following query:</p><blockquote><p>SHOW MASTER STATUS;</p></blockquote><p>This should give you the following sort of overview:</p><blockquote><p>+\u2014\u2014\u2014\u2014\u2014\u2014+\u2014\u2014\u2014-+\u2014\u2014\u2014\u2014\u2013+\u2014\u2014\u2014\u2014\u2014\u2014+<br>\n| File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Position | Binlog_Do_DB | Binlog_Ignore_DB |<br>\n+\u2014\u2014\u2014\u2014\u2014\u2014+\u2014\u2014\u2014-+\u2014\u2014\u2014\u2014\u2013+\u2014\u2014\u2014\u2014\u2014\u2014+<br>\n| mysql-bin.000002 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 107 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n+\u2014\u2014\u2014\u2014\u2014\u2014+\u2014\u2014\u2014-+\u2014\u2014\u2014\u2014\u2013+\u2014\u2014\u2014\u2014\u2014\u2014+</p></blockquote><p>Please note the filename (\u2018File\u2019) and number (\u2018Position\u2019). Remember these or write them down. You will use this to start replication on the slave. This will make sure you don\u2019t miss any data on your slave; data that could be written to your master between the moment of dumping data and having it imported on your slave.</p><p>Now, let\u2019s make a dump of all the databases on your master which should go to your slave:</p><blockquote><p>mysqldump \u2013databases database1&nbsp;database2 database3 -u root -p &gt; data.sql</p></blockquote><p>Replace \u2018database1\u2019 through \u2018database3\u2019 with your database names. You can remove and add databases to cater to your needs. Once you hit enter, use the root password from before.</p><p>Copy the data to your slave and import it to MySQL:</p><blockquote><p>cat data.sql | mysql -u root -p</p></blockquote><p>The data should now be on your slave as well.</p><p><strong>End of steps for masters with existing data.</strong></p><p>It\u2019s now time to make the slave aware of the master. In other words: make it an actual slave. If you <em>did not migrate any data</em>, execute the following query:</p><blockquote><p>CHANGE MASTER TO MASTER_HOST=\u2019192.0.2.100\u2032, MASTER_USER=\u2019replication\u2019, MASTER_PASSWORD=\u2019yourpassword\u2019;</p></blockquote><p>Replace the IP address with your master\u2019s IPv4 address and \u2018yourpassword\u2019 with the password you\u2019ve given the replication user on the master.</p><p>If you <em>did migrate data</em>, use the following query:</p><blockquote><p>CHANGE MASTER TO MASTER_HOST=\u2019192.0.2.100\u2032, MASTER_USER=\u2019replication\u2019, MASTER_PASSWORD=\u2019yourpassword\u2019, MASTER_LOG_FILE=\u2019mysql-bin.000002\u2032, MASTER_LOG_POS=107</p></blockquote><p>Replace the IP address with your master\u2019s IPv4 address and \u2018yourpassword\u2019 with the password you\u2019ve given the replication user on the master. Replace \u2018mysqld-bin.000002\u2019 with the filename you wrote down from your master. Replace \u2018107\u2019 with the number you\u2019ve written down. This tells the slave from what position of the binary log it needs to start replicating. This ensures all data that has been added since you\u2019ve dumped the databases is also added to the slave.</p><p>Now, start the slave:</p><blockquote><p>SLAVE START;</p></blockquote><p>And you\u2019re done! If you want to track the progress/status of your slave, use the following query:</p><blockquote><p>SHOW SLAVE STATUS;</p></blockquote><p>This should give you a bit of a data overload with your slave\u2019s status. If all is well, the first column should read something like:</p><blockquote><p>Waiting for master to send event</p></blockquote><p>Meaning all is well.</p><h2>And now, the big moment\u2026testing the replication</h2><p>It\u2019s time to actually test the replication. On the master, execute the following query:</p><blockquote><p>CREATE DATABASE lowendbox;</p></blockquote><p>Now, on the slave, run the following query:</p><blockquote><p>SHOW DATABASES;</p></blockquote><p>If your replication has been set up correctly, the \u2018lowendbox\u2019 database should be listed on your slave as well.</p><p>Now, go have some fun with setting up tables and executing queries. Just remember: <em>only write to your master!</em></p><h2>Final notes on setting up MySQL master slave replication</h2><p>While replication is now working fine after having followed this guide, it\u2019s still relatively insecure. Data between the master and the slave is not encrypted. That\u2019s why I\u2019m going to show you how to enable SSL for MySQL in my next tutorial.</p><p>If you have the luxury, it is best to set up replication over an internal network. This ensures the data is not sent over the internet and reduces the risk of it being tapped somewhere (if at all).</p><p><span style=\"text-decoration: underline;\">Up next time:</span> Getting started with <a href=\"https://lowendbox.com/blog/getting-started-with-mysql-over-ssl/\">SSL for MySQL</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-mysql-master-slave-replication%2F&amp;t=How%20to%20setup%20MySQL%20master%20slave%20replication\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20to%20setup%20MySQL%20master%20slave%20replication&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-mysql-master-slave-replication%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-mysql-master-slave-replication%2F&amp;title=How%20to%20setup%20MySQL%20master%20slave%20replication&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}