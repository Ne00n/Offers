{"id": "22805", "post": "<div class=\"post-22805 post type-post status-publish format-standard hentry category-tutorials tag-debian-10 tag-free-ssl tag-letsencrypt tag-nginx tag-tutorial\" id=\"post-22805\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/from-zero-to-encrypted-with-nginx-and-lets-encrypt/\" rel=\"bookmark\">Free SSL with NGINX and LetsEncrypt on Debian 10</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/debian-10/\" rel=\"tag\">debian 10</a>, <a href=\"https://lowendbox.com/tag/free-ssl/\" rel=\"tag\">free ssl</a>, <a href=\"https://lowendbox.com/tag/letsencrypt/\" rel=\"tag\">letsencrypt</a>, <a href=\"https://lowendbox.com/tag/nginx/\" rel=\"tag\">nginx</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> May 26, 2020 @ 3:30 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a target=\"_blank\" rel=\"noopener noreferrer\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/04/nginx-and-lets-encrypt.png.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/04/nginx-and-lets-encrypt.png.webp\" alt=\"\" width=\"416\" height=\"245\" data-was-processed=\"true\"></a></p><p>Let\u2019s Encrypt is a free https certificate you can install on your cheap VPS for free, browser-validated https.&nbsp; In this tutorial, we\u2019ll walk through setting up Let\u2019s Encrypt https on an nginx host running on Debian 10.</p><p>We\u2019ll be installing nginx from scratch but not will not be getting into php-fpm and other extensions in this tutorial. I\u2019ll be starting from a spanking new VPS on Vultr.</p><p>This tutorial assumes that you\u2019ve already got your DNS records setup. In other words, if you\u2019re setting up for www.example.com, then www.example.com already has an A record or CNAME that points to your VPS. Note that the certbot installer we\u2019ll be using will query DNS, so this must be working properly.</p><p><span id=\"more-22805\"></span></p><h1>Installing and Setting Up nginx</h1><p>Installing nginx in straightforward:</p><pre>apt-get update &amp;&amp; apt-get upgrade\napt-get install nginx</pre><p>I\u2019ll be setting up www.lowend.party and putting its web root in /web/www.lowend.party.</p><p>Let\u2019s configure the web root and log directory:</p><pre>mkdir -p /web/www.lowend.party\nmkdir -p /var/log/nginx/www.lowend.party\nchown www-data:adm /var/log/nginx/www.lowend.party</pre><h1>Configure Logs and Rotation</h1><p>We want separate logs for each domain we host, and we want to rotate those logs. We can Debian\u2019s log rotation system to accomplish this. We do this by placing the appropriate rules file in /etc/logrotate.d. Start with nginx\u2019s basic log rotation rule:</p><pre>cp /etc/logrotated.d/nginx /etc/logrotate.d/nginx_domain_logs</pre><p>Now edit /etc/logrotate.d/nginx_domain_logs and modify as follows:</p><pre># change this: /var/log/nginx/*.log { \n# to this:\n/var/log/nginx/*/*.log {</pre><h1>Setting Up nginx http</h1><p>Before setting up https, we\u2019ll setup http. I\u2019ll place a place-holder index.html in /web/www.lowend.party:</p><pre>&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;www.lowend.party test page&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;www.lowend.party works!&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre><p>Now take a look at /etc/nginx. /etc/nginx/sites-available should have a file for every single site we might host. Then we symlink into /etc/nginx/sites-enabled to turn on or off specific sites.</p><p>Let\u2019s create a basic nginx config by creating /etc/nginx/sites-available/www.lowend.party:</p><pre>server {\n  server_name www.lowend.party;\n\n  access_log /var/log/nginx/www.lowend.party/access.log;\n  error_log /var/log/nginx/www.lowend.party/error.log;\n\n  location / {\n    root /web/www.lowend.party;\n    index index.html;\n  }\n}</pre><p>Now make it live by:</p><pre>ln -s /etc/nginx/sites-available/www.lowend.party /etc/nginx/sites-enabled/www.lowend.party</pre><p>Let\u2019s syntax check that file:</p><pre># nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful</pre><p>Now restart nginx:</p><pre>systemctl restart nginx</pre><p>Then I visited http://www.lowend.party and successfully saw the HTML I created early.</p><h1>Activating Let\u2019s Encrypt</h1><p>Let\u2019s start by installing certbot, the package that will setup https for us and keep our certificate fresh:</p><pre>apt-get install certbot python-certbot-nginx</pre><p>Now for the magic! Run this command:</p><pre>certbot --authenticator webroot --installer nginx</pre><p>And then follow along with the interactive install. My input is bolded:</p><pre># <strong>certbot --authenticator webroot --installer nginx</strong>\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator webroot, Installer nginx\nEnter email address (used for urgent renewal and security notices) (Enter 'c' to\ncancel): <strong>raindog308@raindog308.com</strong>\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease read the Terms of Service at\nhttps://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must\nagree in order to register with the ACME server at\nhttps://acme-v02.api.letsencrypt.org/directory\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(A)gree/(C)ancel: <strong>A</strong>\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nWould you be willing to share your email address with the Electronic Frontier\nFoundation, a founding partner of the Let's Encrypt project and the non-profit\norganization that develops Certbot? We'd like to send you email about our work\nencrypting the web, EFF news, campaigns, and ways to support digital freedom.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(Y)es/(N)o: <strong>N</strong>\n\nWhich names would you like to activate HTTPS for?\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n1: www.lowend.party\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSelect the appropriate numbers separated by commas and/or spaces, or leave input\nblank to select all options shown (Enter 'c' to cancel): <strong>1</strong>\nObtaining a new certificate\nPerforming the following challenges:\nhttp-01 challenge for www.lowend.party\nInput the webroot for www.lowend.party: (Enter 'c' to cancel): /web/www.lowend.party\nWaiting for verification...\nCleaning up challenges\nDeploying Certificate to VirtualHost /etc/nginx/sites-enabled/www.lowend.party\n\nPlease choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n1: No redirect - Make no further changes to the webserver configuration.\n2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for\nnew sites, or if you're confident your site works on HTTPS. You can undo this\nchange by editing your web server's configuration.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSelect the appropriate number [1-2] then [enter] (press 'c' to cancel): <strong>2</strong>\nRedirecting all traffic on port 80 to ssl in /etc/nginx/sites-enabled/www.lowend.party\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nCongratulations! You have successfully enabled https://www.lowend.party\n\n(rest snipped)</pre><p>Now take a look at /etc/nginx/sites-available/www.lowend.party:</p><pre>server {\n  server_name www.lowend.party;\n\n  access_log /var/log/nginx/www.lowend.party/access.log;\n  error_log /var/log/nginx/www.lowend.party/error.log;\n\n  location / {\n    root /web/www.lowend.party;\n    index index.html;\n  }\n\n  listen 443 ssl; # managed by Certbot\n  ssl_certificate /etc/letsencrypt/live/www.lowend.party/fullchain.pem; # managed by Certbot\n  ssl_certificate_key /etc/letsencrypt/live/www.lowend.party/privkey.pem; # managed by Certbot\n  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\nserver {\n  if ($host = www.lowend.party) {\n    return 301 https://$host$request_uri;\n  } # managed by Certbot\n\n  server_name www.lowend.party;\n  listen 80;\n  return 404; # managed by Certbot\n}</pre><p>certbot has done the following:</p><ul><li>provisioned an SSL certification for www.lowend.party</li><li>loaded the SSL configuration in /etc/letsencrypt</li><li>updated /etc/nginx/sites-available/www.lowend.party and put the proper nginx rules in place to serve HTTPS</li><li>also added an entry so that if you connect on http, it redirects to https</li></ul><p>And going to http://www.lowend.party in my browser confirms everything is working correctly.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iNTEwIiB2aWV3Qm94PSIwIDAgODAwIDUxMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-full wp-image-22807\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-16.12.56-e1588116468599.png.webp\" alt=\"\" width=\"800\" height=\"510\"></p><h1>Keeping Your Certificate Up to Date</h1><p>Here\u2019s a cool part of the certbot system: this chore is already taken care of for you.</p><p>Take a peek in /etc/systemd/system/certbot.timer and you\u2019ll see a job is setup to run twice a day to check renewal and renew if needed.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Ffrom-zero-to-encrypted-with-nginx-and-lets-encrypt%2F&amp;t=Free%20SSL%20with%20NGINX%20and%20LetsEncrypt%20on%20Debian%2010\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Free%20SSL%20with%20NGINX%20and%20LetsEncrypt%20on%20Debian%2010&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Ffrom-zero-to-encrypted-with-nginx-and-lets-encrypt%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Ffrom-zero-to-encrypted-with-nginx-and-lets-encrypt%2F&amp;title=Free%20SSL%20with%20NGINX%20and%20LetsEncrypt%20on%20Debian%2010&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">6</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/managing-your-lowendempire-with-ansible-part-1/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Managing Your LowEndEmpire With Ansible, Part 1\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Managing Your LowEndEmpire With Ansible, Part 1</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Setup a DNS Nameserver Using NSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Setup a DNS Nameserver Using NSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}