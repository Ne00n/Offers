{"id": "22583", "post": "<div class=\"post-22583 post type-post status-publish format-standard hentry category-tutorials tag-ansible tag-tutorial\" id=\"post-22583\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/managing-your-lowendempire-with-ansible-part-1/\" rel=\"bookmark\">Managing Your LowEndEmpire With Ansible, Part 1</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/ansible/\" rel=\"tag\">ansible</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> November 20, 2020 @ 5:38 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a href=\"https://lowendbox.com\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-300x169.png.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-300x169.png.webp\" alt=\"\" width=\"300\" height=\"169\" data-was-processed=\"true\"></a>Ansible is an automation platform that can be used for provisioning, configuration management, and deployments. It does not require deploying an agent and is suitable to manage any system that allows SSH connections and can run Python 2.7.</p><p>Ansible is very powerful for fleet management. Currently, many IT organizations espouse a \u201ccattle not pets\u201d or \u201cstamps not snowflakes\u201d mode of managing in their IT. If your servers are pets, you lovingly create each one by hand, tweaking and tuning it to its specific purpose. This is fine if you have 10 servers but does not scale well. If your servers are cattle, you can create them by the dozen, with the idea that you manage each system identically with common policies.</p><p>For managing your own personal LEBs, Ansible can accomplish several things:</p><ol><li>Taking the drudgery out of common setup tasks, such as installing packages, tweaking config files, installing creature comforts in dot-files, setting up software, etc.</li><li>Enforcing policies so that systems don\u2019t \u201cdrift\u201d from your standard configs.</li><li>Automating routine tasks such as updating systems, deploying new software, etc.</li></ol><p>This tutorial will not attempt to cover everything that Ansible can do, but rather show you how you can quickly make managing your LowEndEmpire more pleasant.</p><p>In part one, we\u2019re going to introduce some Ansible concepts and get Ansible setup on your control node (the master).&nbsp; In the next tutorial we\u2019ll use Ansible to manage some hosts.</p><p><span id=\"more-22583\"></span></p><h1>Ansible Terminology</h1><p><strong>Control Node:</strong> the host that serves as a master, dispatching tasks to other hosts (or itself)</p><p><strong>Host (or node):</strong> a remote machine that Ansible manages</p><p><strong>Roles:</strong> you will assign roles to a host or group of hosts, such as \u201cwebserver\u201d or \u201cdatabase server\u201d to manage them. A host can have many roles.</p><p><strong>Playbooks:</strong> these contain a list of plays (think sports), which are rules that say \u201crun these tasks on these hosts\u201d. A task in this context can be something like \u201cupdate packages\u201d or \u201ccopy this file\u201d. Typically you\u2019ll run a playbook, which says \u201cfor this group of hosts, run these sets of tasks\u201d.</p><p><strong>The Name Ansible Itself:</strong> Science fiction author Ursula LeGuin created the word \u201cansible\u201d to describe a means of high-tech superliminal communication equipment, where messages can be exchanged nearly instantly even over interstellar distances.</p><p>There are <a href=\"https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html\">many more terms</a> but these are enough to get us started.</p><h1>Setting Up An Ansible Control Node</h1><p>In this tutorial, we have a control node called master, and a target called (wait for it\u2026) target. Both are going to run Debian 10, but of course Ansible can run on <a href=\"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html\">many operating systems</a>.</p><p>First, add the following line to /etc/apt/sources.list so you pick up the Ansible repo:</p><pre>deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main</pre><p>Then run these commands as root:</p><pre>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 93C4A3FD7BB9C367\napt update\napt install ansible</pre><h1>Setting Up An Ansible SSH Key</h1><p>Since everything Ansible does is done over ssh, we\u2019ll want to create an ssh key. You can either generate a passwordless ssh key or use ssh-agent.</p><p>In this example, I\u2019m running my control node from a secure location \u2013 my home, safe behind a NAT\u2019d firewall \u2013 so I\u2019ll be using passwordless ssh.</p><p>If your control node is in the cloud, you may not want to use a passwordless ssh key because if your control node is compromised, then all of the nodes that ansible controls could be compromised as well. In that configuration, an ssh-agent setup where you need to enter a password to kick off Ansible may be preferable.</p><p>To generate an passwordless ssh-key, issue the following command, answering with a return when prompted for no password:</p><pre>ssh-keygen -t ed25519 -f ~/.ssh/ansible-key -C 'ssh key for ansible'</pre><h1>Setting Up the Ansible Target Node(s)</h1><p>There\u2019s no software to install, but you do need to setup the ssh key. Some VPS providers allow you to run a script as part of your setup. If so, putting your Ansible ssh key into root\u2019s authorized_keys is easy to go. If your provider doesn\u2019t offer this functionality, then you\u2019ll need to setup the SSH key manually.</p><p>Here is a script that can be used to ensure that the Ansible key is setup properly. You can either run it as a setup script in your provider\u2019s provisioning, or you can copy it to your target node and run it there. You could even login to your target node, copy/paste this script to a file in /tmp, and then execute it. Be sure to change the SSH key (where it says YOUR SSH PUBLIC KEY) to match your control node\u2019s public key.</p><pre>#!/bin/bash\nset -e # will exit on any error\n[ ! -d /root/.ssh] &amp;&amp; mkdir /root/.ssh\n[ ! -f /root/.ssh/authorized_keys] &amp;&amp; touch /root/.ssh/authorized_keys\necho \"YOUR SSH PUBLIC KEY\" &gt;&gt; /root/.ssh/authorized_keys\nchown root:root /root/.ssh/authorized_keys\nchmod 600 /root/.ssh/authorized_keys\nchown root:root /root/.ssh\nchmod 700 /root/.ssh\necho \"Ansible ssh key setup successfully\"</pre><h1>Setting Up Inventory</h1><p>We need to give Ansible a list of hosts to manage. We can also use list this to define groups.</p><p>In this case, \u2018target\u2019 is going to be a database host. So we\u2019ll edit /etc/ansible/hosts to create a \u2018db\u2019 group and put \u2018target\u2019 into it:</p><pre>[db]\ntarget.example.com</pre><p>Look at the examples (commented out) in /etc/ansible/hosts to get a feel for how you can group hosts and specify them.</p><h1>Setting Up ansible.cfg</h1><p>You\u2019ll want to modify /etc/ansible/ansible.cfg (the main Ansible options file). If you use the default Ansible file locations, you\u2019ll have less to modify, so here I will just call out some options to consider.</p><p>If you\u2019ve changed the SSH port on your target hosts, you can use the remote_port setting to change this. For example, if you use port 32222, change this line in the [defaults] group:</p><pre>remote_port = 61941</pre><p>You may wish to disable host key checking, otherwise you\u2019ll need to either use ssh-keyscan to add new hosts to your control node\u2019s known_hosts or manually answer \u2018Y\u2019 the first time a playbook is run:</p><pre>host_key_checking = False</pre><p>Finally, you need to tell Ansible which private key to use, so be sure to set this option:</p><pre>private_key_file = /root/.ssh/ansible-key</pre><h1>Setting Up an Ansible Working Directory</h1><p>You\u2019ll want on a work area on your control node for ansible, where you can:</p><ul><li>keep playbooks and plays</li><li>keep various source files you want to distribute to your target nodes. For example, you might have a vimrc.local you want to always have on your hosts. To do this, create a directory that will hold all your source files. It can be anywhere you wish.</li></ul><p>In this tutorial, we\u2019ll keep it simple and call the work directory /ansible, and keep any files we want to distribute in /ansible/src</p><pre>mkdir -p /ansible/src</pre><h1>Next Time</h1><p>Now that we\u2019ve got Ansible setup, we\u2019ll show you how to exploit its capabilities in the next tutorial.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fmanaging-your-lowendempire-with-ansible-part-1%2F&amp;t=Managing%20Your%20LowEndEmpire%20With%20Ansible%2C%20Part%201\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Managing%20Your%20LowEndEmpire%20With%20Ansible%2C%20Part%201&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fmanaging-your-lowendempire-with-ansible-part-1%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fmanaging-your-lowendempire-with-ansible-part-1%2F&amp;title=Managing%20Your%20LowEndEmpire%20With%20Ansible%2C%20Part%201&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Setup a DNS Nameserver Using NSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Setup a DNS Nameserver Using NSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/top-ten-things-that-should-be-in-your-dot-files/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Top Ten Things That Should Be In Your Dot Files\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Top Ten Things That Should Be In Your Dot Files</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}