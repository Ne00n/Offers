{"id": "9149", "post": "<div class=\"post-9149 post type-post status-publish format-standard hentry category-tutorials tag-monitoring tag-nagios tag-uptime tag-vps\" id=\"post-9149\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/using-nagios-to-monitor-your-virtual-private-servers/\" rel=\"bookmark\">Using Nagios to Monitor your Virtual Private Servers</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/monitoring/\" rel=\"tag\">monitoring</a>, <a href=\"https://lowendbox.com/tag/nagios/\" rel=\"tag\">nagios</a>, <a href=\"https://lowendbox.com/tag/uptime/\" rel=\"tag\">uptime</a>, <a href=\"https://lowendbox.com/tag/vps/\" rel=\"tag\">VPS</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> November 9, 2016 @ 5:09 pm, by Jon Biloh</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><a href=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzEiIGhlaWdodD0iNzAiIHZpZXdCb3g9IjAgMCAyNzEgNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\"></a></p><p>Monitoring the uptime of your virtual private servers is an essential part of guaranteeing maximum uptime for your web facing assets. As a result, many VPS enthusiasts have exclusively chosen Nagios as their uptime monitoring suite.</p><p>Nagios is an open source uptime monitoring app that is used extensively by server administrators all around the world. If a problem is detected on one of your virtual private servers, Nagios can be configured to immediately alert an administrator of the issue.</p><p>When it comes to free open-source uptime monitoring software, Nagios is considered the gold standard. &nbsp;Nagios gives administrators expert insight into services such as:</p><ul><li>CPU Usage</li><li>Memory Consumption</li><li>Disk Performance</li><li>Log Files</li><li>HTTP Logs</li><li>SMTP Monitoring</li><li>DNS Uptime</li></ul><p>Nagios can also be modified using plugins to get the exact uptime metrics of specific services used by your VPS.&nbsp; In this article, we will setup Nagios on a low end box and use this VPS to remotely monitor other virtual private servers in your fleet.</p><p><span id=\"more-9149\"></span></p><p><strong>How to Setup Your First Instance of Nagios</strong></p><p>First, let\u2019s setup Nagios on low end VPS and configure it to monitor itself. After this is setup, we can deploy Nagios to other servers that we may want to monitor remotely. Please note that the instructions in this article pertain to the Ubuntu 16.04 operating system.</p><p>Here are a few prerequisites for getting started with Nagios:</p><ul><li>Root access</li><li>Apache</li><li>PHP</li></ul><p>We will assume that you are logged in the VPS with your root account. If you aren\u2019t, you will need to use all the commands below by prepending \u2018sudo\u2019.&nbsp; Let\u2019s start running the following commands to make sure our system is up to date and that we have all the required modules:</p><pre class=\"code\">&gt; apt-get update\n</pre><pre class=\"code\">&gt; apt-get install openssl perl make php5-gd libgd2-xpm-dev libapache2-mod-php5 libperl-dev libssl-dev daemon wget apache2-utils unzip\n</pre><p>Next, let\u2019s create a user for Nagios with the following commands:</p><pre class=\"code\">&gt; useradd nagios\n\n&gt; groupadd nagcmd\n\n&gt; usermod -a -G nagcmd nagios\n\n&gt; usermod -a -G nagcmd www-data\n</pre><p>We are now ready to install Nagios.&nbsp; Let\u2019s download the app and install it using the following commands:</p><pre class=\"code\">&gt; wget&nbsp; https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.1.1.tar.gz\n</pre><pre class=\"code\">&gt; tar -zxvf /tmp/nagios-4.1.1.tar.gz\n\n&gt; cd nagios-4.1.1/\n\n&gt; ./configure --with-nagios-group=nagios --with-command-group=nagcmd --with-httpd_conf=/etc/apache2/sites-enabled/\n\n&gt; make all\n\n&gt; make install\n\n&gt; make install-init\n\n&gt; make install-config\n\n&gt; make install-commandmode\n\n&gt; sudo /usr/bin/install -c -m 644 sample-config/httpd.conf /etc/apache2/sites-enabled/nagios.conf\n</pre><p>If you haven\u2019t encountered any errors, the Nagios Core should be completely installed. We need to execute a few more commands before Nagios is fully functional.</p><p>Type the following into an SSH window:</p><pre class=\"code\">&gt; wget http://www.nagios-plugins.org/download/nagios-plugins-2.1.1.tar.gz\n\n&gt; tar xzf nagios-plugins-2.1.1.tar.gz\n\n&gt; cd nagios-plugins-2.1.1\n\n&gt; ./configure --with-nagios-user=nagios --with-nagios-group=nagios\n\n&gt; make\n\n&gt; make install\n</pre><p>The next step is to edit the Nagios configuration file. This is the part where you\u2019ll input your email address so that you can get the alerts generated from the servers.&nbsp; Use the following command to open the config file.</p><pre class=\"code\">&gt; vim /usr/local/nagios/etc/objects/contacts.cfg\n</pre><p>And change the following line:</p><pre class=\"code\">&gt; email admin@idroot.net ;\n</pre><p>To the address that should receive the alerts.</p><pre class=\"code\">&gt; email <a href=\"mailto:youremail@domain.com\">youremail@domain.com</a>;\n</pre><p>Now that this is complete, we will need to open this file with your favorite editor:</p><pre class=\"code\">/etc/apache2/sites-enabled/nagios.conf\n</pre><p>and comment each occurrence the following lines:</p><pre class=\"code\">AuthName \"Nagios Access\"\n\nAuthType Basic\n\nAuthUserFile /usr/local/nagios/etc/htpasswd.users\n\nRequire valid-user\n</pre><p>Don\u2019t forget to enable Apache\u2019s rewrite and CGI modules:</p><pre class=\"code\">&gt; sudo a2enmod rewrite\n\n&gt; sudo a2enmod cgi\n</pre><p>Before restarting the webserver, open the following configuration file:</p><pre class=\"code\">/usr/local/nagios/etc/cgi.cfg\n</pre><p>And change the following line from:</p><pre class=\"code\">use_authentication=1\n</pre><p>to</p><pre class=\"code\">use_authentication=0\n</pre><p>Now it\u2019s time to restart the webserver. This will load the new configuration file. You can restart Apache using the following command:</p><pre class=\"code\">&gt; systemctl restart apache2\n</pre><p>Now that our environment is ready, let\u2019s create a configuration file that helps us monitor services. Use the following command to add the new file to the Nagios configuration:</p><pre class=\"code\">&gt; echo \"cfg_file=/usr/local/nagios/etc/objects/newhost.cfg \" &gt;&gt; /usr/local/nagios/etc/nagios.cfg\n</pre><p>Create and open the new file with your favorite editor and add the following content changing the X.X.X.X with the IP address of the server you want to monitor:</p><pre class=\"code\">define host{\n\nuse&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linux-server\n\nhost_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newhost\n\nalias&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newhost\n\naddress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; X.X.X.X\n\n}\n\n&nbsp;\n\ndefine service{\n\nuse&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; local-service\n\nhost_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newhost\n\nservice_description&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PING\n\ncheck_command&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; check_ping!100.0,20%!500.0,60%\n\n}\n</pre><p>In this test, we are only performing a basic ping to monitor the server\u2019s response. Be sure to check out<a href=\"https://assets.nagios.com/downloads/nagioscore/docs/nagioscore/3/en/configmain.html\"> Nagio\u2019s configuration file webpage</a> for tips on how to further customize your uptime monitoring services.</p><p>We\u2019ll want Nagios load when the system is booted up, therefore we must verify that the configuration file has no errors. Use the following command:</p><pre class=\"code\">&gt; /usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg\n</pre><p>And you should get the following 2 lines at the end of the output:</p><p>Total Warnings: 0</p><p>Total Errors:&nbsp;&nbsp; 0</p><p>We are now ready to start Nagios service:</p><pre class=\"code\">&gt; systemctl start nagios\n</pre><p>Nagios will be available on HTTP port 80 by default. Open your favorite browser and navigate to</p><pre class=\"code\">http://YOURIP/nagios/\n</pre><p>Click on the \u201cServices\u201d link located on the left side of the webpage in order to access the list of monitored services. You should be able to monitor the availability of both the local and remote server that we have configured in the steps above.</p><p>If they do not appear to be green, give it some time. The service will run regular tests in order to check the availability of the services. Since we just started Nagios for the first time, it will require a bit of time to complete the first check.</p><p><u>Important:</u> Make sure that the remote server has no firewall on the ICMP protocol. Otherwise, the test will fail and you will receive an alert from Nagios that the server is unreachable.</p><p>Congratulations! You have installed and configured Nagios on your virtual private server.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fusing-nagios-to-monitor-your-virtual-private-servers%2F&amp;t=Using%20Nagios%20to%20Monitor%20your%20Virtual%20Private%20Servers\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Using%20Nagios%20to%20Monitor%20your%20Virtual%20Private%20Servers&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fusing-nagios-to-monitor-your-virtual-private-servers%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fusing-nagios-to-monitor-your-virtual-private-servers%2F&amp;title=Using%20Nagios%20to%20Monitor%20your%20Virtual%20Private%20Servers&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-nameservers-on-a-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Nameservers on a VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-setup-nameservers-on-a-vps-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Nameservers on a VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/top-ten-ways-to-save-on-vps-hosting-and-a-bonus-eleventh-way/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LowEndBox - The best place for hosting and cheap VPS deals!\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Top Ten Ways to Save on VPS Hosting (and a Bonus Eleventh Way)</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/signs-that-youve-outgrown-shared-hosting-and-should-upgrade-to-a-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Signs That You've Outgrown Shared Hosting and Should Upgrade to a VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/signs-you-have-outgrown-shared-hosting-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Signs That You've Outgrown Shared Hosting and Should Upgrade to a VPS</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/jbiloh/\" title=\"All posts by Jon Biloh\" rel=\"author\">Jon Biloh</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/f766d6dc4b5f406b9f3cb0339d48de95?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/f766d6dc4b5f406b9f3cb0339d48de95?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/jbiloh\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"http://Jbiloh\" class=\"bio-icon bio-icon-twitter\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/jon-biloh-4b32598/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\">I'm Jon Biloh and I own LowEndBox and LowEndTalk. I've spent my nearly 20 year career in IT building companies and now I'm excited to focus on building and enhancing the community at LowEndBox and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}