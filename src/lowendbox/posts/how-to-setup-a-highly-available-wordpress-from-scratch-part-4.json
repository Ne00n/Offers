{"id": "23003", "post": "<div class=\"post-23003 post type-post status-publish format-standard hentry category-tutorials tag-high-availability tag-highly-available tag-setup-wordpress tag-tutorial tag-wordpress tag-wordpress-setup\" id=\"post-23003\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-from-scratch-part-4/\" rel=\"bookmark\">How to Setup a Highly Available WordPress Site From Scratch, Part 4</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/high-availability/\" rel=\"tag\">high availability</a>, <a href=\"https://lowendbox.com/tag/highly-available/\" rel=\"tag\">highly available</a>, <a href=\"https://lowendbox.com/tag/setup-wordpress/\" rel=\"tag\">setup wordpress</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a>, <a href=\"https://lowendbox.com/tag/wordpress/\" rel=\"tag\">wordpress</a>, <a href=\"https://lowendbox.com/tag/wordpress-setup/\" rel=\"tag\">wordpress setup</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> January 3, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a target=\"_blank\" rel=\"noopener noreferrer\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part-4.jpg.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" title=\"How to Setup a Highly Available WordPress Site From Scratch, Part 4\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part-4.jpg.webp\" alt=\"How to Setup a Highly Available WordPress Site From Scratch, Part 4\" width=\"410\" height=\"238\" data-was-processed=\"true\"></a>In this tutorial series, we are setting up a highly available WordPress web site from scratch.</p><p><a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-1/\">Part 1 \u2013 Introduction, Considerations, and Architecture</a><br>\n<a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-2/\">Part 2 \u2013 Setting Up the VPSes</a><br>\n<a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-from-scratch-part-3/\">Part 3 \u2013 Setting Up MariaDB Multi-Master Replication</a><br>\nPart 4 \u2013 File Replication and Setting Up DRBD<br>\nPart 5 \u2013 Setting Up OCFS2<br>\nPart 6 \u2013 Round-Robin DNS, Let\u2019s Encrypt, &amp; Conclusion</p><h1 class=\"p1\"><span class=\"s1\">File Replication Options</span></h1><p class=\"p1\"><span class=\"s1\">There are a galaxy of file replication technologies.<span class=\"Apple-converted-space\">&nbsp; </span>We\u2019re going to use DRBD but let\u2019s first cover why we didn\u2019t choose some others.<span class=\"Apple-converted-space\">&nbsp; </span>Our requirements are that the replication is both bi-directional and real-time:</span></p><p class=\"p1\"><span class=\"s1\"><strong>rsync:</strong> not bi-directional, not real-time.<span class=\"Apple-converted-space\">&nbsp; </span>If you are the only author and the only person who will be uploading media, etc. you might just run rsync after each update (or set it up in a cron job).<span class=\"Apple-converted-space\">&nbsp; </span>This is not a bad option but you\u2019ll need to handle the certbot verification a different way.<span class=\"Apple-converted-space\">&nbsp; </span>I recommend either using DNS validation or reading <a href=\"https://scotthelme.co.uk/lets-encrypt-with-dns-round-robin/\">this article</a> on certbot in RRDNS configurations.</span></p><p class=\"p1\"><span class=\"s1\"><strong>lsyncd:</strong> real-time, but not bi-directional.<span class=\"Apple-converted-space\">&nbsp; </span>Only supports one-way syncing.</span></p><p class=\"p1\"><span class=\"s1\"><strong>unison:</strong> bi-directional but not not real-time.<span class=\"Apple-converted-space\">&nbsp; </span>You could run unison in a cron job every few minutes on both nodes to keep your nodes in sync if you can live with the lag.</span></p><p class=\"p1\"><span class=\"s1\"><strong>glusterfs:</strong> \u2013 bi-directional (multi-directional, actually) and real-time, but requires a minimum of three nodes.</span></p><p class=\"p1\"><span class=\"s1\"><strong>mirror:</strong> doesn\u2019t preserve owner, group, etc.</span></p><p class=\"p1\"><span class=\"s1\">In this tutorial, we\u2019ll use DRBD which is both bi-directional and real-time.<span class=\"Apple-converted-space\">&nbsp; </span>Because we want each node to be capable of writing/changing files, we can\u2019t use ext4 or any other \u201cnormal\u201d filesystem but instead need a filesystem that supports shared-disk operations.<span class=\"Apple-converted-space\">&nbsp; </span>For our purposes, we\u2019ll use OFCS2 (Oracle Cluster Filesystem 2)</span></p><p><span id=\"more-23003\"></span></p><h1 class=\"p1\"><span class=\"s1\">Preparing for DRBD</span></h1><p class=\"p1\"><span class=\"s1\">To use DRBD, we need to have a raw, unformatted partition on each side available.<span class=\"Apple-converted-space\">&nbsp; </span>DRBD works a the block level, not the filesystem level.<span class=\"Apple-converted-space\">&nbsp; </span>In Linode\u2019s manager, I\u2019ve added a new 10GB block storage disk to each node.<span class=\"Apple-converted-space\">&nbsp; </span>If you\u2019re using KVM, you will need to set aside an unused partition when you setup the node.</span></p><p class=\"p1\"><span class=\"s1\">Start by installing needed packages on both nodes:</span></p><pre class=\"p1\"><span class=\"s1\">apt-get -y install drbd-utils ocfs2-tools</span></pre><p class=\"p1\"><span class=\"s1\">Load the DRBD kernel module on both nodes:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:~/mysql# modprobe drbd</span>\n<span class=\"s1\">root@web1:~/mysql# lsmod | grep drbd</span>\n<span class=\"s1\">drbd<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>421888<span class=\"Apple-converted-space\">&nbsp; </span>0</span>\n<span class=\"s1\">lru_cache<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>16384<span class=\"Apple-converted-space\">&nbsp; </span>1 drbd</span>\n<span class=\"s1\">libcrc32c<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>16384<span class=\"Apple-converted-space\">&nbsp; </span>1 drbd</span></pre><p class=\"p1\"><span class=\"s1\">I checked dmesg to discover that the block storage I\u2019d added was mapped to /dev/sdc:</span></p><pre class=\"p1\"><span class=\"s1\">[17461.350617] scsi 1:0:0:0: Direct-Access <span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>Linode <span class=\"Apple-converted-space\">&nbsp; </span>Volume <span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>2.5+ PQ: 0 ANSI: 5</span>\n<span class=\"s1\">[17461.353223] sd 1:0:0:0: Power-on or device reset occurred</span>\n<span class=\"s1\">[17461.355751] sd 1:0:0:0: [sdc] 20971520 512-byte logical blocks: (10.7 GB/10.0 GiB)</span>\n<span class=\"s1\">[17461.357007] sd 1:0:0:0: [sdc] Write Protect is off</span>\n<span class=\"s1\">[17461.357771] sd 1:0:0:0: [sdc] Mode Sense: 63 00 00 08</span>\n<span class=\"s1\">[17461.357912] sd 1:0:0:0: [sdc] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA</span>\n<span class=\"s1\">[17461.360936] sd 1:0:0:0: Attached scsi generic sg2 type 0</span>\n<span class=\"s1\">[17461.365013] sd 1:0:0:0: [sdc] Attached SCSI disk</span></pre><p class=\"p1\"><span class=\"s1\">On both nodes, I partitioned /dev/sdc to add a single primary partition that took up the whole disk:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc# fdisk /dev/sdc\n</span>\n<span class=\"s1\">Welcome to fdisk (util-linux 2.33.1).</span>\n<span class=\"s1\">Changes will remain in memory only, until you decide to write them.</span>\n<span class=\"s1\">Be careful before using the write command.</span>\n<span class=\"s1\">\nDevice does not contain a recognized partition table.</span>\n<span class=\"s1\">Created a new DOS disklabel with disk identifier 0x477ee7d7.\n</span>\n<span class=\"s1\">Command (m for help): <strong>p</strong></span>\n<span class=\"s1\">Disk /dev/sdc: 10 GiB, 10737418240 bytes, 20971520 sectors</span>\n<span class=\"s1\">Disk model: Volume <span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; &nbsp;</span></span>\n<span class=\"s1\">Units: sectors of 1 * 512 = 512 bytes</span>\n<span class=\"s1\">Sector size (logical/physical): 512 bytes / 512 bytes</span>\n<span class=\"s1\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span>\n<span class=\"s1\">Disklabel type: dos</span>\n<span class=\"s1\">Disk identifier: 0x477ee7d7\n</span>\n<span class=\"s1\">Command (m for help): <strong>n</strong></span>\n<span class=\"s1\">Partition type</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp;&nbsp; </span>p <span class=\"Apple-converted-space\">&nbsp; </span>primary (0 primary, 0 extended, 4 free)</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp;&nbsp; </span>e <span class=\"Apple-converted-space\">&nbsp; </span>extended (container for logical partitions)</span>\n<span class=\"s1\">Select (default p): <strong>p</strong></span>\n<span class=\"s1\">Partition number (1-4, default 1): <strong>1</strong></span>\n<span class=\"s1\">First sector (2048-20971519, default 2048): <strong>&lt;return&gt;</strong></span>\n<span class=\"s1\">Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-20971519, default 20971519): </span>\n\n<span class=\"s1\">Created a new partition 1 of type 'Linux' and of size 10 GiB.</span>\n\n<span class=\"s1\">Command (m for help): <strong>w</strong></span>\n<span class=\"s1\">The partition table has been altered.</span>\n<span class=\"s1\">Calling ioctl() to re-read partition table.</span>\n<span class=\"s1\">Syncing disks.</span></pre><p class=\"p1\"><span class=\"s1\">The partition table now looks like this:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc# fdisk /dev/sdc</span>\n<span class=\"s1\">Welcome to fdisk (util-linux 2.33.1).</span>\n<span class=\"s1\">Changes will remain in memory only, until you decide to write them.</span>\n<span class=\"s1\">Be careful before using the write command.</span>\n<span class=\"s1\">Command (m for help): <strong>p</strong></span>\n<span class=\"s1\">Disk /dev/sdc: 10 GiB, 10737418240 bytes, 20971520 sectors</span>\n<span class=\"s1\">Disk model: Volume <span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span>\n<span class=\"s1\">Units: sectors of 1 * 512 = 512 bytes</span>\n<span class=\"s1\">Sector size (logical/physical): 512 bytes / 512 bytes</span>\n<span class=\"s1\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span>\n<span class=\"s1\">Disklabel type: dos</span>\n<span class=\"s1\">Disk identifier: 0x477ee7d7</span>\n\n<span class=\"s1\">Device <span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>Boot Start<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; </span>End<span class=\"Apple-converted-space\">&nbsp; </span>Sectors Size Id Type</span>\n<span class=\"s1\">/dev/sdc1<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>2048 20971519 20969472<span class=\"Apple-converted-space\">&nbsp; </span>10G 83 Linux</span></pre><h1 class=\"p1\"><span class=\"s1\">Setting up DRBD</span></h1><p class=\"p1\"><span class=\"s1\">Now let\u2019s setup some configuration files.<span class=\"Apple-converted-space\">&nbsp; </span>On each node, rename /etc/drbd.d/global_common.conf to /etc/drbd.d/global_common.conf.dist and replace it with this:</span></p><pre class=\"p1\"><span class=\"s1\">global {</span>\n<span class=\"s1\">  usage-count yes;</span>\n<span class=\"s1\">}</span>\n\n<span class=\"s1\">common {</span>\n<span class=\"s1\">  net {</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; </span>protocol C;</span>\n<span class=\"s1\">  }</span>\n<span class=\"s1\">}</span></pre><p class=\"p1\"><span class=\"s1\">Protocol C is synchronous replication.<span class=\"Apple-converted-space\">&nbsp; </span>This is the best choice in our scenario because (a) the servers are in the same datacenter so there is reduced latency, and (b) WordPress is a \u201cfew writers, many readers\u201d kind of site, where most operations are read rather than write.</span></p><p class=\"p1\"><span class=\"s1\">Next, create /etc/drbd.d/r0.res and populate it as follows:</span></p><pre class=\"p1\"><span class=\"s1\">resource r0 {</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>on web1.lowend.party {</span>\n<span class=\"s1\">            address 1.1.1.1:7788;</span>\n<span class=\"s1\">            device /dev/drbd0;</span>\n<span class=\"s1\">            meta-disk internal;</span>\n<span class=\"s1\">            disk /dev/sdc1;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>on web2.lowend.party {</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>address 2.2.2.2:7788;</span>\n<span class=\"s1\">            device /dev/drbd0;</span>\n<span class=\"s1\">            meta-disk internal;</span>\n<span class=\"s1\">            disk /dev/sdc1;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</span>\n<span class=\"s1\">#<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>startup {</span>\n<span class=\"s1\">#<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>become-primary-on both; </span>\n<span class=\"s1\">#<span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; &nbsp; &nbsp; </span>net {</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>cram-hmac-alg sha1;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>shared-secret \"secret\";</span>\n<span class=\"s1\">            # allow-two-primaries yes;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>after-sb-0pri discard-zero-changes;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>after-sb-1pri discard-secondary;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>after-sb-2pri disconnect;</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">  &nbsp; &nbsp; &nbsp; </span>}</span>\n<span class=\"s1\">}</span></pre><p class=\"p1\"><span class=\"s1\">A couple important notes:</span></p><ul><li class=\"p1\"><span class=\"s1\">The \u201con\u201d clauses must match the output of the \u2018hostname\u2019 command.</span></li><li class=\"p1\"><span class=\"s1\">You\u2019ll notice both the \u201cstartup\u201d clause and the \u201callow-two-primaries\u201d part of the \u201cnet\u201d clause are commented out.<span class=\"Apple-converted-space\">&nbsp; </span>This is intentional.<span class=\"Apple-converted-space\">&nbsp; </span>We will enable these directives once we have DRBD initialized.</span></li></ul><p class=\"p1\"><span class=\"s1\">Now on each node, execute these commands:</span></p><pre class=\"p1\"><span class=\"s1\">drbdadm create-md r0</span>\n<span class=\"s1\">drbdadm up r0</span></pre><p class=\"p1\"><span class=\"s1\">You can now look at /proc/drbd to see the status, or run drbdadm:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc/drbd.d# cat /proc/drbd </span>\n<span class=\"s1\">version: 8.4.10 (api:1/proto:86-101)</span>\n<span class=\"s1\">srcversion: 983FCB77F30137D4E127B83 </span>\n<span class=\"s1\"> 0: cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent C r-----</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>ns:0 nr:0 dw:0 dr:0 al:8 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:10484380</span>\n<span class=\"s1\">root@web1:/etc/drbd.d# drbdadm status r0</span>\n<span class=\"s1\">r0 role:Secondary</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; </span>disk:Inconsistent</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; </span>peer role:Secondary</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>replication:Established peer-disk:Inconsistent</span></pre><p class=\"p1\"><span class=\"s1\">This output tells use that this volume is in an inconsistent state and both sides of the cluster are secondaries.<span class=\"Apple-converted-space\">&nbsp; </span>In essence, both sides are waiting for the primary to update, but neither is primary so nothing is happening.<span class=\"Apple-converted-space\">&nbsp; </span>Let\u2019s fix that.<span class=\"Apple-converted-space\">&nbsp; </span>On web1, execute this command:</span></p><pre class=\"p1\"><span class=\"s1\">drbdadm primary --force r0</span></pre><p class=\"p1\"><span class=\"s1\">Now if you look at /proc/drbd you\u2019ll see that synchronization is beginning:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc/drbd.d# cat /proc/drbd </span>\n<span class=\"s1\">version: 8.4.10 (api:1/proto:86-101)</span>\n<span class=\"s1\">srcversion: 983FCB77F30137D4E127B83 </span>\n<span class=\"s1\"> 0: cs:SyncSource ro:Primary/Secondary ds:UpToDate/Inconsistent C r-----</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>ns:1732 nr:0 dw:0 dr:1732 al:8 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:10482648</span>\n<span class=\"s1\"> [&gt;....................] sync'ed:<span class=\"Apple-converted-space\">&nbsp; </span>0.1% (10236/10236)M</span>\n<span class=\"s1\"> finish: 1:27:21 speed: 1,732 (1,732) K/sec</span></pre><p class=\"p1\"><span class=\"s1\">Don\u2019t freak out by the estimate 1 hour, 27 minute sync time for a 10G volume.<span class=\"Apple-converted-space\">&nbsp; </span>I checked /proc/drbd about 10 seconds later and it looked like this:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc/drbd.d# cat /proc/drbd </span>\n<span class=\"s1\">version: 8.4.10 (api:1/proto:86-101)</span>\n<span class=\"s1\">srcversion: 983FCB77F30137D4E127B83 </span>\n<span class=\"s1\"> 0: cs:SyncSource ro:Primary/Secondary ds:UpToDate/Inconsistent C r-----</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>ns:596272 nr:0 dw:0 dr:596272 al:8 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:9888108</span>\n<span class=\"s1\"> [&gt;...................] sync'ed:<span class=\"Apple-converted-space\">&nbsp; </span>5.8% (9656/10236)M</span>\n<span class=\"s1\"> finish: 0:07:16 speed: 22,640 (14,904) K/sec</span></pre><p class=\"p1\"><span class=\"s1\">Once the volumes are in sync, you\u2019ll see this:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc/drbd.d# cat /proc/drbd </span>\n<span class=\"s1\">version: 8.4.10 (api:1/proto:86-101)</span>\n<span class=\"s1\">srcversion: 983FCB77F30137D4E127B83 </span>\n<span class=\"s1\"> 0: cs:Connected ro:Primary/Primary ds:UpToDate/UpToDate C r-----</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>ns:134792 nr:0 dw:134792 dr:1469 al:120 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0</span></pre><p class=\"p1\"><span class=\"s1\">Now change /etc/drbd.d/r0.res on both nodes and uncomment out the commented portions.<span class=\"Apple-converted-space\">&nbsp; </span>You can do this manually or by running the sed command below (be sure to do this on both nodes):</span></p><pre class=\"p1\"><span class=\"s1\"># systemctl stop drbd</span>\n<span class=\"s1\"># sed -i 's/#//' /etc/drbd.d/r0.res</span>\n<span class=\"s1\"># systemctl start drbd</span>\n<span class=\"s1\"># systemctl enable drbd\n</span>drbd.service is not a native service, redirecting to systemd-sysv-install.\n<span class=\"s1\">Executing: /lib/systemd/systemd-sysv-install enable drbd</span></pre><p class=\"p1\"><span class=\"s1\">DRBD should now report that it\u2019s both up-to-date (consistent on all nodes) and that all nodes are primaries:</span></p><pre class=\"p1\"><span class=\"s1\">root@web1:/etc# cat /proc/drbd </span>\n<span class=\"s1\">version: 8.4.10 (api:1/proto:86-101)</span>\n<span class=\"s1\">srcversion: 983FCB77F30137D4E127B83 </span>\n<span class=\"s1\"> 0: cs:Connected ro:Primary/Primary ds:UpToDate/UpToDate C r-----</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>ns:609047 nr:7596 dw:15911 dr:623182 al:4 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0</span>\n<span class=\"s1\">root@web1:/etc# drbdadm status all</span>\n<span class=\"s1\">r0 role:Primary</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; </span>disk:UpToDate</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; </span>peer role:Primary</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>replication:Established peer-disk:UpToDate</span></pre><p>Our DRBD configuration is now complete.</p><p><strong>Next Part: <span class=\"s1\">Part 5 \u2013 Setting Up OCFS2</span></strong></p><p>&nbsp;</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/poll-have-you-enjoyed-our-recent-tutorials/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Poll: Have you enjoyed our recent Tutorials?\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/06/lowendbox-poll-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Poll: Have you enjoyed our recent Tutorials?</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-from-scratch-part-3/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup a Highly Available WordPress Site From Scratch, Part 3\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part-3-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Setup a Highly Available WordPress Site From Scratch, Part 3</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-2/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup a Highly Available WordPress Site From Scratch, Part 2\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/04/highly-available-wordpress-part2-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Setup a Highly Available WordPress Site From Scratch, Part 2</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/cloudean-debuts-with-worldwide-shared-email-and-wordpress-hosting-shared-as-cheap-as-e0-998-month/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Cloudean Debuts with Worldwide Shared, Email, and WordPress Hosting! (Shared as Cheap as \u20ac0.998/mont...\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/12/cloudean-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Cloudean Debuts with Worldwide Shared, Email, and WordPress Hosting! (Shared as Cheap as \u20ac0.998/mont...</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}