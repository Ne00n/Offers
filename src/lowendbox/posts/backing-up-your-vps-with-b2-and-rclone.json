{"id": "22803", "post": "<div class=\"post-22803 post type-post status-publish format-standard hentry category-tutorials tag-b2 tag-backblaze tag-backup tag-backupservice tag-backupvps tag-rclone tag-selfhostedbackup\" id=\"post-22803\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/backing-up-your-vps-with-b2-and-rclone/\" rel=\"bookmark\">Backing Up Your VPS With b2 and rclone</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/b2/\" rel=\"tag\">b2</a>, <a href=\"https://lowendbox.com/tag/backblaze/\" rel=\"tag\">backblaze</a>, <a href=\"https://lowendbox.com/tag/backup/\" rel=\"tag\">backup</a>, <a href=\"https://lowendbox.com/tag/backupservice/\" rel=\"tag\">backupservice</a>, <a href=\"https://lowendbox.com/tag/backupvps/\" rel=\"tag\">backupvps</a>, <a href=\"https://lowendbox.com/tag/rclone/\" rel=\"tag\">rclone</a>, <a href=\"https://lowendbox.com/tag/selfhostedbackup/\" rel=\"tag\">selfhostedbackup</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> January 27, 2021 @ 4:35 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a target=\"_blank\" rel=\"noopener noreferrer\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/04/backup-vps-with-b2-rclone.png.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/04/backup-vps-with-b2-rclone.png.webp\" alt=\"\" width=\"416\" height=\"245\" data-was-processed=\"true\"></a>b2 is cloud storage from Backblaze. Like Amazon S3, Microsoft Azure, or Google Cloud Storage, it provides an API for storing files in the cloud and does so at a substantially cheaper price than its competitors.&nbsp; In this tutorial, we\u2019ll show how you can use b2 for backing up your VPS.</p><h1>Understanding B2 Pricing</h1><p>There are three components to B2 pricing:</p><ul><li>The monthly storage cost.</li><li>The transaction costs (delete actions, list actions, etc.)</li><li>Download costs. As of this tutorial, there is no charge for upload.</li></ul><p>The transaction costs are minimal (less than a penny per 1,000 operations such as delete), so we will ignore those. Download costs are only relevant if you are restoring a backup. Hopefully this will be a rare event. This is where S3, Azure, and Google can be very expensive because you pay their normal transit.</p><p>For my backups, I model the monthly storage costs (see <a href=\"https://www.backblaze.com/b2/cloud-storage-pricing.html\" target=\"_blank\" rel=\"noopener noreferrer\">full pricing details on Backblaze.com</a>), since that\u2019s what I\u2019m going to see on my bill. I rarely restore, and typically it\u2019s a few files.</p><p><span id=\"more-22803\"></span></p><h1>Getting the B2 Tools</h1><p>In this tutorial, we\u2019ll be using the b2 command line tool and rclone.</p><p>After signing up on backblaze.com, you will be assigned a Master Application Key. For this tutorial, I\u2019ll create a separate Application Key just for this tutorial. It\u2019s important to note that while you can retrieve the keyID at any time by logging into your account, you can only see the applicationKey <strong>once</strong> at the time you create it.</p><p>Next setup the b2 command line tool:</p><pre>apt-get install python-pip\npip install b2</pre><p>To use the b2 cli, you first have to authorize the client. I will replace my Key ID with XXXXX and my Application Key with YYYYY.</p><pre># b2 authorize-account XXXXX YYYYY\nUsing https://api.backblazeb2.com</pre><p>You\u2019ll now find a file called ~/.b2_account_info has been created. This is a sqlite3 database with configuration information. You can take a look at it with sqlite3 (e.g., sqlite3 ~/.b2_account_info) but don\u2019t modify anything. You can move this file if you want, but if you change it to a non-default location you need to set the B2_ACCOUNT_INFO environment variable so the b2 cli knows where to find it.</p><h1>Picking a B2 Bucket Name</h1><p>We\u2019ll create a bucket next, which is where you\u2019re store your files.&nbsp; You can create as many buckets as you like \u2013 perhaps one for each VPS, one for different filesystems or projects, etc.</p><p>It\u2019s important to realize that the b2 namespace is completely flat. You will never get a bucket named \u2018backup\u2019 because there are 7 billion other humans fighting for that name. Bucket names have a minimum of 6 and a maximum of 50 characters and consist of letters, digits, and hyphens. They also cannot start with b2-.</p><p>One trick to make sure you have a consistent naming standard is to prefix your bucket names with something long, like a UUID.&nbsp;&nbsp;A v4 UUID is 37 characters so if you use a UUID v4 plus a trailing hyphen, that leaves 12 characters for a bucket name and you can rest assured it is available.</p><p>Using an <a href=\"https://www.uuidgenerator.net\" target=\"_blank\" rel=\"noopener noreferrer\">online UUID generator</a> (or install the uuid package and run uuid -v4), I chose this bucket name:</p><pre>5e73a641-5685-4ab5-9276-9f480ebabd2e-backup</pre><p>I could also remove the hypens if I wanted more space.</p><h1>Creating the Bucket</h1><p>Let\u2019s use the b2 command line tool to create a bucket. You could also create one on backblaze.com. By default, if you create a bucket it has a lifecycle setting that retains previous versions of files. In our case, we don\u2019t want to do that. We can either create the bucket on backblaze.com and set the life cycle rules there, or pass some JSON on the b2 command-line to accomplish the same thing.&nbsp; (I\u2019ve split the long line here but you should type this all on one line without the back slashes).</p><pre># b2 create-bucket --lifecycleRules \\\n'[{ \"daysFromHidingToDeleting\": 1, \"daysFromUploadingToHiding\": null, \"fileNamePrefix\":\"\" }]' \\\n5e73a641-5685-4ab5-9276-9f480ebabd2e-backup allPrivate\n8be70287ff4bc9157a1e0915</pre><p>That command says \u201ccreate a bucket, set the life cycle to only keep the most recent version of the file, and make all files in the bucket private\u201d. The command returns the bucket ID.</p><p>If this looks confusing, setup a bucket on Backblaze.com, and then use b2 get-bucket to see the JSON for that particular config.</p><h1>Setting Up rclone</h1><p>Installing rclone is easy:</p><pre>apt-get install rclone</pre><p>And now run rclone config to set it up:</p><pre># rclone config\n2020/04/28 18:22:30 NOTICE: Config file \"/root/.config/rclone/rclone.conf\" not found - using defaults\nNo remotes found - make a new one\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q&gt; n\nname&gt; <strong>b2</strong>\nType of storage to configure.\nEnter a string value. Press Enter for the default (\"\").\nChoose a number from below, or type in your own value\n1 / A stackable unification remote, which can appear to merge the contents of several remotes\n\\ \"union\"\n2 / Alias for a existing remote\n\\ \"alias\"\n3 / Amazon Drive\n\\ \"amazon cloud drive\"\n4 / Amazon S3 Compliant Storage Providers (AWS, Ceph, Dreamhost, IBM COS, Minio)\n\\ \"s3\"\n5 / Backblaze B2\n\\ \"b2\"\n&lt;snip&gt;\n24 / http Connection\n\\ \"http\"\nStorage&gt; <strong>5</strong>\n** See help for b2 backend at: https://rclone.org/b2/ **\n\nAccount ID or Application Key ID\nEnter a string value. Press Enter for the default (\"\").\naccount&gt; <strong>XXXXX</strong>\nApplication Key\nEnter a string value. Press Enter for the default (\"\").\nkey&gt; <strong>YYYYY</strong>\nPermanently delete files on remote removal, otherwise hide files.\nEnter a boolean value (true or false). Press Enter for the default (\"false\").\nhard_delete&gt; \nEdit advanced config? (y/n)\ny) Yes\nn) No\ny/n&gt; <strong>n</strong>\nRemote config\n--------------------\n[b2]\naccount = XXXXX\nkey = YYYYY\n--------------------\ny) Yes this is OK\ne) Edit this remote\nd) Delete this remote\ny/e/d&gt; y\nCurrent remotes:\n\nName Type\n==== ====\nb2   b2\n\ne) Edit existing remote\nn) New remote\nd) Delete remote\nr) Rename remote\nc) Copy remote\ns) Set configuration password\nq) Quit config\ne/n/d/r/c/s/q&gt; <strong>q</strong></pre><p>In this case, I chose to call the b2 remote storage \u2018b2\u2019 (clever, eh?)&nbsp; I could have called it \u2018cloud\u2019, \u2018b2backup\u2019, \u2018snuffleupagus\u2019 or anything else.&nbsp; You can examine /root/.config/rclone/rclone.conf to see the values you entered.</p><h1>Backing Up With rclone</h1><p>You are now ready to backup.&nbsp; In this example, I\u2019ll backup /usr/include:</p><pre>rclone -L sync /usr/include b2:5e73a641-5685-4ab5-9276-9f480ebabd2e-backup</pre><p>then I can list the files:</p><pre># rclone ls b2:5e73a641-5685-4ab5-9276-9f480ebabd2e-backup3\n7456 aio.h\n2031 aliases.h\n1203 alloca.h\n1730 ar.h\n&lt;etc.&gt;</pre><h1>Finer Points</h1><p>One thing that b2 doesn\u2019t handle natively is symlinks.&nbsp; You need to make a choice to either copy the linked file (what the symlink points to) or skip the link entirely.&nbsp; One technique is to tar up directories and then backup the tarball.&nbsp; If you ever need a restore, you restore the tarball and then when you untar, you get your symlink backs.&nbsp; Above I used -L (copy the linked file), but if you want to skip links, there\u2019s \u2013skip-links.</p><p>Remember that for live databases, you\u2019ll want to do a mysqldump, pg_backup, etc. before backup.&nbsp; Because rclone runs so easily on the command line, it\u2019s easy to put the database backup commands and rclone in a single script and stick it in cron.</p><p>Another consideration is how many transfer threads you want to run in parallel.&nbsp; If you have many files, then increasing the number of transfers can increase performance.&nbsp; By default, rclone will use 4 parallel transfers, but you can override this with the \u2013transfers flag.</p><p>There are many other options to rclone to limit bandwidth, tune memory, and configure encryption, so be sure to check out the rclone man page and/or docs.&nbsp; Enjoy!</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/poll-results-which-of-these-features-do-you-look-for-when-selecting-a-provider/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Poll Results: Which of These Features Do You Look for When Selecting a Provider?\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/06/lowendbox-poll-results-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Poll Results: Which of These Features Do You Look for When Selecting a Provider?</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/poll-which-of-these-features-do-you-look-for-when-selecting-a-provider/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Poll: Which of These Features Do You Look for When Selecting a Provider?\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/06/lowendbox-poll-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Poll: Which of These Features Do You Look for When Selecting a Provider?</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/cloud-shards-7month-1gb-in-los-angeles-buffalo-and-dallas-storage-offers-inside/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"cloudshards\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2013/03/cloudshards-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Cloud Shards - $7/month 1GB in Los Angeles, Buffalo and Dallas, storage offers inside</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/serverdragon-8year-32mb-openvz-vps-in-tampa-and-denver-backup-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"serverdragon\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2012/11/serverdragon-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">ServerDragon - $8/Year 32MB OpenVZ VPS in Tampa and Denver + Backup VPS</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}