{"id": "4072", "post": "<div class=\"post-4072 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-4072\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/generate-ssh-key-setup-ssh-agent/\" rel=\"bookmark\">Generating an SSH key and setting up SSH-agent</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> July 13, 2013 @ 4:04 pm, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzEiIGhlaWdodD0iNzAiIHZpZXdCb3g9IjAgMCAyNzEgNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\"></p><p>A couple of weeks ago I started with the first tutorial in a series of security-related ones. This is the second tutorial in this series. Last time I spoke about <a href=\"https://lowendbox.com/blog/securing-your-server-ssh-and-sudo/\">SSH and sudo</a>. As Raymii pointed out in the comments, I never mentioned how to actually generate your own SSH key. In this tutorial, I would like to show you how to do that.</p><p>Why would you want to use an SSH key? Well, normally when you log into a server you get asked for a password. But not only you: anybody who tries to log in to the server gets asked for the password. This means that an attacker can actually try and keep guessing passwords for a long, long time. To tackle this problem, you shouldn\u2019t be using password authentication but rather an SSH keypair. With your public key on the server and your private key on your PC, SSH can match those two and give you access. A password is no longer needed. But why is it more secure?</p><p><span id=\"more-4072\"></span></p><p>Because an SSH key is extremely hard to guess, virtually impossible. Not only because the private key is usually 2048 bits (or more), but also because the private <em>and</em> public key need to match. So you would need to actually guess the private key that matches the public key. Good luck with that ;-)</p><p>So, let\u2019s generate an SSH-key!</p><h1>Generating an SSH key</h1><p>Generating an SSH key is done with the \u2018ssh-keygen\u2019 command. This should be available by default on most Linux distributions and Mac OS X. ssh-keygen generates a keypair for your with a private and public key. The public key is uploaded to the server you want to authenticate with. The private key is used to match with a public key on the server to see if you are allowed to access it over SSH. Only if the public and private key match, you get access to the server.</p><p>Your SSH private key is protected with a password. You have to make sure this is a <em>strong</em> password, as your SSH key could very well be the key to all your servers. \u2018hunter2\u2019 is <em>not</em> a good password, for example. Your password shouldn\u2019t contain any dictionary words, dates (that are important to you), your address or any (family) names. It should basically be random letters, numbers and symbols where the letters differ in case as well. I usually use KeePass2 to check a password\u2019s strength. It\u2019s not a guarantee, but an indication. I make sure my passwords are at least 100bits on the strength meter.</p><p>So what is a good password? Well, I would consider this a good/decent password: KIanf832hWN()@jnfs*@. Of course, this one is quite hard to remember, so you may have to cook up one that\u2019s a bit easier to remember but has the same strength. If you find it too hard to remember the password in general, you could always store it in a KeePass2 database. You would need to guard that with a password again, though\u2026 Anyway, you probably got the point: pick a <em>very</em> strong password. In case your private key ever gets in the wrong hands, it\u2019ll be hard for whoever has it to crack your password if you have a good password.</p><p><em>Editorial note: if anybody has good (additional) advice for coming up with string passwords that are easy to remember, please add them in the comments.</em></p><p>Now, let\u2019s generate the SSH key with the following command:</p><blockquote><p>ssh-keygen -b 4096 -C \u201cMaarten Kossen\u201d</p></blockquote><p>We invoke the ssh-keygen command with to parameters: -b and -C. The -C is user for a comment for the SSH key. This could be \u2018This is the key for my office servers\u2019 or your name, like I used in the example. This comment will be in your public key and will be listed in all the authorized_keys files your public key is in. It\u2019s basically a label for your key.</p><p>The -b parameter is used to indicate the number of bits the key will be. Basically it\u2019s like this: the more bits, the stronger a key is and the harder it is to crack. ssh-keygen\u2019s default length is 2048 bits, which is fine, but I\u2019m going for better. So, with -b 4096 I\u2019m making the key 4096 bits, which should be better ;-)!</p><p>This is the output of the command:</p><blockquote><p>mpkossen@ny:~$ ssh-keygen -b 4096 -C \u201cMaarten Kossen\u201d<br>\nGenerating public/private rsa key pair.<br>\nEnter file in which to save the key (/home/mpkossen/.ssh/id_rsa):<br>\nEnter passphrase (empty for no passphrase):<br>\nEnter same passphrase again:<br>\nYour identification has been saved in /home/mpkossen/.ssh/id_rsa.<br>\nYour public key has been saved in /home/mpkossen/.ssh/id_rsa.pub.<br>\nThe key fingerprint is:<br>\n0a:14:c2:08:bc:95:20:1c:d1:bc:06:3e:95:c7:e3:03 Maarten Kossen<br>\nThe key\u2019s randomart image is:<br>\n+\u2013[ RSA 4096]\u2014-+<br>\n|**B =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|o+.E =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|. = * .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n| + + o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|&nbsp; o . . S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|&nbsp;&nbsp;&nbsp;&nbsp; . .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>\n+\u2014\u2014\u2014\u2014\u2014\u2013+<br>\nmpkossen@ny:~$</p></blockquote><p>First, it asks you where you want to save the private key. The default is usually good, unless you want to change the name of the keyfile. If you want to put it somewhere custom, make sure you enter a full path and a filename (so no trailing slash). Then it asks you for your password, twice. Enter your <em>strong</em> password twice and you should be good. Finally, it generates the key and shows you some key information.</p><p>You just generated your own SSH key! Let\u2019s now set up ssh-agent so you don\u2019t have to type your password every time you log into a server.</p><h1>Setting up ssh-agent</h1><p>ssh-agent is a small program that holds private keys for as long as it runs. It helps you authenticate with servers which you are logging in to using public key authentication. On Ubuntu, ssh-agent runs by default and is nicely integrated into GNOME. This is not the case on many other systems, however.</p><p>So let\u2019s start ssh-agent by running the following command (this has to be done as the user owning the SSH key):</p><blockquote><p>eval $(ssh-agent)</p></blockquote><p>This will start ssh-agent as a background process and store the environment variables it outputs in your environment, by using eval. If we would not have used eval and just ran \u2018ssh-agent\u2019, the agent wouldn\u2019t have been available but would have just output the commands you would have to run for the agent to work.</p><p>This is what it will output using eval (the pid number varies, of course):</p><blockquote><p>mpkossen@ny:~$ eval $(ssh-agent)<br>\nAgent pid 579<br>\nmpkossen@ny:~$</p></blockquote><p>So, now the agent is up and running, let\u2019s add an SSH-key to it. For the default key, run:</p><blockquote><p>ssh-add</p></blockquote><p>Which will ask for your password and output:</p><blockquote><p>mpkossen@ny:~$ ssh-add<br>\nEnter passphrase for /home/mpkossen/.ssh/id_rsa:<br>\nIdentity added: /home/mpkossen/.ssh/id_rsa (/home/mpkossen/.ssh/id_rsa)<br>\nmpkossen@ny:~$</p></blockquote><p>ssh-add searched for default keynames, of which id_rsa is one, and adds them to the ssh-agent. Once you\u2019ve typed your password, the \u201cunlocked\u201d key is stored with ssh-agent and can be used to authenticate against other servers. Now try to log in to a server where you\u2019ve added the public key to. It shouldn\u2019t ask you for your password!</p><p>Now, doing this every time you open a terminal just to SSH into a server is a bit overkill. Therefore, you could consider starting ssh-agent with your bash session:</p><blockquote><p>echo \u2018eval $(ssh-agent)\u2019 &gt;&gt; ~/.bash_profile</p></blockquote><p>This will start ssh-agent every time you open a new bash terminal session.&nbsp; You would still have to run ssh-add manually, but that could also be done automatically after starting ssh-agent:</p><blockquote><p>echo \u2018ssh-add\u2019 &gt;&gt; ~/.bash_profile</p></blockquote><p>Which would add SSH key(s) once you log in (and ask for their password).</p><p>The above solutions are temporary, however. If you close the terminal, ssh-agent will still run but won\u2019t be available in a new terminal session. There are various solutions to handle this, but one I\u2019ve found to work quite well is one from Joseph M. Reagle: <a href=\"http://www.cygwin.com/ml/cygwin/2001-06/msg00537.html\">http://www.cygwin.com/ml/cygwin/2001-06/msg00537.html</a>. His script will detect a running agent and start one if no running one is found.</p><p>Another solution is using Keychain (<a href=\"http://www.funtoo.org/wiki/Keychain\">http://www.funtoo.org/wiki/Keychain</a>) which is a frontend for ssh-agent and ssh-add. I personally have no experience yet with Keychain, as Ubuntu has made me a little spoiled and lazy in this area. However, I\u2019ve read a lot of good things about Keychain and I know several people that use it.</p><h1>Final notes</h1><p>The recipe is there, for an easier and more secure SSH-life. Which solution suits your needs, however, is up to you. Do you always leave your terminal open? Then I wouldn\u2019t bother too much with adding a script to your bash login, but just run the commands once when you start the terminal. Closing and openings tabs, new terminals, etc.? Then I would definitely recommend either one of the two linked solutions.</p><p>Happy SSH-ing!</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fgenerate-ssh-key-setup-ssh-agent%2F&amp;t=Generating%20an%20SSH%20key%20and%20setting%20up%20SSH-agent\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Generating%20an%20SSH%20key%20and%20setting%20up%20SSH-agent&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fgenerate-ssh-key-setup-ssh-agent%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fgenerate-ssh-key-setup-ssh-agent%2F&amp;title=Generating%20an%20SSH%20key%20and%20setting%20up%20SSH-agent&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}