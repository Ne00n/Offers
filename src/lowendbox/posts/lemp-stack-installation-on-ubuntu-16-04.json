{"id": "20384", "post": "<div class=\"post-20384 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-firewall tag-lets-encrypt tag-mariadb tag-nginx tag-php tag-ubuntu-16-04 tag-vps\" id=\"post-20384\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/lemp-stack-installation-on-ubuntu-16-04/\" rel=\"bookmark\">LEMP Stack Installation on Ubuntu 16.04</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/firewall/\" rel=\"tag\">Firewall</a>, <a href=\"https://lowendbox.com/tag/lets-encrypt/\" rel=\"tag\">Let's Encrypt</a>, <a href=\"https://lowendbox.com/tag/mariadb/\" rel=\"tag\">mariadb</a>, <a href=\"https://lowendbox.com/tag/nginx/\" rel=\"tag\">nginx</a>, <a href=\"https://lowendbox.com/tag/php/\" rel=\"tag\">PHP</a>, <a href=\"https://lowendbox.com/tag/ubuntu-16-04/\" rel=\"tag\">Ubuntu 16.04</a>, <a href=\"https://lowendbox.com/tag/vps/\" rel=\"tag\">VPS</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> July 18, 2019 @ 12:09 pm, by Dusko Savic</div><div class=\"storycontent tablelook\"><p>This tutorial will show you how to install and configure the LEMP stack on your VPS/LowEndBox.</p><p><img data-lazyloaded=\"1\" src=\"https://lemp.io/app/uploads/lemp-stack-components.png\" loading=\"lazy\" class=\"litespeed-loading\" data-src=\"https://lemp.io/app/uploads/lemp-stack-components.png\" alt=\"\" width=\"249\" height=\"147\" data-was-processed=\"true\"></p><p>LEMP stands for <strong>L</strong>inux <strong>N</strong>ginx <strong>M</strong>ySQL <strong>P</strong>HP, and is a lightweight variation of the LAMP stack, which includes <strong>A</strong>pache instead of Nginx. You\u2019ll notice that it\u2019s not written as <em>LNMP</em>, and that\u2019s due to the pronunciation of the word <em>Nginx</em> (<strong>E</strong>ngine-X).</p><p><span id=\"more-20384\"></span></p><p>LEMP is more suitable for Low End Boxes and cheap VPS machines, because it consumes far less resources than the LAMP stack (even under heavy load) and is 2.5 times faster according to benchmarks. We are going to install <strong>MariaDB</strong> instead of MySQL as it is much faster, but still fully compatible with the original MySQL.</p><h2 id=\"whatwearegoingtocover\">What We Are Going To Cover</h2><ul><li>Installing Nginx</li><li>Nginx configuration basics</li><li>Setting up a Firewall</li><li>Installing and configuring MariaDB</li><li>Installing latest PHP</li><li>Configuring Nginx to serve PHP files</li><li>Testing the installed stack</li><li>(With a domain) Securing the site with Let\u2019s Encrypt certificates</li></ul><h2 id=\"prerequisites\">Prerequisites</h2><p>We will install and set up the LEMP stack on Ubuntu 16.04:</p><ul><li>Starting with a clean VPS with</li><li>At least 512Mb of RAM</li><li>15Gb of free disk space</li><li>You will need root user access</li><li>You must have DNS records for your your domain already set up to point to your VPS in order to install Let\u2019s Encrypt certificates. If you don\u2019t have one, access your IP address instead and skip the last step</li></ul><h2 id=\"step1installnginx\">Step 1: Install Nginx</h2><h3 id=\"installationandfirewallsetup\">Installation and Firewall Setup</h3><p>First, log in to your server as root or as an another account with sudo privileges. Then, update your package manager\u2019s cache:</p><pre><code>sudo apt update\n</code></pre><p>Install Nginx by running the following command:</p><pre><code>sudo apt install nginx -y\n</code></pre><p>You now have Nginx installed. Navigate to your domain (or IP address if you don\u2019t have one) in your browser. You\u2019ll see the following:</p><p><img data-lazyloaded=\"1\" src=\"https://i.imgur.com/widh8Nh.png\" loading=\"lazy\" class=\"litespeed-loaded\" title=\"Nginx default page\" data-src=\"https://i.imgur.com/widh8Nh.png\" alt=\"Nginx default page\" width=\"483\" height=\"196\" data-was-processed=\"true\"></p><p>which means that Nginx is started and works correctly. To make it start at every server boot, enable it via systemctl:</p><pre><code>systemctl enable nginx\n</code></pre><p>Every Ubuntu installation comes with the <em>ufw</em> (uncomplicated firewall) software preinstalled. For maximum security, you\u2019ll now configure it to allow HTTP, HTTPS, FTP and SSH connections, and to deny all others:</p><pre><code>sudo ufw allow OpenSSH\nsudo ufw allow SSH\nsudo ufw allow FTP\nsudo ufw allow 'Nginx HTTP'\nsudo ufw allow 'Nginx HTTPS'\n</code></pre><p>Make it active (enable it) by running:</p><pre><code>sudo ufw enable\n</code></pre><p>Answer <em>y</em> when asked, and refresh the site in your browser. If you still see the same welcome page, you have configured your firewall correctly. If it shows an error (such as Access Denied), disable the firewall:</p><pre><code>sudo ufw disable\n</code></pre><p>and check its configuration:</p><pre><code>sudo ufw status\n</code></pre><p>You\u2019ll see a list of enabled profiles. If you don\u2019t see the ones from above, rerun the commands and enable it again.</p><h3 id=\"configurationdirectories\">Configuration Directories</h3><p>On Ubuntu 16.04, Nginx stores its <strong>configuration</strong> files under <em>/etc/nginx</em>, and the default directory for serving static files is <em>/usr/share/nginx/html</em>. This will become important in the later steps, when we\u2019ll need to change the configuration.</p><h2 id=\"step2installingmariadb\">Step 2: Installing MariaDB</h2><p>Install MariaDB and its client:</p><pre><code>sudo apt install mariadb-server mariadb-client -y\n</code></pre><p>When the installation finishes, start it:</p><pre><code>sudo systemctl start mysql\n</code></pre><p>You\u2019ll notice that MariaDB responds to <em>mysql</em> commands. This is by design, to retain full compatibility with the original MySQL product.</p><p>Next, enable it via systemctl so it will automatically start on every server boot:</p><pre><code>sudo systemctl enable mysql\n</code></pre><p>After MariaDB installation, it is mandatory to run a script (called <em>mysql</em>secure<em>installation</em>) to secure the database:</p><pre><code>sudo mysql_secure_installation\n</code></pre><p>When it asks you for the current root password, press Enter, because that password has never been set. Then, enter a new password for the root user and answer <em>y</em> for anonymous user removal. If you plan on accessing the database from outside the server, answer <em>n</em> to the next question, otherwise type in <em>y</em>. Enter <em>y</em> for all questions that follow.</p><p>Try connecting with:</p><pre><code>sudo mysql -u root -p\n</code></pre><p>When prompted, enter the root password you just set.</p><p>You\u2019ll see the mysql prompt:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDAiIGhlaWdodD0iMTE3IiB2aWV3Qm94PSIwIDAgNTQwIDExNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"mysql command prompt\" data-src=\"https://i.imgur.com/Qg2dPN5.png\" alt=\"mysql command prompt\" width=\"540\" height=\"117\"></p><p>This means that MariaDB is installed and properly secured. Type in <em>exit</em> to quit the console.</p><h2 id=\"step3installingphp\">Step 3: Installing PHP</h2><p>You\u2019ll now install PHP 7.3, which was the latest at the time of writing. Install the following package so you\u2019ll be able to manage apt repositories:</p><pre><code>sudo apt install software-properties-common\n</code></pre><p>Then, add the <em>ondrej</em> PPA, which hosts latest PHP versions:</p><pre><code>sudo add-apt-repository ppa:ondrej/php\n</code></pre><p>Press Enter when prompted.</p><p>Pull in information about new packages:</p><pre><code>sudo apt update\n</code></pre><p>To install PHP 7.3, run:</p><pre><code>sudo apt install php7.3 php7.3-fpm -y\n</code></pre><p>The reason for specifying <em>php7.3-fpm</em> for installation is that the Apache web server will too get installed if it\u2019s omitted.</p><p>Then install additional PHP extensions that you will most likely need:</p><pre><code>sudo apt install php7.3-mysql php7.3-mbstring php7.3-dev php7.3-gd php-pear php7.3-zip php7.3-xml php7.3-curl -y\n</code></pre><p>Set PHP 7.3 you just installed as the default version:</p><pre><code>sudo update-alternatives --set php /usr/bin/php7.3\n</code></pre><p>Check the version of installed PHP:</p><pre><code>sudo php --version\n</code></pre><p>You\u2019ll see that the version is 7.3, as it should be.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2OTAiIGhlaWdodD0iNTQiIHZpZXdCb3g9IjAgMCA2OTAgNTQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" title=\"PHP version\" data-src=\"https://i.imgur.com/YMpu3CF.png\" alt=\"PHP version output\" width=\"690\" height=\"54\"></p><h2 id=\"step4configuringnginxtoservephpcontent\">Step 4: Configuring Nginx to Serve PHP Content</h2><p>PHP is installed and working correctly, but Nginx won\u2019t automatically use it, meaning that we will have to configure Nginx on our own. Before we do that, we\u2019ll fix a very insecure PHP settings called <em>cgi.fix_pathinfo</em>, which orders PHP to execute files that look like requested ones. By default it is set to <strong>1</strong> (which means enabled). If enabled, it allows bad actors to run malicious code on your server.</p><p>Open the PHP config file for editing:</p><pre><code>sudo nano /etc/php/7.3/fpm/php.ini\n</code></pre><p>Find the line</p><pre><code>;cgi.fix_pathinfo=1\n</code></pre><p>Replace it with</p><pre><code>cgi.fix_pathinfo=0\n</code></pre><p>then save and close the file. Note that two changes had to take place \u2013 removing the semicolon to uncomment the line, as well as changing 1 to 0.</p><p>Restart PHP for the changes to take effect:</p><pre><code>sudo systemctl restart php7.3-fpm\n</code></pre><p>With this you have mitigated a glaring security hole. We\u2019ll now configure Nginx to utilise PHP.</p><p>As noted in Step 1, Nginx stores its configuration files under <em>/etc/nginx</em>. Configuration that is currently enabled (which will be applied by Nginx) is stored in a folder named <em>sites-enabled</em>. Similarly, sites that are available, but are not enabled (and thus can not be accessed from the Internet), are stored in a folder named <em>sites-available</em>. We\u2019ll edit the configuration of the default enabled site.</p><p>Delete the default config file, because we won\u2019t be needing it:</p><pre><code>rm /etc/nginx/sites-enabled/default\n</code></pre><p>A copy of the default site config can be found at <em>/etc/nginx/sites-available/default</em>.</p><p>Create a new config file for editing:</p><pre><code>nano /etc/nginx/sites-enabled/default\n</code></pre><p>Paste in the following:</p><pre><code>server {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    root /var/www/html;\n\n    index index.php index.html index.htm index.nginx-debian.html;\n\n    server_name _;\n\n    location / {\n            try_files $uri $uri/ =404;\n    }\n\n    location ~ \\.php$ {\n           include snippets/fastcgi-php.conf;\n           fastcgi_pass unix:/run/php/php7.3-fpm.sock;\n    }\n\n    location ~ /\\.ht {\n           deny all;\n    }\n}\n</code></pre><p>Save and close the file.</p><p>The first part of the above config specifies that Nginx should listen to the HTTP port 80 for requests. Then it sets the root folder for serving files to <em>/var/www/html</em> (which is where you\u2019ll store your website files), and tells Nginx to first serve <em>index.php</em> (if it exists). If it does not exist, it falls back to <em>.html</em> files, as usual. The effect of this is that it will always try to first execute PHP code, and HTML only after.</p><p>The rest of the config shown tells Nginx how to call PHP when requested, and to deny access to <em>.htaccess</em> and similar files, which originate from the Apache web server and should not be served to users, despite not being used by Nginx.</p><p>Restart Nginx for the changes to take effect:</p><pre><code>sudo systemctl restart nginx\n</code></pre><p>Try reloading your site (or IP address) in your browser. You should see the same Nginx default welcome page, as before.</p><p>To test if PHP rendering is working, create a PHP file in <em>/var/www/html</em>:</p><pre><code>sudo nano /var/www/html/index.php\n</code></pre><p>Put the following into it:</p><pre><code>&lt;?php\n\nphpinfo();\n\n?&gt;\n</code></pre><p>Save and close the file.</p><p>The file shown above is a PHP script that calls the <em>phpinfo()</em> function, which will output very detailed information about the PHP installation.</p><p>Reload the site in your browser. This time, if all is well, you\u2019ll see a page similar to this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjIiIGhlaWdodD0iNTQ2IiB2aWV3Qm94PSIwIDAgNTYyIDU0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"phpinfo() output\" data-src=\"https://i.imgur.com/Co84es0.jpg\" alt=\"phpinfo() output\" width=\"562\" height=\"546\"></p><p>If you see a 502 Bad Gateway error, check the <em>fastcgi_pass</em> line in the above config (the PHP version may be different).</p><p>Be sure to remove the file immediately afterwards, because it reveals a lot of sensitive info:</p><pre><code>rm /var/www/html/index.php\n</code></pre><h2 id=\"step5securingyourdomainusingletsencrypt\">Step 5: Securing Your Domain Using Let\u2019s Encrypt</h2><p><strong>If you have a domain name</strong>, fully registered and pointed to your server, you can secure it using free Let\u2019s Encrypt TLS certificates, so you\u2019ll have HTTPS access and a green padlock will show next to your domain name in all browsers.</p><p>Let\u2019s Encrypt certificates will be generated and configured using <a href=\"https://certbot.eff.org/\">Certbot</a>, a free program created for this purpose.</p><p>To install Certbot, first add its PPA and the <em>universe</em> PPA:</p><pre><code>sudo add-apt-repository universe\nsudo add-apt-repository ppa:certbot/certbot\nsudo apt update\n</code></pre><p>Then, install Certbot:</p><pre><code>sudo apt install certbot python-certbot-nginx -y\n</code></pre><p>Once it is done, run Certbot:</p><pre><code>sudo certbot --nginx --rsa-key-size 4096\n</code></pre><p>Enter an email address you know you\u2019ll check, then agree to the terms of service by typing in <em>A</em>. Press <em>Y</em> if you want to subscribe to EFF\u2019s newsletter, and then input your domain name. Certbot will then ask you if you wish to redirect all traffic to HTTPS \u2013 you certainly do, so type in <em>2</em>.</p><p>You\u2019ll receive a congratulatory message, which means that your domain is now secured with free HTTPS certificates from Let\u2019s Encrypt. Refresh your domain in your browser one last time and observe the green padlock left of the site address, which means that the connection to your site is encrypted. If you want, you can run your site through the <a href=\"https://www.ssllabs.com/ssltest/\">SSL Server Test</a> and see that it will land you high marks.</p><p>Let\u2019s Encrypt certificates expire after 90 days, and Certbot will automatically renew them when it decides it is time (every 60 days by default), so you don\u2019t have to worry about them at all.</p><h2 id=\"whatyoucandonext\">What You Can Do Next</h2><p>You have now installed and configured a LEMP stack on your server. You can now host your PHP website(s) on it, and they will have access to a relational database (MariaDB). For example, you can install WordPress, Joomla, Drupal, Moodle, or any other PHP application that may need to access the database.</p><p>Dusko Savic is a technical writer and programmer.</p><p><a href=\"https://duskosavic.com/blog/\">duskosavic.com</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Flemp-stack-installation-on-ubuntu-16-04%2F&amp;t=LEMP%20Stack%20Installation%20on%20Ubuntu%2016.04\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=LEMP%20Stack%20Installation%20on%20Ubuntu%2016.04&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Flemp-stack-installation-on-ubuntu-16-04%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Flemp-stack-installation-on-ubuntu-16-04%2F&amp;title=LEMP%20Stack%20Installation%20on%20Ubuntu%2016.04&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">19</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/lowendprotection-homemade-raspberry-pi-security-cloud-camera-setup/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/07/rpi_security1-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-nameservers-on-a-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Nameservers on a VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-setup-nameservers-on-a-vps-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Nameservers on a VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-configure-reverse-proxy-with-nginx/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Configure Reverse Proxy with NGINX\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Configure Reverse Proxy with NGINX</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}