{"id": "22505", "post": "<div class=\"post-22505 post type-post status-publish format-standard hentry category-tutorials tag-backend tag-nginx tag-reverseproxy tag-tutorial\" id=\"post-22505\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-configure-reverse-proxy-with-nginx/\" rel=\"bookmark\">How to Configure Reverse Proxy with NGINX</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/backend/\" rel=\"tag\">backend</a>, <a href=\"https://lowendbox.com/tag/nginx/\" rel=\"tag\">nginx</a>, <a href=\"https://lowendbox.com/tag/reverseproxy/\" rel=\"tag\">reverseproxy</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> October 5, 2020 @ 10:07 am, by Jon Biloh</div><div class=\"storycontent tablelook\"><p><a href=\"https://lowendbox.com\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMTY5IiB2aWV3Qm94PSIwIDAgMzAwIDE2OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"screenshot\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-300x169.png.webp\" alt=\"\" width=\"300\" height=\"169\"></a></p><p>NGINX is a light-weight web server first released in 2004 which can also be used as a reverse proxy. We have made many tutorials over NGINX at LowEndBox, and recently <a href=\"https://lowendbox.com/blog/how-to-set-up-a-node-js-application-for-production-on-a-debian-9-vps/\">setup a Node.js Application</a>, it also used NGINX as its reverse proxy, but it used an NPM package to generate the app-specific configurations.</p><p>In this tutorial, we\u2019ll configure NGINX to Reverse Proxy from an Apache backend hosted on a local port just for an example. In general, Reverse Proxy is helpful if you have a hard-coded application (like Plex, Webmin, etc) which listens on a non-default default port (i.e. not on port 80 / 443), or you are already using the HTTP ports with NGINX web server and cannot assign those ports to another application.</p><p><span id=\"more-22505\"></span></p><p>Sometimes, these kinds of configurations are also done where the web application is only compatible with a specific webserver like Apache due to custom rewrites support, and NGINX is used in front-end for its low memory footprint and ability to cache static content. This kind of setup is seen in VestaCP\u2019s default installation too.</p><p><strong>Requirements:</strong></p><ol><li>We will use Ubuntu 18.04 for this tutorial, but it can also be done similarly in Debian or CentOS.</li><li>A domain name or subdomain\u2019s A record pointing to the IP of the VPS.</li><li>We will use nano text editor, you can also use vim or choose to edit the configurations via SFTP on a local editor like Notepad++.</li></ol><p><strong>Step 1: Install Apache as a Backend</strong></p><p>Again, we are installing Apache only as an example, your backend can be any application as per the requirement.</p><p>Let\u2019s install apache2 with apt</p><blockquote><p>apt install apache2 -y</p></blockquote><p>After installing, the apache webserver should now listen on port 80, we can verify it by going to our server IP or the domain we pointed to our server\u2019s IP.</p><p><a href=\"https://cdn.diamondzxd.com/index.php/s/8qeebdjmq4m88kr/preview\">https://cdn.diamondzxd.com/index.php/s/8qeebdjmq4m88kr/preview</a></p><p>Changing Apache\u2019s Ports</p><p>Since the HTTP ports will be taken over by NGINX server in the future, we\u2019ll change apache\u2019s ports, we can change apache\u2019s ports by editing the Apache\u2019s ports.conf file :</p><blockquote><p>nano /etc/apache2/ports.conf</p></blockquote><p>We\u2019ll change the default HTTP port to 8080 and 8443</p><blockquote><p>Listen 8080</p><p>&lt;IfModule ssl_module&gt;</p><p>Listen 8443</p><p>&lt;/IfModule&gt;</p><p>&lt;IfModule mod_gnutls.c&gt;</p><p>Listen 8443</p><p>&lt;/IfModule&gt;</p></blockquote><p>Now, let\u2019s restart the apache web-server to see changes.</p><blockquote><p>service apache2 restart</p></blockquote><p>As you can see, apache now listens on port 8080</p><p><a href=\"https://cdn.diamondzxd.com/index.php/s/swk87TWYb56dfFT/preview\">https://cdn.diamondzxd.com/index.php/s/swk87TWYb56dfFT/preview</a></p><p><strong>Step 2: Installing NGINX webserver</strong></p><blockquote><p>apt install nginx -y</p></blockquote><p>When you install NGINX and go to your Server\u2019s IP, you will see default Apache\u2019s page again. But don\u2019t worry, that\u2019s due to the fact that both webservers are sharing the /var/www/html directory as we can verify from the NGINX\u2019s config file /etc/nginx/sites-enabled/default :</p><blockquote><p>root /var/www/html;</p></blockquote><p><a href=\"https://cdn.diamondzxd.com/index.php/s/JdpSryAACbGd2M8/preview\">https://cdn.diamondzxd.com/index.php/s/JdpSryAACbGd2M8/preview</a></p><p>Instead of displaying index.nginx-debian.html, it is displaying index.html because it is first in the config\u2019s directory index.</p><p><strong>Step 3: Adding Additional Headers to Apache</strong></p><p>Although this is not necessary and not required to achieve what we\u2019re doing, but just for a demonstration, we will add an Additional \u201cServerd-By : Backend\u201d header to see that the content is actually being served by our Backend, and even after reverse proxies the original header will show.</p><p>To do that, simply add the following lines to the apache2.conf</p><blockquote><p>nano /etc/apache2/apache2.conf</p><p>&lt;IfModule mod_headers.c&gt;</p><p>&lt;Directory /&gt;</p><p>Header always set Served-By \u201cBackend\u201d</p><p>&lt;/Directory&gt;</p><p>&lt;/IfModule&gt;</p></blockquote><p>Activate the apache\u2019s headers mod and restart apache webserver.</p><blockquote><p>a2enmod headers</p><p>service apache2 restart</p></blockquote><p>Let\u2019s go to SERVER_IP:8080 and verify those headers.</p><p><a href=\"https://cdn.diamondzxd.com/index.php/s/YBcBLBKHJ2EjBtD/preview\">https://cdn.diamondzxd.com/index.php/s/YBcBLBKHJ2EjBtD/preview</a></p><p>As you can see, the Served-By : Backend header is present.</p><p><strong>Step 4 : Configuring Reverse Proxy</strong></p><p>Now that the backend is setup, it\u2019s time to finally configure reverse proxy.</p><p>First, we\u2019ll remove the default configuration file.</p><blockquote><p>unlink /etc/nginx/sites-enabled/default</p></blockquote><p>Then, add our new config to the <em>/etc/nginx/sites-enabled</em> directory</p><blockquote><p>nano /etc/nginx/sites-enabled/reverse_proxy</p></blockquote><p>&nbsp;</p><blockquote><p>server {</p><p>listen &nbsp; 80;</p><p>server_name &nbsp;DOMAIN_NAME;</p><p>location / {</p><p>proxy_pass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href=\"http://YOUR_SERVER_IP:8080\">http://YOUR_SERVER_IP:8080</a>;</p><p>}</p><p>}</p></blockquote><p>&nbsp;</p><p>Replace the DOMAIN_NAME with the actual FQDN you wish to use and YOUR_SERVER_IP with the server IP:PORT or location to your backend.</p><p>Then, finally restart NGINX webserver.</p><blockquote><p>service nginx restart</p></blockquote><p>&nbsp;</p><p><strong>Verifying the Proxy</strong></p><p>Let\u2019s go to our intended domain name, we\u2019ll find the index.html file being served which was in /var/www/html directory: <a href=\"https://cdn.diamondzxd.com/index.php/s/T4WG6RNsgq9E7DB/preview\">https://cdn.diamondzxd.com/index.php/s/T4WG6RNsgq9E7DB/preview</a></p><p>&nbsp;</p><p>Okay, we see the index.html, but is it really being served by Our Backend? To verify that, lets inspect the headers: <a href=\"https://cdn.diamondzxd.com/index.php/s/pmBCxZWe8sFDeyQ/preview\">https://cdn.diamondzxd.com/index.php/s/pmBCxZWe8sFDeyQ/preview</a></p><p>&nbsp;</p><p>Indeed, the Served-By : Backend header we set in Apache, is now being displayed through NGINX, which can confirm that the Reverse Proxy is working!</p><p>You can also try to stop Apache (Backend), and see what follows</p><blockquote><p>service apache2 stop</p></blockquote><p><a href=\"https://cdn.diamondzxd.com/index.php/s/RRJBf75atX8NgFf/preview\">https://cdn.diamondzxd.com/index.php/s/RRJBf75atX8NgFf/preview</a></p><p>&nbsp;</p><p>As expected, since the backend is now down, we get a 502 Bad Gateway error, which further verifies that the content is serving through Reverse Proxy J</p><p>Let\u2019s restart the backend,</p><blockquote><p>service apache2 start</p></blockquote><p><a href=\"https://cdn.diamondzxd.com/index.php/s/BN7w3nFfEtBgbjw/preview\">https://cdn.diamondzxd.com/index.php/s/BN7w3nFfEtBgbjw/preview</a></p><p>And the site comes back up!</p><p>&nbsp;</p><p><strong>Conclusion</strong></p><p>We have shown your how to configure Reverse Proxy with NGINX over Apache (or any Backend) on a Ubuntu 18.04 VPS. You can do this parallel with your Other NGINX websites on your VPS.</p><p>We hope you like this tutorial!</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-configure-reverse-proxy-with-nginx%2F&amp;t=How%20to%20Configure%20Reverse%20Proxy%20with%20NGINX\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20to%20Configure%20Reverse%20Proxy%20with%20NGINX&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-configure-reverse-proxy-with-nginx%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-configure-reverse-proxy-with-nginx%2F&amp;title=How%20to%20Configure%20Reverse%20Proxy%20with%20NGINX&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">3</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/managing-your-lowendempire-with-ansible-part-1/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Managing Your LowEndEmpire With Ansible, Part 1\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Managing Your LowEndEmpire With Ansible, Part 1</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Setup a DNS Nameserver Using NSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Setup a DNS Nameserver Using NSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/jbiloh/\" title=\"All posts by Jon Biloh\" rel=\"author\">Jon Biloh</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/f766d6dc4b5f406b9f3cb0339d48de95?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/f766d6dc4b5f406b9f3cb0339d48de95?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/jbiloh\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"http://Jbiloh\" class=\"bio-icon bio-icon-twitter\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/jon-biloh-4b32598/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\">I'm Jon Biloh and I own LowEndBox and LowEndTalk. I've spent my nearly 20 year career in IT building companies and now I'm excited to focus on building and enhancing the community at LowEndBox and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}