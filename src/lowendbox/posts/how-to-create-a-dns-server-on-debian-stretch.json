{"id": "19723", "post": "<div class=\"post-19723 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-bind tag-debian tag-dns tag-tutorials-2\" id=\"post-19723\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\" rel=\"bookmark\">How To Create a DNS Server On Debian Stretch</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/bind/\" rel=\"tag\">bind</a>, <a href=\"https://lowendbox.com/tag/debian/\" rel=\"tag\">debian</a>, <a href=\"https://lowendbox.com/tag/dns/\" rel=\"tag\">DNS</a>, <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> June 27, 2019 @ 8:00 am, by Liam</div><div class=\"storycontent tablelook\"><p>The DNS or <em>D</em>omain <em>N</em>ame <em>S</em>ystem is the distributed database that allows zone records, such as IP addresses, to be associated with domain names. When a computer, such as your laptop or phone, needs to communicate with a remote computer, such as a web server, over the internet they use each others IP addresses. People are not very good at remembering IP addresses but they are good at remembering the words and phrases in domain names. The DNS system allows people to use domain names when they interface with computers whilst still allowing computers to use IP addresses when they communicate.</p><p>In this guide, we will examine how you can install and configure a DNS server that will be the authoritative DNS server for your domain names. This will allow you to have complete control over your DNS information and make immediate changes to your DNS records whenever you need to make them.</p><p><span id=\"more-19723\"></span></p><h2><a id=\"Requirements_4\"></a>Requirements</h2><p>In order to follow this guide you will need:</p><ul><li>A Debian Stretch server.</li><li>A domain name.</li><li>A non-root sudo enabled user on the server.</li></ul><p>In order to begin this guide, you must log into your server as the non-root user.</p><h2><a id=\"Installation_12\"></a>Installation</h2><p>The DNS server that we will use in this guide is <a href=\"https://www.isc.org/downloads/bind/\">BIND</a>. BIND is the most deployed and one of the oldest DNS servers in use on the internet.</p><p>Before we install BIND you should ensure that your server up-to-date with the latest packages:</p><pre><code class=\"language-sh\">sudo apt update\nsudo apt upgrade\n</code></pre><p>BIND is available from the default Debian repositories and is installed with the following command:</p><pre><code class=\"language-sh\">sudo apt install <span class=\"hljs-built_in\">bind</span>9 <span class=\"hljs-built_in\">bind</span>9utils <span class=\"hljs-built_in\">bind</span>9-doc dnsutils\n</code></pre><p>BIND is now installed so we can move on to configuring it.</p><h2><a id=\"Global_BIND_Settings_29\"></a>Global BIND Settings</h2><p>Making BIND function as a DNS server falls into two parts. The first is setting the global parameters which will make BIND function in the manner we desire. The second is to create the domain-specific DNS information that BIND will serve. This information is known as \u201czone information\u201d or \u201czone records\u201d.</p><p>In this section, we will configure the global parameters.</p><p>The first configuration file that we will edit is located at <code>/etc/bind/named.conf.options</code> and configures how bind will operate. Open this file with your favorite text editor, here <code>nano</code> is used:</p><pre><code class=\"language-sh\">sudo nano /etc/<span class=\"hljs-built_in\">bind</span>/named.conf.options\n</code></pre><p>Edit <code>named.conf.options</code> so that it looks like the following:</p><pre><code>options {\n        directory \"/var/cache/bind\";\n        auth-nxdomain no;\n        listen-on port 53 { any; };\n        recursion no;\n};\n</code></pre><p>The options used here mean as follows:</p><ul><li><em>directory</em> \u2013 This sets a filesystem path variable. It does not need to be changed.</li><li><em>auth-nxdomain no</em> \u2013 BIND will not answer authoritatively for domains that are not configured on this server.</li><li><em>listen-on port 53 { any; };</em> \u2013 This sets the port that BIND will listen on for incoming DNS requests. Port 53 is the default DNS port. The <em>any</em> options is used here instead of an IP address. This instructs BIND to attach to all available interfaces, private and public.</li><li><em>recursion no</em> \u2013 This option configures BIND to only respond with information about domains that it has configuration files for. If this is set to <code>yes</code> then BIND will become a recursive DNS which means it will look up any request it receives a request for like Google\u2019s recursive server at <code>8.8.8.8</code>. This should <em>always</em> be set to <code>no</code> when BIND is also configured to respond to requests from any IP as we have set it up above for security reasons. This is because it can be used for DNS amplification attacks or other nefarious purposes.</li></ul><p>The second configuration file we will create sets which domains BIND is responsible for and where the files that contain their zone information are located. Open this file with a text editor:</p><pre><code class=\"language-sh\">sudo nano /etc/<span class=\"hljs-built_in\">bind</span>/named.conf.local\n</code></pre><p>Edit this file so that it looks like:</p><pre><code>zone    \"exmaple.com\"   {\n        type master;\n        file    \"/etc/bind/forward.example.com\";\n };\n\nzone   \"10.100.51.198.in-addr.arpa\"  {\n       type master;\n       file    \"/etc/bind/reverse.example.com\";\n };\n</code></pre><p>The lines in this file mean as follows:</p><ul><li><em>zone</em> \u2013 This is the domain name or IP address that BIND will answer requests for.</li><li><em>type master</em> \u2013 BIND will read the zone information from the local storage and provides authoritative information for the domain listed on the <em>zone</em> line.</li><li><em>file</em> \u2013 The file that contains the zone information.</li></ul><p>As you can see there are two sections to this file that have the same syntax. The first section lists the domain (<a href=\"http://example.com\">example.com</a>) and is the so-called, forward DNS record. This means that it will convert domain information to IP addresses.</p><p>The second is the reverse or PTR record of the server\u2019s IP address. This converts in the opposite direction, i.e. IP addresses to domain names. The <em>zone</em> line for the reverse record looks a little strange because the IP address is in reverse. The IP address that this is the reverse record for is <em>198.51.100.10</em>.</p><p>Reverse records are important to have because many security systems such as spam filters will be less likely to accept mail sent from an IP address that has no reverse record.</p><p>Now that BIND\u2019s global configuration is set we can create the zone files that will hold the forward and reverse DNS information.</p><h2><a id=\"Zone_File_Configuration_86\"></a>Zone File Configuration</h2><p>The first zone file that we will create is the forward information for the domain name. Open and create the file with a text editor:</p><pre><code class=\"language-sh\">sudo nano /etc/<span class=\"hljs-built_in\">bind</span>/forward.example.com\n</code></pre><p>And use the following as your template:</p><pre><code>$TTL 1d\n@               IN      SOA     dns1.example.com.    hostmaster.example.com. (\n                1        ; serial\n                6h       ; refresh after 6 hours\n                1h       ; retry after 1 hour\n                1w       ; expire after 1 week\n                1d )     ; minimum TTL of 1 day\n;\n;\n;Name Server Information \n@               IN      NS      ns1.example.com.\nns1             IN      A       198.51.100.10\n;\n;\n;Mail Server Information\nexample.com.    IN      MX      10      mail.example.com.\nmail            IN      A       198.51.100.20\n;\n;\n;Additional A Records:   \nwww             IN      A       198.51.100.30\nsite            IN      A       198.51.100.30\n;\n;\n;Additional CNAME Records:\nslave           IN      CNAME   www.example.com.\n</code></pre><p>The first configuration block beginning <em>$TTL 1d</em> has only a single line that you need to edit by changing the domain to your domain:</p><pre><code>example.com.    IN      SOA     dns1.example.com.    hostmaster.example.com. (\n</code></pre><p>This line means from left to right:</p><ul><li><em>@</em> \u2013 This is replaced with the domain from the <code>named.conf.local</code> file i.e. <em><a href=\"http://example.com\">example.com</a>.</em></li><li><em>IN</em> \u2013 The type of record, in this case, <em>IN</em>ternet records.</li><li><em>SOA</em> \u2013 The record is the <em>S</em>tart <em>O</em>f <em>A</em>uthority record. This is the authoritative record for this domain.</li><li><em><a href=\"http://dns1.example.com\">dns1.example.com</a>.</em> \u2013 The nameserver where the DNS records are found.</li><li><em><a href=\"http://hostmaster.example.com\">hostmaster.example.com</a>.</em> \u2013 The email address of the administrator of the nameserver. The <em>@</em> symbol is replaced with a dot.</li></ul><p>The rest of the lines here set values such as <em>T</em>ime <em>T</em>o <em>L</em>ive\u2019s which you can copy from the example.</p><p>You should note the dots at end of the domains and hostnames e.g. <em><a href=\"http://example.com\">example.com</a>.</em> This final dot stops the domain getting added automatically. We want this to happen with, for example, the <em>www\u2019s</em> in the following line <em><code>www IN A 198.51.100.10</code></em> as this will resolve <em><a href=\"http://www.example.com\">www.example.com</a></em> to the IP address.</p><p>The next section \u2013 <em>Name Server Information</em> \u2013 is mandatory and should be edited to use the hostname of this nameserver and its IP address. It is customary to label the first nameserver <code>ns1.domain.com</code> but you can choose any hostname you want.</p><p>The remaining sections are optional and are included as examples. The first of these, <em>Mail Server Information</em>, is an example of how an email will get sent to an email server at the IP <em>198.51.100.20</em>. <em>MX</em> records should always resolve to hostnames so the required <em>A</em> record for <em><a href=\"http://mail.example.com\">mail.example.com</a></em> is included in the mail records section for ease of understanding.</p><p>The final two sections are further examples of <em>A</em> and <em>CNAME</em> records.</p><p>Next, we need to create a reverse zone file. Open and create the file with a text editor:</p><pre><code class=\"language-sh\">sudo nano /etc/<span class=\"hljs-built_in\">bind</span>/reverse.example.com\n</code></pre><p>Use the following example as your template:</p><pre><code>$TTL 1d\n@               IN      SOA     dns1.example.com.    hostmaster.example.com. (\n                1        ; serial\n                6h       ; refresh after 6 hours\n                1h       ; retry after 1 hour\n                1w       ; expire after 1 week\n                1d )     ; minimum TTL of 1 day\n;\n;\n;Name Server Information \n@               IN      NS      ns1.example.com.\nns1             IN      A       198.51.100.10\n;\n;\n;Reverse IP Information\n10.100.51.198.in-addr.arpa.      IN      PTR       ns1.example.com.\n20.100.51.198.in-addr.arpa.      IN      PTR       mail.example.com.\n30.100.51.198.in-addr.arpa.      IN      PTR       www.example.com.\n</code></pre><p>The first two sections are the same as the forward zone file. The last section is where the reverse maps are configured.</p><p>The IP is set down in the backward format with the hostname you want it to resolve to at the end of the line. Here the reverse maps are set for all three IP addresses used in the forward zone file as examples.</p><h2><a id=\"Check_Your_Configuration_For_Errors_176\"></a>Check Your Configuration For Errors</h2><p>BIND provides a pair of tools to check that its configuration files do not contain any errors that would prevent BIND from starting.</p><p>The first checks the global configuration files and is used as follows:</p><pre><code class=\"language-sh\">sudo named-checkconf /etc/<span class=\"hljs-built_in\">bind</span>/named.conf.options\nsudo named-checkconf /etc/<span class=\"hljs-built_in\">bind</span>/named.conf.local\n</code></pre><p>The second tool will check the zone files and is used as follows:</p><pre><code class=\"language-sh\">sudo named-checkzone &lt;DOMAIN-NAME&gt; &lt;ZONE-FILE&gt;\ne.g.\nsudo named-checkzone example.com /etc/<span class=\"hljs-built_in\">bind</span>/forward.example.com\n</code></pre><p>When you have finished editing these files and they do not throw any errors when you check BIND must be restarted and enabled so that it starts on boot:</p><pre><code class=\"language-sh\">sudo systemctl <span class=\"hljs-built_in\">enable</span> <span class=\"hljs-built_in\">bind</span>9.service\nsudo systemctl restart <span class=\"hljs-built_in\">bind</span>9.service\n</code></pre><h2><a id=\"Configure_Systemd_To_Keep_BIND_Running_198\"></a>Configure Systemd To Keep BIND Running</h2><p>When you start using your own nameservers for your domain it is critical that it keeps running. If it stops then anything that uses your domain e.g. email, website etc will stop working. Systemd is the program that, amongst other services, starts and stops programs like BIND on your server. In addition to starting and stopping it can be configured to ensures that a program is re-started if it stops for any reason.</p><p>First, make a copy of the BIND systemd service file that we will edit:</p><pre><code class=\"language-sh\">sudo cp /lib/systemd/system/<span class=\"hljs-built_in\">bind</span>9.service /etc/systemd/system/\n</code></pre><p>This will ensure that the edits will not be lost in future system updates. Next, open the file in an editor:</p><pre><code class=\"language-sh\">sudo nano /etc/systemd/system/<span class=\"hljs-built_in\">bind</span>9.service\n</code></pre><p>And add the following two lines to the <code>[Service]</code> section:</p><pre><code>Restart=always\nRestartSec=3\n</code></pre><p>Then prompt Systemd to reload all its service files:</p><pre><code class=\"language-sh\">sudo systemctl daemon-reload\n</code></pre><p>And restart BIND:</p><pre><code>sudo systemctl restart bind9.service\n</code></pre><p>Now, if BIND stop running for any reason, systemd will restart it again automatically.</p><h2><a id=\"Testing_The_DNS_Server_229\"></a>Testing The DNS Server</h2><p>Before you begin using your new DNS server you need to test that it works correctly i.e. BIND serves the correct DNS information for your domain.</p><p>The DNS inspection tool <code>dig</code> was included with the packages we installed at the beginning of this guide. <code>dig</code> is one of the powerful and flexible DNS testing and investigation command line tools available on Linux and should be your goto tool for looking up DNS records.</p><p><code>dig</code> has the ability to ignore the system configured resolvers (set in <code>/etc/resolv.conf</code>) and request DNS information directly from a nameserver i.e. the DNS server you have just created.</p><p>The syntax of a <code>dig</code> query is as follows:</p><pre><code class=\"language-sh\">dig @&lt;DNS SERVER&gt; -t &lt;RECORD TYPE&gt; &lt;HOST&gt;\n</code></pre><p>If we replace this information with the details of the example server in this guide we get:</p><pre><code class=\"language-sh\">dig @<span class=\"hljs-number\">198.51</span>.<span class=\"hljs-number\">100.10</span> -t A www.example.com.\n</code></pre><p>This will return quite a bit of information. The result that we are interested in is always contained in the <code>ANSWER SECTION</code> e.g.:</p><pre><code>;; ANSWER SECTION:\nexample.com.         86400   IN      A       198.51.100.30\n</code></pre><p>We can also check the reverse map record by using the <code>-x</code> flag:</p><pre><code>dig @198.51.100.10 -x 198.51.100.10\n</code></pre><p>Which will produce the result:</p><pre><code>;; ANSWER SECTION:\n10.100.51.198.in-addr.arpa.      IN      PTR       ns1.example.com.\n</code></pre><p>You can perform similar queries against all of the zone records you have created for your domain. When they all return the correct information you are ready to start using your DNS server.</p><h2><a id=\"Conclusion_266\"></a>Conclusion</h2><p>You have now successfully installed, configured and tested your own DNS server you are now ready to start using it. In order to do this, you will need to transfer your domain to your DNS server. This is done with the company that registered your domain for you. When you log into their site you will find somewhere in their control panel an option to transfer the domain to new authoritative nameservers.</p><p>Some companies require that a domain has more than one authoritative nameserver. In this guide, we only created one, i.e. <code>ns1.example.com</code>. If an additional nameserver is required then you need to obtain a second virtual machine and copy the configuration substituting <code>ns2</code> for <code>ns1</code>.</p><p>Alternatively, you can request a second IP address for your existing server and duplicate the <code>ns1</code> records changing them to <code>ns2</code>.</p><p>&nbsp;</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-create-a-dns-server-on-debian-stretch%2F&amp;t=How%20To%20Create%20a%20DNS%20Server%20On%20Debian%20Stretch\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20To%20Create%20a%20DNS%20Server%20On%20Debian%20Stretch&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-create-a-dns-server-on-debian-stretch%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-create-a-dns-server-on-debian-stretch%2F&amp;title=How%20To%20Create%20a%20DNS%20Server%20On%20Debian%20Stretch&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Setup a DNS Nameserver Using NSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Setup a DNS Nameserver Using NSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-nameservers-on-a-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Nameservers on a VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-setup-nameservers-on-a-vps-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Nameservers on a VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-run-a-tor-node-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Run a TOR Node on Your VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/07/tor2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Run a TOR Node on Your VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/liam/\" title=\"All posts by Liam\" rel=\"author\">Liam</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/2a78fb56721359b1d81ed05edb5a734f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/2a78fb56721359b1d81ed05edb5a734f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"http://www.lowendbox.com\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}