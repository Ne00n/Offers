{"id": "19245", "post": "<div class=\"post-19245 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-cakephp tag-ubuntu\" id=\"post-19245\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-set-up-cakephp-for-production-ubuntu-16-04/\" rel=\"bookmark\">How To Set Up CakePHP For Production: Ubuntu 16.04</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/cakephp/\" rel=\"tag\">cakephp</a>, <a href=\"https://lowendbox.com/tag/ubuntu/\" rel=\"tag\">ubuntu</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> May 13, 2019 @ 11:00 am, by Dusko Savic</div><div class=\"storycontent tablelook\"><h1 id=\"howtosetupcakephpforproductionubuntu1604\">How To Set Up CakePHP For Production: Ubuntu 16.04</h1><p>We shall assume that you <a href=\"http://lowendbox.com/blog/how-to-install-cakephp-on-ubuntu-16-04-vps\">have developed a CakePHP app on the server</a> and that you are going to launch it as a product. To bring your app to the production level, you\u2019ll need to</p><ul><li><em>Clean</em> up the code,</li><li><em>Increase</em> security by enabling Security and CSRF components, and</li><li><em>Set up</em> the app on the server correctly.</li></ul><p><span id=\"more-19245\"></span></p><h2 id=\"cleaningupthecode\">Cleaning Up the Code</h2><h3 id=\"disabledebugmode\">Disable Debug Mode</h3><p>Every installation of CakePHP comes with the Debug mode enabled and virtually all programmers use it. Debug mode set to <em>false</em> is the way to go in production, to prevent leaking of sensitive info.</p><p>To disable Debug mode, open the config file for editing:</p><pre><code>sudo nano config/app.php\n</code></pre><p>and find the line where the debug variable is mentioned, at the top of the file. Set its value to <em>false</em>, like this:</p><pre><code>'debug' =&gt; filter_var(env('DEBUG', false), FILTER_VALIDATE_BOOLEAN),\n</code></pre><p>Save the file and refresh the site in your browser. In case you have a brand new app, this is the screen you are going to see:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1ODciIGhlaWdodD0iMTM3IiB2aWV3Qm94PSIwIDAgNTg3IDEzNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone wp-image-19318\" data-src=\"http://lowendbox.com/wp-content/uploads/2019/05/cakephp_debug_error-300x70.png.webp\" alt=\"\" width=\"587\" height=\"137\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2019/05/cakephp_debug_error-300x70.png.webp 300w, https://lowendbox.com/wp-content/uploads/2019/05/cakephp_debug_error-768x179.png.webp 768w, https://lowendbox.com/wp-content/uploads/2019/05/cakephp_debug_error.png 980w\" data-sizes=\"(max-width: 587px) 100vw, 587px\"></p><p>This page, located under <em>src/Template/Pages/home.ctp</em>, is the homepage. This is the place to introduce the site or redirect the user to another page. The following code will save the existing home.ctp file, in case you want to bring it back later, and will create an empty file so that you can put the appropriate code into it.</p><p>Execute this from command line:</p><pre><code>cd /var/www/html/cakeapp/src/Template/Pages/\nmv home.ctp home_old.ctp\ntouch home.ctp\nsudo nano /var/www/html/cakeapp/src/Template/Pages/home.ctp\n</code></pre><p>Command <em>mv</em> renames the existing file, <em>touch</em> creates a new file with the same name, only empty. It then opens the editor so you can put the following code into it:</p><pre><code>&lt;?php\necho '&lt;script&gt;window.location='https://google.com';&lt;/script&gt;\n?&gt;\n</code></pre><p>That will redirect the app to Google.com but in real life, you will redirect it to one of the pages on your own site.</p><h3 id=\"settinguppasswordsinsetenvvariables\">Setting Up Passwords in SetEnv Variables</h3><p>Environment variables on Apache HTTP Server store information in named variables that are available in PHP and CakePHP code. Normal usage of environment variables would be to control logging or access to certain pages on the site. You can also set a value for Debug as SetEnv and dynamically check it in the app. The following goes to the Apache configuration file:</p><pre><code>SetEnv CAKEPHP_DEBUG 1\n</code></pre><p>and then you can check it out in the app.php file:</p><pre><code>$debug = (bool)getenv('CAKEPHP_DEBUG');\nreturn [\n    'debug' =&gt; $debug,\n    .....\n];\n</code></pre><p><em>SetEnv</em> can also store sensitive data such as passwords. Then, the passwords would be available in code, but not through text in source code of the app, which adds another level of security.</p><h3 id=\"clearthecachebeforeyoubegin\">Clear the Cache Before You Begin</h3><p>Cached files in CakePHP may reach hundreds of MB and will slow the app down. Before you go to production, be sure to execute this command from your app directory:</p><pre><code>bin/cake schema_cache clear\n</code></pre><p>You should also issue this command whenever you change any data structure in any of the databases and tables, otherwise CakePHP will not take them into account.</p><p>NOTE: Once in production, use the <a href=\"https://book.cakephp.org/3.0/en/migrations.html\">Migration tool</a> to change database schemas.</p><h3 id=\"modelsshouldhavethecorrectvalidationrulesenabled\">Models Should Have the Correct Validation Rules Enabled</h3><p>Model classes in directory /Model/Table contain code for logic validation of input in forms. There will be two functions in those files, <em>validationDefault</em> and <em>buildRules</em> and here is what they do.</p><p><em>validationDefault</em> will have an entry like this:</p><pre><code>$validator\n            -&gt;requirePresence('username', 'create')\n            -&gt;notEmpty('username');\n</code></pre><p>which means that for input field called <em>username</em>, when you press Save on the Form, the field must not be empty. If it is empty, an error will be shown and the data will not be saved to the database, but will instead be presented to the user again.</p><p><em>buildRules</em> may look like this:</p><pre><code>        $rules-&gt;add($rules-&gt;isUnique(['email']));\n        $rules-&gt;add($rules-&gt;existsIn(['user_id'], 'Users'));\n</code></pre><p><em>isUnique</em> means that the email address entered must be unique in the database and if there is a match, a message will be shown to the user and the form data will not be saved.</p><p><em>existsIn</em> means that the value entered must be present in table Users and if it is not there, an error message will be shown and the form will not be saved.</p><p>You can turn off all these validators, by just commenting them out. Do it at your own risk, because it opens up the possibility of entering data in inappropriate formats.</p><p>Learn more about Validators from the <a href=\"https://book.cakephp.org/3.0/en/core-libraries/validation.html\">official documenation page</a>.</p><h2 id=\"improvesecurityofyourcakephpapp\">Improve Security of Your CakePHP App</h2><h3 id=\"activatethecrosssiterequestforgerycomponent\">Activate the Cross Site Request Forgery Component</h3><p>Once in the wild, your app can become an object of attack, mostly by automated software. <em>Cross Site Request Forgery</em> is a common attack performed on web apps and if successful, can lead to the equivalent of online robbery.</p><p>The protection mechanism consists of adding a randomly generated token as a hidden field to every form, which the server knows. This way, the potential attacker has no means of knowing what the token might be, and the attack will fail.</p><p>As of version 3.5, CakePHP also implements CSRF protection as <a href=\"https://book.cakephp.org/3.0/en/controllers/middleware.html#csrf-middleware\">middleware</a>.<br>\nYou should either use CSRF as a component or as middleware, but not both at the same time.</p><h3 id=\"activatethesecuritycomponent\">Activate the Security Component</h3><p>The <em>Security</em> component will enable you to:</p><ul><li>Restrict which HTTP methods your application accepts</li><li>Prevent Form tampering</li><li>Require that SSL be used</li><li>Limit cross controller communication</li></ul><p>Use it in your controller\u2019s <em>beforeFilter()</em> call. Since <em>Security</em> can be used with other callbacks from there, it should be executed before them in the <em>initialize()</em> method.</p><p>The Security Component will automatically give you the means to fight form tampering protection. It inserts and then checks on hidden token fields that are automatically inserted into forms.</p><p>It will also work in conjunction with the SCRF component.</p><h3 id=\"wheretoputcodetoactivatesecuritycomponents\">Where To Put Code to Activate Security Components</h3><p>You may put all of your security components into the file <em>AppController.php</em>, as all other controllers will import that file automatically. Access it via</p><pre><code>sudo nano /var/www/html/cakeapp/src/Controller/AppController.php\n</code></pre><p>This is the beginning of the file and it may have additional lines of code in it.</p><pre><code>&lt;?php\nnamespace App\\Controller;\nuse Cake\\Controller\\Controller;\nuse Cake\\Event\\Event;\nclass AppController extends Controller {\n    public $components = ['Flash', 'Auth', 'Security', 'Csrf', 'Cookie']; \n    public $helpers = ['Form'];\n</code></pre><h2 id=\"settinguptheappontheservercorrectly\">Setting Up the App on the Server Correctly</h2><h3 id=\"setupdocumentroot\">Set Up DocumentRoot</h3><p>If you have followed advice on installing and setting up your first CakePHP app, you will have set up this properly already. If not, open Apache default site config file for editing:</p><pre><code>sudo nano /etc/apache2/sites-enabled/000-default.conf\n</code></pre><p>and change the DocumentRoot like this:</p><pre><code>DocumentRoot /var/www/html/cakeapp/webroot\n</code></pre><p>If you are on shared hosting, it is not likely that you will be able to change <em>DocumentRoot</em> directly. Your only option may be to use basic html folder as the root of the app and for the details have a look <a href=\"https://stackoverflow.com/questions/29401199/how-can-i-put-my-cakephp-3-0-project-on-a-shared-hosting-server\">here</a>.</p><h3 id=\"takecareofthe_webroot_folder\">Take Care of the <em>webroot</em> Folder</h3><p>Files and directories in <em>webroot</em> folder of your app are accessible to the rest of the Internet. If you want to store public images on the site, that\u2019s where you can put them.</p><p>If you have old PHP code that is important to execute without change, you may put it in <em>webroot</em> subfolder as well. It will be executed outside of CakePHP, which means that someone can destroy your site without you ever noticing. If you must put a PHP file there, be sure never to execute it in the browser, or \u2013 even better \u2013 rewrite the old code to be compatible with CakePHP and then execute it in a normal Cake way.</p><p>Dusko Savic is a technical writer and Flutter programmer.</p><p><a href=\"https://duskosavic.com/blog/\">DuskoSavic.com</a></p><p><a href=\"https://www.linkedin.com/in/dusko-savic-741487149/\">Dusko on LinkedIn</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-cakephp-for-production-ubuntu-16-04%2F&amp;t=How%20To%20Set%20Up%20CakePHP%20For%20Production%3A%20Ubuntu%2016.04\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20To%20Set%20Up%20CakePHP%20For%20Production%3A%20Ubuntu%2016.04&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-cakephp-for-production-ubuntu-16-04%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-cakephp-for-production-ubuntu-16-04%2F&amp;title=How%20To%20Set%20Up%20CakePHP%20For%20Production%3A%20Ubuntu%2016.04&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">1</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-disable-ipv6-on-ubuntu/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"how to disable ipv6 on your ubuntu\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/how-to-disable-ipv6-ubuntu-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Disable IPv6 on Ubuntu</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/server-space-1gb-windows-vps-in-nj-or-amsterdam-for-6-mo-plus-and-exclusive-coupon/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Server Space - 1GB Windows VPS in NJ or Amsterdam for $6/mo plus and Exclusive Coupon\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/serverspace2-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Server Space - 1GB Windows VPS in NJ or Amsterdam for $6/mo plus and Exclusive Coupon</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/hostigger-openstack-kvm-in-istanbul-plans-start-at-11-94-yr/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Hostigger \u2013 Openstack/KVM in Istanbul! Plans start at $11.94/yr!\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Hostigger \u2013 Openstack/KVM in Istanbul! Plans start at $11.94/yr!</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/hostigger-goodbye2019-usa-nl-tr-location-3-core-10gb-ram-80gb-ssd-10tb-bw-250-mbps-network-speed-9-99-mo-or-75-yr/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Hostigger - GoodBye2019 - USA/NL/TR Location | 3 Core, 10GB RAM, 80GB SSD, 10TB BW, 250 Mbps Network...\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Hostigger - GoodBye2019 - USA/NL/TR Location | 3 Core, 10GB RAM, 80GB SSD, 10TB BW, 250 Mbps Network...</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}