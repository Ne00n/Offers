{"id": "24022", "post": "<div class=\"post-24022 post type-post status-publish format-standard hentry category-tutorials tag-amazon-s3 tag-linux tag-minio tag-object-storage tag-s3\" id=\"post-24022\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/lowendbuckets-setting-up-an-maintainable-minio/\" rel=\"bookmark\">LowEndBuckets: Setting Up an Maintainable Minio</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/amazon-s3/\" rel=\"tag\">Amazon S3</a>, <a href=\"https://lowendbox.com/tag/linux/\" rel=\"tag\">linux</a>, <a href=\"https://lowendbox.com/tag/minio/\" rel=\"tag\">minio</a>, <a href=\"https://lowendbox.com/tag/object-storage/\" rel=\"tag\">object storage</a>, <a href=\"https://lowendbox.com/tag/s3/\" rel=\"tag\">S3</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> February 12, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p>MinIO is self-hosted S3-compatible object storage.&nbsp; You can set it up in minutes and your VPS will look and act just like Amazon S3 storage, compatible with many backup programs and applications.&nbsp; In this tutorial, we\u2019ll setup MinIO and do so in a secure, encrypted, and maintainable fashion.</p><h1>The Setup</h1><p>We\u2019re using:</p><ul><li>A Debian 10 VPS called storage.lowend.party</li><li>/etc/minio for MinIO config files</li><li>/usr/local/bin for the MinIO binary</li><li>/data for MinIO storage</li></ul><p>This is actually not my preferred MinIO config (I prefer to have everything MinIO-related under /minio, with /minio/bin, /minio/data, /minio/etc, etc.)&nbsp; However, by using the default configs, we can save a great deal of time and you can always tweak later.</p><p><span id=\"more-24022\"></span></p><h1>Installing MinIO</h1><p>You shouldn\u2019t run MinIO as root, so let\u2019s create a MinIO user.</p><pre>useradd -r -s /sbin/nologin minio-user</pre><p>Now create required directories and make minio-user the owner.</p><pre>mkdir /data /etc/minio\nchown minio-user:minio-user /data /etc/minio</pre><p>Next, we\u2019ll download the MinIO binary:</p><pre>wget -O /usr/local/bin/minio https://dl.min.io/server/minio/release/linux-amd64/minio\nchmod 755 minio</pre><p>Now we need to specify options to pass to the systemd startup.&nbsp; We do this by creating /etc/default/minio and populating it as follows:</p><pre>MINIO_ACCESS_KEY=\"storage_lowend_party\"\nMINIO_SECRET_KEY=\"complex-secret-key\"\nMINIO_VOLUMES=\"/data\"\nMINIO_OPTS=\"-C /etc/minio --address storage.lowend.party:9000\"</pre><p>Obviously, you\u2019ll want to change MINIO_ACCESS_KEY and set a significantly more complex password for MINIO_SECRET_KEY.</p><p>Next, grab the MinIO systemd unit file and put it in /etc/systemd/service:</p><pre>wget -O /etc/systemd/service/minio.service https://raw.githubusercontent.com/minio/minio-service/master/linux-systemd/minio.service</pre><p>If you\u2019ve used all the config I\u2019ve specific, this unit file will work without modification, but if you\u2019ve changed paths, MinIO user name, etc., you\u2019ll need to tweak this file.&nbsp; When it\u2019s as you like, load it into systemctl:</p><pre>systemctl daemon-reload</pre><h1>Configuring TLS</h1><p>Before we fire up MinIO, let\u2019s make sure our connections are encrypted.&nbsp; We\u2019ll use Let\u2019s Encrypt for this.</p><pre>apt -y install certbot</pre><p>Now run the certbot standalone web server:</p><pre>certbot certonly --standalone -d storage.lowend.party</pre><p>Enter your email, accept the terms, and decide if you want EFF spam:</p><pre>Saving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator standalone, Installer None\nEnter email address (used for urgent renewal and security notices) (Enter 'c' to\ncancel): raindog308@raindog308.com\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease read the Terms of Service at\nhttps://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must\nagree in order to register with the ACME server at\nhttps://acme-v02.api.letsencrypt.org/directory\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(A)gree/(C)ancel: a\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nWould you be willing to share your email address with the Electronic Frontier\nFoundation, a founding partner of the Let's Encrypt project and the non-profit\norganization that develops Certbot? We'd like to send you email about our work\nencrypting the web, EFF news, campaigns, and ways to support digital freedom.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(Y)es/(N)o: n\nObtaining a new certificate\nPerforming the following challenges:\nhttp-01 challenge for storage.lowend.party\nWaiting for verification...\nCleaning up challenges\n\nIMPORTANT NOTES:\n\n- Congratulations! Your certificate and chain have been saved at:\n/etc/letsencrypt/live/storage.lowend.party/fullchain.pem\nYour key file has been saved at:\n/etc/letsencrypt/live/storage.lowend.party/privkey.pem\nYour cert will expire on 2020-09-26. To obtain a new or tweaked\nversion of this certificate in the future, simply run certbot\nagain. To non-interactively renew *all* of your certificates, run\n\"certbot renew\"\n- Your account credentials have been saved in your Certbot\nconfiguration directory at /etc/letsencrypt. You should make a\nsecure backup of this folder now. This configuration directory will\nalso contain certificates and private keys obtained by Certbot so\nmaking regular backups of this folder is ideal.\n- If you like Certbot, please consider supporting our work by:\n\nDonating to ISRG / Let's Encrypt: https://letsencrypt.org/donate\nDonating to EFF: https://eff.org/donate-le</pre><h1>Maintaining the Certs</h1><p>We have a small problem, in that MinIO needs access to the certs but they\u2019re going to change every 90 days.&nbsp; We don\u2019t want the hassle of manually copying, chmodding, etc. every 90 days, so let\u2019s automate this.</p><p>If you look in /etc/letsencrypt/live (where the certs live), you\u2019ll see that the certs are actually symlinks, and they point to files (in /etc/letsencrypt/storage/archive) whose names change, so we can\u2019t simply symlink to the symlink because symlink permissions aren\u2019t really permissions.&nbsp; We\u2019ll need to create a short script to solve the problem.</p><p>Put this in a file called /usr/local/bin/maintain_minio_certs.sh</p><pre>#!/bin/bash\n\ncp /etc/letsencrypt/live/storage.lowend.party/privkey.pem /etc/minio/certs/private.key\nchown minio-user:minio-user /etc/minio/certs/private.key\ncp /etc/letsencrypt/live/storage.lowend.party/fullchain.pem /etc/minio/certs/public.crt\nchown minio-user:minio-user /etc/minio/certs/public.crt\nsystemctl restart minio</pre><p>Save it, and then</p><pre>chmod 755 /usr/local/bin/maintain_minio_certs.sh</pre><p>We could schedule it to run regularly, but an easier method is to link it in to the certbot service itself.&nbsp; This way, every time certbot updates, this script will run.</p><p>Modify /lib/systemd/service/certbot.service and add the ExecStartPost line shown below:</p><pre>[Service]\nType=oneshot\nExecStart=/usr/bin/certbot -q renew \n<strong>ExecStartPost=/usr/local/bin/maintain_minio_certs.sh</strong>\nPrivateTmp=true</pre><p>Now reload the unit file:</p><p>systemctl daemon-reload</p><p>And run</p><pre>systemctl start certbot</pre><p>After that, you can see that the certificates are now properly installed:</p><pre>root@storage:/lib/systemd/system# ls -l /etc/minio/certs/\ntotal 20\ndrwx------ 3 minio-user minio-user 4096 Jun 28 10:08 .\ndrwxr-xr-x 3 minio-user minio-user 4096 Jun 28 09:37 ..\ndrwx------ 2 minio-user minio-user 4096 Jun 28 09:37 CAs\n-rw------- 1 minio-user minio-user 1704 Jun 28 10:08 private.key\n-rw-r--r-- 1 minio-user minio-user 3574 Jun 28 10:08 public.crt</pre><h1>Starting MinIO</h1><p>At this point, you\u2019re ready to fire up MinIO:</p><p>systemctl start minio</p><p>Your MinIO server should now be running on port 9000.&nbsp; Start a web browser and navigate to https://your-server-name:9000 and you should be able to log into MinIO:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMzgxIiB2aWV3Qm94PSIwIDAgODAwIDM4MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-full wp-image-24029\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/minio1a.png.webp\" alt=\"\" width=\"800\" height=\"381\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/minio1a.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/minio1a-300x143.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/minio1a-768x366.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\"></p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMjQ5IiB2aWV3Qm94PSIwIDAgODAwIDI0OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-full wp-image-24027\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/minio2.png.webp\" alt=\"\" width=\"800\" height=\"249\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/minio2.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/minio2-300x93.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/minio2-768x239.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\"></p><p>&nbsp;</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/installing-linux-on-your-vps-template-or-iso/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Installing Linux on Your VPS: Template or ISO?\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/02/linux-templates-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Installing Linux on Your VPS: Template or ISO?</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/vulnerability-in-debian-10-solusvm-templates-you-need-to-take-action/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Vulnerability in Debian 10 SolusVM Templates - You Need to Take Action\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Vulnerability in Debian 10 SolusVM Templates - You Need to Take Action</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/getting-nerdy-with-your-passwords-the-bitwarden-command-line-interface/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Getting Nerdy With Your Passwords: the Bitwarden Command Line Interface\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Getting Nerdy With Your Passwords: the Bitwarden Command Line Interface</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/take-control-of-your-passwords-with-self-hosted-bitwarden/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Take Control of Your Passwords with Self-Hosted Bitwarden\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/06/bitwarden1-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Take Control of Your Passwords with Self-Hosted Bitwarden</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}