{"id": "24100", "post": "<div class=\"post-24100 post type-post status-publish format-standard hentry category-tutorials tag-backup tag-cloud tag-linux tag-tarsnap\" id=\"post-24100\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/tarsnap-cloud-backups-for-the-truly-paranoid/\" rel=\"bookmark\">Tarsnap: Cloud Backups for the Truly Paranoid</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" width=\"16\" height=\"16\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/backup/\" rel=\"tag\">backup</a>, <a href=\"https://lowendbox.com/tag/cloud/\" rel=\"tag\">cloud</a>, <a href=\"https://lowendbox.com/tag/linux/\" rel=\"tag\">linux</a>, <a href=\"https://lowendbox.com/tag/tarsnap/\" rel=\"tag\">tarsnap</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" width=\"16\" height=\"16\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> July 18, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/07/tarsnap.png\" loading=\"lazy\" class=\"alignright size-full wp-image-27777 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/07/tarsnap.png\" alt=\"TarSnap\" width=\"300\" height=\"300\" align=\"right\" hspace=\"20\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/07/tarsnap.png 300w, https://lowendbox.com/wp-content/uploads/2020/07/tarsnap-150x150.png 150w\" data-sizes=\"(max-width: 300px) 100vw, 300px\" sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"https://lowendbox.com/wp-content/uploads/2020/07/tarsnap.png 300w, https://lowendbox.com/wp-content/uploads/2020/07/tarsnap-150x150.png 150w\" data-was-processed=\"true\"><a href=\"http://www.tarsnap.com/\" aria-label=\"tarsnap\">Tarsnap</a> is a cloud backup company that emphasize strong cryptography. It\u2019s the brainchild of Dr. Colin Percival, former FreeBSD security officer. Its motto is \u201conline backups for the truly paranoid\u201d and Tarsnap has been in business since 2008.</p><p>Tarsnap uses an open, documented cryptographic design that securely encrypts your files. The command-line client is perfect for Linux VPSes and uses a familiar tar syntax. On the back end, backups are stored on Amazon S3 and Tarsnap uses variable-length, deduplicated blocks of data. So if you change a file, only the changes to that file are backed up, not the entire file (like rsync).</p><p>Suppose you have a directory with 100MB of files and a 5% daily change rate. If you create a Tarsnap archive every day, you will see the following:</p><pre>Monday (initial): 100MB archive created (100MB uploaded, 100MB stored)\nTuesday: 10MB archive created (5MB new data uploaded, 105MB total data stored)\nWednesday: 10MB archive created (5MB new data uploaded, 110MB total data stored)</pre><p>If you then delete your Monday backup, the Tuesday archive will be made complete by retaining whatever Monday files are needed. It\u2019s a very flexible system.</p><p>Tarsnap is not the cheapest backup solution by any means, but it does provide robustly secure files.</p><h1>Installing Tarsnap</h1><p>First, register at tarsnap.com, deposit some funds in your account, and download the client.</p><p>The <a href=\"https://www.tarsnap.com/download.html\">client is available</a> as a .deb, .rpm, etc. or you can get the source code. The source installs cleanly with the usual untar/configure/make install.</p><p>Be sure to open port 9279 via TCP, which is what tarsnap communicates on.</p><p><span id=\"more-24100\"></span></p><h1>Setting Up Tarsnap</h1><p>The tarsnap configuration file is in /etc/tarsnap.conf. You probably don\u2019t need to change anything there, but you do need to register your system.</p><p>To this, using my email and setting up on a system called server1:</p><pre>root@server1:~# tarsnap-keygen --keyfile /root/tarsnap.key --user me@example.com --machine server1\nEnter tarsnap account password:</pre><p>Note that the argument to \u2013machine is just a name for the usage reports.</p><p>Note that you need to keep your key file (/root/tarsnap.key) safe!. If you lose this, you won\u2019t be able to access your backups.</p><h1>Using Tarsnap</h1><p>Now that you\u2019re setup, you can create backups.&nbsp; Tarsnap comes with a robust man page (\u2018man tarsnap\u2019) or run tarsnap -h for a short summary.</p><p>I\u2019ve created a directory called /data and populated it with some data.&nbsp; To back it up, I use tarsnap cf (create file \u2013 same syntax as tar):</p><pre>root@server1:/data# tarsnap cf data.20200703 /data\ntarsnap: Removing leading '/' from member names\n              Total size Compressed size\nAll archives   102201669    102668723\n(unique data)  102201669    102668723\nThis archive   102201669    102668723\nNew data       102201669    102668723</pre><p>I can list archives (tars):</p><pre>root@server1:/data# tarsnap --list-archives\ndata.20200703</pre><p>And use (as you might expect) tarsnap tf to list the files in an archive:</p><pre>root@server1:/data# tarsnap tf data.20200703\ndata/\ndata/free stock photos/\ndata/Travel/\ndata/Travel/March Trip.pdf\ndata/free stock photos/Dew-on-a-spiderweb-in-the-Fall.zip\ndata/free stock photos/Lonely-Key-Island.zip\ndata/free stock photos/Submarine-Dials-2.zip\n(etc.)</pre><p>The next day, I add some more data and create a new archive:</p><pre>root@server1:/data# tarsnap cf data.20200704 /data\ntarsnap: Removing leading '/' from member names\n              Total size    Compressed size\nAll archives   257155378       250038933\n(unique data)  154994247       147400577\nThis archive   154953709       147370210\nNew data        52792578        44731854</pre><p>So I added a new 52,792,578 bytes.&nbsp; Overall, I have 250MB stored, but it compresses and dedupes down to about 147MB.&nbsp; You can see your total usage at any time via \u2013print-stats:</p><pre>root@server1:/data# tarsnap --print-stats\n             Total size Compressed size\nAll archives  257155378    250038933\n(unique data) 154994247    147400577</pre><p>Finally, if I want to delete an archive, I use tarsnap df:</p><pre>root@server1:/data# tarsnap df data.20200703\n              Total size Compressed size\nAll archives   154953709    147370210\n(unique data)  154953709    147370210\nThis archive   102201669    102668723\nDeleted data       40538        30367</pre><p>&nbsp;</p><p>&nbsp;</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/celebrate-black-friday-in-july-with-losangelesvpss-50-off-sale/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LosAngelesVPS Logo\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/11/losangelesvps-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Celebrate Black Friday in July with LosAngelesVPS's 50% Off Sale!</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/running-like-a-swiss-watch-interview-with-andrew-azarov-cto-of-serverastra/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"ServerAstra Logo\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/06/serverastra-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Running Like a Swiss Watch: Interview with Andrew Azarov, CTO of ServerAstra</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/one-folder-to-rule-them-all-running-dropbox-headless-on-your-vps/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Dropbox\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/07/dropbox_logo-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">One Folder to Rule Them All: Running Dropbox Headless on Your VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/amd-epyc-openvz-7-vps-in-strasbourg-france-europe-and-quebec-canada-starting-from-12-year-hostnamaste/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"HostNamaste Logo\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/12/hostnamaste300-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">AMD Epyc OpenVZ 7 VPS in Strasbourg, France, Europe and Quebec, Canada Starting from $12/year - Host...</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}