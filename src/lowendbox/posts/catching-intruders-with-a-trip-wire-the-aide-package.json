{"id": "22404", "post": "<div class=\"post-22404 post type-post status-publish format-standard hentry category-tutorials tag-aide tag-aidepackage tag-security tag-tutorial\" id=\"post-22404\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/catching-intruders-with-a-trip-wire-the-aide-package/\" rel=\"bookmark\">Catching Intruders With a Trip Wire: The AIDE Package</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/aide/\" rel=\"tag\">aide</a>, <a href=\"https://lowendbox.com/tag/aidepackage/\" rel=\"tag\">aidepackage</a>, <a href=\"https://lowendbox.com/tag/security/\" rel=\"tag\">Security</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> August 20, 2020 @ 9:55 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/04/catching-intruders-with-a-trip-wire.png.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/04/catching-intruders-with-a-trip-wire.png.webp\" alt=\"\" width=\"416\" height=\"245\" data-was-processed=\"true\"></a></p><p class=\"p1\"><span class=\"s1\">Your Linux VPS lives in a hostile, dangerous world: the Internet.<span class=\"Apple-converted-space\">&nbsp; </span>Left unsecured, your system is vulnerable to compromise, which can result in lost data, incurred charges, and general unpleasantness.<span class=\"Apple-converted-space\">&nbsp; You should take every precaution to secure your system, but\u2026how will you know if someone slips through?&nbsp; Blissful ignorance is dangerous.</span></span></p><p>Intrusion detection systems (IDS) are tools to detect if someone has compromised your system.&nbsp; Naturally it\u2019s better to catch electronic criminals before they\u2019re inside your server, but if they do get in, you certainly want to know about it.&nbsp; That\u2019s where a \u201ctrip wire\u201d system like AIDE comes in.&nbsp; A trip wire refers to military perimeter defenses where a thin, invisible wire would be setup to ring an alarm bell if someone broke the wire in the middle of the night.&nbsp; In a similar vein, AIDE can warn you if someone slips past your perimeter defenses.</p><p>Continue to read more\u2026</p><p><span id=\"more-22404\"></span></p><h1>What Does AIDE Do?</h1><p>When installed, AIDE creates a database of all files on your system as well as metadata (modification time, checksum, etc.).&nbsp; Then every night it scans your system and reports if any files have changed.</p><p>Of course, some files change all the time.&nbsp; For example, logs are constantly being written to and there are many files that contain transient state information.&nbsp; AIDE can be configured to ignore those files.&nbsp; What you want to monitor with AIDE are system binaries (perhaps someone has installed a root kit), modified web content, etc.</p><p>Naturally, when you upgrade your system or do routine patching, many files will change \u2013 but in that case, you\u2019ll remember doing it.&nbsp; On the other hand, if some morning you get a report that many files in /usr/bin have been changed and you don\u2019t remember doing it, you\u2019ll be alerted to investigate.</p><h1>Installing AIDE</h1><p>On Debian-based systems:</p><pre>sudo apt-get install aide</pre><p>Then initialize the AIDE database:</p><pre>sudo aideinit --init</pre><p>This process can take some time.&nbsp; On a bare-bones Debian 9 box running at Vultr, it took approximately 2 minutes to complete.&nbsp; You will see output such as this:</p><pre>Start timestamp: 2020-04-07 17:04:45 -0700 (AIDE 0.16.1)\nAIDE initialized database at /var/lib/aide/aide.db.new\nVerbose level: 6\nNumber of entries: 42544\n---------------------------------------------------\nThe attributes of the (uncompressed) database(s):\n---------------------------------------------------\n/var/lib/aide/aide.db.new\nRMD160 &nbsp; : 34sejbbJk8NkYF2BJMGHd7+OkWM=\nTIGER&nbsp; &nbsp; : Xp7tp/LytruyViLSmSGS0lSNzeR4h9I+\nSHA256 &nbsp; : T2SCINBXz7G1/W0PfcZrpe82RnWVYYBS\nwL40glZRM4o=\nSHA512 &nbsp; : kFziwj1myd8AJMj4WvXEWmaftHW1aiJl\nE5xLlBS7KwOBP49z2DpPSrqLbAhH2cQ3\nLEYbJpWAX4gUV8hlZfCV1Q==\nCRC32&nbsp; &nbsp; : NiWF3Q==\nHAVAL&nbsp; &nbsp; : +cs/EVPUkqStdNYfwd2UcRz5gWZiWLHM\n4jBzWyT/FdY=\nGOST &nbsp; &nbsp; : LvnKAW+XrISqnftzVtA3QYsAtTbqoYJp\nTmoJfbQOvkk=\nEnd timestamp: 2020-04-07 17:06:25 -0700 (run time: 1m 40s)\n\n</pre><h1>Running AIDE</h1><p>On Debian, there is a pre-generated job setup in /etc/cron.daily/aide that runs aide with all of the correct parameters and flags.&nbsp; If you wish to perform a check, simply execute this job:</p><pre>/etc/cron.daily/aide</pre><p>After a few minutes\u2019 processing, AIDE will send an email.&nbsp; By default it goes to root.&nbsp; If you wish to change this, modify /etc/default/aide and change the MAILTO line.</p><h1>The Daily Report</h1><p>Here is an example of a daily AIDE report.&nbsp; Prior to running this report, I modified a couple files:</p><ul><li>I executed \u201ctouch /usr/bin/date\u201d to change that files\u2019 mtime</li><li>I edited /etc/issue</li></ul><p>His is what AIDE detected.&nbsp; I\u2019ve trimmed it to focus on the interesting parts:</p><pre>This is an automated report generated by the Advanced Intrusion Detection environment on server.example.com started at 2020-04-07 17:20:22.\n\nAIDE returned with exit code 7. Added, removed and changed entries detected!\n\nAIDE produced no errors.\n\nOutput of the daily AIDE run (410 lines):\nStart timestamp: 2020-04-07 17:20:23 -0700 (AIDE 0.16.1)\nAIDE found differences between database and filesystem!!\nNew AIDE database written to /var/lib/aide/aide.db.new\nVerbose level: 6\n\nSummary:\nTotal number of entries: 42553\nAdded entries: 5\nRemoved entries: 3\nChanged entries: 24\n\n---------------------------------------------------\nAdded entries:\n---------------------------------------------------\n\nd++++++++++++++++: /tmp/aide\nf++++++++++++++++: /tmp/aide/aide.conf.autogenerated\nf++++++++++++++++: /tmp/aide/aide.db\nf++++++++++++++++: /tmp/aide/aide.db.new\nf++++++++++++++++: /var/lib/aide/aide.db\n\n---------------------------------------------------\nRemoved entries:\n---------------------------------------------------\n\nf----------------: /run/systemd/sessions/11\np----------------: /run/systemd/sessions/11.ref\nl----------------: /run/systemd/units/invocation:session-11.scope\n\n---------------------------------------------------\nChanged entries:\n---------------------------------------------------\n\nd =.... mc.. .. .: /etc/aide\nd =.... mc.. .. .: /etc/cron.daily\nf &gt;.... mc..C.. .: /etc/csf/csf.deny\nf &gt;.... mci.C.. .: /etc/issue\nd =.... mc.. .. .: /etc/ssh\nf &lt;.... mci.C.. .: /etc/ssh/sshd_config\nd =.... mc.. .. .: /root\nf &gt;.... mc..C.. .: /root/.bash_history\nf &gt;.... mci.C.. .: /root/.viminfo\nd ... n .. : /run\nd &lt;.... mc.. .. : /run/systemd/units\nf =.... mc..... .: /usr/bin/date\nf &gt;.... mc..C.. .: /var/lib/csf/csf.dnscache\nf &gt;.... mc..C.. .: /var/lib/csf/csf.tempip\nf =.... mc..C.. .: /var/lib/csf/lock/AT_INTERVAL.lock\nf =.... mc..C.. .: /var/lib/csf/lock/LF_DIRWATCH.lock\nf =.... mc..C.. .: /var/lib/csf/lock/LF_EXPLOIT.lock\nf =.... mc..C.. .: /var/lib/csf/lock/PT_INTERVAL.lock\nf =.... mc..C.. .: /var/lib/csf/lock/PT_LOAD.lock\nf =.... mc..C.. .: /var/lib/csf/lock/ST_ENABLE_report.lock\nf =.... mc..C.. .: /var/lib/csf/lock/command.lock\nf &gt;b... mc..C.. .: /var/lib/csf/stats/iptables_log\nf =.... mc..C.. .: /var/lib/csf/stats/lfdstats\nf &gt;.... mc..C.. .: /var/log/lfd.log</pre><p>So here we see it\u2019s detected both /usr/bin/date and /etc/issue, as well as quite a lot of other things.&nbsp; We\u2019ll talk next about how to trim down the noise.&nbsp; AIDE also gives you detailed information on the changes\u2026here, I\u2019ve trimmed the email down to just the two files we intentionally modified:</p><pre>---------------------------------------------------\nDetailed information about changes:\n---------------------------------------------------\n\nFile: /etc/issue\nSize : 27 | 32\nMtime : 2020-02-01 09:09:26 -0800 | 2020-04-07 17:18:08 -0700\nCtime : 2020-03-09 11:39:41 -0700 | 2020-04-07 17:18:08 -0700\nInode : 1731 | 33431\nRMD160 : Bol7XoOiUO6aKpMaWAHqRIApxbs= | 7us/8GJhsItGIaiX+VKr8wT8oa4=\nTIGER : JSqTrZPw9d7S50HXSU8ZYggI/H6uCUBs | lNyNWwkBUEdCTRMJSeC1JsBQ28jix8xC\nSHA256 : ecDKUqYd+ifA4V9pC6ddPXQXXOEXK+/C | sgKqMRBIz9fJt5miZkDvRYPxk43bw2Oq\n1lIEmp27DXI= | Be3LniYEOho=\nSHA512 : pV/mBESQb4rAo6JQ6yz5vo4dVnVMgdqC | K7Q7naUcNZOa6usQa7mjeqsMBnMhu77R\nhPb8D03E9ANL9fO5ROLS68HGjyOcqBtl | sTpzd0RHlhT5n8PHZBjLvSK5Ifd4idUd\n/WozNwQrNa47z0PrtBJDDA== | y3uaK374jhlNGChb1rS5GQ==\nCRC32 : Mk9Fiw== | rqebvQ==\nHAVAL : NSpBJniUuZPLndLFtFYgfAQNFCt261xZ | DNyN6a4YuSjQBJGrQsT5UfZx/2DpnXTS\n/GfU8iVjPSs= | 29XiFsU2/0M=\nGOST : ZIoi5Ot+3FxA9bpstZrKbAyGa+XAUmBO | Pz05vaNaaFp6+T1oPFT+agcupDdR/s/C\n7pBHdKY/GGc= | f7xmSDu5X4U=\n\nFile: /usr/bin/date\nMtime : 2019-02-28 07:30:31 -0800 | 2020-04-07 17:13:45 -0700\nCtime : 2020-03-09 11:40:10 -0700 | 2020-04-07 17:13:45 -0700</pre><p>AIDE then gives some information on the AIDE database itself, and concludes with:</p><pre>End timestamp: 2020-04-07 17:22:13 -0700 (run time: 1m 50s)\n\nEnd of AIDE output.\n\nEnd of AIDE daily cron job at 2020-04-07 17:22, run time 111 seconds</pre><h1>Tuning AIDE</h1><p>As you can see, out of the box AIDE gives a lot of extraneous reports.&nbsp; It\u2019s doing its job, but it\u2019s monitoring and reporting on things we don\u2019t care about.</p><p>AIDE has a very flexible language for excluding files \u2013 you can even specify what sorts of metadata info you can are about and what you don\u2019t.&nbsp; Debian ships with a lot of rule sets kept in /etc/aide/aide.conf.d.&nbsp; if you peruse those rules, you\u2019ll see they\u2019re by service.&nbsp; Adding your own rules is straightforward.&nbsp; Here we will add a rule to ignore /etc/csf/csf.deny.&nbsp; CSF is an active firewall and it notes every IP it blocks in that file, so it changes nearly every day.&nbsp; In /etc/aide/aide.conf.d, I create a file called 80_aide_csf and put this line inside:</p><pre>!/etc/csf/csf.deny$</pre><p>This means \u201cignore changes in a file called /etc/csf/csf.deny\u201d.</p><p>You can read more about creating your own rules in the <a href=\"https://github.com/aide/aide/tree/master/doc\">AIDE documentation</a>.</p><h1>Off-Site Database</h1><p>One thing to consider is that if an attacker penetrates your system, he can run aide \u2013init and generate a new DB after installing his root kit.&nbsp; You may wish to copy /var/lib/aide/* to an off-site location and periodically restore it.&nbsp; You could even keep it on a secure host (or cloud storage service such as Dropbox) and wget it prior to running the nightly aide report.&nbsp; If you do this, be sure to periodically refresh the off-site copy otherwise the list of differences will constantly grow.</p><p>&nbsp;</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fcatching-intruders-with-a-trip-wire-the-aide-package%2F&amp;t=Catching%20Intruders%20With%20a%20Trip%20Wire%3A%20The%20AIDE%20Package\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Catching%20Intruders%20With%20a%20Trip%20Wire%3A%20The%20AIDE%20Package&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fcatching-intruders-with-a-trip-wire-the-aide-package%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fcatching-intruders-with-a-trip-wire-the-aide-package%2F&amp;title=Catching%20Intruders%20With%20a%20Trip%20Wire%3A%20The%20AIDE%20Package&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">2</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/managing-your-lowendempire-with-ansible-part-1/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Managing Your LowEndEmpire With Ansible, Part 1\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Managing Your LowEndEmpire With Ansible, Part 1</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/lowendprotection-homemade-raspberry-pi-security-cloud-camera-setup/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/07/rpi_security1-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Setup a DNS Nameserver Using NSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Setup a DNS Nameserver Using NSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}