{"id": "4580", "post": "<div class=\"post-4580 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-4580\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/tutorial-getting-started-with-openvz/\" rel=\"bookmark\">Tutorial: Getting started with OpenVZ!</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> November 3, 2013 @ 4:06 pm, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><a href=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957 litespeed-loaded\" alt=\"lowendtutorial\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" width=\"271\" height=\"70\" data-was-processed=\"true\"></a></p><p>OpenVZ, who doesn\u2019t know it? It\u2019s been used (and abused) for many, many years in the hosting industry and it\u2019s still out there going strong. Being a operation system-level virtualization technology, there are no hardware requirements in order to be able to run OpenVZ. OpenVZ creates virtualized environments known as containers. These containers are not completely isolated. For example, a process that runs on the guest is displayed on the host node\u2019s ToP. This is one of the powers of OpenVZ: it\u2019s simplicity and the fact that there\u2019s hardly any overhead. A container has limits (like RAM or Disk), but those limits are not reserved anywhere. So, you can assign much more resources to container than you have available. That\u2019s also one of OpenVZ\u2019s weaknesses, it\u2019s easily oversold.</p><p>Like it or not, OpenVZ is a nice piece of technology and it\u2019s perfect for creating a virtualized environment with hardly any overhead. But, what would you do with it as a non-provider?</p><p><span id=\"more-4580\"></span></p><p>There\u2019s many things you can do with it, actually. For example, it\u2019s great for a development machine or a testing environment: you can create and destroy containers as often as you like or keep them around (but powered off) for when you need them. It can also be used to facilitate easy migrations: if you \u201cwrap\u201d your entire machine with OpenVZ, you can just tar the OpenVZ container, move it and deploy it on a new host machine. OpenVZ runs fine on dedicated servers, but also on KVM machines, making it even cheaper to get a machine to run OpenVZ on. I\u2019ve actually tested this tutorial on a KVM machine with 2 IPs (you can do with 1 IP and use only internal networking, but it\u2019s more work and more IPs allow more world-reachable machines).</p><p>This is what you need for this tutorial: a dedicated server or a KVM machine with a fresh install of CentOS 6 (64-bit, minimal installation preferred), at least 2 IPs in the same subnet and a bit of time.</p><h2>Installing OpenVZ</h2><p>Installing OpenVZ has recently gotten a lot simpler lately. No more editing /etc/sysctl.conf, it\u2019s being done for&nbsp; you! OpenVZ is currently modernizing themselves in order to support newer kernels (they currently run on a pretty old kernel, still from the 2.6.x-series while Linux is at 3.10.x), so this process will get even simpler in the future.</p><p>First thing you need to do, is install the OpenVZ kernel. This is a patched kernel using the RHEL kernel as an upstream source. In order to install the kernel, we need to add the OpenVZ YUM sources, and to do that, we need wget. So, install wget first:</p><blockquote><p>yum install wget</p></blockquote><p>Then fetch the repo file:</p><blockquote><p>wget -P /etc/yum.repos.d/ http://ftp.openvz.org/openvz.repo</p></blockquote><p>And finally add the repository\u2019s key:</p><blockquote><p>rpm <code>--</code>import http://ftp.openvz.org/RPM-GPG-Key-OpenVZ</p></blockquote><p>You\u2019re now ready to install the kernel. No worries, it\u2019s really simple:</p><blockquote><p>yum install vzkernel</p></blockquote><p>That\u2019s it! Now, <strong>do not reboot</strong>! We first need to install additional packages that will put everything where it\u2019s supposed to be and get you a working installation. These packages are \u2018vzctl\u2019, used for managing containers, \u2018vzquota\u2019, to control disk quotas, and \u2018ploop\u2019, a \u201cnew\u201d filesystem management method for OpenVZ.</p><p>Let\u2019s install the additional OpenVZ packages:</p><blockquote><p>yum install vzctl vzquota ploop</p></blockquote><p>Once that\u2019s done, reboot! It should automatically load the OpenVZ kernel. To check whether you rebooted in the right kernel, run:</p><blockquote><p>uname -a</p></blockquote><p>And it should output something like:</p><blockquote><p>Linux hostname.example.net 2.6.32-042stab081.8 #1 SMP Mon Sep 30 16:52:24 MSK 2013 x86_64 x86_64 x86_64 GNU/Linux</p></blockquote><p>The \u2018042stab81.8\u2019 part should match the latest stable version on openvz.org, in this case: https://wiki.openvz.org/Download/kernel/rhel6/042stab081.8.</p><p>That\u2019s it, you\u2019ve installed OpenVZ! Now let\u2019s create your first container!</p><h2>Creating your first container</h2><p>Creating a container isn\u2019t hard, it\u2019s actually really simple. I\u2019m going to create a venet container, which has a virtual networking device. Another option is a veth container, which will use a bridge on the host to route traffic through and which puts network control in the hands of the guest (and gives it an actual network interface). A venet container is easier to create, though, and it\u2019s sufficient for most purposes.</p><p>Before we can create a container, we need a template to use. OpenVZ provides official templates themselves: <a href=\"http://openvz.org/Download/template/cache\">http://openvz.org/Download/template/cache</a>. I\u2019ve chosen the ubuntu template for my example. Go to /vz/template/cache/ and download the template:</p><blockquote><p>wget http://download.openvz.org/template/precreated/ubuntu-12.04-x86_64.tar.gz</p></blockquote><p>Now, create the container:</p><blockquote><p>vzctl create 101 <code>--</code>ostemplate ubuntu-12.04-x86_64</p></blockquote><p>What we do here, is we tell vzctl to create a container with as ID \u2018101\u2019. This ID is later used for all commands with vzctl and should be a number that equals or is over 100 (everything below 100 is used for OpenVZ internal purposes). With the \u2013ostemplate flag, you point vzctl to the right template. The name is the full name of the template download minus the \u2018.tar.gz\u2019. When this command is finished running, let\u2019s add an IP to the container:</p><blockquote><p>vzctl set 101 <code>--</code>ipadd&nbsp;192.0.2.1 <code>--</code>save</p></blockquote><p>This IP address should be <em>assigned</em> to your server but not used on it. So if you have a KVM with 2 IPs, just configure one IP on the host node and leave the other(s) alone. The second (or any other) IP can be used in the command above and will be automatically configured. The \u2013save makes the setting persistent in the containers configuration file.</p><p>Finally, add a nameserver (I\u2019ve used Google\u2019s public DNS server here):</p><blockquote><p>vzctl set 101 <code>--</code>nameserver 8.8.8.8 <code>--</code>save</p></blockquote><p>And start your new container:</p><blockquote><p>vzctl start 101</p></blockquote><p>That\u2019s it! Your container is running. Now, to get connectivity, you need to either add IPtables rules or shut IPtables down. I highly recommend the former, so, open up /etc/sysconfig/iptables and make sure that this block:</p><blockquote><p>:FORWARD ACCEPT [0:0]<br>\n:OUTPUT ACCEPT [0:0]</p></blockquote><p>Looks like this:</p><blockquote><p>:FORWARD ACCEPT [0:0]<br>\n-P FORWARD ACCEPT<br>\n-F FORWARD<br>\n:OUTPUT ACCEPT [0:0]</p></blockquote><p>And that this line:</p><blockquote><p>-A FORWARD -j REJECT \u2013reject-with icmp-host-prohibited</p></blockquote><p>Is commented out and looks like this:</p><blockquote><p>#-A FORWARD -j REJECT \u2013reject-with icmp-host-prohibited</p></blockquote><p>Now, restart IPtables:</p><blockquote><p>/etc/init.d/iptables restart</p></blockquote><p>And you should be good. What we have done here, is accept all forwarded traffic through IPtables and made sure pinging was not being blocked. Your container should be reachable from the internet.</p><p>Now, to get in your container, enter:</p><blockquote><p>vzctl enter 101</p></blockquote><p>And you chroot into your new container. As you may have noticed, we haven\u2019t set any limits for our new container. It used defaults, so it has 256MB RAM, 512MB vSwap and 2GB disk space. This is defined in the container\u2019s configuration file, which can be found at /etc/vz/conf/101.conf. Each container gets a config file there, with the container ID as its name. You can both edit this file or use vzctl to modify your container\u2019s resources. Feel free to play around with this a bit!</p><p>That\u2019s it, you\u2019ve just set up OpenVZ on your server and added your first container!</p><h2>Final notes</h2><p>Like usual, there\u2019s a lot more to tell about OpenVZ: configuration options, adding IPv6, using VETH or configuring private networking. I\u2019m probably going to cover some of these topics in a future tutorial. The OpenVZ website (<a href=\"http://openvz.org\">http://openvz.org</a>) has a lot of information, so be sure to check that out!</p><p><strong>Up next time</strong>: Setting up nginx, PHP-FPM and MariaDB!</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Ftutorial-getting-started-with-openvz%2F&amp;t=Tutorial%3A%20Getting%20started%20with%20OpenVZ%21\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Tutorial%3A%20Getting%20started%20with%20OpenVZ%21&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Ftutorial-getting-started-with-openvz%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Ftutorial-getting-started-with-openvz%2F&amp;title=Tutorial%3A%20Getting%20started%20with%20OpenVZ%21&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}