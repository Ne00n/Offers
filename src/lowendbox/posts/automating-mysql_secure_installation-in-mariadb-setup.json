{"id": "24249", "post": "<div class=\"post-24249 post type-post status-publish format-standard hentry category-tutorials tag-automation tag-database tag-mariadb tag-mysql tag-security\" id=\"post-24249\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/automating-mysql_secure_installation-in-mariadb-setup/\" rel=\"bookmark\">Automating mysql_secure_installation in MariaDB Setup</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/automation/\" rel=\"tag\">automation</a>, <a href=\"https://lowendbox.com/tag/database/\" rel=\"tag\">database</a>, <a href=\"https://lowendbox.com/tag/mariadb/\" rel=\"tag\">mariadb</a>, <a href=\"https://lowendbox.com/tag/mysql/\" rel=\"tag\">mysql</a>, <a href=\"https://lowendbox.com/tag/security/\" rel=\"tag\">Security</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> April 27, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p>Lots of people want to automate their system setup, and this is frequently done by either using the provider\u2019s new VM hooks to run a script at setup time or later using something like Ansible. If you are trying to automate MariaDB/MySQL installations, it\u2019s easy enough to install MariaDB (e.g., apt-get -y mariadb-server) but you typically want to run the mysql_secure_installation script afterwards to clean up some of the open doors MySQL comes with.</p><p>Unfortunately, it\u2019s an interactive script. Here\u2019s an example:</p><pre># mysql_secure_installation\n\nNOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB\nSERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!\n\nIn order to log into MariaDB to secure it, we'll need the current\npassword for the root user. If you've just installed MariaDB, and\nyou haven't set the root password yet, the password will be blank,\nso you should just press enter here.\n\nEnter current password for root (enter for none): \nOK, successfully used password, moving on...\n\nSetting the root password ensures that nobody can log into the MariaDB\nroot user without the proper authorisation.\n\nSet root password? [Y/n] y\nNew password: \nRe-enter new password: \nPassword updated successfully!\nReloading privilege tables..\n... Success!\n\n\nBy default, a MariaDB installation has an anonymous user, allowing anyone\nto log into MariaDB without having to have a user account created for\nthem. This is intended only for testing, and to make the installation\ngo a bit smoother. You should remove them before moving into a\nproduction environment.\n\nRemove anonymous users? [Y/n] y\n... Success!\n\nNormally, root should only be allowed to connect from 'localhost'. This\nensures that someone cannot guess at the root password from the network.\n\nDisallow root login remotely? [Y/n] y\n... Success!\n\nBy default, MariaDB comes with a database named 'test' that anyone can\naccess. This is also intended only for testing, and should be removed\nbefore moving into a production environment.\n\nRemove test database and access to it? [Y/n] y\n- Dropping test database...\n... Success!\n- Removing privileges on test database...\n... Success!\n\nReloading the privilege tables will ensure that all changes made so far\nwill take effect immediately.\n\nReload privilege tables now? [Y/n] y\n... Success!\n\nCleaning up...\n\nAll done! If you've completed all of the above steps, your MariaDB\ninstallation should now be secure.\n\nThanks for using MariaDB!</pre><p>It\u2019s tedious to type those answers every single time you install MariaDB. Let\u2019s automate it with a script we can inline into any setup script we have.</p><p><span id=\"more-24249\"></span></p><h1>What mysql_secure_installation Does</h1><p>mysql_secure_installation does the following:</p><ul><li>sets the root password</li><li>removes anonymous users</li><li>disallows remote root logins</li><li>removes the \u2018test\u2019 database and access to it</li><li>flushes privileges so changes are immediately effective</li></ul><h1>Scripting Unattended mysql_secure_installation</h1><p>There are multiple ways to accomplish unattended mysql_secure_installation.&nbsp; For example, you could use the Expect program.&nbsp; Or you write a script that echoes \u201cY\u201d and answers (with newlines) into mysql_secure_installation.</p><p>But I prefer to just do what mysql_secure_installation does via SQL.&nbsp; Here\u2019s a script that accomplishes that.&nbsp; Note that we are invoking MySQL with \u2018-sfu\u2019 which means</p><ul><li>-s silent</li><li>-f keep going if there\u2019s an error</li><li>-u use the following account, which in this case is root</li></ul><p>Also be sure to change the \u201ccomplex_password\u201d below to a good, secure password.</p><pre>#!/bin/bash\n\nmysql -sfu root &lt;&lt;EOS\n-- set root password\nUPDATE mysql.user SET Password=PASSWORD('complex_password') WHERE User='root';\n-- delete anonymous users\nDELETE FROM mysql.user WHERE User='';\n-- delete remote root capabilities\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\n-- drop database 'test'\nDROP DATABASE IF EXISTS test;\n-- also make sure there are lingering permissions to it\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\\\_%';\n-- make changes immediately\nFLUSH PRIVILEGES;\nEOS</pre><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/tuning-mysql-101-the-big-things-to-look-at/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Tuning MySQL 101: The Big Things to Look At\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Tuning MySQL 101: The Big Things to Look At</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/running-your-own-openvpn-vpn-server/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Running Your Own OpenVPN VPN Server\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/running-your-own-openvpn-server-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Running Your Own OpenVPN VPN Server</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/getting-started-with-the-dolphin-mysql-101-full-setup-and-how-to-guide/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup MySQL - A Full Setup and How to Guide\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/getting-strated-with-the-dolphin-mysql-101-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Getting Started With the Dolphin: MySQL 101 - Full Setup and How to Guide</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/vulnerability-in-debian-10-solusvm-templates-you-need-to-take-action/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Vulnerability in Debian 10 SolusVM Templates - You Need to Take Action\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Vulnerability in Debian 10 SolusVM Templates - You Need to Take Action</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}