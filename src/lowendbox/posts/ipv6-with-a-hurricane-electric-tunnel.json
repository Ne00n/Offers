{"id": "3971", "post": "<div class=\"post-3971 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-3971\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/ipv6-with-a-hurricane-electric-tunnel/\" rel=\"bookmark\">IPv6 with a Hurricane Electric tunnel</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> June 1, 2013 @ 11:02 am, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center\"><a href=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957 litespeed-loaded\" alt=\"lowendtutorial\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" width=\"271\" height=\"70\" data-was-processed=\"true\"></a></p><p>IPv6 is a topic that has received a lot of discussion over the last couple of years. Although originally from 1996, IPv6 became more important and more implemented over the last few years because of IPv4 depletion. Not all providers offer IPv6 though.: sometimes the data center hasn\u2019t completed a dual stack implementation yet, sometimes the provider hasn\u2019t got the proper equipment yet or sometimes providers just don\u2019t care. Whatever the reasons: you are sometimes with a VPS without IPv6, while you may want to have it or really need it.</p><p>But why would you want IPv6? Well, this is one of the hardest questions to answer and there are a lot of opinions on this subject. Let me put it like this: you mostly don\u2019t <em>need</em> IPv6, but you do need it to be prepared for the future. Some providers started offering IPv6-only servers, which basically means that if you don\u2019t have IPv6, you cannot be reached by those servers. Congratulations, you just broke the internet. Not adapting it delays global adoption. So I say: adapt!<br>\n<span id=\"more-3971\"></span><br>\nIn this guide, I\u2019m going to show you how to set up IPv6 on a KVM VPS by using a Hurricane Electric tunnel, which tunnels IPv6 traffic over IPv4. You need a free <a href=\"http://tunnelbroker.net\">tunnelbroker.net</a> account for this. If you don\u2019t have one, head over to <a href=\"http://tunnelbroker.net\">tunnelbroker.net</a>, register for an account and log in.</p><p>Once logged in, click \u2018Create Regular Tunnel\u2019 on the left side. You are now asked for the IPv4 endpoint. Enter the primary IPv4 of your VPS there. Then select a tunnel server near the location of your VPS. Meanwhile, the page starts checking whether your server is reachable. It does this by pinging your server. If it can\u2019t reach you server, it will give an error message. Once completed (and once you\u2019ve resolved any errors), you\u2019ll get your tunnel overview. The overview contains a block looking like this:</p><blockquote><p>Server IPv4 Address:&nbsp;&nbsp; &nbsp;203.0.113.30<br>\nServer IPv6 Address:&nbsp;&nbsp; &nbsp;2001:db8:1f0a:3ec::1/64<br>\nClient IPv4 Address:&nbsp;&nbsp; &nbsp;198.51.100.100<br>\nClient IPv6 Address:&nbsp;&nbsp; &nbsp;2001:db8:1f0a:3ec::2/64</p></blockquote><p>These are the addresses important in setting up your tunnel. The server addresses are the addresses on HE\u2019s side, the client addresses are for your VPS. Your VPS\u2019 public IPv4 address should be listed as the \u2018Client IPv4 Address\u2019. The \u2018Client IPv6 Address\u2019 will be the primary IPv6 address we\u2019ll assign to the VPS.</p><p>This guide is written for two linux distributions: CentOS and Ubuntu.</p><h2>CentOS</h2><p>This guide assumes you have CentOS 6 or newer. On CentOS, the tunnel is created using the \u2018sit\u2019 device. \u2018sit\u2019 means \u2018simple internet transition\u2019. We\u2019re going to use \u2018sit1\u2019 to create our tunnel.</p><p>Open up the \u2018sit1\u2019 configuration file:</p><blockquote><p>vim /etc/sysconfig/network-scripts/ifcfg-sit1</p></blockquote><p>And paste this into it:</p><blockquote><p>DEVICE=sit1<br>\nBOOTPROTO=none<br>\nONBOOT=yes<br>\nIPV6INIT=yes<br>\nIPV6TUNNELIPV4=&lt;Server IPv4 Address&gt;<br>\nIPV6TUNNELIPV4LOCAL=&lt;Client IPv4 Address*&gt;<br>\nIPV6ADDR=&lt;Client IPv4 Address (with the \u2018/64\u2019)&gt;<br>\nIPV6_DEFAULTGW=&lt;Server IPv6 Address (without the \u2018/64\u2019)&gt;</p></blockquote><p>You see four \u201ctokens\u201d here which we need to replace with the addresses from HE. We\u2019ll discuss them piece by piece.</p><blockquote><p>IPV6TUNNELIPV4=203.0.113.30</p></blockquote><p>This is the IPv6 address of the tunnel server, in this case the HE server you choose when you set up the tunnel. This is the endpoint of your tunnel.</p><blockquote><p>IPV6TUNNELIPV4LOCAL=198.51.100.100</p></blockquote><p>This is your VPS\u2019 primary IPv4 address, the one you\u2019ve entered when you created the tunnel.</p><blockquote><p>IPV6ADDR=2001:db8:1f0a:3ec::2/64</p></blockquote><p>This is the Client IPv6 address, the eventual IPv6 address of your server. Make sure to include the /64 here, as it indicates the subnet this address is in.</p><blockquote><p>IPV6_DEFAULTGW=2001:db8:1f0a:3ec::1</p></blockquote><p>This is the default IPv6 gateway (at HE). You must not include the /64 at the end here. The subnet is already known and no longer needed here.</p><p>Now we\u2019ve got the config file all set up, let\u2019s bring up the interface:</p><blockquote><p>ifup sit1</p></blockquote><p>Run \u2018ifconfig\u2019 to check everything is OK. If everything is in working order, the sit1 device should be listed with the address we\u2019ve just been provided with:</p><blockquote><p>sit1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Link encap:IPv6-in-IPv4<br>\ninet6 addr: 2001:db8:1f0a:3ec::2/64 Scope:Global<br>\ninet6 addr: fe80::5f2f:7566/128 Scope:Link<br>\nUP POINTOPOINT RUNNING NOARP&nbsp; MTU:1480&nbsp; Metric:1<br>\nRX packets:0 errors:0 dropped:0 overruns:0 frame:0<br>\nTX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br>\ncollisions:0 txqueuelen:0<br>\nRX bytes:0 (0.0 b)&nbsp; TX bytes:0 (0.0 b)</p></blockquote><p>Let\u2019s check if everything works by running a ping6 against google.com:</p><blockquote><p>[root@localhost ~]# ping6 google.com<br>\nPING google.com(wg-in-x8a.1e100.net) 56 data bytes<br>\n64 bytes from wg-in-x8a.1e100.net: icmp_seq=1 ttl=56 time=16.7 ms<br>\n64 bytes from wg-in-x8a.1e100.net: icmp_seq=2 ttl=56 time=16.5 ms<br>\n64 bytes from wg-in-x8a.1e100.net: icmp_seq=3 ttl=56 time=16.7 ms<br>\n64 bytes from wg-in-x8a.1e100.net: icmp_seq=4 ttl=56 time=16.5 ms<br>\n^C<br>\n\u2014 google.com ping statistics \u2014<br>\n4 packets transmitted, 4 received, 0% packet loss, time 3365ms<br>\nrtt min/avg/max/mdev = 16.562/16.638/16.726/0.175 ms</p></blockquote><p>You can do an additional test by pinging your server from the outside.</p><p>Congratulations! You\u2019re now IPv6 connected!</p><h2>Ubuntu</h2><p>For Ubuntu, I assume you\u2019re running Ubuntu 12.04 LTS or higher. On Ubuntu, the tunnel is created as a separate interface using \u2018v4tunnel\u2019 configuration. By using \u2018v4tunnel\u2019 configuration, rather than \u2018static\u2019 or \u2018dhcp\u2019, Ubuntu knows this is an IPv6-over-IPv4 tunnel.</p><p>Let\u2019s open up the /etc/network/interfaces file:</p><blockquote><p>sudo vim /etc/network/interfaces</p></blockquote><p>And add this block to it:</p><blockquote><p>auto he-ipv6<br>\niface he-ipv6 inet6 v4tunnel<br>\nendpoint &lt;Server IPv4 Address&gt;<br>\naddress &lt;Client IPv6 Address (without the \u2018/64\u2019)&gt;<br>\nnetmask 64<br>\nup ip -6 route add default dev he-ipv6<br>\ndown ip -6 route del default dev he-ipv6</p></blockquote><p>There\u2019s only two things you should replace in here:</p><blockquote><p>endpoint 216.66.80.30</p></blockquote><p>This is the IPv4 tunnel endpoint at HE, so where your traffic is routed to. This is important, as this is the address where all tunnelled packets are sent.</p><blockquote><p>address 2001:db8:1f0a:3ec::2</p></blockquote><p>This is the IPv6 address of your server. It does not need the /64, as we\u2019re explicitly entering the netmask at this line:</p><blockquote><p>netmask 64</p></blockquote><p>Where \u201964\u2019 is derived from the /64 at the end of your IPv6 address. This is the subnet your IPv6 address is in.</p><p>Ubuntu doesn\u2019t need the Client IPv4 and the Server IPv6 address: it can figure that out based on the current configuration.</p><p>The following lines are also worth noting:</p><blockquote><p>up ip -6 route add default dev he-ipv6<br>\ndown ip -6 route del default dev he-ipv6</p></blockquote><p>These lines add the default route for IPv6 traffic every time you interface goes up and remove it every time it goes down. This way you ensure IPv6 traffic always takes the proper route, namely the \u2018he-ipv6\u2019 one.</p><p>Let\u2019s bring up the interface we\u2019ve just added:</p><blockquote><p>sudo ifup he-ipv6</p></blockquote><p>And run \u2018ifconfig\u2019 to confirm it\u2019s configured properly:</p><blockquote><p>he-ipv6&nbsp;&nbsp; Link encap:IPv6-in-IPv4<br>\ninet6 addr: fe80::5f2f:7567/64 Scope:Link<br>\ninet6 addr: 2001:db8:1f0a:3ec::2/64 Scope:Global<br>\nUP POINTOPOINT RUNNING NOARP&nbsp; MTU:1480&nbsp; Metric:1<br>\nRX packets:0 errors:0 dropped:0 overruns:0 frame:0<br>\nTX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br>\ncollisions:0 txqueuelen:0<br>\nRX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p></blockquote><p>Finally, let\u2019s run a ping6 to google.com:</p><blockquote><p>mpkossen@ubuntu:~$ ping6 google.com<br>\nPING google.com(wg-in-x71.1e100.net) 56 data bytes<br>\n64 bytes from wg-in-x71.1e100.net: icmp_seq=1 ttl=56 time=18.9 ms<br>\n64 bytes from wg-in-x71.1e100.net: icmp_seq=2 ttl=56 time=19.0 ms<br>\n64 bytes from wg-in-x71.1e100.net: icmp_seq=3 ttl=56 time=18.5 ms<br>\n64 bytes from wg-in-x71.1e100.net: icmp_seq=4 ttl=56 time=18.3 ms<br>\n^C<br>\n\u2014 google.com ping statistics \u2014<br>\n4 packets transmitted, 4 received, 0% packet loss, time 3002ms<br>\nrtt min/avg/max/mdev = 18.301/18.701/19.017/0.325 ms</p></blockquote><p>And you\u2019re all done! You can do an additional test by pinging your server from the outside and see if you get a response.</p><p>Congratulations, you\u2019re now part of the IPv6 family!</p><h2>Final note</h2><p>It\u2019s quite easy to get IPv6 up and running, but there\u2019s a few things to consider. IPv6 uses a different iptables: ip6tables. Running a dual stack configuration would mean maintaining two firewalls. Additionally, not all software supports IPv6 (like older MySQL versions). IPv6 also has quite a few new concepts and doesn\u2019t have some of the things that IPv4 has. It\u2019s advisable to read a bit more about IPv6 on, for example, Wikipedia before you get started.</p><p>By default, HE blocks IRC and SMTP ports. If you become a IPv6 Certified Sage (by taking free tests on the HE website) you can unblock these ports.</p><p>For now, happy IPv6ing!</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fipv6-with-a-hurricane-electric-tunnel%2F&amp;t=IPv6%20with%20a%20Hurricane%20Electric%20tunnel\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=IPv6%20with%20a%20Hurricane%20Electric%20tunnel&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fipv6-with-a-hurricane-electric-tunnel%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fipv6-with-a-hurricane-electric-tunnel%2F&amp;title=IPv6%20with%20a%20Hurricane%20Electric%20tunnel&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}