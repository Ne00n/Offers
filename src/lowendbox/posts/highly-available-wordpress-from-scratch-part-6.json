{"id": "23010", "post": "<div class=\"post-23010 post type-post status-publish format-standard hentry category-tutorials tag-high-availability tag-highly-available tag-setup-wordpress tag-tutorial tag-wordpress tag-wordpress-setup\" id=\"post-23010\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/highly-available-wordpress-from-scratch-part-6/\" rel=\"bookmark\">How to Setup a Highly Available WordPress Site From Scratch, Part 6</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/high-availability/\" rel=\"tag\">high availability</a>, <a href=\"https://lowendbox.com/tag/highly-available/\" rel=\"tag\">highly available</a>, <a href=\"https://lowendbox.com/tag/setup-wordpress/\" rel=\"tag\">setup wordpress</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a>, <a href=\"https://lowendbox.com/tag/wordpress/\" rel=\"tag\">wordpress</a>, <a href=\"https://lowendbox.com/tag/wordpress-setup/\" rel=\"tag\">wordpress setup</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> January 9, 2021 @ 12:00 pm, by raindog308</div><div class=\"storycontent tablelook\"><p><a target=\"_blank\" rel=\"noopener noreferrer\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part-6.jpg.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" title=\"How to Setup a Highly Available WordPress Site From Scratch, Part 6\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part-6.jpg.webp\" alt=\"How to Setup a Highly Available WordPress Site From Scratch, Part 6\" width=\"410\" height=\"235\" data-was-processed=\"true\"></a>In this tutorial series, we are setting up a highly available WordPress web site from scratch.</p><p><a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-1/\">Part 1 \u2013 Introduction, Considerations, and Architecture</a><br>\n<a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-2/\">Part 2 \u2013 Setting Up the VPSes</a><br>\n<a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-from-scratch-part-3/\">Part 3 \u2013 Setting Up MariaDB Multi-Master Replication</a><br>\n<a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-from-scratch-part-4/\">Part 4 \u2013 File Replication and Setting Up DRBD</a><br>\n<a href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-5/\">Part 5 \u2013 Setting Up OCFS2</a><br>\nPart 6 \u2013 Round-Robin DNS, Let\u2019s Encrypt, &amp; Conclusion</p><h1 class=\"p1\"><span class=\"s1\">Configuring Round-Robin DNS</span></h1><p class=\"p1\"><span class=\"s1\">Our final step is to setup round-robin DNS.<span class=\"Apple-converted-space\">&nbsp; </span>This should be straightforward with whatever DNS provider you\u2019re using.<span class=\"Apple-converted-space\">&nbsp; </span>If your DNS provider\u2019s interface doesn\u2019t specifically have a RRDNS setting, you can usually just enter multiple A records.<span class=\"Apple-converted-space\">&nbsp; </span>In this case, I entered the following records:</span></p><pre class=\"p1\"><span class=\"s1\">www.lowend.party<span class=\"Apple-converted-space\">&nbsp; </span>in A <span class=\"Apple-converted-space\">&nbsp; </span>1.1.1.1</span>\n<span class=\"s1\">www.lowend.party<span class=\"Apple-converted-space\">&nbsp; </span>in A <span class=\"Apple-converted-space\">&nbsp; </span>2.2.2.2\n</span><span id=\"more-23010\"></span></pre><h1 class=\"p1\"><span class=\"s1\">Configuring Let\u2019s Encrypt</span></h1><p class=\"p1\"><span class=\"s1\">We\u2019re going to exploit our shared storage to make setting up Let\u2019s Encrypt with certbot a snap.<span class=\"Apple-converted-space\">&nbsp; </span>First install these packages on both nodes:</span></p><pre class=\"p1\"><span class=\"s1\">apt-get install certbot python-certbot-nginx</span></pre><p class=\"p1\"><span class=\"s1\">Now we\u2019ll move our nginx and letsencrypt configurations to the shared storage.<span class=\"Apple-converted-space\">&nbsp; </span>Stop nginx on both nodes:</span></p><pre class=\"p1\"><span class=\"s1\"># systemctl stop nginx</span></pre><p class=\"p1\"><span class=\"s1\">On web1, move the config directories to /web:</span></p><pre class=\"p1\"><span class=\"s1\">mv /etc/nginx /web</span>\n<span class=\"s1\">mv /etc/letsencrypt /web</span></pre><p class=\"p1\"><span class=\"s1\">And link on web1:</span></p><pre class=\"p1\"><span class=\"s1\">ln -s /web/nginx /etc/nginx</span>\n<span class=\"s1\">ln -s /web/letsencrypt /etc/letsencrypt</span></pre><p class=\"p1\"><span class=\"s1\">On web2, replace the existing configs with links:</span></p><pre class=\"p1\"><span class=\"s1\">rm -rf /etc/letsencrypt</span>\n<span class=\"s1\">rm -rf /etc/nginx</span>\n<span class=\"s1\">ln -s /web/nginx /etc/nginx</span>\n<span class=\"s1\">ln -s /web/letsencrypt /etc/letsencrypt</span></pre><p class=\"p1\"><span class=\"s1\">And then start nginx on both nodes:</span></p><pre class=\"p1\"><span class=\"s1\">systemctl start nginx</span></pre><p class=\"p1\"><span class=\"s1\">Now we can run Let\u2019s Encrypt\u2019s certbot as usual.<span class=\"Apple-converted-space\">&nbsp; </span>On web1:</span></p><pre class=\"p1\"><span class=\"s1\"># certbot --authenticator webroot --installer nginx</span>\n<span class=\"s1\">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span>\n<span class=\"s1\">Plugins selected: Authenticator webroot, Installer nginx</span>\n<span class=\"s1\">Enter email address (used for urgent renewal and security notices) (Enter 'c' to</span>\n<span class=\"s1\">cancel): <strong>raindog308@raindog308.com</strong>\n</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">Please read the Terms of Service at</span>\n<span class=\"s1\">https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must</span>\n<span class=\"s1\">agree in order to register with the ACME server at</span>\n<span class=\"s1\">https://acme-v02.api.letsencrypt.org/directory</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">(A)gree/(C)ancel: <strong>a</strong>\n</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">Would you be willing to share your email address with the Electronic Frontier</span>\n<span class=\"s1\">Foundation, a founding partner of the Let's Encrypt project and the non-profit</span>\n<span class=\"s1\">organization that develops Certbot? We'd like to send you email about our work</span>\n<span class=\"s1\">encrypting the web, EFF news, campaigns, and ways to support digital freedom.</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">(Y)es/(N)o: <strong>n</strong>\n</span>\n<span class=\"s1\">Which names would you like to activate HTTPS for?</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">1: www.lowend.party</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">Select the appropriate numbers separated by commas and/or spaces, or leave input</span>\n<span class=\"s1\">blank to select all options shown (Enter 'c' to cancel): <strong>1</strong></span>\n<span class=\"s1\">Obtaining a new certificate</span>\n<span class=\"s1\">Performing the following challenges:</span>\n<span class=\"s1\">http-01 challenge for www.lowend.party</span>\n<span class=\"s1\">Input the webroot for www.lowend.party: (Enter 'c' to cancel): <strong>/web/www.lowend.party</strong></span>\n<span class=\"s1\">Waiting for verification...</span>\n<span class=\"s1\">Cleaning up challenges</span>\n<span class=\"s1\">Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/www.lowend.party</span>\n\n<span class=\"s1\">Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">1: No redirect - Make no further changes to the webserver configuration.</span>\n<span class=\"s1\">2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for</span>\n<span class=\"s1\">new sites, or if you're confident your site works on HTTPS. You can undo this</span>\n<span class=\"s1\">change by editing your web server's configuration.</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">Select the appropriate number [1-2] then [enter] (press 'c' to cancel): <strong>2</strong></span>\n<span class=\"s1\">Redirecting all traffic on port 80 to ssl in /etc/nginx/sites-enabled/www.lowend.party\n</span>\n<span class=\"s1\">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>\n<span class=\"s1\">Congratulations! You have successfully enabled https://www.lowend.party</span>\n<span class=\"s1\">&lt;snip&gt;</span></pre><p class=\"p1\"><span class=\"s1\">And you\u2019re done!<span class=\"Apple-converted-space\">&nbsp; </span>Because both /etc/letsencrypt and /etc/nginx are immediately visible on both nodes, you\u2019ve setup Let\u2019s Encrypt on both nodes.</span></p><p class=\"p1\"><span class=\"s1\">You can play with shutting down nginx on one node and loading the site in your browser, then restarting it and shutting down the other node and reloading.<span class=\"Apple-converted-space\">&nbsp; </span>When the browser can\u2019t connect to the IP it was using previously, you may see a 2-3 second pause and then the site will load from the other node.</span></p><p class=\"p1\"><span class=\"s1\">When the certbot renew job fires (run systemctl show certbot.timer to see details), Let\u2019s Encrypt can talk to either nodes to validate because they\u2019re both serving the same filesystem for web content.</span></p><h1 class=\"p1\"><span class=\"s1\">Adding More Sites</span></h1><p class=\"p1\"><span class=\"s1\">This configuration is fully enabled for more WordPress sites if you want to add more domains.<span class=\"Apple-converted-space\">&nbsp; </span>All you need to do is use /web as your web root.<span class=\"Apple-converted-space\">&nbsp; </span>Nginx configuration will be identical on both nodes (since it\u2019s on shared storage).<span class=\"Apple-converted-space\">&nbsp; </span>We\u2019ve configured MariaDB to replicate all databases, so any new databases will be automatically picked up and replicated.</span></p><h1 class=\"p1\"><span class=\"s1\">Wrapping Up</span></h1><p class=\"p1\"><span class=\"s1\">I hope you\u2019ve enjoyed this tutorial, which has taken you from bare metal nodes to a highly-available, fully-replicated WordPress web site.</span></p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/5-common-uses-for-a-lowendbox-cheap-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"5 Common Uses for a LowEndBox (Cheap VPS)\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/5-common-uses-for-lowendbox-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">5 Common Uses for a LowEndBox (Cheap VPS)</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-site-from-scratch-part-5/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup a Highly Available WordPress Site From Scratch, Part 5\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part5-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Setup a Highly Available WordPress Site From Scratch, Part 5</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-setup-a-highly-available-wordpress-from-scratch-part-4/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup a Highly Available WordPress Site From Scratch, Part 4\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/highly-available-wordpress-part-4-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Setup a Highly Available WordPress Site From Scratch, Part 4</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/poll-have-you-enjoyed-our-recent-tutorials/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Poll: Have you enjoyed our recent Tutorials?\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/06/lowendbox-poll-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Poll: Have you enjoyed our recent Tutorials?</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}