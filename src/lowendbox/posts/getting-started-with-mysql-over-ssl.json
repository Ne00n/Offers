{"id": "5373", "post": "<div class=\"post-5373 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-5373\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/getting-started-with-mysql-over-ssl/\" rel=\"bookmark\">Getting started with MySQL over SSL</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> June 22, 2014 @ 1:00 am, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzEiIGhlaWdodD0iNzAiIHZpZXdCb3g9IjAgMCAyNzEgNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"alignnone wp-image-3957 size-full\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\"></p><p>When you want to reach a database server with a client that is not on that server, you usually set up a Virtual Private Network (VPN) in order to access the server securely without having to open it up to the internet as a whole. In certain situations, though, this is not an option; you may not have a VPN, you may not know how to set it up or consider it too complicated, or the client or server do not support it.</p><p>For these situations MySQL offers SSL support. This ensures your database is accessed securely even though you\u2019re doing it over a public line. What\u2019s more: you don\u2019t even have to open up your full database server for this. You can require users to use SSL and only allow users to connect from certain IPs and/or with SSL.</p><p>In this tutorial, I\u2019m going to show you how to set up SSL for MySQL. I\u2019m using Ubuntu 14.04\u2019s default MySQL, but MariaDB will also work. I have no reason to believe this shouldn\u2019t work on other Linux distributions as well, as long as the proper server version is installed.</p><p><span id=\"more-5373\"></span></p><h2>Setting up the server</h2><p>First of all, install the MySQL server:</p><blockquote><p>sudo apt-get install mysql-server</p></blockquote><p>During the installation you will be asked for a root password several times. Pick a strong one and enter it the first time. Every additional time you are asked for it, you can just hit enter. It keeps the old password if you leave the field blank.</p><p>In order to have a proper setup, you need to generate a s0-called \u2018Certificate Authority\u2019 certificate first. This certificate is used to create both the server and the client certificates. When the client establishes a connection to the server, the server checks the client certificate against the CA certificate for validity. If it matches, the client is considered trusted and a secure connection is established. I could go into more detail about that, but that is not the goal of this tutorial. Maybe for another day.</p><p>Anyway, lets generate the CA certificate and private key. On the server, go to /etc/mysql and type the following command:</p><blockquote><p>openssl genrsa 2048 &gt; ca-key.pem</p></blockquote><p>This generates a new CA private key. Next, generate the certificate using that key:</p><blockquote><p>openssl req -sha1 -new -x509 -nodes -days 3650 -key ca-key.pem &gt; ca-cert.pem</p></blockquote><p>You will be asked a series of questions. It doesn\u2019t really matter what you put in here. Once done, you will have a CA key and certificate and we can now create the other certificates.</p><p>Let\u2019s create a private key for the server and a signing request to go with that:</p><blockquote><p>openssl req -sha1 -newkey rsa:2048 -days 730 -nodes -keyout server-key.pem &gt; server-req.pem</p></blockquote><p>Fill out all the fields again. Just like before, it doesn\u2019t really matter what you put in there. Be sure to leave \u2018A challenge password\u2019 empty. It\u2019s going to be removed in the next step anyway.</p><p>Now, export the private key into an RSA private key:</p><blockquote><p>openssl rsa -in server-key.pem -out server-key.pem</p></blockquote><p>And finally, create a certificate using the CA certificate:</p><blockquote><p>openssl x509 -sha1 -req -in server-req.pem -days 730&nbsp; -CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 &gt; server-cert.pem</p></blockquote><p>As you can see, we use the ca-cert.pem and ca-key.pem files to actually create a certificate based on the certificate request, which was generated for a certain private key. Like I said before, I\u2019ll dive into the workings of SSL in another tutorial.</p><p>Now that we\u2019ve got the CA certificate, the server private key, and the server certificate, let\u2019s configure MySQL to use them. Open up /etc/mysql/my.cnf and put the following lines in the [mysqld] section:</p><blockquote><p>ssl-ca=/etc/mysql/ca-cert.pem<br>\nssl-cert=/etc/mysql/server-cert.pem<br>\nssl-key=/etc/mysql/server-key.pem</p></blockquote><p>These files are now loaded when MySQL starts and it enables SSL, which in turn makes MySQL accept SSL connections. While we\u2019re here, change the following line:</p><blockquote><p>bind-address = 127.0.0.1</p></blockquote><p>To:</p><blockquote><p>bind-address = *</p></blockquote><p>This ensures MySQL listens on all addresses, not just on localhost. To apply these changes, restart MySQL:</p><blockquote><p>sudo service mysql restart</p></blockquote><p>And the MySQL server should now be ready to accept SSL connections.</p><p>The final step is to add a user that is allowed to connect to this server. We are going to require the user to use SSL, so the user cannot connect without SSL. Log in to MySQL</p><blockquote><p>mysql -u root -p</p></blockquote><p>And create the user with the following command:</p><blockquote><p>GRANT ALL PRIVILEGES ON *.* TO \u2018iamsecure\u2019@\u2019%\u2019 IDENTIFIED BY \u2018dingdingding\u2019 REQUIRE SSL;</p></blockquote><p>Obviously, it is good to pick a better password than I have. You may also want to limit the database a user is able to connect to or from which host a user is allowed to connect. For example, this limits the user to the database \u2018collections\u2019 and only allows him to connect from 192.0.2.10:</p><blockquote><p>GRANT ALL PRIVILEGES ON \u2018collections\u2019.* TO \u2018iamsecure\u2019@\u2019192.0.2.10\u2019 IDENTIFIED BY \u2018dingdingding\u2019 REQUIRE SSL;</p></blockquote><p>Now flush the privilege cache to ensure the user you just added can connect:</p><blockquote><p>FLUSH PRIVILEGES;</p></blockquote><p>That\u2019s it! We\u2019re now ready to set up the client.</p><h2>Setting up the client</h2><p>We still need to be on the MySQL server in order to set up the client, though. A private key and certificate for the client need to be generated on the server, as that is where the CA certificate and private key reside. Just like before, we start with a private key and a certificate signing request:</p><blockquote><p>openssl req -sha1 -newkey rsa:2048 -days 730 -nodes -keyout client-key.pem &gt; client-req.pem</p></blockquote><p>Next, we export the private key to an RSA private key:</p><blockquote><p>openssl rsa -in client-key.pem -out client-key.pem</p></blockquote><p>And finally, we create a certificate using the CA private key and certificate:</p><blockquote><p>openssl x509 -sha1 -req -in client-req.pem -days 730 -CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 &gt; client-cert.pem</p></blockquote><p>Now we need to copy the following three files to the client:</p><ul><li>ca-cert.pem</li><li>client-key.pem</li><li>client-cert.pem</li></ul><p>The easiest way is to use \u2018scp\u2019 to do this, but you may also open two terminals and copy-paste the contents of the files across.</p><p>When that has been done, we need to install the MySQL client on the client server:</p><blockquote><p>sudo apt-get install mysql-client</p></blockquote><p>Next, open up /etc/mysql/my.cnf and add the following lines under the [client] section:</p><blockquote><p>ssl-cert=/etc/mysql/server-cert.pem<br>\nssl-key=/etc/mysql/server-key.pem</p></blockquote><p>Which is all there should be to it. When you now use the \u2018mysql\u2019 command to make a connection to a server, it will automatically try to establish and SSL connection and use these files to do so.</p><p>To see if all we did works, try and connect to your server:</p><blockquote><p>mysql -h [SERVER HOSTNAME/IP] -u iamsecure -p</p></blockquote><p>It should ask you for the password, which is \u2018dingdingding\u2019 in my example but I hope you\u2019ve picked a better one. If the connection is successful, you should be connected to MySQL. That\u2019s all there\u2019s to it!</p><h2>Final notes</h2><p>While understanding the concepts on SSL may be hard at first, they\u2019re not really relevant for using it. Setting up SSL for MySQL is actually a quite simple and straight-forward process. In times where privacy is a more and more important topic, securing your connections between your servers is a great idea.</p><p><span style=\"text-decoration: underline;\">Up next time:</span> Linux Basics: what do you on your first ever VPS</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fgetting-started-with-mysql-over-ssl%2F&amp;t=Getting%20started%20with%20MySQL%20over%20SSL\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Getting%20started%20with%20MySQL%20over%20SSL&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fgetting-started-with-mysql-over-ssl%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fgetting-started-with-mysql-over-ssl%2F&amp;title=Getting%20started%20with%20MySQL%20over%20SSL&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}