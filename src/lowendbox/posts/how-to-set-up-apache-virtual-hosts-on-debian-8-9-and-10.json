{"id": "20397", "post": "<div class=\"post-20397 post type-post status-publish format-standard hentry category-tutorials tag-apache-virtual-hosts\" id=\"post-20397\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-set-up-apache-virtual-hosts-on-debian-8-9-and-10/\" rel=\"bookmark\">How To Set Up Apache Virtual Hosts on Debian 8, 9, and 10</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/apache-virtual-hosts/\" rel=\"tag\">apache virtual hosts</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> April 13, 2020 @ 9:34 am, by Dusko Savic</div><div class=\"storycontent tablelook\"><p>In this tutorial, we will start with an empty VPS with a freshly installed Debian 9 and will end up with three different sites sharing the same IP address, hosted on the same machine.</p><p>Apache web server analyzes HTTP request headers and appropriately connects it to the directory structure inside the VPS. The technical term for \u201csites\u201d inside VPS boxes is \u201cvirtual host\u201d \u2013 the server is the \u201chost\u201d to many domains at the same time, hence, they are not real, but only \u201cvirtual\u201d.</p><p>Let\u2019s see how it\u2019s done.</p><h2 id=\"whatwearegoingtocover\">What We Are Going To Cover</h2><ul><li>Creating a Non Root User</li><li>Installing Apache</li><li>Installing and setting up UFW</li><li>Defining File Locations For the Default Apache Page</li><li>Creating File Structure For Our Demo Virtual Hosts</li><li>Granting Permissions</li><li>Creating index.html Pages For Our Demo Sites</li><li>Creating Virtual Hosts Files</li><li>Turning On the New Virtual Host Files</li><li>Testing the Virtual Hosts</li><li>Securing Your Domains With Let\u2019s Encrypt TLS certificates</li></ul><p>Read more to continue\u2026</p><p><span id=\"more-20397\"></span></p><h2 id=\"prerequisites\">Prerequisites</h2><p>We use Debian 9 but this article has been tested against Debian 8 and 10 as well. The differences are noted in the text:</p><ul><li>Starting with a clean VPS with</li><li>At least 512Mb of RAM and</li><li>15Gb of free disk space</li><li>You will need root user access via SSH</li><li>Two domain names pointed to your server\u2019s IP address using A records at your DNS service provider.</li><li>We use nano as our editor of choice, and you can install it with this command:</li></ul><pre><code>sudo apt install nano -y\n</code></pre><ul><li>On Debian 8 you need to install <em>sudo</em> as well:</li></ul><pre><code>apt-get install sudo\n</code></pre><h1 id=\"step1creatinganonrootuser\">Step 1: Creating a Non Root User</h1><p>Once you are logged in as <em>root</em>, you can create a new user account that you\u2019ll use to carry out the rest of the commands in this tutorial. We\u2019ll call the new user <em>simpleuser</em>. To create it, run:</p><pre><code>adduser simpleuser\n</code></pre><p>Debian 9.7 will ask you for a UNIX password, while Debian 10 will ask only for a password, however, the procedure is the same. Enter the password twice and press Enter five times to create a new user.</p><p>Then, add <em>simpleuser</em> to the sudo group, so that you can run commands as sudo:</p><pre><code>usermod -aG sudo simpleuser\n</code></pre><p>On Debian 9.7, you may get a harmless but annoying message like this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTEiIGhlaWdodD0iMTAzIiB2aWV3Qm94PSIwIDAgNjUxIDEwMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/xy4BJif.png\" alt=\"\" width=\"651\" height=\"103\"></p><p>Turns out that your version of Debian 9.7 may come with a package called <em>unscd</em> preinstalled. It is supposed to speed up requests to name servers like LDAP\u2026 unfortunately, it contains a bug that forces the lines such as</p><pre><code>sent invalidate(passwd) request, exiting\nsent invalidate(group) request, exiting\n</code></pre><p>to appear after <em>usermod</em> command.</p><p>Feel free to remove <em>unscd</em> with this command:</p><pre><code>apt remove unscd\n</code></pre><p>After that, the <em>usermod</em> command won\u2019t report strange lines.</p><p>You don\u2019t get this problem on Debian 10.</p><p>Anyways, now you will be able to use the <em>simpleuser</em> as a root using the command <em>sudo</em>.</p><h2 id=\"step2installingapache\">Step 2: Installing Apache</h2><p>To install Apache web server on all three versions of Debian, type the following commands:</p><pre><code>sudo apt update\nsudo apt install apache2 apache2-doc\n</code></pre><p>That will install the Apache manual as well.</p><p>The following command will show the status of Apache service in a terminal window:</p><pre><code>sudo systemctl status apache2    \n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjkiIGhlaWdodD0iMjE4IiB2aWV3Qm94PSIwIDAgNjI5IDIxOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/8GFs4tj.png\" alt=\"\" width=\"629\" height=\"218\"></p><p>The real test of successful installation is whether you can access files from the server through your local browser. Navigate to this address:</p><pre><code>http://YOUR_DOMAIN/\n</code></pre><p>You should see a welcome page for Apache on Debian, which means that you now have Apache running.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NTEiIGhlaWdodD0iNTM3IiB2aWV3Qm94PSIwIDAgNjUxIDUzNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/4XByECy.png\" alt=\"\" width=\"651\" height=\"537\"></p><h2 id=\"step3changefirewallrulestoenablenginx\">Step 3: Change Firewall Rules to Enable Nginx</h2><p>On Debian, the <em>iptables</em> firewall is installed by default, but we prefer <em>ufw</em>, the uncomplicated firewall. First install it:</p><pre><code>sudo apt install ufw -y\n</code></pre><p>List all the port profiles <em>ufw</em> already knows about:</p><pre><code>sudo ufw app list\n</code></pre><p>It will show quite a list, but we are interested only in those entries that have prefix <em>*WWW</em> in them:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTMiIGhlaWdodD0iMjE0IiB2aWV3Qm94PSIwIDAgNjEzIDIxNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/lKLvqKi.png\" alt=\"\" width=\"613\" height=\"214\"></p><p>Let\u2019s take a closer look at the <strong>WWW Full</strong>:</p><pre><code>sudo ufw app info \"WWW Full\"\n</code></pre><p>The result is:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTciIGhlaWdodD0iMjE3IiB2aWV3Qm94PSIwIDAgNjE3IDIxNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/DuO48o2.png\" alt=\"\" width=\"617\" height=\"217\"></p><p>It is exactly what we need, two ports 80 and 443, one for the HTTP traffic and the other for HTTPS traffic. Enable it:</p><pre><code>sudo ufw allow 'WWW Full'\n</code></pre><p>Here is a list of ports and feel free to add any other that your host requires for the normal functioning of the system:</p><pre><code>sudo ufw allow ssh\nsudo ufw allow ftp\nsudo ufw allow http\nsudo ufw allow https\nsudo ufw allow 20/tcp\nsudo ufw allow 3000\nsudo ufw allow 8080\nsudo ufw allow 'WWW Full'\nsudo ufw enable\n</code></pre><p>The above commands illustrate various ways of defining ports within <em>ufw</em>. For instance, ports 3000 and 8080 are here used only as an example \u2013 they are not needed for installing virtual hosts on Apache, but may well be needed for some other type of application running on your VPS. Learn from your VPS provider which ports might be mandatory for normal functioning of the system and then add them to <em>ufw</em>.</p><h3 id=\"warning\">WARNING:</h3><p>Always enable <em>ssh</em>, <em>http</em>, <em>https</em> and other critical ports in <em>ufw</em>, otherwise you will <strong>NOT</strong> be able to log back into your VPS server!</p><p>To see the changes, run:</p><pre><code>sudo ufw status\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDkiIGhlaWdodD0iNTg3IiB2aWV3Qm94PSIwIDAgNjA5IDU4NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/cp1EFKm.png\" alt=\"\" width=\"609\" height=\"587\"></p><p>To test, navigate to your domain in your browser. It should load correctly, and if you again see the welcome to Apache on Debian page, you have set up <em>ufw</em> correctly.</p><h2 id=\"step4filelocationsforthedefaultapachepage\">Step 4: File Locations For the Default Apache Page</h2><p>We\u2019ll now learn how did Apache know to serve that welcome page. In Debian, root document page is in directory <em>/var/www/html</em> and it is called <em>index.html</em>. You can see its contents by running this command:</p><pre><code>ls -la /var/www/html\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjMiIGhlaWdodD0iNzkiIHZpZXdCb3g9IjAgMCA1MjMgNzkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/7SxbL0N.png\" alt=\"\" width=\"523\" height=\"79\"></p><p>Note that the directories and the index.html files belong to the <em>root</em> user.</p><p>Execute this command</p><pre><code>sudo nano /var/www/html/index.html\n</code></pre><p>to see the contents of <em>index.html</em>:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTQiIGhlaWdodD0iNTcyIiB2aWV3Qm94PSIwIDAgNTk0IDU3MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/q4CKQjv.png\" alt=\"\" width=\"594\" height=\"572\"></p><p>It is a very long document, so we can scroll through it, change it and so on.</p><p>Under Debian, all Apache files are in folder <em>/etc/apache2</em>:</p><pre><code>ls -la /etc/apache2\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MTgiIGhlaWdodD0iMjk2IiB2aWV3Qm94PSIwIDAgNjE4IDI5NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/r0ZP01i.png\" alt=\"\" width=\"618\" height=\"296\"></p><p>Directories <em>sites-available</em> and <em>sites-enabled</em> hold information on sites that exist and on sites that are permitted to be served to the Internet, respectively.</p><p>File <em>/etc/apache2/sites-enabled/000-default.conf</em> is a symbolic link to the file of the same name in folder <em>sites-available</em>. That link enables Apache to read the contents of file</p><pre><code>/etc/apache2/sites-available/000-default.conf\n</code></pre><p>and serve it to the browser. By adding more config files into <em>/etc/apache2/sites-available</em> and creating the corresponding symbolic links in <em>/etc/apache2/sites-enabled</em>, we can serve different pages to different domains. That is how we can host multiple independent sites off of one and the same IP address.</p><p>Each site in Apache parlance is called \u201cvirtual host\u201d and will have to reside in its own subdirectory. The plan for adding new virtual hosts boils down to</p><ul><li>creating file structure for each site,</li><li>populating HTML and other files in the site,</li><li>creating a new .conf file in <em>/etc/apache2/sites-available</em>, and</li><li>creating a new symbolic link in <em>/etc/apache2/sites-enabled</em>.</li></ul><p>Apache will then do the rest, automatically.</p><h2 id=\"step5creatingfilestructureforourdemovirtualhosts\">Step 5: Creating File Structure For Our Demo Virtual Hosts</h2><p>We will create two virtual hosts called <em>debian1.com</em> and <em>debian2.com</em>. They will correspond to DNS entries <em>debian1.duskosavic.com</em> and <em>debian2.duskosavic.com</em> that we have previously made using A records at our DNS service provider. (Instead of these, you should enter your own site domains.) If we now navigated to http://debian1.duskosavic.com/_ in a browser, the default <em>index.html</em> page with basic Apache information would be served, again.</p><p>Let\u2019s now create a directory to hold our <em>debian1.com</em> site. Apache on Ubuntu stores its HTML files under <em>/var/www/html</em> so we could also use it to create our demo sites there. One possibility is to make that folder the top one and to put the demo sites into it. With commands such as</p><pre><code>cd /var/www/html\nsudo mkdir debian1.com\nsudo mkdir debian2.com\nls -la\n</code></pre><p>we would have the following directory structure:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTMiIGhlaWdodD0iMjQwIiB2aWV3Qm94PSIwIDAgNTUzIDI0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/3mbpnXc.png\" alt=\"\" width=\"553\" height=\"240\"></p><p>Here we decide upon the other possibility, and that is to go one level up the directory tree and create the demo sites in <em>/var/www</em>. Inside folders <em>debian1.com</em> and <em>debian2.com</em> we can create whatever directory structure we need, for example:</p><pre><code>cd /var/www\nsudo mkdir -p /var/www/debian1.com/{public_html,private,log,cgi-bin,backup}\nsudo mkdir -p /var/www/debian2.com/{public_html,private,log,cgi-bin,backup}\nls /var/www/debian1.com -la\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDkiIGhlaWdodD0iMTk2IiB2aWV3Qm94PSIwIDAgNjA5IDE5NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/kRhIPge.png\" alt=\"\" width=\"609\" height=\"196\"></p><h2 id=\"step6grantingpermissions\">Step 6: Granting Permissions</h2><p>From the image above we see that <em>root</em> user is still owning the <em>public_html</em> folder, from which our public files will be served to the Internet. We will now change the ownership so that our <em>simpleuser</em> can access the <em>public_html</em> files. The commands are:</p><pre><code>sudo chown -vR simpleuser:simpleuser /var/www/debian1.com/public_html\nsudo chown -vR simpleuser:simpleuser /var/www/debian2.com/public_html\n</code></pre><p>Also make sure that files in <em>/var/www</em> and its subfolders can be read correctly:</p><pre><code>sudo chmod -R 755 /var/www\n</code></pre><h2 id=\"step7createindexhtmlpagesforourdemosites\">Step 7: Create index.html Pages For Our Demo Sites</h2><p>Our public files will be in <em>/var/www/debian1.com/public</em>html_ and <em>/var/www/debian2.com/public</em>html<em>. We\u2019ll now create an _index.html</em> in each of these two folders so that we have something to see while browsing. Using <em>nano</em>, we will create <em>index.html</em> for <em>debian1.com</em>:</p><pre><code>sudo nano /var/www/debian1.com/public_html/index.html\n</code></pre><p>We need only one line of text, preferably in H1 format for better readability. Insert the following text into <em>nano</em>, then save and close the file:</p><pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n\"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;debian1.com Title&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"&gt;\n&lt;style type=\"text/css\"&gt;\nbody,td,th {\n    color: #FF3333;\n}\n&lt;/style&gt;&lt;/head&gt;\n\n&lt;body&gt;\n&lt;h1&gt;This is debian1.com \n&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>Create <em>index.html</em> for <em>debian2.com</em></p><pre><code>sudo nano /var/www/debian2.com/public_html/index.html\n</code></pre><p>and paste this in:</p><pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n\"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;debian2.com Title&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"&gt;\n&lt;style type=\"text/css\"&gt;\n.style1 {color: #3333FF}\n&lt;/style&gt;&lt;/head&gt;\n\n&lt;body&gt;\n&lt;h1 class=\"style1\"&gt;This is debian2.com&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><h2 id=\"step8createvirtualhostsfiles\">Step 8: Create Virtual Hosts Files</h2><p>Let us now inform Apache that there are two new sites to be served. We will copy the default virtual host file, <em>000-default.conf</em> twice and then alter these new files to reflect the positions of <em>debian1.com</em> and <em>debian2.com</em> sites on disk.</p><h3 id=\"step8acreatethefirstvirtualhostsfile\">Step 8A: Create the First Virtual Hosts File</h3><p>Copy the original file and rename it <em>debian1.com.conf</em>:</p><pre><code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/debian1.com.conf\n</code></pre><p>Use <em>nano</em> to see what is in it:</p><pre><code>sudo nano /etc/apache2/sites-available/debian1.com.conf\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTAiIGhlaWdodD0iNTU5IiB2aWV3Qm94PSIwIDAgNTkwIDU1OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/iyHoSF8.png\" alt=\"\" width=\"590\" height=\"559\"></p><p>For clarity, we\u2019ll remove comments and this is what you should return back into <em>nano</em>:</p><pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin admin@debian1.com\n    ServerName debian1.com\n    ServerAlias debian1.duskosavic.com\n    ServerAlias www.debian1.com\n    DocumentRoot /var/www/debian1.com/public_html\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n&lt;/VirtualHost&gt;\n</code></pre><p>Here is a detailed explanation:</p><ul><li><strong>80</strong>: This virtual host will listen on port 80. You can change port number through file <em>ports.conf</em> with this command:</li></ul><pre><code>sudo nano /etc/apache2/ports.conf\n</code></pre><p>The contents of the <em>ports.conf</em> file are here in case you want to actually change them:</p><pre><code># If you just change the port or add more ports here, you will likely also\n# have to change the VirtualHost statement in\n# /etc/apache2/sites-enabled/000-default.conf\n\nListen 80\n\n&lt;IfModule ssl_module&gt;\n        Listen 443\n&lt;/IfModule&gt;\n\n&lt;IfModule mod_gnutls.c&gt;\n        Listen 443\n&lt;/IfModule&gt;\n\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet\n</code></pre><ul><li><strong>ServerAdmin</strong>: It is the email address to which Apache will send messages for administrator in case of an error in the system. May be omitted.</li><li><strong>ServerName</strong>: Server name, obviously, it should coincide with the domain name.</li><li><strong>ServerAlias</strong>: Another name for the same server as above. You can have as many of these aliases as you like.</li><li><strong>DocumentRoot</strong>: Points to the absolute address of the site on disk.</li><li><strong>ErrorLog</strong>: The address of the error log.</li><li><strong>CustomLog</strong>: The same for access logs \u2013 for example, have there been too many unauthorized accesses from the same IP address?</li></ul><h3 id=\"step8bcreatethesecondvirtualhostsfile\">Step 8B: Create the Second Virtual Hosts File</h3><p>Do the same for the other site/domain. Here are the commands:</p><pre><code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/debian2.com.conf\n</code></pre><p>Again use <em>nano</em> to see what is in it:</p><pre><code>sudo nano /etc/apache2/sites-available/debian2.com.conf\n</code></pre><p>This is what you should return back into <em>nano</em>:</p><pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin admin@debian2.com\n    ServerName debian2.duskosavic.com\n    ServerAlias www.debian2.com\n    DocumentRoot /var/www/debian2.com/public_html\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n&lt;/VirtualHost&gt;\n</code></pre><p>Save and close the file.</p><h2 id=\"step9turnonthenewvirtualhostfiles\">Step 9: Turn On the New Virtual Host Files</h2><p>Command <em>a2ensite</em> will create symbolic links from <em>sites-enabled</em> directory to <em>sites-available</em> and so Apache will routinely start serving the virtual hosts. The commands are:</p><pre><code>sudo a2ensite debian1.com.conf\nsudo a2ensite debian2.com.conf\n</code></pre><p>If you want to disable the default site, the command would be:</p><pre><code>sudo a2dissite 000-default.conf\n</code></pre><p>You may want to leave it as it is in case that someone enters the IP address directly into the browser \u2013 then the default <em>index.html</em> will be activated and the visitor would see what you have prepared for that case.</p><p>Once you use the <em>a2ensite</em> and <em>a2dissite</em> commands, you may see something like this in the terminal window:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MjkiIGhlaWdodD0iMTQ1IiB2aWV3Qm94PSIwIDAgNjI5IDE0NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/alyiJZq.png\" alt=\"\" width=\"629\" height=\"145\"></p><p>If you try to activate a link that is already activated, you will be notified as <em>already enabled</em>. And then you will see two lines that say:</p><pre><code>To activate new configuration, you need to run:\n  service apache2 reload\n</code></pre><p>That is, however, an <strong>incorrect</strong> advice to follow. The proper command is:</p><pre><code>sudo service apache2 reload\n</code></pre><p>In other words, run it as <em>sudo</em>.</p><p>Also, be sure to clear cache in your browser or it may start fooling you with old values instead of the properly refreshed ones.</p><h2 id=\"step10testingthevirtualhosts\">Step 10: Testing the Virtual Hosts</h2><p>If you have left the default IP address activated, it will currently show the welcome to Apache screen. If you enter address <em>debian1.duskosavic.com</em> you will see this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNjAiIGhlaWdodD0iOTciIHZpZXdCb3g9IjAgMCAyNjAgOTciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/5BSgcgb.png\" alt=\"\" width=\"260\" height=\"97\"></p><p>And entering <em>debian2.duskosavic.com</em> into the browser changes the image to:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNDYiIGhlaWdodD0iOTAiIHZpZXdCb3g9IjAgMCAyNDYgOTAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/b70dFxW.png\" alt=\"\" width=\"246\" height=\"90\"></p><h2 id=\"step11securingyourdomainswithletsencryptssl\">Step 11: Securing Your Domains With Let\u2019s Encrypt SSL</h2><p>We can use free certificates to turn our HTTP traffic into HTTPS traffic, which will make connecting to your site secure.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTQiIGhlaWdodD0iMzk4IiB2aWV3Qm94PSIwIDAgNTk0IDM5OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/PJDjzn1.png\" alt=\"\" width=\"594\" height=\"398\"></p><p>Certbot for Debian comes from the <a href=\"https://backports.debian.org/Instructions/\">Backports repo</a>, so let\u2019s create a sources list for our case:</p><pre><code>sudo nano /etc/apt/sources.list.d/apache.list\n</code></pre><p>and enter the following line into that file:</p><pre><code>deb http://deb.debian.org/debian stretch-backports main\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDMiIGhlaWdodD0iMTM4IiB2aWV3Qm94PSIwIDAgNjAzIDEzOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/30wgdoN.png\" alt=\"\" width=\"603\" height=\"138\"></p><p>Run</p><pre><code>sudo apt update\n</code></pre><p>and install backports:</p><pre><code>sudo apt-get install certbot python-certbot-apache -t stretch-backports\n</code></pre><p>Finally, run Certbot:</p><pre><code>sudo certbot --apache\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDIiIGhlaWdodD0iNzM1IiB2aWV3Qm94PSIwIDAgNjAyIDczNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/RlttzhE.png\" alt=\"\" width=\"602\" height=\"735\"></p><p>It will ask for your email address in case of emergency, then another two questions that you may answer however you like and then the most important question \u2013 which names would you like to activate HTTPS for?</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjkiIGhlaWdodD0iMjU4IiB2aWV3Qm94PSIwIDAgNTY5IDI1OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/9ZQ1uqh.png\" alt=\"\" width=\"569\" height=\"258\"></p><p>I chose 4 and 5 as these are the only real domains and subdomains that I have DNS set up for:</p><ul><li><em>debian1.duskosavic.com</em></li><li><em>debian2.duskosavic.com</em></li></ul><p>The last question will be whether do you want HTTPS access or not. You do, of course, so choose 2.</p><p>Restart Apache:</p><pre><code>sudo service apache2 restart\n</code></pre><p>In your browser, go to address</p><pre><code>http://debian1.duskosavic.com/\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNDYiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCAzNDYgNjQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/ENYURjk.png\" alt=\"\" width=\"346\" height=\"64\"></p><p>We have entered the HTTP address and Apache automatically redirects to HTTPS, as it should:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMzUiIGhlaWdodD0iMTA0IiB2aWV3Qm94PSIwIDAgMzM1IDEwNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/VZ2oyTo.png\" alt=\"\" width=\"335\" height=\"104\"></p><p>You\u2019ll notice that the actual site address starts with HTTPS and that there is green padlock in the address bar.</p><h2 id=\"whatcanyoudonext\">What Can You Do Next</h2><p>We have shown how to share one IP address to one, two, three or dozens or hundreds of independent sites. You can now use this knowledge to host all your sites on one low cost VPS box, running Debian 9 or 10.</p><p>Dusko Savic is a technical writer and programmer.</p><p><a href=\"https://duskosavic.com/blog/\">duskosavic.com</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-apache-virtual-hosts-on-debian-8-9-and-10%2F&amp;t=How%20To%20Set%20Up%20Apache%20Virtual%20Hosts%20on%20Debian%208%2C%209%2C%20and%2010\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20To%20Set%20Up%20Apache%20Virtual%20Hosts%20on%20Debian%208%2C%209%2C%20and%2010&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-apache-virtual-hosts-on-debian-8-9-and-10%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-apache-virtual-hosts-on-debian-8-9-and-10%2F&amp;title=How%20To%20Set%20Up%20Apache%20Virtual%20Hosts%20on%20Debian%208%2C%209%2C%20and%2010&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">7</span><span>shares</span></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}