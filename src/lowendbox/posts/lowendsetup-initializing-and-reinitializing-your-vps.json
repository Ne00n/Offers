{"id": "23974", "post": "<div class=\"post-23974 post type-post status-publish format-standard hentry category-tutorials tag-ansible tag-cloud-init tag-linux tag-sysadmin tag-system-administration\" id=\"post-23974\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/lowendsetup-initializing-and-reinitializing-your-vps/\" rel=\"bookmark\">LowEndSetup: Initializing and Reinitializing Your VPS</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" width=\"16\" height=\"16\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/ansible/\" rel=\"tag\">ansible</a>, <a href=\"https://lowendbox.com/tag/cloud-init/\" rel=\"tag\">cloud-init</a>, <a href=\"https://lowendbox.com/tag/linux/\" rel=\"tag\">linux</a>, <a href=\"https://lowendbox.com/tag/sysadmin/\" rel=\"tag\">sysadmin</a>, <a href=\"https://lowendbox.com/tag/system-administration/\" rel=\"tag\">system administration</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" width=\"16\" height=\"16\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> October 14, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/06/powerbutton.png\" loading=\"lazy\" class=\"alignright size-full wp-image-28453 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/powerbutton.png\" alt=\"Power Button\" width=\"300\" height=\"300\" align=\"right\" hspace=\"20\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/powerbutton.png 300w, https://lowendbox.com/wp-content/uploads/2020/06/powerbutton-150x150.png 150w\" data-sizes=\"(max-width: 300px) 100vw, 300px\" sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/powerbutton.png 300w, https://lowendbox.com/wp-content/uploads/2020/06/powerbutton-150x150.png 150w\" data-was-processed=\"true\">If you frequently setup new VPSes or re-initialize them, you may find yourself typing the same commands over and over. There are various technologies to alleviate these hassles and get your environment consistently setup every time without all the manual work.</p><h1>Big Boy Solutions</h1><p>If you\u2019re managing many systems, you may wish to invest in Ansible or some other configuration management tool such as Puppet, Chef, or Salt. If your provider supports it, you could consider using cloud-init, which allows you to declare configurations using a YAML syntax.</p><h1>A Low End Solution</h1><p>Since I\u2019m generally using lowend providers whose environments do not support fancy cloud tools, I generally use the following method to setup new hosts.</p><p>After logging in as root, I do the following:</p><pre>apt-get -y install git\ngit clone https://github.com/raindog308/setup.git\ncd setup\n./setup_debian10.sh &lt;hostname&gt;</pre><p>This repository is a private repo on github, so it\u2019s available anywhere.</p><h1>The Setup Script</h1><p>This is an example of a setup script I use.</p><p><span id=\"more-23974\"></span></p><pre>#!/bin/bash\n\nHOSTNAME_FQDN=${1}\n\nif [ -z \"${HOSTNAME_FQDN}\" ] ; then\n  echo \"ERROR: HOSTNAME_FQDN not set!\"\n  echo \"Aborting.\"\n  exit 1\nfi</pre><p>Takes the hostname as a first argument, since there\u2019s no way for the script to know what we want to call the box. So, as an example, I\u2019d execute this as</p><pre>  ./setup_debian10.sh deb10.lowend.party</pre><p>Continuing with the script:</p><pre>echo \"updating sshd config\"\nsed -i 's/^Port/^#Port/' /etc/ssh/sshd_config\necho \"Port 5555\" &gt;&gt; /etc/ssh/sshd_config\nsed -i 's/^PermitRootLogin/#PermitRootLogin/' /etc/ssh/sshd_config\necho \"PermitRootLogin prohibit-password\" &gt;&gt; /etc/ssh/sshd_config\nsed -i 's/^UseDNS/#UseDNS/' /etc/ssh/sshd_config\necho \"UseDNS no\" &gt;&gt; /etc/ssh/sshd_config\nsystemctl restart ssh</pre><p>I precede each section with an echo command stating what it\u2019s doing to make troubleshooting easier (otherwise many commands execute silently).</p><p>These commands setup sshd, specifically:</p><ul><li>change the port</li><li>disable root password logins</li><li>disable UseDNS</li></ul><p>Note that for each configuration change there are two commands:</p><ol><li>a sed in-place edit command that comments out any existing config for that directive. So for example, any line that begins with Port is commented out</li><li>an echo statement that appends the sshd directive to the sshd_config file. (It does not matter what order directives appear in).</li></ol><pre>echo \"updating /etc/profile\"\necho \"set -o vi\" &gt;&gt; /etc/profile\necho \"alias ll='ls -al'\" &gt;&gt; /etc/profile</pre><p>These are some \u201ccreature comforts\u201d I put in /etc/profile. You could also put them in individual user .bash_profiles.</p><pre>echo \"generating locales\"\nlocale-gen --purge en_US.UTF-8</pre><p>This sets my preferred locale.</p><pre>echo \"setting timezone\"\ntimedatectl set-timezone America/Los_Angeles</pre><p>This sets my preferred timezone.</p><pre>echo \"apt-get update\"\napt-get update \nprint \"apt-get upgrade\"\napt-get -y upgrade</pre><p>This updates apt and applies all upgrades.</p><pre>echo \"apt-get faves\"\napt-get -y install unzip dnsutils nmap</pre><p>These are tools I find useful to have on all systems. You may have a different list.</p><pre>echo \"setting hostname\"\necho $HOSTNAME_FQDN &gt; /etc/hostname\nhostname -F /etc/hostname</pre><p>Here we set the hostname, both in the config file and for the running system.</p><pre>echo \"configuring root .ssh\"\nif [ ! -d /root/.ssh ] ; then\n  mkdir /root/.ssh\nfi\nif [ ! -d /root/.ssh ] ; then\n  echo \"ERROR: could not mkdir /root/.ssh\"\n  echo \"Aborting.\"\nexit 1\nfi\nchown root:root /root/.ssh\nchmod 700 /root/.ssh\necho 'ssh-rsa SSH-KEY-TEXT-HERE' &gt; /root/.ssh/authorized_keys\nchown root:root /root/.ssh/authorized_keys\nchmod 600 /root/.ssh/authorized_keys</pre><p>These commands ensure that root\u2019s .ssh is setup properly and installs my ssh key.</p><h1>Further Improvements</h1><ul><li>This is a sample of how to do a quick and dirty system setup that only takes a couple commands. Some other things you might consider doing:</li><li>adding users (e.g., \u201cuseradd -m -s /bin/bash raindog308\u201d). If you want to set passwords, <a href=\"https://www.cyberciti.biz/tips/howto-write-shell-script-to-add-user.html\">read this article</a>.</li><li>setting root\u2019s password</li><li>git cloning setup files for nginx and other web components, then using sed (or perl) to tweak the setups for what you\u2019re doing</li><li>setting up mail (e.g., postfix), including configuring aliases and running newaliases</li><li>setting up additional scripts to setup different kinds of servers, so you can call the main, universal setup and then call other scripts as needed</li></ul><p>&nbsp;</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/locking-down-access-to-your-vps/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Locked Door\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/06/locked_down_door-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Locking Down Access to Your VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-audit-every-command-run-on-your-linux-system/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"audit\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/10/auditctl-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Audit Every Command Run on Your Linux System</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/cloudlinux-announces-support-for-centos-8-through-2025/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/12/centos-logo-300-150x150.png.webp) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CloudLinux Announces Support for CentOS 8 Through 2025</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/udemy-has-free-courses-on-python-linux-sql-machine-learning-and-more/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Udemy\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/09/udemy-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Udemy Has Free Courses on Python, Linux, SQL, Machine Learning, and More!</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}