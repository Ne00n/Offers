{"id": "1457", "post": "<div class=\"post-1457 post type-post status-publish format-standard hentry category-editorial tag-xen\" id=\"post-1457\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-tell-your-xen-vps-is-overselling-memory/\" rel=\"bookmark\">How to Tell Your Xen VPS is Overselling Memory?</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/xen/\" rel=\"tag\">xen</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> November 13, 2010 @ 2:48 pm, by LowEndAdmin</div><div class=\"storycontent tablelook\"><p>Alright. We all know OpenVZ VPS are <em>generally</em> oversold in either memory, disk space or bandwidth (or all of them). Overselling memory and disk space is <b>easy</b>. You just <code>vzctl create</code> a new virtual environment <em>regardless</em> whether there is sufficient memory or disk space. Piece of cake. But a sure fire-way to anger your clients if overdone.</p><p>That too is also one of many arguments against OpenVZ, especially when it is compared to Xen. <em>\u201cOpenVZ got oversold resources. Xen VPS has dedicated memory, blah blah blah.\u201d</em> Well. Not entirely true.</p><p><span id=\"more-1457\"></span></p><p>2 weeks ago I got a cheap VPS from a provider in Asheville NC. Someone who should probably remain anonymous here :) It is a <b>Xen VPS</b> running Ubuntu 10.04 and 64bit Linux 2.6.32 kernel. 512MB of memory, 25GB of disk space and more bandwidth than I ever need. Pretty good price too. So I logged in and check how much memory it got\u2026</p><pre class=\"code\"># <b>free</b>\n             total       used       free     shared    buffers     cached\nMem:        543776     535360       8416          0      66516     130504\n-/+ buffers/cache:     338340     205436\nSwap:      1048568        136    1048432\n</pre><p>Hmm. 330MB of memory already used for my brand new Xen VPS. Let\u2019s see what processes are running.</p><pre class=\"code\"># <b>ps aux</b>\n...\n\nroot       204  0.0  0.1  17028   780 ?        S    Oct27   0:00 upstart-udev-bridge --daemon\n102        356  0.0  0.1  23548  1080 ?        Ss   Oct27   0:00 dbus-daemon --system --fork\nroot       431  0.0  0.1  21068   788 ?        Ss   Oct27   0:00 cron\nroot      3110  0.0  0.5 253832  2992 ?        Sl   Oct28   0:00 /usr/sbin/console-kit-daemon --no-daemon\nroot     11037  0.0  0.1  49256  1012 ?        Ss   Oct28   0:00 /usr/sbin/sshd\nroot     15427  0.0  0.1  12520   772 ?        S    Oct28   0:00 /usr/sbin/syslogd --no-forward\nroot     31231  0.0  0.0  16748   436 ?        S&lt;s  Nov12   0:00 udevd --daemon\nroot      5716  0.0  0.6  79100  3772 ?        Ss   01:02   0:00 sshd: root@pts/0\nroot      5731  0.0  0.3  19400  2148 pts/0    Ss   01:02   0:00 -bash\nroot      5782  0.0  0.1   6072   724 ?        Ss   01:08   0:00 /sbin/getty -8 38400 hvc0\nroot      5783  0.0  0.2  15248  1172 pts/0    R+   01:08   0:00 ps --sort=start_time uax\n</pre><p>Yes. That\u2019s it \u2014 there is <b>nothing</b> memory intensive running on the box. SSH server, syslogd, cron and that\u2019s about it. So where did my 330MB of used memory disappear into?</p><p>Before digging any further, here is the fact. <b>You can most definitely oversell memory on Xen VPS</b>. Something that is well known for years, although it is not something Xen providers want to talk about. It uses a technique called <b>ballooning</b>.</p><p>Basically a special Linux kernel driver is installed on your system \u2014 the \u201cballoon driver\u201d. When dom0 (the Xen server/hypervisor) needs more memory, and wishes to claim some from the guest VPS (domU), it asks the guest VPS\u2019s balloon driver to <em>inflate</em> itself \u2014 by asking its Linux kernel for some memory. Kernel memory allocation will be requested from the available memory for that VPS, and cannot be paged out to swap. Once the balloon driver consumes the memory, it then passes to dom0/hypervisor to be used elsewhere (creating a new VPS for example). So the amount of your VPS\u2019s \u201ctotal memory\u201d will stay the same, but there will be a big increase in \u201cused memory\u201d, as a big chunk has now been used by the balloon driver inside the kernel, and possibly now a part of another VPS. A user-land daemon \u201cxenballoond\u201d (a bash script actually) is also available to allow dynamic ballooning, although I did not see that in my VPS.</p><p>I guess it <em>might</em> explain why I have 330MB of memory used, while I only have a very small number of processes running.</p><p>I found this file in procfs interesting:</p><pre># <b>cat /proc/xen/balloon</b>\nCurrent allocation:   524288 kB\nRequested target:     524288 kB\nMinimum target:       173056 kB\nMaximum target:       532480 kB\nLow-mem balloon:        8192 kB\nHigh-mem balloon:          0 kB\nDriver pages:            224 kB\n</pre><p>I can\u2019t seem to be able to find sufficient document on explaining what those value mean. It looks like my VPS has requested 512MB of memory (Request target), and has currently allocated so (Current allocation). However at the same time it also has \u201cMinimum target\u201d \u2014 the minimum amount of memory reserved for this VPS to prevent it from FUBAR when the balloon requested too much \u2014 set to 169MB. Would that mean that is how much memory that is really guaranteed to my VPS?</p><p>It\u2019s certainly something that I am not familiar with and maybe some providers can enlighten us. However the conclusion remains the same. Overselling on Xen is certainly possible.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-tell-your-xen-vps-is-overselling-memory%2F&amp;t=How%20to%20Tell%20Your%20Xen%20VPS%20is%20Overselling%20Memory%3F\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20to%20Tell%20Your%20Xen%20VPS%20is%20Overselling%20Memory%3F&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-tell-your-xen-vps-is-overselling-memory%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-tell-your-xen-vps-is-overselling-memory%2F&amp;title=How%20to%20Tell%20Your%20Xen%20VPS%20is%20Overselling%20Memory%3F&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/hostsailor-512mb-kvm-vps-for-just-1-mo-in-the-netherlands-many-more-options/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"HostSailor - Cheap KVM and XEN VPS in the Netherlands\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2017/10/HOSTSAILER-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">HostSailor - 512MB KVM VPS for just $1/mo in the Netherlands + Many More Options!</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/servarica-10-month-3gb-vps-with-3-tb-disk-space-in-montreal-canada/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"servarica com 2015-02-27 13-52-59\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2015/02/servarica-com-2015-02-27-13-52-59-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Servarica - $10/month 3GB Xen VPS with 3 TB disk space in Montreal, Canada</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/ait-1-for-first-month-on-512mb-xen-vps-w-unlimited-bandwidth-in-the-usa/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"AIT \u2013 $1 for first month on 512MB Xen VPS w/ UNLIMITED bandwidth in the USA!\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2018/04/AIT-site-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">AIT \u2013 $1 for first month on 512MB Xen VPS w/ UNLIMITED bandwidth in the USA!</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/gbservers-6-00-mo-xen-w-windows-1gb-ram-60gb-hd-800gb-bw-in-maidenhead-uk/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"GBServers \u2013 \u00a36.00/mo Xen w/ Windows / 1GB RAM / 60GB HD / 800GB BW \u2013 in Maidenhead, UK\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2017/12/gbservers-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">GBServers \u2013 \u00a36.00/mo Xen w/ Windows / 1GB RAM / 60GB HD / 800GB BW \u2013 in Maidenhead, UK</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/admin/\" title=\"All posts by LowEndAdmin\" rel=\"author\">LowEndAdmin</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/11a4d9191634a9374eeca7d0e8982ba2?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/11a4d9191634a9374eeca7d0e8982ba2?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">The original owner of LowEndBox known as \"LowEndAdmin\" or \"LEA\" for short founded LowEndBox in 2008 and created the concept of hosting applications on low resource \"Low End Boxes\". After creating the roots of the community that we know today, \"LEA\" stepped aside and allowed others to carry the torch forward.</p></div></div><div class=\"feedback\"></div></div>"}