{"id": "23255", "post": "<div class=\"post-23255 post type-post status-publish format-standard hentry category-tutorials tag-mysql tag-mysql-tweaks tag-tuning-mysql tag-tutorial\" id=\"post-23255\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/tuning-mysql-101-the-big-things-to-look-at/\" rel=\"bookmark\">Tuning MySQL 101: The Big Things to Look At</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/mysql/\" rel=\"tag\">mysql</a>, <a href=\"https://lowendbox.com/tag/mysql-tweaks/\" rel=\"tag\">mysql tweaks</a>, <a href=\"https://lowendbox.com/tag/tuning-mysql/\" rel=\"tag\">tuning mysql</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> April 9, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p>Database tuning is an art, rather than a science. I speak as someone who\u2019s worked as a professional DBA for over 15 years and is certified in multiple commercial RDBMS techologies. There is no set of formulas that can be presented that work in all cases, because the data sets and workloads are too variable. If we had a server with static data, unchanging server configuration, and known workloads, we could work out the ideal configuration\u2026but if would only be useful in that one fixed scenario.</p><p>However, we can generalize some good techniques for RDBMS tuning and point out some high-level areas to look at.</p><h1>Rule #1: Avoid Overtuning</h1><p>There are tons of bottons, knobs, dials, switches, and configuration parameters. The vast majority do not need to changed. Do not change any parameters without a specific reason for doing so. The more obscure the parameter, the less likely that you need to change it. Also be careful to observe only tuning advice that is relevant to your particular version. Because things live forever on the Internet, there is advice out there for tuning MySQL 3.x and 4.x that would be completely inappropriate for MariaDB 10. For example, many parameters discussed in older tuning guids are MyISAM-related, and devoting memory to benefitting MyISAM tables is pointless if you\u2019re using InnoDB tables.</p><p><span id=\"more-23255\"></span></p><h1>Tune Your Code and Your Structure</h1><p>The #1 thing you can do to improve database performance is to write good SQL and have a solid database structure. Both topics are far beyond what can be taught in a tutorial but some major areas to look at are:</p><ol><li>Is the data you\u2019re querying properly indexed? A single index can often vastly improve performance, because it\u2019s the difference between going to a single address in a couple steps versus driving up and down the entire street.</li><li>Is your data over-indexed? If you index every single column, you\u2019ll find inserting and updating data to be much slower because the engine has to maintain all those indexes.</li><li>Are you using bind variables? They reduce parsing work for the engine.</li><li>Have you profiled (EXPLAIN PLAN) your query? Look at the most expensive parts and see if you can rewrite them, then explain again, then rewrite, then explain\u2026</li></ol><p>As an illustration of the power of indexing, consider this table:</p><pre>MariaDB [tester]&gt; desc data;\n+------------+-------------+------+-----+---------+-------+\n| Field      | Type        | Null | Key | Default | Extra |\n+------------+-------------+------+-----+---------+-------+\n| id         | int(11)     | YES  | MUL | NULL    |       |\n| first_name | varchar(30) | YES  |     | NULL    |       |\n| last_name  | varchar(30) | YES  |     | NULL    |       |\n+------------+-------------+------+-----+---------+-------+</pre><p>Without any indexing this simple query takes .3 seconds (on a very busy MariaDB server) when there are 50,000 rows in the table:</p><pre>select * from data where id = 2482;\nreal 0m0.305s</pre><p>After creating an index and doing a similar query:</p><pre>create index idx1 on data(id):\n\nselect * from data where id = 16159;\nreal 0m0.014s</pre><p>An improvement of 21x! And that\u2019s from a change that can be done online.</p><h1>The Slow Query Log</h1><p>Not sure which queries to attack? Turn on the slow query log by placing the following in your .my.cnf configs. MariaDB Will create a log of queries that that more than 1 second to complete.</p><pre>slow-query-log = 1\nslow-query-log-file = /var/lib/mysql/mysql-slow.log\nlong_query_time = 1</pre><p>You can also turn on logging for queries that don\u2019t use indexes with the following .my.cnf directive:</p><pre>log_queries_not_using_indexes=ON</pre><h1>innodb_buffer_pool_size</h1><p>Buffer pool is for caching retrieved table and index data in memory. This is the \u201cbig one\u201d and you want to tune it as high as your RAM will permit \u2013 as high as 60-80% of RAM. A cached query is much faster than a query the engine has to recompute.</p><h1>Thread Pool Size and Connections</h1><p>Your max_connections should be set to a reasonable peak. If you exceed this number, no one can connect, which definitely impacts performance :-)</p><p>The thread_pool_size parameter sizes the thread pool, as you might expect. When a thread is released (by a closed connection), it goes back into the thread pool for reuse. A reasonable number is 2x CPUs, but going above 16 is rarely necessary.</p><h1>Temp Tables</h1><p>MariaDB uses temp tables for sorting. If you have a big sort (ORDER BY, etc.) that exceeds the limit set for temp tables, then MariaDB may have to page to disk, which is much slower.</p><p>There are two parameters to consider. max_heap_table_size is the maximum size for any temporary table (either users using in-memory tables or the engine). tmp_table_size is the max temporary table size you can set, but it cannot be bigger than max_heap_table_size, so size them in unison. How big to make it? The dreaded \u201cit depends\u201d is applicable here. Set it as big as the likely peak of all sorted rows.</p><p>You can use use these status variables to see if you\u2019re creating temp files on disk. If you are, you need more temp table space.</p><pre>show status like 'Created_tmp_disk_tables' \nshow status like 'Created_tmp_disk'</pre><h1>Reverse DNS</h1><p>One easy way to improve performance is to turn off reverse DNS lookups. By default, MariaDB will do a reverse DNS lookup on the client\u2019s IP for record-keeping, but you can disable this by putting this parameter in your .my.cnf files:</p><pre>skip-name-resolve</pre><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/your-own-private-videoconference-running-jitsi-meet-on-your-vps/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Your Own Private Videoconference on your VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/private-video-conference-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Your Own Private Videoconference: Running Jitsi Meet on Your VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/running-your-own-openvpn-vpn-server/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Running Your Own OpenVPN VPN Server\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/running-your-own-openvpn-server-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Running Your Own OpenVPN VPN Server</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/puffy-vs-penguin-getting-started-with-openbsd/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Puffy vs Penguin Getting Started With OpenBSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/puffy-vs-penguin-openbsd-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Puffy vs. Penguin: Getting Started With OpenBSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/getting-started-with-the-dolphin-mysql-101-full-setup-and-how-to-guide/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup MySQL - A Full Setup and How to Guide\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/05/getting-strated-with-the-dolphin-mysql-101-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Getting Started With the Dolphin: MySQL 101 - Full Setup and How to Guide</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}