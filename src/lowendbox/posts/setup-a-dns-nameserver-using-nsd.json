{"id": "22550", "post": "<div class=\"post-22550 post type-post status-publish format-standard hentry category-tutorials tag-dns tag-nameserver tag-nsd tag-tutorial\" id=\"post-22550\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\" rel=\"bookmark\">Setup a DNS Nameserver Using NSD</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/dns/\" rel=\"tag\">DNS</a>, <a href=\"https://lowendbox.com/tag/nameserver/\" rel=\"tag\">nameserver</a>, <a href=\"https://lowendbox.com/tag/nsd/\" rel=\"tag\">nsd</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> November 11, 2020 @ 5:37 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a href=\"https://lowendbox.com\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-300x169.png.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-300x169.png.webp\" alt=\"\" width=\"300\" height=\"169\" data-was-processed=\"true\"></a>You can still buy little 128MB VPSes for $10-15 per year and they are perfect for serving DNS.&nbsp;&nbsp;A nameserver does not take much memory or CPU. Indeed, once it\u2019s setup, you\u2019ll probably find your nameserver isn\u2019t doing much at all, because so much is cached with other DNS servers. It just serves as the authority.&nbsp; Of course, if you have bigger VPSes, they can do double duty as DNS nameservers as well.</p><p>Why not just use your registrar\u2019s DNS?&nbsp; Why not indeed \u2013 often that is a great option.&nbsp; But if you want more control or if you want to make updating DNS records part of some automated workflow, then you\u2019ll want to run your own nameservers.</p><p>This tutorial is geared towards a super-simple (dare we say lowend?) DNS setup. We\u2019ll be using NSD, a very lightweight DNS server. While the most-widely used package is BIND, BIND is designed to support every possible option and feature, which is overkill for most people. If you just want to setup DNS for your servers and act as the authority for your domain, NSD is a much simpler solution. I\u2019m also going to give you the basics and defaults, without getting into explaining every single option.</p><p>DNS can be complex! But this will get you going on a basic setup.</p><p><span id=\"more-22550\"></span></p><p>Things I won\u2019t be covering:</p><ul><li>reverse DNS: typically this is setup through your hosting provider</li><li>zone transfers: but I\u2019ll show you how to setup two authoritative NSD servers and synchronize them</li><li>MX records: but it\u2019s obvious how to set them up once you\u2019ve mastered the steps below</li></ul><p>Here is how we\u2019ll configure NSD:</p><ul><li>Two servers, each of which listen for DNS on their public interfaces.</li><li>/etc/nsd/nsd.conf will contain the NSD configuration specific to that server</li><li>/etc/nsd/zones will contain all the zone files (the DNS records for your domain(s))</li><li>We\u2019ll use rsync to keep both servers in sync. NSD supports zone transfers, but it complicates the setup and is unnecessary if all you\u2019re doing is DNS for a few domains and it doesn\u2019t change much. If you have a lot of DNS changes and a complex setup, then this tutorial isn\u2019t for you :-)</li></ul><p>In this example, we\u2019re setting up DNS for this configuration:</p><pre>Nameserver #1: ns1.example.com at 1.23.45.67\nNameserver #2: ns2.example.com at 1.23.45.68\nbigvps.example.com is a web server at 1.23.45.100\nwww.example.com is an alias for bigvps</pre><p>Of course, you can\u2019t host DNS for example.com \u2013 only the owner of example.com can. So replace \u2018example.com\u2019 with your own domain.</p><p>I\u2019m using CentOS 7 but the procedure is very similar for other distros and chiefly only differs in the way you get the package for your OS.</p><h1>Step One: Install nsd</h1><p>We\u2019ll start on ns1. I recommend using your distro\u2019s package manager. For CentOS, you will need to use the EPEL repo.</p><pre>yum -y install epel-release\nyum install nsd\nsystemctl enable nsd</pre><p>On Debian:</p><p>apt-get install nsd<br>\nsystemctl enable nsd</p><h1>Step Two: Open firewall ports</h1><p>If you\u2019re not using a firewall, you can skip this. If you\u2019re using iptables, then you\u2019ll need to open port 53 for udp. The exact configuration will depend on how you\u2019ve setup your firewall, but it\u2019ll be something that looks like this:</p><pre>iptables -A INPUT -p udp --dport 53 -j ACCEPT</pre><p>Of course, if you\u2019re firewalling outgoing as well, you\u2019d need to open a port on OUTPUT, too.&nbsp; If you\u2019re using a firewall package such as ConfigServer, etc. check your firewall documentation.&nbsp; The main thing is that DNS needs port 53 UDP incoming and outgoing</p><pre>Step Three: Configure nsd.conf</pre><p>The main config file is in /etc/nsd/nsd.conf. Here is an example. You should probably save the file that comes with nsd for future reference:</p><pre>cp /etc/nsd/nsd.conf /etc/nsd/nsd.conf.dist</pre><p>Now edit /etc/nsd/nsd.conf as follows:</p><pre># The 'server:' section is the configuration for the DNS server\nserver:\n# this is the IP address it will listen on for DNS requests\n# change this to the public-facing IP address of your VPS\nip-address: 1.23.45.67\n\n# no need to tell people what version we're running\nhide-version: yes\n\n# the database to use\ndatabase: \"/var/lib/nsd/nsd.db\"\n\n# log file\nlogfile: \"/var/log/nsd.log\"\n\n# Number of NSD servers to fork.\nserver-count: 1\n\n# we'll use a separate \"zone list\" file to make rsync easier\ninclude: \"/etc/nsd/zones/zone_list.conf\"</pre><p>Very simple!</p><h1>Step Four: Configure zone_list.conf</h1><p>This file is simply a list of all the zones. You could put this info in the main nsd.conf file, but our goal is to use rsync to keep the two nameservers in sync. We don\u2019t want to rsync nsd.conf itself, because the ip-address field is unique to each server. We only want to rsync what changes, which is the zone files. So we\u2019ll be rsyncing the zone files and the zone_list.conf, which is a list of the zone files.</p><p>The zone files can be owned by nsd or root. I have mine owned by root, so the nsd user can read them but not change them.</p><pre>mkdir /etc/nsd/zones\nvi /etc/nsd/zones/zone_list.conf</pre><p>zone_list.conf should look like this:</p><pre>zone:\nname: example.com\nzonefile: /etc/nsd/zones/example.com</pre><p>This means \u201cthere will be a zone named example.com, and you can find its records in /etc/nsd/zones/example.com\u201d. You can define as many zones here as you want.</p><h1>Step Four: Lather, Rinse, Repeat on ns2</h1><p>Do steps 1-3 for ns2.example.com. The only thing you need to change is the ip-address line in /etc/nsd/nsd.conf</p><h1>Step Five: Configure zone_list.conf</h1><p>This is probably the most complicated part. The format of the zone file is the same one BIND uses.</p><p>Back on ns1, edit /etc/nsd/zones/example.com:</p><pre>$ORIGIN example.com. \n$TTL 3600\n\n@ IN SOA ns1.example.com. admin.example.com. (\n2011102301 ; serial number\n28800 ; Refresh\n7200 ; Retry\n864000 ; Expire\n86400 ; Min TTL\n)\n\nIN NS ns1.example.com.\nIN NS ns2.example.com.\n\nns1 IN A 1.23.45.67\nns2 IN A 1.23.45.68\nbigvps IN A 1.23.45.100\nwww IN CNAME bigvps</pre><p>Well, what a lot of arcane syntax! Let\u2019s take it line by line, but first, let me point out something very important: the dots at the end of domain names as shown here are very important. When you say \u201cns1.example.com.\u201d (with the trailing dot) it means \u201ctreat that as the FQDN). If you just typed \u201cns1.example.com\u201d you\u2019d actually mean \u201cns1.example.com.example.com\u201d which is not what you want.</p><p>Now let\u2019s look through the file:</p><pre>$ORIGIN example.com.</pre><p>\u201cThis is the origin of all DNS information on example.com\u201d. This line must be first. Again, note the trailing dot.</p><pre>$TTL 3600</pre><p>TTL means \u201ctime to live\u201d which means \u201cother DNS servers, you should cache this for 3600 seconds (one hour)\u201d. That is a good setting.</p><pre>@ IN SOA ns1.example.com. admin.example.com. (</pre><p>\u201cSOA\u201d is \u201cStart of Authority\u201d. @ is shorthand for \u201cexample.com.\u201d The two names that follow it are the primary DNS server and then an email contact, rewritten in a dot notation format. In this case, admin.example.com. means \u201cadmin@example.com\u201d.</p><pre>2020050101 ; serial number\n28800 ; Refresh\n7200 ; Retry\n864000 ; Expire\n86400 ; Min TTL\n)</pre><p>Since we\u2019re not doing zone transfers, only the \u2018serial number\u2019 really matters. But it\u2019s important! Every time you change this file, you need to increment the serial number.</p><p>An old trick is to use a YYYYMMDDXX format, so the first change on May 1, 2020 is 2020050101, the second change on that day would be 2020050102, etc. You could of course just use 1, 2, 3, etc., but the date format is commonly done.</p><p>The point of the serial number increment is that this tells other DNS resolvers (and yours) if the file has changed. Otherwise, they don\u2019t bother reparsing it.</p><p>I\u2019m not going to go into the other records (refresh, retry, etc.) If you want to read up on them, try this link:</p><p><a href=\"http://www.zytrax.com/books/dns/ch8/soa.html\">http://www.zytrax.com/books/dns/ch8/soa.html</a></p><pre>IN NS ns1.example.com.\nIN NS ns2.example.com.</pre><p>These define what nameservers are valid for this domain. You need to have at least two (at least, you really should :-)</p><pre>ns1 IN A 1.23.45.67\nns2 IN A 1.23.45.68\nbigvps IN A 1.23.45.100\nwww IN CNAME bigvps</pre><p>Finally, we get into the actual records. Here we\u2019ve defined three \u201cA\u201d records and one \u201cCNAME\u201d record. There are other types, but these are the most common. MX (for mail exchange) is the next most common type.</p><p>An A record is a forward DNS record. In this case, if you ask the nameserver \u201cwhat is the IP address for bigvps.example.com\u201d it will tell you \u201c1.23.45.100\u201d. We\u2019ve defined three such records here.</p><p>A CNAME record is an alias. You can have as many aliases as you want. For example, you might have Apache/NGINX setup to host forum.example.com, http://www.example.com, and gallery.example.com on the same host:</p><pre>bigvps IN A 1.23.45.100\nwww IN CNAME bigvps\nforum IN CNAME bigvps\ngallery IN CNAME bigvps</pre><h1>Step Six: rsync</h1><p>Now you\u2019ve finished the zone list setup on ns1. You should have an entry for example.com in your /etc/nsd/zones/zone_list.conf file, and the above DNS record in /etc/nsd/zones/example.com file. You want to get these files to ns2. From ns1:</p><pre>cd /etc/nsd\nrsync -avz zones ns2:/etc/nsd</pre><p>You could also use scp if you wished.</p><h1>Step Seven: start nsd</h1><p>On both ns1 and ns2, we first need to \u201ccompile\u201d the zones and then we can start:</p><pre>nsdc rebuild\n/etc/init.d/nsd start</pre><p>Do the same thing on ns2.</p><p>Later when you add more records, you can do this:</p><ul><li>Modify on ns1. Don\u2019t forget to increment serial numbers :-)</li><li>If you add a new domain (zone), put the corresponding zone: entry in /etc/nsd/zones/zone_list.conf</li><li>rsync to ns2 to keep it in sync</li></ul><p>On both ns1 and ns2, execute \u201cnsdc rebuild\u201d and \u201cnsdc reload\u201d. This will load the changes without having to stop/start nsd.</p><h1>Step Eight: Your Registrar</h1><p>You\u2019ll need to use your registrar\u2019s web site to set the nameservers for your domain. For example.com, you need to define both the nameserver (ns1.example.com) and the IP address. For other domains you want to use ns1.example.com/ns2.example.com as DNS authorities, you just specify the DNS servers. So, for example, if you bought yahoo.com and wanted to use ns1.example.com and ns2.example.com to do the DNS, you\u2019d set the DNS nameservers for yahoo.com to ns1.example.com and ns2.example.com (and of course create the zone file/zone list entry).</p><p>&nbsp;</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-a-dns-nameserver-using-nsd%2F&amp;t=Setup%20a%20DNS%20Nameserver%20Using%20NSD\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Setup%20a%20DNS%20Nameserver%20Using%20NSD&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-a-dns-nameserver-using-nsd%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-a-dns-nameserver-using-nsd%2F&amp;title=Setup%20a%20DNS%20Nameserver%20Using%20NSD&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/managing-your-lowendempire-with-ansible-part-1/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Managing Your LowEndEmpire With Ansible, Part 1\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Managing Your LowEndEmpire With Ansible, Part 1</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-nameservers-on-a-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Nameservers on a VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-setup-nameservers-on-a-vps-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Nameservers on a VPS</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}