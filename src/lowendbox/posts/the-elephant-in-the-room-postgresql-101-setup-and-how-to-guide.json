{"id": "23264", "post": "<div class=\"post-23264 post type-post status-publish format-standard hentry category-tutorials tag-postgres tag-postgres-guide tag-postgresql tag-postgressql tag-setup-postgres\" id=\"post-23264\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/the-elephant-in-the-room-postgresql-101-setup-and-how-to-guide/\" rel=\"bookmark\">The Elephant in the Room: PostgreSQL 101 \u2013 Setup and How to Guide</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/postgres/\" rel=\"tag\">postgres</a>, <a href=\"https://lowendbox.com/tag/postgres-guide/\" rel=\"tag\">postgres guide</a>, <a href=\"https://lowendbox.com/tag/postgresql/\" rel=\"tag\">postgresql</a>, <a href=\"https://lowendbox.com/tag/postgressql/\" rel=\"tag\">PostgresSQL</a>, <a href=\"https://lowendbox.com/tag/setup-postgres/\" rel=\"tag\">setup postgres</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> March 9, 2021 @ 6:47 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a target=\"_blank\" rel=\"noopener noreferrer\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/05/postgresql-101.jpg.webp\" loading=\"lazy\" class=\"screenshot litespeed-loaded\" title=\"How to Setup PostgreSQL - A Full Setup and How to Guide\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/05/postgresql-101.jpg.webp\" alt=\"How to Setup PostgreSQL - A Full Setup and How to Guide\" width=\"410\" height=\"235\" data-was-processed=\"true\"></a>MariaDB and PostgreSQL are the two leading SQL databases. Both adhere to many ANSI SQL standards, but these ANSI standards don\u2019t specify all behaviors. The SQL statement themselves (such as SELECT, INSERT, UPDATE, and DELETE) are the areas where they have the most commonality. Where they differ the most is in their DDL (data definition language) commands, and the administrative/server components. In this tutorial, we\u2019ll cover PostgreSQL.</p><h1>History</h1><p>PostgreSQL (sometimes called Postgres) is the successor to Ingres, which was a project at the University of California, Berkeley. Originally known simply as POSTGRES (a play on words), it was renamed to PostgreSQL in 1996.</p><h1>Install</h1><p>To install PostgreSQL on Debian systems:</p><pre>apt-get install postgresql</pre><p>On CentOS systems:</p><pre>yum -y install postgresql-server\n<span id=\"more-23264\"></span></pre><h1>Post-Install Steps</h1><p>On Debian, PostgreSQL comes ready to roll. On Centos, you need to initialize Pg with this command:</p><pre># /usr/bin/postgresql-setup --initdb\n* Initializing database in '/var/lib/pgsql/data'\n* Initialized, logs are in /var/lib/pgsql/initdb_postgresql.log</pre><h1>Configuration Files</h1><p>On Debian systems, PostgreSQL configuration lives in /etc/postgresql/VERSION/main. So if you\u2019re running version 11, the configuration files are in</p><pre>/etc/postgresql/11/main</pre><p>On Centos, PostgreSQL configuration files can be found in /var/lib/pgsql/data, regardless of version.</p><h1>Starting and Stopping</h1><p>PostgreSQL starts and starts like a normal systemd service:</p><pre>systemctl start postgresql\nsystemctl stop postgresql</pre><h1>Connecting</h1><p>Typically you would connect this way from the command line:</p><pre>psql -U someuser -W -h localhost somedb\nPassword:\npsql (11.7 (Debian 11.7-0+deb10u1))\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\nType \"help\" for help.\n\nsomedb=&gt;</pre><p>The reason we use -h localhost is to force a network connection. Otherwise, peer authentication is used and PostgreSQL would expect your Unix username to be the same as your database username.</p><p>If connecting from an application, note that by default PostgreSQL runs on port 5432.</p><h1>Super User Access</h1><p>In PostgreSQL, the system \u2018postgres\u2019 account is the superuser.</p><pre># su - postgres\n$ psql \npsql (11.7 (Debian 11.7-0+deb10u1))\nType \"help\" for help.\n\npostgres=#</pre><h1>Scripted Access</h1><p>If you are scripting PostgreSQL (perhaps for backups), you can eliminate the need to enter a password. There are two methods for accomplishing this. The first is to set the PGPASSWORD environment variable:</p><pre>export PGPASSWORD=some-password</pre><p>However, be advised that any user can see this environment variable in the process table. Hence, it\u2019s better to use method two, which is to create a .pgpass file in the user\u2019s home directory. It must be owned by that user and set to read/write by that user only:</p><pre># touch ~/.pgpass\n# chmod 600 ~/.pgpass</pre><p>Then populate it with this format:</p><pre>hostname:port:database:username:password</pre><p>For example:</p><pre>localhost:5432:somedb:user1:my-password</pre><p>Then you could do this without a password:</p><pre>psql -U user1 -h localhost somedb</pre><h1>Backing Up Databases</h1><p>PostgreSQL can be backed up with the pg_dump program, which dumps your database to a .sql file that contains the SQL instructions for recreating the database. Basic usage for dumping a database called \u2018mydb\u2019 looks like this:</p><pre>$ pg_dump mydb &gt; /some/path/mydb.sql</pre><p>To dump all databases:</p><pre>pg_dumpall &gt; /some/path/all.sql</pre><h1>Creating a New Database</h1><pre>$ psql\npsql (11.7 (Debian 11.7-0+deb10u1))\nType \"help\" for help.\n\npostgres=# create database new1;\nCREATE DATABASE\npostgres=#</pre><p>You can also us the \u2018createdb\u2019 program in the shell:</p><pre>$ createdb new2</pre><h1>Switching to a Database</h1><p>Most PostgreSQL commands start with a backslash. For example, to switch databases, use \\c (for \u201cconnect\u201d):</p><pre>$ psql\npsql (11.7 (Debian 11.7-0+deb10u1))\nType \"help\" for help.\n\npostgres=# \\c new1;\nYou are now connected to database \"new1\" as user \"postgres\".\nnew1=#</pre><h1>Creating a User</h1><pre>new1=# create user someone with password 'something';\nCREATE ROLE</pre><p>To grant privileges on a database:</p><pre>new1=# grant all privileges on database new1 to someone;\nGRANT</pre><p>Note that this does not, as you might think, grant all privileges on all tables and sequences in that database. It only grants the ability to connect to that database and create objects. If you need to grant the ability to select, update, etc. existing tables, then you need to grant privileges on those tables individually. Alternatively, you can make the new user the owner of the database:</p><pre>new1=# alter database new1 owner to someone;\nALTER DATABASE</pre><h1>Listing Databases and Tables</h1><p>To list databases, use the \\l (for list) command:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMjgyIiB2aWV3Qm94PSIwIDAgODAwIDI4MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-full wp-image-23265\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/05/pg1.png.webp\" alt=\"\" width=\"800\" height=\"282\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/05/pg1.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/05/pg1-300x106.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/05/pg1-768x271.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\"></p><p>To list tables, use \\dt:</p><pre>dvdrental=&gt; \\dt\nList of relations\nSchema  | Name          | Type  | Owner \n--------+---------------+-------+----------\npublic  | actor         | table | postgres\npublic  | address       | table | postgres\npublic  | category      | table | postgres\npublic  | city          | table | postgres\npublic  | country       | table | postgres\npublic  | customer      | table | postgres\npublic  | film          | table | postgres\npublic  | film_actor    | table | postgres\npublic  | film_category | table | postgres\npublic  | inventory     | table | postgres\npublic  | language      | table | postgres\npublic  | payment       | table | postgres\npublic  | rental        | table | postgres\npublic  | staff         | table | postgres\npublic  | store         | table | postgres\n(15 rows)</pre><h1>Creating Tables</h1><p>Creating tables is a very standard SQL command. In this case, we are setting the \u2018id\u2019 column to be the primary key and also declaring it as type \u201cserial\u201d, which means that it will automatically increase with every insert.</p><pre>CREATE TABLE superheroes (\nid serial primary key,\nhero_name varchar(30),\nsecret_identity varchar(30),\nteam varchar(30)\n);\n\nheroes=# CREATE TABLE superheroes (\nheroes(# id serial primary key,\nheroes(# hero_name varchar(30),\nheroes(# secret_identity varchar(30),\nheroes(# team varchar(30)\nheroes(# );\nCREATE TABLE\nheroes=#</pre><h1>Inserting Data</h1><pre>We'll add some rows, but we don't need to include the 'id' column in our insert statement because it will auto-increment for us. The \"START TRANSACTION\" is optional, as we'll explain next;\n\nSTART TRANSACTION;\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Iron Man', 'Tony Stark', 'Avengers');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Captain America', 'Steve Rogers', 'Avengers');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Thor', 'Donald Blake', 'Avengers');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('She-Hulk', 'Jennifer Walters', 'Avengers');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Wolverine', 'Logan', 'X-Men');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Cyclops', 'Scott Summers', 'X-Men');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Shadowcat', 'Kitty Pryde', 'X-Men');\nINSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Colossus', 'Piotr Rasputin', 'X-Men');\n\nheroes=# START TRANSACTION;\nSTART TRANSACTION\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Iron Man', 'Tony Stark', 'Avenger\ns');\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Captain America', 'Steve Rogers',\n'Avengers');\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Thor', 'Donald Blake', 'Avengers'\n);\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('She-Hulk', 'Jennifer Walters', 'A\nvengers');\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Wolverine', 'Logan', 'X-Men');\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Cyclops', 'Scott Summers', 'X-Men\n');\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Shadowcat', 'Kitty Pryde', 'X-Men\n');\nINSERT 0 1\nheroes=# INSERT INTO superheroes (hero_name, secret_identity, team) VALUES ('Colossus', 'Piotr Rasputin', 'X-M\nen');\nINSERT 0 1\nheroes=#</pre><h1>Transactions</h1><p>We\u2019re in the middle of a transaction thanks to the START TRANSACTION statement. From our perspective, this is what the superheroes table looks like:</p><pre>heroes=# select count(*) from superheroes;\ncount \n-------\n8\n(1 row)</pre><p>However, logging in from another session and running the same query produces this:</p><pre>heroes=# select count(*) from superheroes;\ncount \n-------\n0\n(1 row)</pre><p>This is because we haven\u2019t committed the data yet. Let\u2019s do so.</p><pre>heroes=# commit;\nCOMMIT\nheroes=#</pre><p>Now both queries show:</p><pre>heroes=# select count(*) from superheroes;\ncount \n-------\n8\n(1 row)</pre><p>Let\u2019s try one more transaction. I\u2019m going to delete one of the heroes:</p><pre>START TRANSACTION;\nDELETE FROM superheroes WHERE hero_name = 'Thor';\n\nheroes=# START TRANSACTION;\nSTART TRANSACTION\nheroes=# DELETE FROM superheroes WHERE hero_name = 'Thor';\nDELETE 1\nheroes=#</pre><pre>heroes=# select count(*) from superheroes;\ncount \n-------\n7\n(1 row)</pre><p>However, in the other session, I still see all rows:</p><pre>heroes=# select count(*) from superheroes;\ncount \n-------\n8\n(1 row)</pre><p>I could COMMIT in session #1, but I also have the option to ROLLBACK \u2013 in other words, abandon my changes. In this case, it\u2019s only one statement, but I could have hundreds or thousands of statements pending commit. A COMMIT would apply them all, and a ROLLBACK would roll them all back. In this case, I\u2019ll rollback:</p><pre>heroes=# rollback;\nROLLBACK\nheroes=# select count(*) from superheroes;\ncount \n-------\n8\n(1 row)</pre><h1>Querying Data</h1><p>To query data, we use SELECT in the from \u201cSELECT (columns) FROM (table)\u201d and then optionally adding clauses to filter data (WHERE), group data (GROUP BY), and sort data (ORDER BY). Some examples:</p><pre>heroes=# select secret_identity from superheroes where hero_name = 'Iron Man';\nsecret_identity \n-----------------\nTony Stark\n(1 row)</pre><p>I can use \u201c*\u201d to mean all columns:</p><pre>heroes=# select * from superheroes where hero_name = 'Thor';\nid | hero_name | secret_identity | team \n----+-----------+-----------------+----------\n3 | Thor | Donald Blake | Avengers\n(1 row)</pre><p>Of course, I may have many rows:</p><pre>heroes=# select hero_name, secret_identity from superheroes where team = 'Avengers' order by hero_name;\nhero_name | secret_identity \n-----------------+------------------\nCaptain America | Steve Rogers\nIron Man | Tony Stark\nShe-Hulk | Jennifer Walters\nThor | Donald Blake\n(4 rows)</pre><p>I can also use various database functions to summarize data:</p><pre>heroes=# select team, count(*) from superheroes group by team order by team;\nteam | count \n----------+-------\nAvengers | 4\nX-Men | 4\n(2 rows)</pre><h1>Deleting Data</h1><p>PostgreSQL uses a standard DELETE statement:</p><pre>heroes=# delete from superheroes where team = 'X-Men';\nDELETE 4</pre><h1>Updating Data</h1><p>Perhaps She-Hulk decides to leave the Avengers (nerds: she joined in Avengers #221 and left in Avengers #243):</p><pre>heroes=# update superheroes set team = NULL where hero_name = 'She-Hulk';\nUPDATE 1\nheroes=# select hero_name from superheroes where team = 'Avengers' order by hero_name;\nhero_name \n-----------------\nCaptain America\nIron Man\nThor\n(3 rows)</pre><h1>Learning More</h1><p>\u2013 The official <a href=\"https://www.postgresql.org/\">PostgreSQL page</a> and <a href=\"https://www.postgresql.org/docs/\">documentation</a><br>\n\u2013 The <a href=\"https://www.postgresqltutorial.com/postgresql-sample-database/\">\u201cdvdrental\u201d database</a>, which is an unofficial but useful PostgreSQL test database</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-install-moodle-on-ubuntu-18-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Install Moodle on Ubuntu 18.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2019/07/moodle-vector-logo-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Install Moodle on Ubuntu 18.04</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}