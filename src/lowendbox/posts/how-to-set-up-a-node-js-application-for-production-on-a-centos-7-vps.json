{"id": "19843", "post": "<div class=\"post-19843 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-centos-7 tag-lets-encrypt tag-nginx tag-node-js tag-npm-packages tag-reverse-proxy\" id=\"post-19843\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-set-up-a-node-js-application-for-production-on-a-centos-7-vps/\" rel=\"bookmark\">How To Set Up a Node.js Application for Production on a CentOS 7 VPS</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/centos-7/\" rel=\"tag\">CentOS 7</a>, <a href=\"https://lowendbox.com/tag/lets-encrypt/\" rel=\"tag\">Let's Encrypt</a>, <a href=\"https://lowendbox.com/tag/nginx/\" rel=\"tag\">nginx</a>, <a href=\"https://lowendbox.com/tag/node-js/\" rel=\"tag\">node.js</a>, <a href=\"https://lowendbox.com/tag/npm-packages/\" rel=\"tag\">npm packages</a>, <a href=\"https://lowendbox.com/tag/reverse-proxy/\" rel=\"tag\">Reverse Proxy</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> June 10, 2019 @ 2:09 pm, by Dusko Savic</div><div class=\"storycontent tablelook\"><p>In this tutorial, we will create a simple <a href=\"https://nodejs.org/en/\"><strong>Node.js</strong></a> application and put it into a production ready environment. We are going to install and use the following pieces of software:</p><ul><li><a href=\"https://www.nginx.com/\"><strong>Nginx</strong></a> as a reverse proxy. It will make the app accessible from your browser, and in case you ran several sites from the same server, it could serve as a load balancer as well.</li><li><a href=\"https://certbot.eff.org/\"><strong>Certbot</strong></a> will let us install Let\u2019s Encrypt certificates. Access to the site will be secure as only the HTTPS requests will be honored.</li><li>NPM package called <a href=\"https://pm2.io/doc/en/runtime/overview/\"><strong>PM2</strong></a> will turn a node.js app into a service. The app will run in the background, even after system crashes or reboots.</li></ul><p><span id=\"more-19843\"></span></p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMjIiIGhlaWdodD0iMTk3IiB2aWV3Qm94PSIwIDAgMzIyIDE5NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://nodejs.org/static/images/logos/nodejs-new-pantone-black.png\" alt=\"\" width=\"322\" height=\"197\"></p><h2 id=\"whatwearegoingtocover\">What We Are Going To Cover</h2><ul><li>Install Nginx</li><li>Install <em>firewall-cmd</em> and enable rules for Nginx</li><li>Install the latest version of Node.js</li><li>Add NPM packages for the app that we are making</li><li>Create the example app to show all characters in upper case</li><li>Configure Nginx as a reverse proxy</li><li>Install Let\u2019s Encrypt certificates to serve HTTPS requests</li><li>Access the app from the browser</li><li>Install PM2, a production process manager for Node.js applications with a built-in traffic Load Balancer</li><li>Use PM2 to restart the Node.js app on every restart or reboot of the system</li></ul><h2 id=\"prerequisites\">Prerequisites</h2><p>We use Centos 7:</p><ul><li>Starting with a clean VPS with</li><li>At least 512Mb of RAM and</li><li>15Gb of free disk space.</li><li>You will need root user access via SSH</li><li>A domain name pointed to your server\u2019s IP address (it can also be a subdomain) using A records at your DNS service provider</li><li>We use <em>nano</em> as our editor of choice, and you can install it with this command:</li></ul><pre><code>yum install nano\n</code></pre><h2 id=\"step1installnginx\">Step 1: Install Nginx</h2><p>After you have logged in as a root user, you will install Nginx. Add the CentOS 7 EPEL repository with this command:</p><pre><code>yum install epel-release\n</code></pre><p>Next, install Nginx:</p><pre><code>yum install nginx\n</code></pre><p>Press \u2018y\u2019 twice and the installation will be finished. Enable Nginx service to start at server boot:</p><pre><code>systemctl enable nginx\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDkiIGhlaWdodD0iNjYiIHZpZXdCb3g9IjAgMCA2NDkgNjYiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/qu2930o.png\" alt=\"\" width=\"649\" height=\"66\"></p><h2 id=\"step2changefirewallrulestoenablenginx\">Step 2: Change Firewall Rules to Enable Nginx</h2><p>Let\u2019s now install <em>firewall-cmd</em>, the command line front-end for <strong>firewalld</strong> (firewalld daemon), for CentOS. It supports both IPv4 and IPv6, firewall zones, bridges and ipsets, allows for timed firewall rules in zones, logs denied packets, automatically loads kernel modules, and so on.</p><p>Install it in the usual manner, by using yum:</p><pre><code>yum install firewalld\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTkiIGhlaWdodD0iMjUyIiB2aWV3Qm94PSIwIDAgNTE5IDI1MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/gNd6PLs.png\" alt=\"\" width=\"519\" height=\"252\"></p><p>Let us now start it, enable it to auto-start at system boot, and see its status:</p><pre><code>systemctl start firewalld\nsystemctl enable firewalld\nsystemctl status firewalld\n</code></pre><p>Node.js apps require a port that is not used by the system, but is dedicated to that one app only. In our examples, we might use ports such as 3000, 8080 and so on, so we need to declare them explicitly, otherwise the app won\u2019t run.</p><p>Here is a list of ports and feel free to add any other that your host requires for the normal functioning of the system:</p><pre><code>firewall-cmd --permanent --zone=public --add-service=ssh\nfirewall-cmd --zone=public --add-port=3000/tcp --permanent\nfirewall-cmd --zone=public --add-port=8080/tcp --permanent\nfirewall-cmd --permanent --zone=public --add-service=http\nfirewall-cmd --permanent --zone=public --add-service=https\nfirewall-cmd --reload\n</code></pre><p>Let us now start Nginx:</p><pre><code>systemctl start nginx\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1ODAiIGhlaWdodD0iMjM1IiB2aWV3Qm94PSIwIDAgNTgwIDIzNSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/lOOFvdc.png\" alt=\"\" width=\"580\" height=\"235\"></p><p>With HTTP functioning, we can visit this address in the browser:</p><pre><code>http://YOUR_DOMAIN/\n</code></pre><p>and verify that Nginx is running:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMzQ2IiB2aWV3Qm94PSIwIDAgNjAwIDM0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/rFG8ebU.png\" alt=\"\" width=\"600\" height=\"346\"></p><h2 id=\"step3installlatestnodejs\">Step 3: Install Latest Node.js</h2><p>We\u2019ll now install the latest release of Node.js. First, install development tools to build native add-ons (<em>make</em>, <em>gcc-c++</em>) and then enable Node.js yum repository from the Node.js official website:</p><pre><code>yum install -y gcc-c++ make\ncurl -sL https://rpm.nodesource.com/setup_12.x | sudo -E bash -\n</code></pre><p>Now, the repository is added to your VPS and we can install the Node.js package. NPM, the package manager for Node.js, will also be installed, as well as many other dependent packages in the system.</p><pre><code>yum install nodejs\n</code></pre><p>Press \u2018y\u2019 twice to finish the installation. Show the version of Node.js that is installed:</p><pre><code>node -v\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDgiIGhlaWdodD0iNzQiIHZpZXdCb3g9IjAgMCA0MDggNzQiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/GHLyKxL.png\" alt=\"\" width=\"408\" height=\"74\"></p><p>It shows v12.3.1, which was the actual version at the time of this writing. If it shows an error, double check the commands you entered against the ones shown above.</p><h2 id=\"step4addingnpmpackages\">Step 4: Adding NPM Packages</h2><p>We of course know what packages our Node.js app will need, so we install the required npm packages in advance. Since our app will turn any input into uppercase letters, we first install a package for that:</p><pre><code>npm install upper-case\n</code></pre><p>Most Node.js apps will now use Express.js, so let\u2019s install that as well:</p><pre><code>npm install --save express\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjUiIGhlaWdodD0iMTYzIiB2aWV3Qm94PSIwIDAgNTI1IDE2MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/gBZ07pO.png\" alt=\"\" width=\"525\" height=\"163\"></p><p>Execute this command as well:</p><pre><code>npm install -g nginx-generator\n</code></pre><p>It will globally install an NPM package to generate the reverse proxy config for Nginx. We will apply it after the app is running on port 8080.</p><h2 id=\"step5creatingtheapp\">Step 5: Creating The App</h2><p>Open a file named <em>uppercase-http.js</em> for editing:</p><pre><code>nano uppercase-http.js\n</code></pre><p>Add the following lines:</p><pre><code>var http = require('http');\nvar uc = require('upper-case');\nconsole.log('starting...');\nhttp.createServer(function (req, res) {\n  console.log('received request for url: ' + req.url);\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(uc(req.url + '\\n'));\n  res.end();\n}).listen(8080);\n</code></pre><p>Save and close the file.</p><p>The HTTP server will listen to port 8080. You can specify any other port that you like, provided that it will be free when the app is running (and that you have previously opened access to it in <em>firewalld</em>).</p><p>Run the app:</p><pre><code>node uppercase-http.js\n</code></pre><p>You will see the following message:</p><pre><code>starting...\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" title=\"Node.js app starting\" data-src=\"https://i.imgur.com/hMVcnNx.png\" alt=\"Node.js app starting\"></p><p>To test it, fire up another terminal, connect to your VPS as <em>root</em> via SSH and curl <em>localhost:8080</em>:</p><pre><code>curl localhost:8080/test\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzciIGhlaWdodD0iMjI4IiB2aWV3Qm94PSIwIDAgNTc3IDIyOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/wAHnclw.png\" alt=\"\" width=\"577\" height=\"228\"></p><p>The program correctly converted path to uppercase. The server app shows a status message for the request:</p><pre><code>received request for url: /test\n</code></pre><p>Now we have two terminal windows, one with the app running and the other which we used to test the app. The first window is blocked as long as the app is running and we can press Ctrl-C from keyboard to stop it. If we do so, the app won\u2019t be running later when we access it from the browser. The solution is to either activate the app again or \u2014 much cleaner \u2014 enter further commands only into the second terminal window for the rest of this tutorial.</p><h2 id=\"step6configurenginxasreverseproxy\">Step 6: Configure Nginx as Reverse Proxy</h2><p>Nginx for CentOS comes without folders for available and enabled sites, as is the custom on Ubuntu Linux. You\u2019ll need to create them:</p><pre><code>mkdir /etc/nginx/sites-available\nmkdir /etc/nginx/sites-enabled\n</code></pre><p>Then, edit Nginx global configuration to load config files from these folders:</p><pre><code>nano /etc/nginx/nginx.conf\n</code></pre><p>Find line</p><pre><code>include /etc/nginx/conf.d/*.conf;\n</code></pre><p>and insert these lines:</p><pre><code>include /etc/nginx/sites-enabled/*;\nserver_names_hash_bucket_size 64;\n</code></pre><p>Save and close the file. Now Nginx will read the contents of the \u201cenabled\u201d sites.</p><p>For the sake of completness, our <em>nginx.conf</em> file looks like this:</p><pre><code>user  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n    server_names_hash_bucket_size 64;\n</code></pre><p>You may want to copy it and paste it.</p><p>With NPM package <em>nginx-generator</em> we generate files that will tell Nginx to act as a reverse proxy. In the command line, execute the following:</p><pre><code>nginx-generator \\\n      --name site_nginx \\\n      --domain YOUR_DOMAIN \\\n      --type proxy \\\n      --var host=localhost \\\n      --var port=8080 \\\n      /etc/nginx/sites-enabled/site_nginx\n</code></pre><p>Replace YOUR_DOMAIN with your actual domain before running this command.</p><p>That command creates a file called <em>site_nginx</em> and puts it into the directory /etc/nginx/sites-enabled/. (We could have used any other name instead of site_nginx for the file.)</p><p>We can see it with this command:</p><pre><code>sudo nano /etc/nginx/sites-enabled/site_nginx\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzIiIGhlaWdodD0iNTQyIiB2aWV3Qm94PSIwIDAgNTcyIDU0MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/xVQk5BD.png\" alt=\"\" width=\"572\" height=\"542\"></p><p>Test the configuration:</p><pre><code>sudo nginx -t\n</code></pre><p>and if everything is OK, restart Nginx:</p><pre><code>systemctl restart nginx\n</code></pre><p>Run the app again:</p><pre><code>node uppercase-http.js\n</code></pre><p>You will see the following message:</p><pre><code>starting...\n</code></pre><p>In your browser, go to address</p><pre><code>http://YOUR_DOMAIN/test\n</code></pre><p>and the result should be</p><pre><code>/TEST\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://i.imgur.com/Vqx8fHC.png\" alt=\"\"></p><h3 id=\"badgatewaycaseno1theappisnotactive\">Bad Gateway Case No. 1 \u2013 The App is Not Active</h3><p>Instead of proper result, which in this particular case would be text printed in uppercase letters, it is all too easy to get the message <strong>Bad Gateway</strong> in this place.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyODUiIGhlaWdodD0iMTE4IiB2aWV3Qm94PSIwIDAgMjg1IDExOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/Yi30T5n.png\" alt=\"\" width=\"285\" height=\"118\"></p><p>The main reason is that we were using one teminal window to both run the app and insert other commands. When you start the app with <strong>node uppercase-http.js</strong>, it will block the entire window and when you want to try out the next command in the installation process, the app will stop running. One way to prevent this is to repeat starting the app all over again, as we have done in this tutorial.</p><p>Another way would be to open two terminal windows, start the app in one of them and then proceed with further commands in the second terminal window, exclusively.</p><h3 id=\"badgatewaycaseno2selinuxisactive\">Bad Gateway Case No. 2 \u2013 SELinux Is Active</h3><p>If SELinux is enabled, it can block Nginx from making outbound connections.</p><p>You can check this with:</p><pre><code>getenforce\n</code></pre><p>If you get <strong>Enforcing</strong> as the result, SELinux is active. Run this command to let Nginx serve as a reverse proxy:</p><pre><code>setsebool -P httpd_can_network_connect true\n</code></pre><h2 id=\"step7securingyoursitetoserveonlyhttps\">Step 7: Securing Your Site To Serve Only HTTPS</h2><p>We want to serve our app via a HTTPS request. If you have a domain name and DNS records properly set up to point to your VPS, you can use <a href=\"https://certbot.eff.org/\">certbot</a> to generate Let\u2019s Encrypt certificates. This means that you will always access the app as well as the rest of your domain, via HTTPS.</p><p>We will folow the <a href=\"https://certbot.eff.org/\">original documentation to install Let\u2019s Encrypt</a>. Choose Nginx for <em>Software</em> and Centos/RHEL 7 for <em>System</em> \u2013 it should look like this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjQiIGhlaWdodD0iMzIzIiB2aWV3Qm94PSIwIDAgNTI0IDMyMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"Nginx Certbot Site\" data-src=\"https://i.imgur.com/NR0cmXK.png\" alt=\"Certbot Certbot Site\" width=\"524\" height=\"323\"></p><p>Certbot is packaged in EPEL (Extra Packages for Enterprise Linux). To use Certbot, you must first enable the EPEL repository. On CentOS, you must also enable the optional channel, by issuing the following commands:</p><pre><code>yum -y install yum-utils\nyum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional\n</code></pre><p>Now install the Certbot by executing this:</p><pre><code>yum install certbot python2-certbot-nginx\n</code></pre><p>It will compute the dependencies needed and ask you to let it proceed with the installation.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjYiIGhlaWdodD0iNjE3IiB2aWV3Qm94PSIwIDAgNTY2IDYxNyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/l6q2t7t.png\" alt=\"\" width=\"566\" height=\"617\"></p><p>Press \u2018y\u2019 when asked.</p><p>Finally, run Certbot:</p><pre><code>certbot --nginx\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1ODgiIGhlaWdodD0iNjIwIiB2aWV3Qm94PSIwIDAgNTg4IDYyMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/w2GMSoE.png\" alt=\"\" width=\"588\" height=\"620\"></p><p>If you are installing certificates for the fist time, Certbot will ask for an emergency email address, then several less important questions and finally \u2013 do you want to redirect all HTTP traffic to HTTPS? Select 2 to confirm this redirection, and you\u2019re all set!</p><p>Activate Nginx as you normally would after each change in parameters:</p><pre><code>systemctl restart nginx\n</code></pre><p>To verify that redirection is working, go to the same address in your browser:</p><pre><code>https://YOUR_DOMAIN/test\n</code></pre><p>Note that this address started with HTTP, but that it ended up as HTTPS.</p><p><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://i.imgur.com/VVJzMgm.png\" alt=\"\"></p><h2 id=\"step8installpm2\">Step 8: Install PM2</h2><p>PM2 is a production process manager for Node.js applications. With PM2, we can monitor applications, their memory and CPU usage. It also provides easy commands to stop/start/restart all apps or individual apps.</p><p>Once the app is started through PM2, it will always be restarted after system crashes or restarts. In effect, it will \u201calways be there\u201d.</p><p>Use NPM to install PM2:</p><pre><code>npm install pm2@latest -g\n</code></pre><p>Option <em>-g</em> tells it to install pm2 globally, so it can run from all paths in the system.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MzIiIGhlaWdodD0iMjExIiB2aWV3Qm94PSIwIDAgNTMyIDIxMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/QPMUMn7.png\" alt=\"\" width=\"532\" height=\"211\"></p><p>Let\u2019s now run our application under PM2:</p><pre><code>pm2 start uppercase-http.js\n</code></pre><p>The output of PM2 can be spectacular when run for the first time, but we really need to concentrate on the rows about the app:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzYiIGhlaWdodD0iNzM0IiB2aWV3Qm94PSIwIDAgNTc2IDczNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/91focMz.png\" alt=\"\" width=\"576\" height=\"734\"></p><p>PM2 will use app name, and then show the <em>id</em> number of the app, mode, status, CPU usage and memory. If two or more apps are running in the background, they will all be presented in this table.</p><p>We can list the processes like this:</p><pre><code>pm2 list\n</code></pre><p>The following command</p><pre><code>pm2 show 0\n</code></pre><p>will show details of the app with ID of 0:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTEiIGhlaWdodD0iNzQ0IiB2aWV3Qm94PSIwIDAgNTkxIDc0NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/WJ9nggM.png\" alt=\"\" width=\"591\" height=\"744\"></p><p>It is also possible to monitor CPU usage in real time:</p><pre><code>pm2 monit\n</code></pre><p>Other useful PM2 commands are <em>stop</em>, <em>restart</em>, <em>delete</em>.</p><h2 id=\"whatcanyoudonext\">What Can You Do Next</h2><p>Now you have a node.js app in a production environment, using HTTPS protocol for safety, Nginx for speed and as a reverse proxy, running as a service in the background. We have just installed one such app and one such site, while you may run serveral node.js apps and sites from the same server. We used <em>root</em> user throughout for ease of installation, while for multiples sites you would need multiple non-root users for safety.</p><p>Dusko Savic is a technical writer and programmer.</p><p><a href=\"https://duskosavic.com/blog/\">duskosavic.com</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-a-node-js-application-for-production-on-a-centos-7-vps%2F&amp;t=How%20To%20Set%20Up%20a%20Node.js%20Application%20for%20Production%20on%20a%20CentOS%207%20VPS\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20To%20Set%20Up%20a%20Node.js%20Application%20for%20Production%20on%20a%20CentOS%207%20VPS&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-a-node-js-application-for-production-on-a-centos-7-vps%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-a-node-js-application-for-production-on-a-centos-7-vps%2F&amp;title=How%20To%20Set%20Up%20a%20Node.js%20Application%20for%20Production%20on%20a%20CentOS%207%20VPS&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-configure-reverse-proxy-with-nginx/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Configure Reverse Proxy with NGINX\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Configure Reverse Proxy with NGINX</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/from-zero-to-encrypted-with-nginx-and-lets-encrypt/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Free SSL with NGINX and LetsEncrypt on Debian 10\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-and-lets-encrypt-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Free SSL with NGINX and LetsEncrypt on Debian 10</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}