{"id": "4036", "post": "<div class=\"post-4036 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-4036\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/server-security-ssh-sudo/\" rel=\"bookmark\">Server Security: How to Install Sudo and Configure SSH Server</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> June 29, 2013 @ 11:25 am, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzEiIGhlaWdodD0iNzAiIHZpZXdCb3g9IjAgMCAyNzEgNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\"></p><p>One of the most important aspects of running a server is a good security policy. It is also one of the things that comes last, usually. But if you don\u2019t pay attention to it up front, it\u2019s going to cost you in the long run in case you are breached. This tutorial is one in a series of security-related tutorials (not all will be released sequentially).</p><p>When you install a new machine, the default security configuration often isn\u2019t optimal. For example: CentOS gives&nbsp; you just a root account and Ubuntu doesn\u2019t come with a preconfigured firewall. You often want to secure your server, but most beginners don\u2019t know how to (on the other hand, I\u2019ve seen people with years of experience not understanding the sudo-concept). My goal is to show you how to initially harden your server a bit by configuring the SSH server and my enabling sudo. This can be both done on new installations or on existing machines.</p><p><span id=\"more-4036\"></span></p><p><em>NOTE: I\u2019m using \u2018mpkossen\u2019 as an example username here. Please replace it with a username of your choosing.</em></p><h2>Securing SSH</h2><p>The first thing you should always do with a server, it upload your public key (that matches your private key) and enable password-less login. This will prevent people from guessing passwords to enter your server from ever succeeding. Let\u2019s first upload the public key. From a terminal on a Linux or Mac OS machine, run:</p><blockquote><p>ssh-copy-id -i ~/.ssh/id_rsa.pub root@198.51.100.100</p></blockquote><p>It then asks for the password for the root user. Fill that in. Once that\u2019s done, it gives you a notice telling what has happened.</p><p>What you do here, is copy a public key (in this case .ssh/id_rsa.pub [indicated by -i], which is often the default name for an SSH key) to your server at 198.51.100.100. It then adds the public key to the .ssh/authorized_keys file on the server for the user you\u2019ve used in the command. From this point on, you only need your SSH key to log in. Be sure to use a strong password for it and don\u2019t leave it lying around, since it is the entrance to your server.</p><p>Next, login to the server. We\u2019re going to tweak some SSH server settings to make it more secure. Open up /etc/ssh/sshd_config with an editor (vim, nano, or anything else). First, we\u2019re going to disable password authentication. Look for the following line:</p><blockquote><p>#PasswordAuthentication yes</p></blockquote><p>And change it to:</p><blockquote><p>PasswordAuthentication no</p></blockquote><p>This disables password authentication and forces you to use only public keys. No worries, in case you ever loose your private key you can always access your server via an out-of-band console. In case you have a dedicated server without any out-of-band access, well, don\u2019t loose your private key ;-)</p><p>Now look for the following line:</p><blockquote><p>PermitRootLogin yes</p></blockquote><p>And change it to:</p><blockquote><p>PermitRootLogin no</p></blockquote><p>This disables logging in as root. When these things are done, we would usually restart SSH to get these changes live. However, this time, we need to make sure we have a non-root account with sudo access first. If you\u2019ve installed Ubuntu on a KVM machine, this should already be the case and you can safely run the following command. <strong>WARNING</strong>: if you are currently logged in as root, <em><span style=\"text-decoration: underline;\"><strong>do not log</strong><strong> out</strong></span></em>, or you\u2019ll have a nice trip to your console ;-)</p><p>Again, only as a non-root user with sudo privileges, run:</p><blockquote><p>sudo /etc/init.d/ssh restart</p></blockquote><p>Now, if you\u2019ve run this command, that\u2019s it for you! Otherwise, head over to the next part.</p><h2>How to Install and Configure Sudo</h2><p>Sudo\u2026 the ground of quite some discussion. To many, sudo is an inconvenience. Rightly so, because inconvenience in security is good. If your security doesn\u2019t annoy you ever, you\u2019re either a very patient human being or your security isn\u2019t good enough.</p><p>But why <em>should</em> you use sudo, because inconvenience in itself isn\u2019t an argument. Sudo adds an extra layer of security. When you log in as root, the only thing you need is either your private key or your root password. When you\u2019re in, you\u2019re in and you can do everything you want. Sudo prevents that last part. If you use sudo and somebody manages to get hold of your private key, they can log into the server but still not do much to ruin it, since they haven\u2019t got your password. That alone is, for me, enough reason to use sudo rather than log in as root.</p><p>There are additional reasons for using sudo, which <a href=\"https://help.ubuntu.com/community/RootSudo#Benefits_of_using_sudo\">are listed here</a>. Not all of them are very strong, though.</p><p>So, let\u2019s enable sudo for you. These are instructions for both Ubuntu and CentOS.</p><h3>Installing Sudo: Ubuntu</h3><p>Logged in as root, make sure sudo is installed first:</p><blockquote><p>apt-get install sudo</p></blockquote><p>Once that is done, add a new user:</p><blockquote><p>adduser mpkossen</p></blockquote><p>This will ask you for the password twice, make sure you pick a strong one. It then asks some additional questions like you name, room number, etc. Fill these out to your liking. Once done, you need to confirm the information after which your user was created.</p><p>Next, add it to the sudo group:</p><blockquote><p>usermod -a -G sudo mpkossen</p></blockquote><p>The above command modifies the user. It adds it to the group(s) mentioned by using -G. The -a is for append. If you wouldn\u2019t use -a, the user would <em>only</em> be in the sudo group, causing all kinds of different problems.</p><p>Now the newly created user is all set up, log out and transfer the SSH key for this user (like we\u2019ve done above):</p><blockquote><p>ssh-copy-id -i ~/.ssh/id_rsa.pub mpkossen@198.51.100.100</p></blockquote><p>Finally, log in to the server to disable the root account and clean up. First, disable the root account:</p><blockquote><p>sudo passwd -dl root</p></blockquote><p>What you do here, is delete the root password (-d) and lock the account (-l). From this point on, logging in a root is impossible, even via the CLI.</p><p>Finally, remove root\u2019s SSH authorized_keys:</p><blockquote><p>rm -rf /root/.ssh</p></blockquote><p>And you\u2019re done! From now on, commands that require root access should be prefixed with sudo and you will be asked for your password.</p><h3>Installing Sudo: CentOS</h3><p>Logged in as root, make sure sudo is installed first:</p><blockquote><p>yum install sudo</p></blockquote><p>Once that is done, add a new user:</p><blockquote><p>adduser mpkossen</p></blockquote><p>And add a password to the user:</p><blockquote><p>passwd mpkossen</p></blockquote><p>This will ask you for the password twice, make sure you pick a strong one.</p><p>Next, add sudo right to the user. Run \u2018visudo\u2019. It will open a file. Look for the following line:</p><blockquote><p>root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL=(ALL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL</p></blockquote><p>Add the following line under it:</p><blockquote><p>root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL=(ALL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL<br>\nmpkossen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL=(ALL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL</p></blockquote><p>Now, save the file and exit. What you just did was ensure that user \u2018mpkossen\u2019 can run any command as any user (even as root).</p><p>Now the newly created user is all set up, log out and transfer the SSH key for this user (like we\u2019ve done above):</p><blockquote><p>ssh-copy-id -i ~/.ssh/id_rsa.pub mpkossen@198.51.100.100</p></blockquote><p>Finally, log in to the server to lock the root account and clean up. First, disable the root account:</p><blockquote><p>sudo passwd -l root</p></blockquote><p>What you did here is lock (-l) the root account. You could optionally delete (-d) the password first. CentOS doesn\u2019t like combining -d and -l, though.</p><p>Remove root\u2019s SSH authorized_keys:</p><blockquote><p>rm -rf /root/.ssh</p></blockquote><p>And you\u2019re done! From now on, commands that require root access should be prefixed with sudo and you will be asked for your password.</p><h2>Final notes</h2><p>Now, with the above, you\u2019ve definitely made your server more secure. Other good security practices would add to this one, though. Like keeping a strong password and changing it regularly. The same goes for your SSH key. A good firewall is a must as well, but that is something for a future guide!</p><p>For now, get used to a life with sudo! It\u2019s going to get annoying at some moments, but it is more secure.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fserver-security-ssh-sudo%2F&amp;t=Server%20Security%3A%20How%20to%20Install%20Sudo%20and%20Configure%20SSH%20Server\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Server%20Security%3A%20How%20to%20Install%20Sudo%20and%20Configure%20SSH%20Server&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fserver-security-ssh-sudo%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fserver-security-ssh-sudo%2F&amp;title=Server%20Security%3A%20How%20to%20Install%20Sudo%20and%20Configure%20SSH%20Server&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}