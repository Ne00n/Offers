{"id": "3856", "post": "<div class=\"post-3856 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-3856\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/nagios-tutorial-ubuntu-debian-server-monitoring/\" rel=\"bookmark\">Server Monitoring with Nagios Tutorial</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> April 20, 2013 @ 12:00 am, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p>Nagios is one of the most easy, expandable and trustworthy ways to monitor the status of your server(s). It is highly configurable and even lets you write your own plugins in whatever language you want.</p><p>This article will focus on installing nagios on a single server (and monitor just that server). In order to monitor more than just the nagios server, see my \u2018Remote server monitoring with Nagios\u2019 article. In the context of that article, this will be the nagios server.</p><p>This article also assumes you use a recent version of Ubuntu/Debian, but could very well work on other distributions as well. If there is popular demand for, say, a CentOS-tested version of this guide I will write that.<br>\n<span id=\"more-3856\"></span><br>\n<strong>Getting Nagios up and running</strong><br>\nGetting Nagios up and running in itself is actually pretty easy. Not that configuring it is that hard, but you do need to know where to look. Let\u2019s first get Nagios up and running and then configure it properly so everything will work.</p><p>Before we start, we need to remove sendmail. Nagios pulls in Postfix as a dependency. On OpenVZ\u2019s Ubuntu 12.04 x64 LTS template, sendmail is installed by default. Run this to remove it:</p><blockquote><p>sudo apt-get purge sendmail sendmail-base sendmail-bin sendmail-cf sendmail-doc</p></blockquote><p>Also, make sure the system is up-to-date, otherwise apt-get may not find nagios3 and nagios3-cgi:</p><blockquote><p>sudo apt-get update; sudo apt-get dist-upgrade</p></blockquote><p>Once that\u2019s all done, we can now start by installing Nagios:</p><blockquote><p>sudo apt-get install -y nagios3 nagios3-cgi</p></blockquote><p>This will list Postfix as a dependency. You will be asked to configure it. Select \u2018Internet Site\u2019 and press ENTER.</p><p><a href=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_1.png\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjEyIiB2aWV3Qm94PSIwIDAgMzAwIDIxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-medium wp-image-3857\" title=\"Postfix mail type configuration\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_1-300x212.png.webp\" alt=\"Postfix mail type configuration\" width=\"300\" height=\"212\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_1-300x212.png.webp 300w, https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_1.png.webp 958w\" data-sizes=\"(max-width: 300px) 100vw, 300px\"></a></p><p>Then set the proper system mail name and press ENTER again.</p><p><a href=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_2.png\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjEyIiB2aWV3Qm94PSIwIDAgMzAwIDIxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-medium wp-image-3859\" title=\"Postfix system mail name configuration\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_2-300x212.png.webp\" alt=\"Postfix system mail name configuration\" width=\"300\" height=\"212\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_2-300x212.png.webp 300w, https://lowendbox.com/wp-content/uploads/2013/04/nagios-postfix_step_2.png.webp 958w\" data-sizes=\"(max-width: 300px) 100vw, 300px\"></a></p><p>Finally, it should ask for your nagios administrator password. Fill one out and confirm it.</p><p><a href=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-nagiosadmin_password.png\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjEyIiB2aWV3Qm94PSIwIDAgMzAwIDIxMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-medium wp-image-3858\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-nagiosadmin_password-300x212.png.webp\" alt=\"Nagios nagiosadmin password configuration\" width=\"300\" height=\"212\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2013/04/nagios-nagiosadmin_password-300x212.png.webp 300w, https://lowendbox.com/wp-content/uploads/2013/04/nagios-nagiosadmin_password.png.webp 958w\" data-sizes=\"(max-width: 300px) 100vw, 300px\"></a></p><p>That\u2019s it! You\u2019ve now got Nagios up and running. If you go to http://example.net/nagios3 and log in with \u2018nagiosadmin\u2019 and the password you just entered, you\u2019ll see the Nagios Web Interface. If you click \u2018Services\u2019 in the left-hand menu, you\u2019ll see localhost listed and some checks on \u2018OK\u2019 and some checks on \u2018Pending\u2019. Eventually, they should all become green and \u2018OK\u2019. Nagios just needs some time for the initial checks.</p><p><strong>Getting it all working</strong><br>\nYou\u2019re done, but you\u2019re not done. Nagios may now list the initial check, but some things are still broken. For example, you cannot plan maintenance yet.</p><p>We start by telling nagios to check for external or CGI commands. You perform a CGI command by, for example, scheduling maintenance via the Nagios Web Interface. We have to edit the main nagios config for this, so:</p><blockquote><p>sudo vim /etc/nagios3/nagios.cfg</p></blockquote><p>Look for \u2018check_external_commands\u2019 and enable if by changing \u2018check_external_commands=0\u2019 to:</p><blockquote><p>check_external_commands=1</p></blockquote><p>Next we need to add the www-data user to the nagios group, so it has permissions to certain files. Open up the groups file:</p><blockquote><p>sudo vim /etc/group</p></blockquote><p>And look for this line:</p><blockquote><p>nagios:x:114</p></blockquote><p>And change it to:</p><blockquote><p>nagios:x:114:www-data</p></blockquote><p>We\u2019ve now added www-data to the nagios group.</p><p>The last step for getting Nagios to run is giving execute permissions to one file and one directory. We need to set the executable bit on both the file and the directory because if we just set it on the file, it won\u2019t work. Let\u2019s start with the directory:</p><blockquote><p>sudo chmod g+x /var/lib/nagios3</p></blockquote><p>And then the file:</p><blockquote><p>sudo chmod g+x /var/lib/nagios3/rw</p></blockquote><p>You\u2019ve just made sure CGI commands actually work, not that nagios just listens to them.</p><p>We close up by restarting nagios and apache so all new settings are available:</p><blockquote><p>sudo service nagios3 restart<br>\nsudo service apache2 restart</p></blockquote><p>And we\u2019re done setting up nagios!</p><p><strong>Defining a contact</strong><br>\nNow that we\u2019ve got nagios up and running and have our initial checks for localhost in place, let\u2019s make sure we do get e-mail when something goes wrong.</p><p>Open up the contacts configuration file (sudo vim /etc/nagios3/conf.d/contacts_nagios2.cfg) and look for a code block like this:</p><blockquote><p>define contact{<br>\ncontact_name root<br>\nalias Root<br>\nservice_notification_period 24\u00d77<br>\nhost_notification_period 24\u00d77<br>\nservice_notification_options w,u,c,r<br>\nhost_notification_options d,r<br>\nservice_notification_commands notify-service-by-email<br>\nhost_notification_commands notify-host-by-email<br>\nemail root@localhost<br>\n}</p></blockquote><p>Let\u2019s explain what you\u2019re seeing here and how you\u2019re going to be receiving e-mail.</p><p>The first two lines (contact_name and alias) are identifiers for this contact. You can name the contact whatever you want. Just stay clear of spaces in the contact_name. Feel free to use them in the alias.</p><p>The next two lines refer to a time period from /etc/nagios3/conf.d/timeperiod_nagios2.cfg. In that file, several time periods are configured per day. Check the file out to see which time periods are available. We\u2019re using the timeperiod_name as listed in the timeperiods file in our contacts file:</p><blockquote><p>service_notification_period 24\u00d77<br>\nhost_notification_period 24\u00d77</p></blockquote><p>Those two lines tell us during which time period to send notifications for service and host problems respectively, but only to this contact. You probably see the flexibility we\u2019ve got here.</p><p>Next we look at the type of service/host states we will be receiving notifications for:</p><blockquote><p>service_notification_options w,u,c,r<br>\nhost_notification_options d,r</p></blockquote><p>This is set to send notifications when a service is WARNING (w), UNKOWN (u), CRITICAL (c) or when it recovers from a problem (r). For hosts, we get notified when they are DOWN (d) or when it recovers from a problem (r). You can specify to receive no notifications at all for a certain type (service or host) by putting an \u2018n\u2019 there.</p><p>The next two lines refer to commands defined in the commands file /etc/nagios3/commands.cfg. Open up this file and look around a bit. In our contacts configuration it looks like this:</p><blockquote><p>service_notification_commands notify-service-by-email<br>\nhost_notification_commands notify-host-by-email</p></blockquote><p>When a service notification is going to be sent, it uses the command defined in notify-service-by-email and sends out the e-mail. Same goes for host notifications. Feel free to customize the e-mail in the commands file.</p><p>The last line of this configuration file is what we\u2019ve actually been looking for. The e-mail setting:</p><blockquote><p>email root@localhost</p></blockquote><p>This is where you can define your own e-mail address. When done, reload nagios:</p><blockquote><p>sudo service nagios3 reload</p></blockquote><p>And you should be receiving e-mail notifications when a problem occurs.</p><p><strong>A closing word</strong><br>\nThere\u2019s a lot more to tell about nagios, but you\u2019ve probably already noticed that. We\u2019ve referred to several files which we\u2019ve not handled in detail. The most important next thing is monitoring remote servers and defining checks. For that, I recommend you read my article \u2018Remote server monitoring with Nagios\u2019 which is a follow-up to this one. In that article, we\u2019re going to add a remote server and define a host check. The host check definition explained there can also be used on localhost.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fnagios-tutorial-ubuntu-debian-server-monitoring%2F&amp;t=Server%20Monitoring%20with%20Nagios%20Tutorial\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Server%20Monitoring%20with%20Nagios%20Tutorial&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fnagios-tutorial-ubuntu-debian-server-monitoring%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fnagios-tutorial-ubuntu-debian-server-monitoring%2F&amp;title=Server%20Monitoring%20with%20Nagios%20Tutorial&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}