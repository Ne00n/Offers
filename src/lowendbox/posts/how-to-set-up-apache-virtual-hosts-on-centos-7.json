{"id": "20406", "post": "<div class=\"post-20406 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-apache tag-centos-7 tag-firewalld tag-selinux tag-virtual-hosts tag-yum\" id=\"post-20406\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-set-up-apache-virtual-hosts-on-centos-7/\" rel=\"bookmark\">How To Set Up Apache Virtual Hosts on CentOS 7</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/apache/\" rel=\"tag\">apache</a>, <a href=\"https://lowendbox.com/tag/centos-7/\" rel=\"tag\">CentOS 7</a>, <a href=\"https://lowendbox.com/tag/firewalld/\" rel=\"tag\">firewalld</a>, <a href=\"https://lowendbox.com/tag/selinux/\" rel=\"tag\">SELinux</a>, <a href=\"https://lowendbox.com/tag/virtual-hosts/\" rel=\"tag\">Virtual Hosts</a>, <a href=\"https://lowendbox.com/tag/yum/\" rel=\"tag\">yum</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> August 15, 2019 @ 2:38 pm, by Dusko Savic</div><div class=\"storycontent tablelook\"><p>In this tutorial, we will start with an empty VPS with a freshly installed CentOS 7 and will end up with three different sites sharing the same IP address, hosted on the same machine.</p><p>Apache web server analyzes HTTP request headers and appropriately connects it to the directory structure inside the VPS. The technical term for \u201csites\u201d inside VPS boxes is \u201cvirtual host\u201d \u2013 the server is the \u201chost\u201d to many domains at the same time, hence, they are not real, but only \u201cvirtual\u201d.</p><p>Let\u2019s see how it\u2019s done.</p><p><span id=\"more-20406\"></span></p><h2 id=\"whatwearegoingtocover\">What We Are Going To Cover</h2><ul><li>Creating a Non Root User</li><li>Installing Apache</li><li>Installing and setting up firewall</li><li>Defining File Locations For the Default Apache Page</li><li>Creating File Structure For Our Demo Virtual Hosts</li><li>Granting Permissions</li><li>Creating index.html Pages For Our Demo Sites</li><li>Creating Virtual Hosts Files</li><li>Turning On the New Virtual Host Files</li><li>Testing the Virtual Hosts</li><li>Securing Your Domains With Let\u2019s Encrypt TLS certificates</li></ul><h2 id=\"prerequisites\">Prerequisites</h2><p>We\u2019ll use CentOS 7:</p><ul><li>Starting with a clean VPS with</li><li>At least 512Mb of RAM and</li><li>15Gb of free disk space</li><li>You will need root user access via SSH</li><li>Two domain names pointed to your server\u2019s IP address using A records at your DNS service provider.</li><li>We use nano as our editor of choice, and you can install it with this command:</li></ul><pre><code>sudo yum install nano -y\n</code></pre><h2 id=\"step1updatethesystem\">Step 1: Update the System</h2><p>First, update your system to the latest stable version by running the following command:</p><pre><code>sudo yum update -y\nsudo reboot\n</code></pre><p>It may take several minutes for the transaction to get finished. You can always stop it by pressing Ctrl-C, but Centos will later, while performing another transaction, ask you to finish this transaction first. Be patient.</p><p><img data-lazyloaded=\"1\" src=\"https://i.imgur.com/gP7iUsZ.png\" loading=\"lazy\" class=\"litespeed-loaded\" data-src=\"https://i.imgur.com/gP7iUsZ.png\" alt=\"\" width=\"512\" height=\"305\" data-was-processed=\"true\"></p><h2 id=\"step2createuserwithnonrootprivileges\">Step 2: Create User With Non-root Privileges</h2><p>Sudo is already installed on Centos. Add user <em>simpleuser</em> and make it have access to the <em>sudo</em> command:</p><pre><code>adduser simpleuser\n</code></pre><p>Debian and Ubuntu will automatically ask you for the new user\u2019s password but on Centos you have to do it yourself:</p><pre><code>passwd simpleuser\n</code></pre><p>Add <em>simpleuser</em> to the <em>wheel</em> group:</p><pre><code>usermod -aG wheel simpleuser\n</code></pre><h2 id=\"step3cleanupyumcache\">Step 3: Clean Up yum Cache</h2><p>When installing packages, <em>yum</em> will download them into its special cache. After successful installation, the packages should be deleted from the cache, but it may not always be the case. The following command will clean all cached information:</p><pre><code>sudo yum clean all\n</code></pre><p>It will also reclaim disk space or clear errors due to corrupted metadata files.</p><p>This is a typical result:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzAiIGhlaWdodD0iNzMiIHZpZXdCb3g9IjAgMCA1NzAgNzMiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/YV7OVNM.png\" alt=\"\" width=\"570\" height=\"73\"></p><h2 id=\"step4installapache\">Step 4: Install Apache</h2><p>Apache installation files are in the <em>yum</em> repository, so one command is more than enough to install it:</p><pre><code>sudo yum -y install httpd\n</code></pre><h2 id=\"step5installfirewalldasourfirewall\">Step 5: Install firewalld as Our Firewall</h2><p>Apache uses standard ports 80 and 443 for HTTP and HTTPS traffic, respectively.</p><p>Let\u2019s now install <em>firewall-cmd</em>, the command line front-end for <strong>firewalld</strong> (firewalld daemon), for CentOS. It supports both IPv4 and IPv6, firewall zones, bridges and ipsets, allows for timed firewall rules in zones, logs denied packets, automatically loads kernel modules, and so on.</p><p>Install it in the usual manner, by using yum:</p><pre><code>yum install firewalld\n</code></pre><p>Let us now start it, enable it to auto-start at system boot, and see its status:</p><pre><code>systemctl start firewalld\nsystemctl enable firewalld\nsystemctl status firewalld\n</code></pre><p>Firewall is now running:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NDEiIGhlaWdodD0iMjIxIiB2aWV3Qm94PSIwIDAgNTQxIDIyMSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/UxZtAsP.png\" alt=\"\" width=\"541\" height=\"221\"></p><p>Here is a list of ports and feel free to add any other that your host requires for the normal functioning of the system:</p><pre><code>firewall-cmd --permanent --zone=public --add-service=ssh\nfirewall-cmd --zone=public --add-port=3000/tcp --permanent\nfirewall-cmd --zone=public --add-port=8080/tcp --permanent\nfirewall-cmd --permanent --zone=public --add-service=http\nfirewall-cmd --permanent --zone=public --add-service=https\nfirewall-cmd --reload\n</code></pre><p>We have added addresses 3000 and 8080 as examples only and will not use them in the rest of this text. You should, however, do well to find out the list of ports that the applications on your VPS are going to need and put them in this exact spot for later.</p><p><strong>WARNING</strong><br>\nAlways enable <em>ssh</em>, <em>http</em>, <em>https</em> and other critical ports in <em>ufw</em>, otherwise you will <strong>NOT</strong> be able to log back into your VPS server, nor see you site!</p><p>Now we can start Apache:</p><pre><code>sudo systemctl start httpd\n</code></pre><p>We want Apache to always be there so we make sure that it starts at boot:</p><pre><code>sudo systemctl enable httpd\n</code></pre><p>We can check the status of Apache:</p><pre><code>sudo systemctl status httpd\n</code></pre><p>This would be a typical output for the status of Apache:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjUiIGhlaWdodD0iMzAwIiB2aWV3Qm94PSIwIDAgNTI1IDMwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/DitaGXD.png\" alt=\"\" width=\"525\" height=\"300\"></p><p>The following command, to stop Apache from running, is here for your reference only (do not execute it as a part of this installation)</p><pre><code>sudo systemctl stop httpd\n</code></pre><p>The real test of successful installation is whether you can access files from the server through your local browser. Navigate to this address:</p><pre><code>http://YOUR_DOMAIN/\n</code></pre><p>You should see a welcome page for Apache on CentOS, which means that you now have Apache running on your VPS.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OTEiIGhlaWdodD0iMjc5IiB2aWV3Qm94PSIwIDAgNDkxIDI3OSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/sMFtEwC.png\" alt=\"\" width=\"491\" height=\"279\"></p><h2 id=\"step6configureselinux\">Step 6: Configure SELinux</h2><p>You\u2019ll also need to configure SELinux (a security system within Centos) to allow Apache to operate normally:</p><pre><code>sudo setsebool -P httpd_unified 1\n</code></pre><h2 id=\"step7filelocationsforthedefaultapachepage\">Step 7: File Locations For the Default Apache Page</h2><p>In CentOS, root document directory is in directory <em>/var/www/html</em> and if it contains file <em>index.html</em>, its contentw will be shown to the world. The fresh installation of Centos does NOT contain one such file in that directory and is set up so that in that case, it will show the contents of file</p><pre><code>/usr/share/httpd/noindex/index.html\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjYiIGhlaWdodD0iNjU0IiB2aWV3Qm94PSIwIDAgNTY2IDY1NCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/dZsNNEv.png\" alt=\"\" width=\"566\" height=\"654\"></p><p>That\u2019s the page with grey background and with Testing 1 2 3 as the headline that we have already seen.</p><p>Let us now install an <em>index.html</em> page into proper document root i.e. <em>/var/www/html</em>. Create that file by opening it in <em>nano</em>:</p><pre><code>sudo nano /var/www/html/index.html\n</code></pre><p>and insert the following text:</p><pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n\"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Untitled Document&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"&gt;\n&lt;style type=\"text/css\"&gt;\n&lt;!--\n.style1 {color: #66CC66}\n--&gt;\n&lt;/style&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n&lt;h1&gt;&lt;span class=\"style1\"&gt;Centos 7 Root document index.html file \n  &lt;/span&gt;\n&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>Enter the address of the site into the browser address line and get this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDkiIGhlaWdodD0iNDkiIHZpZXdCb3g9IjAgMCA0MDkgNDkiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/SpSov5s.png\" alt=\"\" width=\"409\" height=\"49\"></p><p>The directories and the index.html files belong to the <em>root</em> user.</p><p>Under CentOS 7, all Apache files are stored in folder <em>/etc/httpd</em>:</p><pre><code>ls -la /etc/httpd\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTciIGhlaWdodD0iMTY4IiB2aWV3Qm94PSIwIDAgNTU3IDE2OCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/RLskXbD.png\" alt=\"\" width=\"557\" height=\"168\"></p><p>We shall now create directories <em>sites-available</em> and <em>sites-enabled</em> which will hold information on sites that exist and on sites that are permitted to be served to the Internet, respectively:</p><pre><code>sudo mkdir /etc/httpd/sites-available /etc/httpd/sites-enabled\n</code></pre><p>You\u2019ll also need to configure Apache to look for them by adding a line of configuration. Open the main config file:</p><pre><code>sudo nano /etc/httpd/conf/httpd.conf\n</code></pre><p>Scroll down to the very end of the file and add the following line:</p><pre><code>IncludeOptional sites-enabled/*.conf\n</code></pre><p>Save and close the file.</p><p>This is what you should see:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjQiIGhlaWdodD0iMjY3IiB2aWV3Qm94PSIwIDAgNTI0IDI2NyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/DR3sokB.png\" alt=\"\" width=\"524\" height=\"267\"></p><p>By adding more config files into <em>/etc/httpd/sites-available</em> and creating the corresponding symbolic links in <em>/etc/httpd/sites-enabled</em>, we can serve different pages to different domains. That is how we can host multiple independent sites off of one and the same IP address.</p><p>Each site in Apache parlance is called \u201cvirtual host\u201d and will have to reside in its own subdirectory. The plan for adding new virtual hosts boils down to</p><ul><li>creating file structure for each site,</li><li>populating HTML and other files in the site,</li><li>creating a new .conf file in <em>/etc/httpd/sites-available</em>, and</li><li>creating a new symbolic link in <em>/etc/httpd/sites-enabled</em>.</li></ul><p>Apache will then do the rest, automatically.</p><h2 id=\"step8creatingfilestructureforourdemovirtualhosts\">Step 8: Creating File Structure For Our Demo Virtual Hosts</h2><p>We will create two virtual hosts called <em>centos1.com</em> and <em>centos2.com</em>. They will correspond to DNS entries <em>centos1.duskosavic.com</em> and <em>centos2.duskosavic.com</em> that we have previously made using A records at our DNS service provider. (Instead of these, you should enter your own site domains.) If we now navigated to http://centos1.duskosavic.com/_ in a browser, the default <em>index.html</em> page with basic Apache information would be served, again.</p><p>Let\u2019s now create a directory to hold our <em>centos1.com</em> site. Apache on Ubuntu stores its HTML files under <em>/var/www/html</em> so we could also use it to create our demo sites there. One possibility is to make that folder the top one and to put the demo sites into it. With commands such as</p><pre><code>cd /var/www/html\nsudo mkdir centos1.com\nsudo mkdir centos2.com\nls -la\n</code></pre><p>we would have the following directory structure:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1OTEiIGhlaWdodD0iMTYzIiB2aWV3Qm94PSIwIDAgNTkxIDE2MyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/mY1reov.png\" alt=\"\" width=\"591\" height=\"163\"></p><p>Here we decide upon the other possibility, and that is to go one level up the directory tree and create the demo sites in <em>/var/www</em>. Inside folders <em>centos1.com</em> and <em>centos2.com</em> we can create whatever directory structure we need, for example:</p><pre><code>cd /var/www\nsudo mkdir -p /var/www/centos1.com/{public_html,private,log,cgi-bin,backup}\nsudo mkdir -p /var/www/centos2.com/{public_html,private,log,cgi-bin,backup}\nls /var/www/centos1.com -la\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTEiIGhlaWdodD0iMTI5IiB2aWV3Qm94PSIwIDAgNTExIDEyOSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/0ELeMLD.png\" alt=\"\" width=\"511\" height=\"129\"></p><h2 id=\"step9grantingpermissions\">Step 9: Granting Permissions</h2><p>From the image above we see that <em>root</em> user is still owning the <em>public_html</em> folder, from which our public files will be served to the Internet. We will now change the ownership so that our <em>simpleuser</em> can access the <em>public_html</em> files. The commands are:</p><pre><code>sudo chown -vR apache:apache /var/www/centos1.com/public_html\nsudo chown -vR apache:apache /var/www/centos2.com/public_html\n</code></pre><p>Also make sure that files in <em>/var/www</em> and its subfolders can be read correctly:</p><pre><code>sudo chmod -R 755 /var/www\n</code></pre><h2 id=\"step10createindexhtmlpagesforourdemosites\">Step 10: Create index.html Pages For Our Demo Sites</h2><p>Our public files will be in <em>/var/www/centos1.com/public_html</em> and <em>/var/www/centos2.com/public_html</em>. We\u2019ll now create an <em>index.html</em> in each of these two folders so that we have something to see while browsing. Using <em>nano</em>, we will create <em>index.html</em> for <em>centos1.com</em>:</p><pre><code>sudo nano /var/www/centos1.com/public_html/index.html\n</code></pre><p>We need only one line of text, preferably in H1 format for better readability. Insert the following text into <em>nano</em>, then save and close the file:</p><pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n\"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;centos1.com Title&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"&gt;\n&lt;style type=\"text/css\"&gt;\nbody,td,th {\n    color: #FF3333;\n}\n&lt;/style&gt;&lt;/head&gt;\n\n&lt;body&gt;\n&lt;h1&gt;This is centos1.com \n&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>Create <em>index.html</em> for <em>centos2.com</em>:</p><pre><code>sudo nano /var/www/centos2.com/public_html/index.html\n</code></pre><p>and paste this in:</p><pre><code>&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n\"http://www.w3.org/TR/html4/loose.dtd\"&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;centos2.com Title&lt;/title&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"&gt;\n&lt;style type=\"text/css\"&gt;\n.style1 {color: #3333FF}\n&lt;/style&gt;&lt;/head&gt;\n\n&lt;body&gt;\n&lt;h1 class=\"style1\"&gt;This is centos2.com&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><h2 id=\"step11createvirtualhostsfiles\">Step 11: Create Virtual Hosts Files</h2><p>We\u2019ll now inform Apache that there are two new sites to be served by creating two new Virtual Hosts.</p><h3 id=\"step11acreatethefirstvirtualhostsfile\">Step 11A: Create the First Virtual Hosts File</h3><p>Create the first virtual host file:</p><pre><code>sudo nano /etc/httpd/sites-available/centos1.com.conf\n</code></pre><p>Paste in the following (and change the domain names to yours):</p><pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin admin@centos1.com\n    ServerName centos1.com\n    ServerAlias centos1.duskosavic.com\n    ServerAlias www.centos1.com\n    DocumentRoot /var/www/centos1.com/public_html\n    #ErrorLog ${APACHE_LOG_DIR}/error.log\n    #CustomLog ${APACHE_LOG_DIR}/access.log combined\n&lt;/VirtualHost&gt;\n</code></pre><p>Here is a detailed explanation of the above virtual host:</p><ul><li><strong>80</strong>: This virtual host will listen on port 80. You can change port number through file <em>httpd.conf</em> with this command:</li></ul><pre><code>sudo nano /etc/httpd/conf/httpd.conf\n</code></pre><p>You\u2019ll find a <em>Listen</em> directive with port 80 specified, and that is where you can customize it. Remember to restart Apache afterwards by running:</p><pre><code>sudo systemctl restart httpd\n</code></pre><ul><li><strong>ServerAdmin</strong>: It is the email address to which Apache will send messages for administrator in case of an error in the system. May be omitted.</li><li><strong>ServerName</strong>: Server name, obviously, it should coincide with the domain name.</li><li><strong>ServerAlias</strong>: Another name for the same server as above. You can have as many of these aliases as you like.</li><li><strong>DocumentRoot</strong>: Points to the absolute address of the site on disk.</li></ul><h3 id=\"step11bcreatethesecondvirtualhostsfile\">Step 11B: Create the Second Virtual Hosts File</h3><p>Do the same for the other site/domain. Here are the commands:</p><pre><code>sudo nano /etc/httpd/sites-available/centos2.com.conf\n</code></pre><p>This is what you should return paste into <em>nano</em>:</p><pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin admin@centos2.com\n    ServerName centos2.duskosavic.com\n    ServerAlias www.centos2.com\n    DocumentRoot /var/www/centos2.com/public_html\n#    ErrorLog ${APACHE_LOG_DIR}/error.log\n#    CustomLog ${APACHE_LOG_DIR}/access.log combined\n&lt;/VirtualHost&gt;\n</code></pre><p>Save and close the file.</p><h2 id=\"step12turnonthenewvirtualhostfiles\">Step 12: Turn On the New Virtual Host Files</h2><p>You\u2019ll have to create symbolic links from <em>sites-enabled</em> directory to <em>sites-available</em>, so Apache will start serving the virtual hosts. The commands are:</p><pre><code>sudo ln -s /etc/httpd/sites-available/centos1.com.conf /etc/httpd/sites-enabled/centos1.com.conf\nsudo ln -s /etc/httpd/sites-available/centos2.com.conf /etc/httpd/sites-enabled/centos2.com.conf\n</code></pre><p>If you want to disable the default site, the command would be:</p><pre><code>sudo mv /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/welcome.conf.bak\n</code></pre><p>Then, restart Apache:</p><pre><code>sudo systemctl restart httpd\n</code></pre><p>Be sure to clear cache in your browser or it may start fooling you with old values instead of the properly refreshed ones.</p><h2 id=\"step13testingthevirtualhosts\">Step 13: Testing the Virtual Hosts</h2><p>If you have left the default IP address activated, it will currently show the \u2018Welcome to Apache\u2019 screen. If you enter the address <em>centos1.duskosavic.com</em>, you will see this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyODciIGhlaWdodD0iMTA0IiB2aWV3Qm94PSIwIDAgMjg3IDEwNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/uEbTY3h.png\" alt=\"\" width=\"287\" height=\"104\"></p><p>And entering <em>centos2.duskosavic.com</em> into the browser changes the image to:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyOTgiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjk4IDEwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/lKZtSu1.png\" alt=\"\" width=\"298\" height=\"100\"></p><h2 id=\"step14securingyourdomainswithletsencryptssl\">Step 14: Securing Your Domains With Let\u2019s Encrypt SSL</h2><p>We can use free TLS certificates from Let\u2019s Encrypt to turn our HTTP traffic into HTTPS traffic, which will make connecting to your site secure.</p><p>Certbot for CentOS 7 comes from the EPEL repository, which you\u2019ll need to install first:</p><pre><code>sudo yum install epel-release -y\n</code></pre><p>Install Certbot:</p><pre><code>sudo yum install certbot python2-certbot-apache -y\n</code></pre><p>Then, run Certbot:</p><pre><code>sudo certbot --apache\n</code></pre><p>It will ask for your email address in case of emergency, then another two questions that you may answer however you like and then the most important question \u2013 which names would you like to activate HTTPS for?</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjUiIGhlaWdodD0iMjYwIiB2aWV3Qm94PSIwIDAgNTY1IDI2MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/Ny6hjml.png\" alt=\"\" width=\"565\" height=\"260\"></p><p>Choose your domain(s) from the list.</p><p>The last question will be whether do you want HTTPS access or not. You do, so choose 2.</p><p>Restart Apache:</p><pre><code>sudo systemctl restart httpd\n</code></pre><p>In your browser, go to address</p><pre><code>http://centos1.duskosavic.com/\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNzAiIGhlaWdodD0iNjYiIHZpZXdCb3g9IjAgMCAzNzAgNjYiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/wLYtoIt.png\" alt=\"\" width=\"370\" height=\"66\"></p><p>We have entered the HTTP address and Apache automatically redirects to HTTPS, as it should:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNjQiIGhlaWdodD0iMTA0IiB2aWV3Qm94PSIwIDAgMzY0IDEwNCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/puxurz9.png\" alt=\"\" width=\"364\" height=\"104\"></p><p>You\u2019ll notice that the actual site address starts with HTTPS and that there is green padlock in the address bar, signifying a secure connection.</p><p>Let\u2019s Encrypt certificates expire after 90 days. Certbot can automatically renew them for you, but it must be told to do so:</p><pre><code>echo \"0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random() * 3600)' &amp;&amp; certbot renew\" | sudo tee -a /etc/crontab &gt; /dev/null\n</code></pre><h2 id=\"whatcanyoudonext\">What Can You Do Next</h2><p>We have shown how to share one IP address to one, two, three or dozens or hundreds of independent sites. You can now use this knowledge to host all your sites on one low cost VPS box, running CentOS 7.</p><p>Dusko Savic is a technical writer and programmer.</p><p><a href=\"https://duskosavic.com/blog/\">duskosavic.com</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-apache-virtual-hosts-on-centos-7%2F&amp;t=How%20To%20Set%20Up%20Apache%20Virtual%20Hosts%20on%20CentOS%207\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20To%20Set%20Up%20Apache%20Virtual%20Hosts%20on%20CentOS%207&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-apache-virtual-hosts-on-centos-7%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-set-up-apache-virtual-hosts-on-centos-7%2F&amp;title=How%20To%20Set%20Up%20Apache%20Virtual%20Hosts%20on%20CentOS%207&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">11</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-secure-apache-with-lets-encrypt-on-ubuntu-18-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Secure Apache with Let's Encrypt on Ubuntu 18.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Secure Apache with Let's Encrypt on Ubuntu 18.04</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-apache-virtual-hosts-on-ubuntu-16-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Set Up Apache Virtual Hosts on Ubuntu  16.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Set Up Apache Virtual Hosts on Ubuntu 16.04</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}