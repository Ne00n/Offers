{"id": "23977", "post": "<div class=\"post-23977 post type-post status-publish format-standard hentry category-tutorials tag-email tag-linux tag-postfix tag-security\" id=\"post-23977\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/get-notified-via-email-whenever-someone-logs-in-to-your-vps/\" rel=\"bookmark\">Get Notified via Email Whenever Someone Logs In To Your VPS</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" width=\"16\" height=\"16\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/email/\" rel=\"tag\">email</a>, <a href=\"https://lowendbox.com/tag/linux/\" rel=\"tag\">linux</a>, <a href=\"https://lowendbox.com/tag/postfix/\" rel=\"tag\">postfix</a>, <a href=\"https://lowendbox.com/tag/security/\" rel=\"tag\">Security</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" width=\"16\" height=\"16\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> August 8, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2021/08/email-alert.png\" loading=\"lazy\" class=\"alignright size-full wp-image-27946 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2021/08/email-alert.png\" alt=\"Email Alert\" width=\"300\" height=\"300\" align=\"right\" hspace=\"20\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2021/08/email-alert.png 300w, https://lowendbox.com/wp-content/uploads/2021/08/email-alert-150x150.png 150w\" data-sizes=\"(max-width: 300px) 100vw, 300px\" sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"https://lowendbox.com/wp-content/uploads/2021/08/email-alert.png 300w, https://lowendbox.com/wp-content/uploads/2021/08/email-alert-150x150.png 150w\" data-was-processed=\"true\">In this tutorial we\u2019ll show you how to configure your VPS so that every time someone logs in, you receive an email alerting you to this fact. This is kind of a \u201clowend intrusion detection system\u201d though it may have other uses. For example, if you need to audit what staff are doing or if you\u2019ve got third parties accessing your system.</p><h1>Configuring Email</h1><p>We don\u2019t need to be able to receive mail, but we do need to be able to send it. For this purpose, we will use postfix.</p><pre>apt-get install postfix</pre><p>This will ask you various configuration questions.&nbsp; Set your server up as an Internet site and specify the fully-qualified domain name:</p><p><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix1.png.webp\" loading=\"lazy\" class=\"alignnone size-full wp-image-23978 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix1.png.webp\" alt=\"Postfix\" width=\"800\" height=\"478\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix1.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/postfix1-300x179.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/postfix1-768x459.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\" sizes=\"(max-width: 800px) 100vw, 800px\" srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix1.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/postfix1-300x179.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/postfix1-768x459.png.webp 768w\" data-was-processed=\"true\"> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix2.png.webp\" loading=\"lazy\" class=\"alignnone size-full wp-image-23979 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix2.png.webp\" alt=\"Postfix\" width=\"800\" height=\"479\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix2.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/postfix2-300x180.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/postfix2-768x460.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\" sizes=\"(max-width: 800px) 100vw, 800px\" srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/postfix2.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/postfix2-300x180.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/postfix2-768x460.png.webp 768w\" data-was-processed=\"true\"></p><p><span id=\"more-23977\"></span></p><p>We will also need mailx:</p><pre>apt-get install mailutils</pre><p>Make sure that reverse DNS is set for your VPS. You can do this in your provider\u2019s panel. This will help ensure that email from your VPS does not go to spam.</p><p>If you are not using ipv6, be sure to disable it in Postfix:</p><pre>postconf \"inet_protocols = ipv4\"\nsystemctl restart postfix</pre><p>Now you should be able to send a test email to ensure mail is working:</p><pre>echo \"test email from $(hostname)\" | mailx -s \"$(hostname) email works\" raindog308@raindog308.com</pre><p>Check your email:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iMTQ2IiB2aWV3Qm94PSIwIDAgODAwIDE0NiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-full wp-image-23980\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/login-mail-1.png.webp\" alt=\"Login Mail\" width=\"800\" height=\"146\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/login-mail-1.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/login-mail-1-300x55.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/login-mail-1-768x140.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\"></p><h1>Configuring Alerts</h1><p>We\u2019re going to use Linux\u2019s Pluggable Authentication Modules system to notify us when someone logs in. First, we need to create a script for this purpose. Place the following in /usr/local/bin/login_notification.sh</p><pre>#!/bin/sh\n\nFROM=\"root@$(hostname)\"\nTO=\"you@somewhere.com\"\nif [ \"$PAM_TYPE\" != \"close_session\" ]; then\n  SUBJECT=\"SSH Login: $PAM_USER from $PAM_RHOST on $(hostname)\"\n  # You can put anything you want for the body of the email.\n  # Here I'll send the environment.\n  env | /usr/bin/mailx -r \"$FROM\" -s \"$SUBJECT\" \"$TO\"\nfi</pre><p>Make the file executable</p><pre>chmod 755 /usr/local/bin/login_notification.sh</pre><p>Make sure that the following line exists in /etc/ssh/sshd_config and is not commented out.</p><pre>UsePAM yes</pre><p>Now place the following line in /etc/pam.d/sshd:</p><pre>session optional pam_exec.so seteuid /usr/local/bin/login_notification.sh</pre><p>Now login, and you should receive an email:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MDAiIGhlaWdodD0iNDM4IiB2aWV3Qm94PSIwIDAgODAwIDQzOCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"alignnone size-full wp-image-23981\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/06/login-mail-2.png.webp\" alt=\"Login Mail\" width=\"800\" height=\"438\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2020/06/login-mail-2.png.webp 800w, https://lowendbox.com/wp-content/uploads/2020/06/login-mail-2-300x164.png.webp 300w, https://lowendbox.com/wp-content/uploads/2020/06/login-mail-2-768x420.png.webp 768w\" data-sizes=\"(max-width: 800px) 100vw, 800px\"></p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/comment-free-for-all-hacking-in-the-movies/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Comment Free For All\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/03/comment-free-for-all-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Comment Free For All: Hacking in the Movies</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/boomer-host-free-stickers-with-every-order-7-95-year-for-a-1gb-vps/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Boomer.Host Logo\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/07/boomerhost-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Boomer.Host: Free Stickers with Every Order! $7.95/Year for a 1GB VPS!</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-tostiff-arm-brutes-and-protect-your-server-with-fail2ban/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"fail2ban\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/07/fail2ban-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Stiff-Arm Brutes and Protect Your Server with Fail2Ban</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/insurers-tire-of-paying-ransom-to-cyber-crooks/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"empty wallet\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/07/empty_wallet-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Insurers Tire of Paying Ransom to Cyber Crooks</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}