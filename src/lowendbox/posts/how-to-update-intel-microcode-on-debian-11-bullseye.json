{"id": "28471", "post": "<div class=\"post-28471 post type-post status-publish format-standard hentry category-tutorials tag-amd tag-apt tag-bullseye tag-debian tag-debian-11 tag-intel tag-microcode\" id=\"post-28471\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-update-intel-microcode-on-debian-11-bullseye/\" rel=\"bookmark\">How to Update Intel Microcode on Debian 11 Bullseye</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" width=\"16\" height=\"16\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/amd/\" rel=\"tag\">amd</a>, <a href=\"https://lowendbox.com/tag/apt/\" rel=\"tag\">apt</a>, <a href=\"https://lowendbox.com/tag/bullseye/\" rel=\"tag\">bullseye</a>, <a href=\"https://lowendbox.com/tag/debian/\" rel=\"tag\">debian</a>, <a href=\"https://lowendbox.com/tag/debian-11/\" rel=\"tag\">debian 11</a>, <a href=\"https://lowendbox.com/tag/intel/\" rel=\"tag\">intel</a>, <a href=\"https://lowendbox.com/tag/microcode/\" rel=\"tag\">microcode</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" width=\"16\" height=\"16\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> October 17, 2021 @ 12:00 am, by raindog308</div><div class=\"storycontent tablelook\"><p><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2021/10/intel_inside.png\" loading=\"lazy\" class=\"alignright size-full wp-image-28472 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2021/10/intel_inside.png\" alt=\"Intel Inside\" width=\"300\" height=\"300\" align=\"right\" hspace=\"20\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2021/10/intel_inside.png 300w, https://lowendbox.com/wp-content/uploads/2021/10/intel_inside-150x150.png 150w\" data-sizes=\"(max-width: 300px) 100vw, 300px\" sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"https://lowendbox.com/wp-content/uploads/2021/10/intel_inside.png 300w, https://lowendbox.com/wp-content/uploads/2021/10/intel_inside-150x150.png 150w\" data-was-processed=\"true\">Not long ago I noticed this message when booting one of my home systems:</p><p>\u201cTSC_DEADLINE disabled due to Errata; please update microcode to version: 0x22 (or later)\u201d</p><p>I wasn\u2019t having any issues with the system, but this sounded like something I should correct.&nbsp; But doing a microcode upgrade sounded risky \u2013 couldn\u2019t brick my CPU?&nbsp; And while an apt-cache search quickly found a package called intel-microcode, it was listed as not available.&nbsp; Time to investigate.</p><p>The system in question has an Intel <span class=\"s1\"><a href=\"https://www.intel.com/content/www/us/en/products/sku/80810/intel-core-i54690-processor-6m-cache-up-to-3-90-ghz/specifications.html\" target=\"_blank\" rel=\"noopener\" aria-label=\"Intel Ark\">i5-4690</a><span class=\"Apple-converted-space\"> from circa 2014 and I\u2019m running Debian Bullseye 11.1.</span></span></p><p>After doing a little more research, I noticed that doing a&nbsp;\u201cdmesg | grep -i microcode\u201d produced a number of messages related to CPU microcode:</p><pre>[ 0.015642] [Firmware Bug]: TSC_DEADLINE disabled due to Errata; please update microcode to version: 0x22 (or later)\n[ 0.067475] TAA: Vulnerable: Clear CPU buffers attempted, no microcode\n[ 0.067475] SRBDS: Vulnerable: No microcode\n[ 0.067476] MDS: Vulnerable: Clear CPU buffers attempted, no microcode\n[ 0.869517] microcode: sig=0x306c3, pf=0x2, revision=0x19\n[ 0.869548] microcode: Microcode Update Driver: v2.2.</pre><p>By microcode, Debian is referring to the software that sits on the Intel microprocessor (CPU) itself.&nbsp; Many people think of CPUs as pure silicon but in fact an x86 processor (and many other microprocessors) contains onboard software that is executed.&nbsp; For example, the old 80486 had approximately 250 lines of microcode, totally 12,032 bits stored in its ROM (read only memory) (<a href=\"https://en.wikipedia.org/wiki/Intel_Microcode\" target=\"_blank\" rel=\"noopener\" aria-label=\"Wikipedia\">Wikipedia</a>).&nbsp; This is very common in many types of processors besides CPUs.</p><p>Starting with the P6 series (mid 1990s), Intel CPUs contain not only manufacturer-loaded ROM but also field-loaded volatile memory which can be updated by users.&nbsp; This facility exists so you fixes can be distributed to end users for loading.</p><p>You can\u2019t write your own microprocessor microcode because the CPU will only accept signed blobs.&nbsp; Also, you can\u2019t brick your CPU (render it useless) because any microcode is loaded into volatile memory.&nbsp; Once you turn your computer off, all volatile memory is lost and the CPU reverts back to its factory condition.&nbsp; So if you obtain and load a microcode fix, you need to have a mechanism to load this microcode every time you start your computer.&nbsp; In Linux, this is done by loading it at boot-time (as part of initrd typically).&nbsp; Other Unix-like OSes have similar facilities.</p><p>Back to my home computer<span class=\"s1\"><span class=\"Apple-converted-space\">.&nbsp; Looking at /proc/cpuinfo, I can see the microcode version:</span></span></p><pre>processor : 0\nvendor_id : GenuineIntel\ncpu family : 6\nmodel : 60\nmodel name : Intel(R) Core(TM) i5-4690 CPU @ 3.50GHz\nstepping : 3\nmicrocode : 0x19</pre><p>I can also see the bugs detected by the Linux kernel.&nbsp; Debian Bullseye 11.1 uses Linux kernel 5.10 and reports:</p><pre>bugs : cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa itlb_multihit srbds</pre><p>Some of those probably look familiar from news reports: Meltdown, Spectre, etc.</p><p>So how can I update my microcode?</p><p><span id=\"more-28471\"></span></p><p>On Debian, there is a package called intel-microcode.&nbsp; There is also amd-microcode, so adjust as needed for your platform.</p><p>You have to enable the non-free software components because, as a signed blob loaded into the CPU, it\u2019s not free software in the licensing sense.&nbsp; So first, make sure your /etc/apt/sources list looks something like this:</p><pre>deb http://ftp.us.debian.org/debian/ bullseye main contrib non-free\ndeb-src http://ftp.us.debian.org/debian/ bullseye main contrib non-free\n\ndeb http://security.debian.org/debian-security bullseye-security main contrib non-free\ndeb-src http://security.debian.org/debian-security bullseye-security main contrib non-free</pre><p>Next, install the intel-microcode package:</p><pre># apt-get install intel-microcode\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following additional packages will be installed:\niucode-tool\nThe following NEW packages will be installed:\nintel-microcode iucode-tool\n0 upgraded, 2 newly installed, 0 to remove and 3 not upgraded.\nNeed to get 3,897 kB of archives.\nAfter this operation, 4,932 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://ftp.us.debian.org/debian bullseye/contrib amd64 iucode-tool amd64 2.3.1-1 [62.4 kB]\nGet:2 http://ftp.us.debian.org/debian bullseye/non-free amd64 intel-microcode amd64 3.20210608.2 [3,834 kB]\nFetched 3,897 kB in 2s (2,361 kB/s) \nSelecting previously unselected package iucode-tool.\n(Reading database ... 335743 files and directories currently installed.)\nPreparing to unpack .../iucode-tool_2.3.1-1_amd64.deb ...\nUnpacking iucode-tool (2.3.1-1) ...\nSelecting previously unselected package intel-microcode.\nPreparing to unpack .../intel-microcode_3.20210608.2_amd64.deb ...\nUnpacking intel-microcode (3.20210608.2) ...\nSetting up iucode-tool (2.3.1-1) ...\nSetting up intel-microcode (3.20210608.2) ...\nupdate-initramfs: deferring update (trigger activated)\nintel-microcode: microcode will be updated at next boot</pre><p>And now reboot.&nbsp; At boot-time, the Intel microcode load will be triggered and you\u2019ll see a message like this (or issue a dmesg | grep -i microcode to see it later):</p><pre>[ 0.000000] microcode: microcode updated early to revision 0x28, date = 2019-11-12\n[ 0.067434] SRBDS: Mitigation: Microcode\n[ 0.807409] microcode: sig=0x306c3, pf=0x2, revision=0x28\n[ 0.807429] microcode: Microcode Update Driver: v2.2.</pre><p>Sure enough, when I look in /proc/cpuinfo I see my microcode has been updated:</p><pre>processor : 0\nvendor_id : GenuineIntel\ncpu family : 6\nmodel : 60\nmodel name : Intel(R) Core(TM) i5-4690 CPU @ 3.50GHz\nstepping : 3\nmicrocode : 0x28</pre><p>And while not all bugs are gone \u2013 this is a pretty old CPU and Intel is not releasing fixes for every one \u2013 we got rid of the one the kernel was complaining about:</p><p>Before:</p><pre>bugs : cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs <strong>taa</strong> itlb_multihit srbds</pre><p>After:</p><pre class=\"p1\"><span class=\"s1\">bugs : cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit srbds</span></pre><p>&nbsp;</p><p>&nbsp;</p><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/amds-server-market-share-hits-new-high-at-16/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"AMD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/09/amd-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">AMD's Server Market Share Hits New High at 16%</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/debian-11-bullseye-released-today/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Debian 11\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/08/debian11-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Debian 11 \"Bullseye\" Released Today!</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-install-directadmin-on-debian-10/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Install DirectAdmin on Debian 10\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/05/rntut_directadmin-150x150.png.webp) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Install DirectAdmin on Debian 10</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/ait-returns-with-unlimited-bandwidth-vms-in-north-carolina-dedis-too/\"><div class=\"relpost-custom-block-single\" style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"AIT Logo\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2021/05/ait-150x150.png.webp) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">AIT Returns With Unlimited Bandwidth VMs in North Carolina! Dedis, too!</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}