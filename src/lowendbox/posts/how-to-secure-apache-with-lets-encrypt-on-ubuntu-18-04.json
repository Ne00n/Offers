{"id": "19124", "post": "<div class=\"post-19124 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-apache tag-lets-encrypt tag-ubuntu-18-04\" id=\"post-19124\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/how-to-secure-apache-with-lets-encrypt-on-ubuntu-18-04/\" rel=\"bookmark\">How To Secure Apache with Let\u2019s Encrypt on Ubuntu 18.04</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/apache/\" rel=\"tag\">apache</a>, <a href=\"https://lowendbox.com/tag/lets-encrypt/\" rel=\"tag\">Let's Encrypt</a>, <a href=\"https://lowendbox.com/tag/ubuntu-18-04/\" rel=\"tag\">Ubuntu 18.04</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> March 6, 2020 @ 8:30 am, by Jon Biloh</div><div class=\"storycontent tablelook\"><p>The Apache is a web server developed by Apache Foundation in 1995. Apache is the one of the most widely used and robust web server. Apache web server requires a valid SSL certificate to enable web security between the server and client by encrypting the traffic.</p><p>The Let\u2019s Encrypt is a certificate authority that provides free SSL certificate and it works out of the box with all major web browsers. The Certbot is Let\u2019s Encrypt client developed by Electronic Frontier Foundation (EFF). The Let\u2019s Encrypt SSL Certificate will provide better security to Apache and it easy to integrate using Certbot tool. In this tutorial you will secure the Apache web server using free Let\u2019s Encrypt SSL on your Ubuntu 18.04 server.</p><p><span id=\"more-19124\"></span></p><h2>Pre Requirements</h2><ul><li>It requires a valid domain name for generating the free Let\u2019s Encrypt SSL certificates. You can use paid domain name or else you can use free domain name from various domain registrar.</li><li>You need to configure your DNS management so that your domain name and sub domain is pointed towards your server IPv4 address.</li></ul><h2>Step 1: Installing Required Packages</h2><p>The installation of Apache Web Server and Certbot is very straight forward. The default Ubuntu repository contains all the packages of Apache and Certbot. The Advanced Packaging Tool (APT) is the default package manager for Ubuntu that installs those packages so effectively.</p><p>First remove and flush the old apt repository cache.</p><pre>sudo apt clean all</pre><p>Then update the repository to load latest packages information.</p><pre>sudo apt update</pre><p>You need to perform a full upgrade to for updating the installed packages.</p><pre>sudo apt dist-upgrade</pre><p>As soon as update is implemented its time to install the Apache web server and Certbot (Let\u2019s Encrypt client) for Apache using default apt package installers.</p><pre>sudo apt install apache2 python-certbot-apache</pre><p>After Successful installation of required packages. Lets configure the firewall that is explained in next step.</p><h2>Step-2: Configure the UFW firewall</h2><p>The UFW (Unified Firewall) is the default firewall used by the Ubuntu. It is a port based firewall that is easy to configure and manage. The Apache web server requires both HTTP and HTTPS services to allow regular and encrypted traffic.</p><p>In order to allow these services you need HTTP(80) and HTTPS(443) ports to be open and it required by Apache web server. So you can allow these ports by implementing port based rules in firewall.</p><pre>sudo ufw allow http\nsudo ufw allow https</pre><p>The SSH(22) port is an important port for login to server but in terms of security so it better to keep this port with limited permission. This will enable the port based security to secure this port against brute-force attack.</p><pre>sudo ufw limit ssh</pre><p>After adding all rules to firewall you need to start the firewall and enable it in boot time to survive the firewall services during boot.</p><pre>sudo ufw enable</pre><p>When all completed it\u2019s time to check whether ports are added.</p><pre>sudo ufw status</pre><p>If all configured perfectly then it looks like given sample output.</p><pre>Status: active\n\nTo Action From\n-- ------ ----\n80/tcp ALLOW Anywhere\n443/tcp ALLOW Anywhere\n22/tcp LIMIT Anywhere\n80/tcp (v6) ALLOW Anywhere (v6)\n443/tcp (v6) ALLOW Anywhere (v6)\n22/tcp (v6) LIMIT Anywhere (v6)</pre><p>After completing this step now let\u2019s move to the next step.</p><h2>Step-3:&nbsp; Configuring Apache VirtualHost</h2><p>Apache VirtualHost allow multiple domain name to serve content on single Apache web server. It allows secure mechanism to keep different directory for several domain name. This is the cost effective solution that works out of box with low traffic. This process will keep several website in single machine like a shared environment.</p><blockquote><p>Note: Throughout this tutorial you need to replace <strong>example.com</strong> with your domain name.</p></blockquote><p>First thing is to add virtual host of your domain name. The given sample Apache VirtualHost configuration file will help you for getting free Let\u2019s encrypt SSL certificate. In Ubuntu the Apache VirtualHost are located at <strong>sites-available</strong> and <strong>sites-enabled</strong> directory inside the Apache configuration directory.</p><pre>sudo nano /etc/apache2/sites-available/example.com.conf</pre><p>Add the given lines to configuration file and make sure your domain name must be added to <strong>ServerName</strong> and <strong>ServerAlias</strong> in order to get Let\u2019s Encrypt SSL certificates.</p><pre>&lt;VirtualHost *:80&gt;\nServerName example.com\nServerAlias www.example.com\nServerAdmin admin@example.com\nDocumentRoot /var/www/html/\n&lt;/VirtualHost&gt;\n\n&lt;Directory /var/www/html&gt;\nRequire all granted\nAllowOverride None\n&lt;/Directory&gt;</pre><p>When completes hit <strong>Ctrl</strong> + <strong>O</strong> to save and <strong>Ctrl</strong> + <strong>X</strong> to exit from nano editor.</p><p>After adding the Apache VirtualHost configuration files you have to the create the symbolic link between <strong>sites-available</strong> and <strong>sites-enabled</strong> directory. This allows you whenever you make changes to VirtualHost configuration file inside <strong>sites-available</strong> directory and it will automatically replicated to&nbsp;<strong>sites-enabled</strong> directory by using these soft links.</p><pre>sudo ln -s /etc/apache2/sites-available/example.com.conf /etc/apache2/sites-enabled/example.com.conf</pre><p>Check whether the configuration files are correct and this command will also check the syntax of Apache configuration files.</p><pre>sudo apachectl -t</pre><p>If all goes correct then it shows <strong>Syntax OK</strong> as a output. If any thing goes wrong please re-verify the Apache VirtualHost files. After all completed restart the services for making changes in the effect.</p><pre>sudo systemctl restart apache2</pre><p>After adding the Apache VirtualHost file it\u2019s time to move forward by generating the free Let\u2019s Encrypt Certificate SSL to secure the Apache web server.</p><h2>Step-4: Generating the Let\u2019s Encrypt SSL certificate</h2><p>The Certbot is the Let\u2019s Encrypt Client for automated generation of Let\u2019s Encrypt SSL and integration with the Apache web server. This step will guide you how to make use of Certbot using the sub flag <strong>\u2013apache</strong> for auto SSL integration with Apache and&nbsp; flag <strong>-d</strong> for all your domain name that requires SSL certificate.</p><pre>sudo certbot --apache -d example.com -d www.example.com</pre><p>There are several information\u2019s you need to be provide during interactive setup of Lets\u2019s Encrypt script. You will provide your email address to get the email notifications with various information related to your Let\u2019s Encrypt SSL certificate.</p><pre>Saving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator apache, Installer apache\nEnter email address (used for urgent renewal and security notices) (Enter 'c' to\ncancel): <strong>admin@example.com</strong></pre><p>Accept the terms of services and choose whether your Email address is shared with Electronic Frontier Foundation.</p><pre>-------------------------------------------------------------------------------\nPlease read the Terms of Service at\nhttps://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must\nagree in order to register with the ACME server at\nhttps://acme-v01.api.letsencrypt.org/directory\n-------------------------------------------------------------------------------\n(A)gree/(C)ancel: <strong>A</strong>\n\n-------------------------------------------------------------------------------\nWould you be willing to share your email address with the Electronic Frontier\nFoundation, a founding partner of the Let's Encrypt project and the non-profit\norganization that develops Certbot? We'd like to send you email about EFF and\nour work to encrypt the web, protect its users and defend digital rights.\n-------------------------------------------------------------------------------\n(Y)es/(N)o: <strong>N</strong></pre><p>When all completed the Let\u2019s Encrypt will perform couple of challenges for getting free Let\u2019s Encrypt SSL certificates. If all things are configured correctly then you will get the Let\u2019s Encrypt SSL certificates after completing all the steps.</p><pre>Obtaining a new certificate\nPerforming the following challenges:\nhttp-01 challenge for example.com\nhttp-01 challenge for www.example.com\nEnabled Apache rewrite module\nWaiting for verification...\nCleaning up challenges\nCreated an SSL vhost at /etc/apache2/sites-available/000-default-le-ssl.conf\nEnabled Apache socache_shmcb module\nEnabled Apache ssl module\nDeploying Certificate to VirtualHost /etc/apache2/sites-available/000-default-le-ssl.conf\nEnabling available site: /etc/apache2/sites-available/000-default-le-ssl.conf</pre><p>If Certbot won\u2019t find your server virtualhost it will ask you which configuration file you want to add.</p><pre>We were unable to find a vhost with a ServerName or Address of www.example.com.\nWhich virtual host would you like to choose?\n(note: conf files with multiple vhosts are not yet supported)\n-------------------------------------------------------------------------------\n1: 000-default.conf | | | Enabled\n2: 000-default-le-ssl.conf | example.com | HTTPS | Enabled\n-------------------------------------------------------------------------------\nSelect the appropriate number [1-2] then [enter] (press 'c' to cancel): <strong>2</strong>\nDeploying Certificate to VirtualHost /etc/apache2/sites-available/000-default-le-ssl.conf</pre><p>This step is suitable for redirection from insecure HTTP traffic to secure HTTPS traffic.</p><pre>Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.\n-------------------------------------------------------------------------------\n1: No redirect - Make no further changes to the webserver configuration.\n2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for\nnew sites, or if you're confident your site works on HTTPS. You can undo this\nchange by editing your web server's configuration.\n-------------------------------------------------------------------------------\nSelect the appropriate number [1-2] then [enter] (press 'c' to cancel): <strong>2</strong>\nEnabled Apache rewrite module\nRedirecting vhost in /etc/apache2/sites-enabled/000-default.conf to ssl vhost in /etc/apache2/sites-available/000-default-le-ssl.conf</pre><p>When all steps are successfully implemented and finally Let\u2019s Encrypt SSL certificate are generated then it will show given information.</p><pre>-------------------------------------------------------------------------------\nCongratulations! You have successfully enabled https://example.com and\nhttps://www.example.com\n\nYou should test your configuration at:\nhttps://www.ssllabs.com/ssltest/analyze.html?d=example.com\nhttps://www.ssllabs.com/ssltest/analyze.html?d=www.example.com\n-------------------------------------------------------------------------------\n\nIMPORTANT NOTES:\n- Congratulations! Your certificate and chain have been saved at:\n/etc/letsencrypt/live/example.com/fullchain.pem\nYour key file has been saved at:\n/etc/letsencrypt/live/example.com/privkey.pem\nYour cert will expire on 2019-08-02. To obtain a new or tweaked\nversion of this certificate in the future, simply run certbot again\nwith the \"certonly\" option. To non-interactively renew *all* of\nyour certificates, run \"certbot renew\"\n- Your account credentials have been saved in your Certbot\nconfiguration directory at /etc/letsencrypt. You should make a\nsecure backup of this folder now. This configuration directory will\nalso contain certificates and private keys obtained by Certbot so\nmaking regular backups of this folder is ideal.\n- If you like Certbot, please consider supporting our work by:\n\nDonating to ISRG / Let's Encrypt: https://letsencrypt.org/donate\nDonating to EFF: https://eff.org/donate-le</pre><p>After successfully generating of Let\u2019s Encrypt Certificate and it is automatically added to secure the Apache. In next step you will setup crontab for automated renewal of Let\u2019s Encrypt SSL certificates.</p><h2>Step-5: Automatic Renewal of Let\u2019s Encrypt SSL certificates</h2><p>The Let\u2019s Encrypt SSL certificates are valid for 90 days from the date of issue. So, It is vital to renew the certificate before its expiry date. The crontab allows to auto schedule the renewal task at scheduled time.</p><p>To add the entry to crontab you need schedule time and certbot renewal will run periodically during your configured scheduled time.</p><pre>sudo crontab -e</pre><p>During first run it asks default editor you have to select the nano as a text editor.</p><pre>Select an editor. To change later, run 'select-editor'.\n1. /bin/nano &lt;---- easiest\n2. /usr/bin/vim.basic\n3. /usr/bin/vim.tiny\n4. /bin/ed\n\nChoose 1-4 [1]: <strong>1</strong></pre><p>Add the given lines to crontab for enabling automatic Let\u2019s Encrypt SSL renewal at 05:00 AM. This will auto renew SSL certificates before expiry date.</p><pre>0 5 * * * /usr/bin/certbot renew --post-hook \"systemctl restart apache2\"</pre><p>When completes hit <strong>Ctrl</strong> + <strong>O</strong> to save and <strong>Ctrl</strong> + <strong>X</strong> to exit from nano editor.</p><p>Check whether these entries are added to crontab.</p><pre>sudo crontab -l</pre><p>This command show output of added cronjobs. Which means you have successfully added the crontab entries for automatic renewal of Let\u2019s Encrypt SSL certificate.</p><h2>Conclusion</h2><p>Finally you have secured the Apache using Let\u2019s Encrypt SSL certificate. It will also enable automatic renewal of Let\u2019s Encrypt SSL certificate using crontab. This will secure your web property by implementing Let\u2019s Encrypt SSL certificate. At this time you are ready to use the secure protocol HTTPS for your website.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-secure-apache-with-lets-encrypt-on-ubuntu-18-04%2F&amp;t=How%20To%20Secure%20Apache%20with%20Let%27s%20Encrypt%20on%20Ubuntu%2018.04\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20To%20Secure%20Apache%20with%20Let%27s%20Encrypt%20on%20Ubuntu%2018.04&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-secure-apache-with-lets-encrypt-on-ubuntu-18-04%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fhow-to-secure-apache-with-lets-encrypt-on-ubuntu-18-04%2F&amp;title=How%20To%20Secure%20Apache%20with%20Let%27s%20Encrypt%20on%20Ubuntu%2018.04&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">2</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-a-node-js-application-for-production-on-a-debian-9-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Set Up a Node.js Application for Production on a Debian 9 VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Set Up a Node.js Application for Production on a Debian 9 VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-apache-virtual-hosts-on-centos-7/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Set Up Apache Virtual Hosts on CentOS 7\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Set Up Apache Virtual Hosts on CentOS 7</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-install-webmin-on-ubuntu-18-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to install Webmin on Ubuntu 18.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to install Webmin on Ubuntu 18.04</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/jbiloh/\" title=\"All posts by Jon Biloh\" rel=\"author\">Jon Biloh</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/f766d6dc4b5f406b9f3cb0339d48de95?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/f766d6dc4b5f406b9f3cb0339d48de95?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/jbiloh\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"http://Jbiloh\" class=\"bio-icon bio-icon-twitter\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/jon-biloh-4b32598/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\">I'm Jon Biloh and I own LowEndBox and LowEndTalk. I've spent my nearly 20 year career in IT building companies and now I'm excited to focus on building and enhancing the community at LowEndBox and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}