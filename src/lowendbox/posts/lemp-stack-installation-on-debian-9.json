{"id": "20394", "post": "<div class=\"post-20394 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-debian-9 tag-firewall tag-lemp tag-lets-encrypt tag-mysql tag-nginx tag-php\" id=\"post-20394\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/lemp-stack-installation-on-debian-9/\" rel=\"bookmark\">LEMP Stack Installation on Debian 9</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/debian-9/\" rel=\"tag\">Debian 9</a>, <a href=\"https://lowendbox.com/tag/firewall/\" rel=\"tag\">Firewall</a>, <a href=\"https://lowendbox.com/tag/lemp/\" rel=\"tag\">LEMP</a>, <a href=\"https://lowendbox.com/tag/lets-encrypt/\" rel=\"tag\">Let's Encrypt</a>, <a href=\"https://lowendbox.com/tag/mysql/\" rel=\"tag\">mysql</a>, <a href=\"https://lowendbox.com/tag/nginx/\" rel=\"tag\">nginx</a>, <a href=\"https://lowendbox.com/tag/php/\" rel=\"tag\">PHP</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> July 13, 2019 @ 12:56 pm, by Dusko Savic</div><div class=\"storycontent tablelook\"><p>This tutorial will show you how to install and configure the LEMP stack on your VPS/LowEndBox, running Debian 9.</p><p><img data-lazyloaded=\"1\" src=\"https://lemp.io/app/uploads/lemp-stack-components.png\" loading=\"lazy\" class=\"litespeed-loading\" data-src=\"https://lemp.io/app/uploads/lemp-stack-components.png\" alt=\"\" width=\"307\" height=\"181\" data-was-processed=\"true\"></p><p>LEMP stands for <strong>L</strong>inux <strong>N</strong>ginx <strong>M</strong>ySQL <strong>P</strong>HP, and is a lightweight variation of the LAMP stack, which includes <strong>A</strong>pache instead of Nginx. You\u2019ll notice that it\u2019s not written as <em>LNMP</em>, and that\u2019s due to the pronunciation of the word <em>Nginx</em> (<strong>E</strong>ngine-X).</p><p><span id=\"more-20394\"></span></p><p>LEMP consumes far less resources than the LAMP stack, and is thus more sutiable for cheap VPS machines and Low End Boxes. It is 2.5 times faster under heavy load, according to benchmarks. Also, to speed up things even more, we are going to install <strong>MariaDB</strong> instead of MySQL as it is much faster, but still fully compatible with the original MySQL.</p><h2 id=\"whatwearegoingtocover\">What We Are Going To Cover</h2><ul><li>Installing Nginx</li><li>Nginx configuration basics</li><li>Setting up a Firewall</li><li>Installing and configuring MariaDB</li><li>Installing latest PHP</li><li>Configuring Nginx to serve PHP files</li><li>Testing the installed stack</li><li>(With a domain) Securing the site with Let\u2019s Encrypt certificates</li></ul><h2 id=\"prerequisites\">Prerequisites</h2><p>We will install and set up the LEMP stack on Debian 9:</p><ul><li>Starting with a clean VPS with</li><li>At least 512Mb of RAM</li><li>15Gb of free disk space</li><li>You will need root user access</li><li>You must have DNS records for your domain (<em>example.com</em> in this tutorial) already set up to point to your VPS in order to install Let\u2019s Encrypt certificates. If you don\u2019t have one, access your IP address instead and skip the last step</li></ul><h2 id=\"step1installnginx\">Step 1: Install Nginx</h2><h3 id=\"installationandfirewallsetup\">Installation and Firewall Setup</h3><p>First, log in to your server as root or as an another account with sudo privileges. Then, update your package manager\u2019s cache:</p><pre><code>sudo apt update\n</code></pre><p>Install Nginx by running the following command:</p><pre><code>sudo apt install nginx -y\n</code></pre><p>Nginx is now installed. Go to your domain (or IP address if you don\u2019t have one) in your browser. The default Nginx welcome page will be shown:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NDkiIGhlaWdodD0iMTgyIiB2aWV3Qm94PSIwIDAgNDQ5IDE4MiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"Nginx default page\" data-src=\"https://i.imgur.com/widh8Nh.png\" alt=\"Nginx default page\" width=\"449\" height=\"182\"></p><p>This means that Nginx was installed successfully. Enable it via systemctl to start it at every server boot:</p><pre><code>sudo systemctl enable nginx\n</code></pre><p>For maximum security, you\u2019ll now install <em>ufw</em> (uncomplicated firewall) and configure it to allow HTTP, HTTPS, FTP and SSH connections, and to deny all others:</p><pre><code>sudo apt install ufw -y\nsudo ufw allow 'Nginx Full'\nsudo ufw allow OpenSSH\nsudo ufw allow SSH\nsudo ufw allow ftp\n</code></pre><p>Enable it (make it active) by running:</p><pre><code>sudo ufw enable\n</code></pre><p>Answer <em>y</em> when asked, and reload the site in your browser. If you still see the same welcome page, you have configured your firewall correctly. If it shows an error (such as Access Denied), disable the firewall:</p><pre><code>sudo ufw disable\n</code></pre><p>and check its configuration:</p><pre><code>sudo ufw status\n</code></pre><p>You\u2019ll see a list of enabled profiles. If you don\u2019t see the ones from above, rerun the commands and enable it again.</p><h3 id=\"configurationdirectories\">Configuration Directories</h3><p>On Debian 9, Nginx stores its <strong>configuration</strong> files under <em>/etc/nginx</em>, and the default directory for serving static files is <em>/usr/share/nginx/html</em>. This will become important in the later steps, when we\u2019ll need to change the configuration and add new files.</p><h2 id=\"step2installingmariadb\">Step 2: Installing MariaDB</h2><p>Install MariaDB (it is available to apt by default):</p><pre><code>sudo apt install mysql-server  -y\n</code></pre><p>Start it when the installation finishes:</p><pre><code>sudo systemctl start mysql\n</code></pre><p>To retain full compatibility with the original MySQL product, MariaDB responds to the <em>mysql</em> command.</p><p>After MariaDB installation, it is mandatory to run a script (called <em>mysql_secure_installation</em>) to secure the database:</p><pre><code>sudo mysql_secure_installation\n</code></pre><p>When it asks you for the current root password, press Enter, because this is the first time you are configuring it. Then, enter a new password for the root user and answer <em>y</em> for anonymous user removal. If you don\u2019t plan on accessing the database from outside the server, answer <em>y</em> to the next question, otherwise type in <em>n</em>. Enter <em>y</em> or press Enter for all questions that follow.</p><p>Try to connect to it by running:</p><pre><code>sudo mysql -u root -p\n</code></pre><p>When prompted, enter the root password you just set.</p><p>You\u2019ll see the mysql prompt:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDkiIGhlaWdodD0iMTMyIiB2aWV3Qm94PSIwIDAgNjA5IDEzMiI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"mysql command prompt\" data-src=\"https://i.imgur.com/Qg2dPN5.png\" alt=\"mysql command prompt\" width=\"609\" height=\"132\"></p><p>meaning that MariaDB is working correctly and is properly secured. Type in <em>exit</em> to quit the console.</p><h2 id=\"step3installingphp\">Step 3: Installing PHP</h2><p>You\u2019ll now install PHP 7.0, the version available by default on Debian 9.</p><p>To install PHP 7.0, run:</p><pre><code>sudo apt install php-fpm php-mysql\n</code></pre><p>Then, install additional PHP extensions that you will most likely need:</p><pre><code>sudo apt install php-mysql php-mbstring php-dev php-gd php-pear php-zip php-xml php-curl -y\n</code></pre><p>To set the version of PHP you just installed as the default one system-wide, run the following command:</p><pre><code>sudo update-alternatives --set php /usr/bin/php7.0\n</code></pre><p>Now check the version of the available PHP:</p><pre><code>sudo php --version\n</code></pre><p>You\u2019ll see that the version is 7.0, as it should be.</p><p><br>\n<img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NzYiIGhlaWdodD0iMTMzIiB2aWV3Qm94PSIwIDAgNTc2IDEzMyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"PHP version\" data-src=\"https://i.imgur.com/QmW7NMv.png\" alt=\"PHP version output\" width=\"576\" height=\"133\"></p><h2 id=\"step4configuringnginxtoservephpcontent\">Step 4: Configuring Nginx to Serve PHP Content</h2><p>PHP is installed and working correctly, but we now have to configure Nginx to use it, because it won\u2019t do so automatically (unlike Apache).</p><p>As noted in Step 1, Nginx stores its configuration files under <em>/etc/nginx</em>. Configuration that is currently enabled (which will be applied by Nginx) is stored in a folder named <em>sites-enabled</em>. Similarly, sites that are available, but are not enabled (and thus can not be accessed from the Internet), are stored in a folder named <em>sites-available</em>. We\u2019ll edit the configuration of the default enabled site.</p><p>Delete the default config file, because we won\u2019t be needing it:</p><pre><code>rm /etc/nginx/sites-enabled/default\n</code></pre><p>A copy of the default site config can be found at <em>/etc/nginx/sites-available/default</em>.</p><p>Create a new config file for editing:</p><pre><code>nano /etc/nginx/sites-enabled/default\n</code></pre><p>Add the following lines:</p><pre><code>server {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    root /var/www/html;\n\n    index index.php index.html index.htm index.nginx-debian.html;\n\n    server_name _;\n\n    location / {\n            try_files $uri $uri/ =404;\n    }\n\n    location ~ \\.php$ {\n           include snippets/fastcgi-php.conf;\n           fastcgi_pass unix:/run/php/php7.3-fpm.sock;\n    }\n\n    location ~ /\\.ht {\n           deny all;\n    }\n}\n</code></pre><p>Save and close the file.</p><p>The first part of the above config specifies that Nginx should listen to the HTTP port 80 for requests. Then it sets the root folder for serving files to <em>/var/www/html</em> (which is where you\u2019ll store your website files) and tells Nginx to first try to serve PHP files (instead of HTML).</p><p>The rest of the config shown tells Nginx how to call PHP when requested, and to deny access to <em>.htaccess</em> and similar files, which originate from the Apache web server. They are not used by Nginx, and should not be served to users because they might contain some sensitive info.</p><p>Restart Nginx for the changes to take effect:</p><pre><code>sudo systemctl restart nginx\n</code></pre><p>Try reloading your site (or IP address) in your browser. You should see the same Nginx default welcome page as before.</p><p>To test if PHP rendering is working, create a PHP file in <em>/var/www/html</em>:</p><pre><code>sudo nano /var/www/html/index.php\n</code></pre><p>Put the following into it:</p><pre><code>&lt;?php\n\nphpinfo();\n\n?&gt;\n</code></pre><p>Save and close the file.</p><p>The <em>phpinfo()</em> function outputs very detailed information about PHP installation.</p><p>Reload the site in your browser. This time, if all is well, you\u2019ll see a page similar to this:</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NjciIGhlaWdodD0iNTUxIiB2aWV3Qm94PSIwIDAgNTY3IDU1MSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" title=\"phpinfo() output\" data-src=\"https://i.imgur.com/Co84es0.jpg\" alt=\"phpinfo() output\" width=\"567\" height=\"551\"></p><p>If you see a 502 Bad Gateway error, check the <em>fastcgi_pass</em> line in the above config (the PHP version may be different, though that is unlikely).</p><p>Be sure to remove the file immediately afterwards, because it reveals a lot of sensitive info:</p><pre><code>rm /var/www/html/index.php\n</code></pre><h2 id=\"step5securingyourdomainusingletsencrypt\">Step 5: Securing Your Domain Using Let\u2019s Encrypt</h2><p><strong>If you have a domain name</strong>, fully registered and pointed to your server, you can secure it using free Let\u2019s Encrypt TLS certificates. The benefits of this are that you\u2019ll have HTTPS access and a padlock will show next to your domain name in all browsers.</p><p>Let\u2019s Encrypt certificates will be generated and configured using <a href=\"https://certbot.eff.org/\">Certbot</a>, a free program created for this purpose. Let\u2019s Encrypt certificates expire after 90 days, and Certbot will automatically renew them when it decides it is time (every 60 days by default), so you don\u2019t have to worry about them at all.</p><p>To install Certbot, you\u2019ll first need to enable the Debian Backports repository by running:</p><pre><code>secho \"deb http://ftp.debian.org/debian stretch-backports main\" |\nsudo tee /etc/apt/sources.list.d/backports.list\n</code></pre><p>Update your package manager cache:</p><pre><code>sudo apt update\n</code></pre><p>Then, install Certbot:</p><pre><code>sudo apt install certbot python-certbot-nginx -t stretch-backports -y\n</code></pre><p>Once it is done, run Certbot:</p><pre><code>sudo certbot --nginx --rsa-key-size 4096\n</code></pre><p>Enter an email address you know you\u2019ll check, then agree to the terms of service by typing in <em>A</em>. Press <em>Y</em> if you want to subscribe to EFF\u2019s newsletter, and then input your domain name. Certbot will then ask you if you wish to redirect all traffic to HTTPS \u2013 you do, so type in <em>2</em>.</p><p>You\u2019ll receive a congratulatory message, which means that your domain is now secured with free HTTPS certificates from Let\u2019s Encrypt. Refresh your domain in your browser once more. A padlock will show to the left of your site address, meaning that the connection is encrypted. If you want, you can run your site through the <a href=\"https://www.ssllabs.com/ssltest/\">SSL Server Test</a> and see that you\u2019ll get an A or better.</p><h2 id=\"whatyoucandonext\">What You Can Do Next</h2><p>You have now installed and configured a LEMP stack on your Debian 9 server. You can now host your PHP website(s) on it, and they will have access to the MariaDB database. For example, you can install WordPress, Joomla, Drupal, Moodle, or any other PHP application that may need to access the database, and it will work with sufficient further configuration.</p><p>Dusko Savic is a technical writer and programmer.</p><p><a href=\"https://duskosavic.com/blog/\">duskosavic.com</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Flemp-stack-installation-on-debian-9%2F&amp;t=LEMP%20Stack%20Installation%20on%20Debian%209\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=LEMP%20Stack%20Installation%20on%20Debian%209&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Flemp-stack-installation-on-debian-9%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Flemp-stack-installation-on-debian-9%2F&amp;title=LEMP%20Stack%20Installation%20on%20Debian%209&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/lowendprotection-homemade-raspberry-pi-security-cloud-camera-setup/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/07/rpi_security1-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-configure-reverse-proxy-with-nginx/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Configure Reverse Proxy with NGINX\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Configure Reverse Proxy with NGINX</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/protect-your-vps-with-an-electronic-pitbull-active-firewalls/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Protect Your VPS With an Electronic Pitbull: Active Firewalls\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/active-firewalls-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Protect Your VPS With an Electronic Pitbull: Active Firewalls</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}