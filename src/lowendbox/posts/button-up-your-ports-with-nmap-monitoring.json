{"id": "22408", "post": "<div class=\"post-22408 post type-post status-publish format-standard hentry category-tutorials tag-monitor-ports tag-nmap tag-nmap-monitoring tag-port-security tag-tutorial\" id=\"post-22408\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/button-up-your-ports-with-nmap-monitoring/\" rel=\"bookmark\">Improved Server Security By Closing Ports With nmap Monitoring</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/monitor-ports/\" rel=\"tag\">monitor ports</a>, <a href=\"https://lowendbox.com/tag/nmap/\" rel=\"tag\">nmap</a>, <a href=\"https://lowendbox.com/tag/nmap-monitoring/\" rel=\"tag\">nmap monitoring</a>, <a href=\"https://lowendbox.com/tag/port-security/\" rel=\"tag\">port security</a>, <a href=\"https://lowendbox.com/tag/tutorial/\" rel=\"tag\">tutorial</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> June 7, 2020 @ 4:48 am, by raindog308</div><div class=\"storycontent tablelook\"><p><a><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MTYiIGhlaWdodD0iMjQ1IiB2aWV3Qm94PSIwIDAgNDE2IDI0NSI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"screenshot\" data-src=\"https://lowendbox.com/wp-content/uploads/2020/04/nmap-monitoring.png.webp\" alt=\"\" width=\"416\" height=\"245\"></a></p><p class=\"p1\"><span class=\"s1\">A cardinal rule of security is to avoid running services you don\u2019t need.&nbsp; A logical extension of that rule is to not expose ports to the public Internet unnecessarily.</span></p><p class=\"p1\"><span class=\"s1\">You may have a very good reason to run MySQL, however you may not need to expose MySQL to the public Internet.<span class=\"Apple-converted-space\">&nbsp; </span>If you have a package that requires Samba as a dependency, you want to make sure Samba is not up and running on your public IP.<span class=\"Apple-converted-space\">&nbsp; </span>On many VPSes, nothing beyond sshd and a web server need to be publicly facing.&nbsp;</span></p><p><span id=\"more-22408\"></span></p><p class=\"p1\"><span class=\"s1\">Take a moment to scan your system to determine what ports are publicly facing.<span class=\"Apple-converted-space\">&nbsp; </span>The easiest way to do this is with the nmap tool:</span></p><pre class=\"p1\"><span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>apt-get install nmap (Debian)</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>yum -y install nmap (CentOS)</span></pre><p class=\"p1\"><span class=\"s1\">Then:</span></p><pre class=\"p1\"><span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>nmap &lt;your public IP&gt;</span></pre><p class=\"p1\"><span class=\"s1\">It will provide a report of what ports are open.<span class=\"Apple-converted-space\">&nbsp; </span>For example:</span></p><pre class=\"p1\"><span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>Starting Nmap 7.40 ( https://nmap.org ) at 2020-04-01 16:35 PDT</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>Nmap scan report for myvps.example.com (x.x.x.x)</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>Host is up (0.0000030s latency).</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>Not shown: 992 closed ports</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>PORT <span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>STATE SERVICE</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>22/tcp <span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>ssh</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>25/tcp <span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>smtp</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>80/tcp <span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>http</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>111/tcp<span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>rpcbind</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>139/tcp<span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>netbios-ssn</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>445/tcp<span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>microsoft-ds</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>587/tcp<span class=\"Apple-converted-space\">&nbsp; </span>open<span class=\"Apple-converted-space\">&nbsp; </span>submission</span>\n<span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>3306/tcp open<span class=\"Apple-converted-space\">&nbsp; </span>mysql</span></pre><p class=\"p1\"><span class=\"s1\">In this case, many services can be reconfigured to enhance security:</span></p><ul><li class=\"p1\"><span class=\"s1\">ssh could be moved to a different port</span></li><li class=\"p1\"><span class=\"s1\">if the system is not designed to accept mail, smtp shouldn\u2019t be listening on ports 25 and 587</span></li><li class=\"p1\"><span class=\"s1\">rpcbind is unneeded in most cases</span></li><li class=\"p1\"><span class=\"s1\">netbios-ssn and microsoft-ds are Samba and should be disabled or restricted to private IPs</span></li><li class=\"p1\"><span class=\"s1\">mysql should be reconfigured to listen on localhost (127.0.0.1) only</span></li></ul><p><span class=\"s1\">Note that nmap does not scan all 65536 ports by default.<span class=\"Apple-converted-space\">&nbsp; </span>If you want a comprehensive scan:</span></p><pre class=\"p1\"><span class=\"s1\"><span class=\"Apple-converted-space\">&nbsp; &nbsp; </span>nmap -p1-65535 &lt;your public IP&gt;</span></pre><p class=\"p1\"><span class=\"s1\">Be advised that scanning your VPS from another VPS will sometimes trip your provider\u2019s intrusion detection systems, so it\u2019s best to scan from the VPS itself.</span></p><p class=\"p1\"><span class=\"s1\">You can also automate checking if new ports are opened by running nmap periodically and reporting any differences.<span class=\"Apple-converted-space\">&nbsp; </span>Here is a script to accomplish this.</span></p><pre class=\"p1\"><span class=\"s1\">     #!/bin/bash</span>\n<span class=\"s1\">     EMAIL=someone@example.com </span>\n<span class=\"s1\">     PUBLIC_IP=&lt;your public ip&gt;</span>\n<span class=\"s1\">     prev_file=/root/nmap.last.scan.txt</span>\n<span class=\"s1\">     if [ ! -f $prev_file ] ; then</span>\n<span class=\"s1\">         nmap -p1-65535 $PUBLIC_IP | grep open &gt; $prev_file</span>\n<span class=\"s1\">         exit 0</span>\n<span class=\"s1\">     fi</span>\n<span class=\"s1\">     temp_file=$(mktemp)</span>\n<span class=\"s1\">     nmap -p1-65535 $PUBLIC_IP | grep open &gt; $temp_file</span>\n<span class=\"s1\">     cmp $prev_file $temp_file &gt; /dev/null</span>\n<span class=\"s1\">     if [ $? -ne 0 ] ; then</span>\n<span class=\"s1\">         mailx -s \"nmap output has changed on $(hostname)!\" $EMAIL &lt; $temp_file</span>\n<span class=\"s1\">     fi</span>\n<span class=\"s1\">     mv $temp_file $prev_file</span></pre><p><span class=\"s1\">To deploy this script:</span></p><ol><li class=\"p1\"><span class=\"s1\">Change the EMAIL and PUBLIC_IP to appropriate values</span></li><li class=\"p1\"><span class=\"s1\">Save the script as /root/nmap_checker.sh (or wherever you would like) and make it executable (chmod 755 /root/nmap_checker.sh)</span></li><li class=\"p1\"><span class=\"s1\">Add the following line to root\u2019s crontab.&nbsp; In this example it\u2019s configured to run every day at 4am:</span></li></ol><pre class=\"p1\"><span class=\"s1\">        0 4 * * * <span class=\"Apple-converted-space\">&nbsp; </span>/root/nmap_checker.sh</span>\n</pre><p class=\"p1\"><span class=\"s1\">From that point forward you should get an email whenever the nmap scan of your VPS changes.</span></p><p>&nbsp;</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fbutton-up-your-ports-with-nmap-monitoring%2F&amp;t=Improved%20Server%20Security%20By%20Closing%20Ports%20With%20nmap%20Monitoring\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Improved%20Server%20Security%20By%20Closing%20Ports%20With%20nmap%20Monitoring&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fbutton-up-your-ports-with-nmap-monitoring%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fbutton-up-your-ports-with-nmap-monitoring%2F&amp;title=Improved%20Server%20Security%20By%20Closing%20Ports%20With%20nmap%20Monitoring&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">5</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/managing-your-lowendempire-with-ansible-part-1/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Managing Your LowEndEmpire With Ansible, Part 1\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Managing Your LowEndEmpire With Ansible, Part 1</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/setup-a-dns-nameserver-using-nsd/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Setup a DNS Nameserver Using NSD\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Setup a DNS Nameserver Using NSD</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/keeping-a-logwatchful-eye-on-your-vps-with-logwatch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Keeping A (log)Watchful Eye on Your VPS With logwatch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/logwatch-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Keeping A (log)Watchful Eye on Your VPS With logwatch</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/raindog308/\" title=\"All posts by raindog308\" rel=\"author\">raindog308</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4ce3b8640a70e05bd73ac25b8a37821c?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.lowendtalk.com/profile/raindog308\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\">I'm Andrew, techno polymath and long-time LowEndTalk community Moderator. My technical interests include all things Unix, perl, python, shell scripting, and relational database systems. I enjoy writing technical articles here on LowEndBox to help people get more out of their VPSes.</p></div></div><div class=\"feedback\"></div></div>"}