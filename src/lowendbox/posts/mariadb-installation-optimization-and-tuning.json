{"id": "9113", "post": "<div class=\"post-9113 post type-post status-publish format-standard hentry category-tutorials tag-mariadb tag-tutorials-2\" id=\"post-9113\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/mariadb-installation-optimization-and-tuning/\" rel=\"bookmark\">MariaDB: Installation, Optimization and Tuning</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \"> <a href=\"https://lowendbox.com/tag/mariadb/\" rel=\"tag\">mariadb</a>, <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \"> September 29, 2016 @ 3:42 pm, by SysAdmin</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><a href=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzEiIGhlaWdodD0iNzAiIHZpZXdCb3g9IjAgMCAyNzEgNzAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\"></a></p><p>MariaDB is forked from MySQL, MariaDB has been known to be a drop-in replacement that brings enhancements and performance optimizations over MySQL. This tutorial will show you how to install, optimize and tune on your server-side.</p><p><span id=\"more-9113\"></span></p><p><strong>Step 1: Download/Install MariaDB</strong></p><p>This is straightforward, if you don\u2019t have installed yet simply run the following. If you already have installed then good, move to the next step directly. <strong>Remember to always verify the contents of a remote script before executing.</strong></p><blockquote><p style=\"padding-left: 30px;\">wget https://raw.githubusercontent.com/sayem314/MariaDB-Installer-for-Linux/master/install-mariadb.sh &amp;&amp; bash install-mariadb.sh &amp;&amp; rm install-mariadb.sh</p></blockquote><p>On Debian/Ubuntu it would prompt for entering a root password. I would recommend choosing a strong/complex password.</p><p><strong>Step 2: Securing MariaDB</strong></p><p>Finish the installation by running mysql_secure_installation script to address several security concerns in a default MariaDB installation:</p><blockquote><p style=\"padding-left: 30px;\">/usr/bin/mysql_secure_installation</p></blockquote><p>In order to log into MariaDB to secure it, we\u2019ll need the current password for the root user. If you\u2019ve just installed MariaDB, and you haven\u2019t set the root password yet, then the default password will be blank, so you should just press enter to continue.</p><blockquote><p style=\"padding-left: 30px;\">Enter current password for root (enter for none):</p><p style=\"padding-left: 30px;\">OK, successfully used password, moving on\u2026</p></blockquote><p>Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorization.</p><blockquote><p style=\"padding-left: 30px;\">Set root password? [Y/n] y</p><p style=\"padding-left: 30px;\">New password: MyPassword</p><p style=\"padding-left: 30px;\">Re-enter new password: MyPassword</p><p style=\"padding-left: 30px;\">Password updated successfully!</p><p style=\"padding-left: 30px;\">Reloading privilege tables..</p><p style=\"padding-left: 30px;\">\u2026 Success!</p></blockquote><p>By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove the anonymous login before moving into a production environment.</p><blockquote><p style=\"padding-left: 30px;\">Remove anonymous users? [Y/n] y</p><p style=\"padding-left: 30px;\">\u2026 Success!</p></blockquote><p>Normally, root should only be allowed to connect from \u2018localhost\u2019. This ensures that someone cannot guess the root password over the network.</p><blockquote><p style=\"padding-left: 30px;\">Disallow root login remotely? [Y/n] y</p><p style=\"padding-left: 30px;\">\u2026 Success!</p></blockquote><p>By default, MariaDB comes with a database named \u2018test\u2019 that anyone can access. This is intended for testing only and should be removed before moving into a production environment.</p><blockquote><p style=\"padding-left: 30px;\">Remove test database and access to it? [Y/n] y</p><p style=\"padding-left: 30px;\">\u2013 Dropping test database\u2026</p><p style=\"padding-left: 30px;\">\u2026 Success!</p><p style=\"padding-left: 30px;\">\u2013 Removing privileges on test database\u2026</p><p style=\"padding-left: 30px;\">\u2026 Success!</p></blockquote><p>Reloading the privilege tables will ensure that all changes made so far will take effect immediately.</p><blockquote><p style=\"padding-left: 30px;\">Reload privilege tables now? [Y/n] y</p><p style=\"padding-left: 30px;\">\u2026 Success!</p><p style=\"padding-left: 30px;\">Cleaning up\u2026</p></blockquote><p style=\"padding-left: 30px;\">All done! If you\u2019ve completed all of the above steps, your MariaDB installation should now be secure.</p><p style=\"padding-left: 30px;\">Thanks for using MariaDB!</p><p>Now, you have to restart MariaDB.</p><blockquote><p style=\"padding-left: 30px;\">service mysql restart</p><p style=\"padding-left: 30px;\">Shutting down MySQL.. SUCCESS!</p><p style=\"padding-left: 30px;\">Starting MySQL. SUCCESS!</p></blockquote><p>That\u2019s it. To log in to MariaDB as the root user:</p><blockquote><p style=\"padding-left: 30px;\">mysql -u root -p</p></blockquote><p>When prompted, enter the root password you assigned when the mysql_secure_installation script was run.</p><p><strong>Step 3: Tuning/Optimization</strong></p><p>Tuning/Optimization are about utilizing as many resources as possible, not reducing resource utilization. No one buys a Ferrari and modifies it to go slower! A well-tuned MySQL server can perform 2-3x better than a poorly tuned MySQL server. Optimizing MySQL/MariaDB is very important to get right the first time. There are really only few settings that need to be tuned/changed. This post will walk you through the steps for determining if MySQL/MariaDB needs to be tuned, and if it does how to tune the settings.</p><p><strong>This is how MySQL/MariaDB works on the server-side:</strong></p><ul><li>Server A: Lots of CPU power and good storage system.</li></ul><p style=\"padding-left: 30px;\">E5-2650v3</p><p style=\"padding-left: 30px;\">8GB RAM</p><p style=\"padding-left: 30px;\">SATA RAID 10 with 4 disks</p><p style=\"padding-left: 30px;\">10GB of MySQL data</p><ul><li>Server B: Decent CPU, not a ton of cores, lots of RAM, basic storage system.</li></ul><p style=\"padding-left: 30px;\">E3-1270v3</p><p style=\"padding-left: 30px;\">16GB RAM</p><p style=\"padding-left: 30px;\">SATA RAID 1 with 2 disks</p><p style=\"padding-left: 30px;\">10GB of MySQL data</p><p>The question is which server will perform better? You might think that because the E5 box has a lot of cores, costs a lot of money and has RAID 10 it\u2019s better. However, if you run some Sysbench OLTP read tests on these boxes Server B will more than likely to crush server A. Why? RAM, that\u2019s why.</p><p>Here is what happens if I send a SELECT query to the server A:</p><p style=\"padding-left: 30px;\">Step 1) Server gets my request, goes to find my data, there\u2019s a 4/10 chance that it\u2019s in RAM. Just so happens my data is not in RAM.</p><p style=\"padding-left: 30px;\">Step 2) Server sends my disk a request for my data, CPU sends the request really quickly, and then waits for the array to return my data.</p><p style=\"padding-left: 30px;\">Step 3) My disks took their time getting my data, let\u2019s say they took 20ms (really long).</p><p style=\"padding-left: 30px;\">Step 4) My CPU fiddles it\u2019s thumbs waiting on my data to be returned from the disks (into RAM). And finally gets the results and sends to me.</p><p>Here is what happens if I send a SELECT query to the server B:</p><p style=\"padding-left: 30px;\">Step 1) Server gets my request, goes to find my data, 100% chance it\u2019s in RAM. Great!</p><p style=\"padding-left: 30px;\">Step 2) It takes less than 1ms for the RAM to find my data and return it to the CPU</p><p style=\"padding-left: 30px;\">Step 3) CPU sends the data to me.</p><p>Basically the server B could theoretically serve more than 10 requests in the amount of time the server A takes to return one request. There are four main areas to focus on in terms of server performance, RAM, CPU, DISK and NETWORK. RAM is the most important factor for MySQL performance. The fastest CPU will not help to speed up your database if it does not have correct amount of RAM. There has always been a severe bottleneck between the CPU and Harddrive, the solution to that is RAM. Reading data out of RAM is significantly faster than reading data from an SATA harddrive, or even an SSD. Because of this we want to try and fit as much data into RAM as possible to speed up response times.</p><p>CPU performance is ONLY a factor if you have very low IO WAIT and you are correctly utilizing RAM. If you notice that your CPU is constantly around 90%-100% then you may want to look into a CPU upgrade. In general, MySQL/MariaDB prefers faster cores instead of more cores.</p><p><strong>How much RAM do I need?</strong></p><p>Let\u2019s say you have one database that totals 6GB in size. You would want at least 6GB of RAM for this database. You also need RAM for the OS and things like that so 8GB of RAM should be sufficient.</p><p>If you have 30GB of databases then, you will want at least 30GB of RAM. Obviously this can sometimes be cost prohibitive, but the fact is that you will want to put as much of your data into RAM as possible. This is the most important thing to improve MySQL/MariaDB performance. If you don\u2019t have sufficient RAM on your server MySQL/MariaDB will perform poorly regardless of the my.cnf settings you try to change.</p><p>By utilizing as much RAM as possible you are not only making response time faster, you are also freeing up the servers DISK so that it can attend to other things, like writing data. This also makes your CPU much more efficient since it does not have to wait for the slow disk to process its request for data.</p><p>You can use below script to get MySQL/MariaDB memory usage, or memory usage for any other running process. Create a file named mem.sh, paste in the contents below.</p><blockquote><p style=\"padding-left: 30px;\">#!/bin/bash</p><p style=\"padding-left: 30px;\">ps -C $1 -O rss | awk \u2018{ count ++; sum += $2 }; END {count \u2013; print \u201cNumber of processes =\u201d,count; print \u201cMemory usage per process =\u201d,sum/1024/count, \u201cMB\u201d; print \u201cTotal memory usage =\u201d, sum/1024, \u201cMB\u201d ;};\u2019</p></blockquote><p>Run <em>chmod +x mem.sh</em> then run <em>./mem.sh mysqld</em> to get MySQL/MariaDB memory usage. You can also use this for other apps like apache, php or anything else.</p><p>Changes you should make on MySQL/MariaDB configuration file described below. Your configuration file (my.cnf) is located on /etc/my.cnf or /etc/mysql/my.cnf. If you have a 512MB server then I would recommend you keep the default settings.</p><p><strong>innodb_buffer_pool_size</strong></p><p>InnoDB maintains a storage area called the buffer pool for caching data and indexes in memory. Knowing how the InnoDB buffer pool works, and taking advantage of it to keep frequently accessed data in memory, it\u2019s an important aspect of MySQL/MariaDB tuning.</p><p><strong>key_buffer_size</strong></p><p>To minimize disk I/O, the MyISAM storage engine exploits a strategy that is used by many database management systems. It employs a cache mechanism to keep the most frequently accessed table blocks in memory.</p><p><strong>innodb_log_file_size</strong></p><p>For servers with SSDs you can raise this to 128MB, 256MB, or even 2GB. Keep in mind that the larger the logs are the longer a recovery might take. For spinning HDDs this is a problem since they are already slow, so recovery could take a long time. If you have SSDs, which is much faster, recovery would take only few more seconds or minutes if you set this really high.</p><p style=\"padding-left: 30px;\">## 160M for 1GB RAM, 450M for 2GB RAM 2G for 4GB RAM and 5G for 8GB RAM</p><p style=\"padding-left: 30px;\">innodb_buffer_pool_size = 64M</p><p style=\"padding-left: 30px;\">## 96M for 2GB RAM, 256M for 4GB RAM and 768M for 8GB RAM</p><p style=\"padding-left: 30px;\">key_buffer = 64M</p><p style=\"padding-left: 30px;\">## Changing this setting requires you to stop MySQL</p><p style=\"padding-left: 30px;\">innodb_log_file_size = 128M</p><p>If you have 256MB VPS then, you can lower default value slightly, this might decrease performance, but it would keep your VPS stable. I would not recommend you to install MariaDB on a system with less than 256MB RAM. You can use <a href=\"https://tools.percona.com/\">Percona Tools</a> to get an optimized configuration files for your server.</p><p>Thank you to @sayem314 on <a href=\"http://www.lowendtalk.com\">LowEndTalk</a>&nbsp;for contributing this tutorial!</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fmariadb-installation-optimization-and-tuning%2F&amp;t=MariaDB%3A%20Installation%2C%20Optimization%20and%20Tuning\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=MariaDB%3A%20Installation%2C%20Optimization%20and%20Tuning&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fmariadb-installation-optimization-and-tuning%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fmariadb-installation-optimization-and-tuning%2F&amp;title=MariaDB%3A%20Installation%2C%20Optimization%20and%20Tuning&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">1</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/lemp-stack-installation-on-ubuntu-16-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LEMP Stack Installation on Ubuntu 16.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">LEMP Stack Installation on Ubuntu 16.04</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/sysadmin/\" title=\"All posts by SysAdmin\" rel=\"author\">SysAdmin</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/5643ecc712d8cfd7617ed9f0e45dc348?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/5643ecc712d8cfd7617ed9f0e45dc348?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"http://www.lowendbox.com\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}