{"id": "8990", "post": "<div class=\"post-8990 post type-post status-publish format-standard hentry category-tutorials\" id=\"post-8990\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/enabling-encryption-ssl-on-apache-and-nginx/\" rel=\"bookmark\">Enabling Encryption (SSL) on Apache and Nginx</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> September 6, 2016 @ 9:00 pm, by SysAdmin</div><div class=\"storycontent tablelook\"><p>Encrypting the connections to your website will help you keep your customer\u2019s data safe and secure. Without encryption, a malicious actor could sniff the connection of your users and intercept the packets in transit.</p><p>The Secured Socket Layer (SSL) prevents data from being intercepted between the client and the server. Here are some of the most common reasons why a server should always deliver content using secured pages:</p><p>\u2013 Protect user identities and passwords</p><p>\u2013 Protect credit card transactions and other sensitive information during online purchases</p><p>\u2013 Allow users to safely view personal and business financial information</p><p>\u2013 Prevents a connection from being sniffed by a \u201cMan in the Middle.\u201d</p><p><span id=\"more-8990\"></span></p><p>Getting Started with Encrypted Connections to Your Website</p><p>In order to encrypt the connection between a client and the server, you will need to have a valid security certificate installed on your server.</p><p>In this article we will show you how to set up a TLS/SSL certificate from \u201cLet\u2019s Encrypt\u201d on an Ubuntu 16.04 server running Apache and Nginx as a web server. In addition, we will also cover how to automate the certificate renewal process using a CRON job.</p><p>In order to install the Let\u2019s Encrypt client, we will need to download and install git. You can do this using the following command:</p><p style=\"padding-left: 30px;\">&gt; sudo apt-get install git</p><p>We can now download the Let\u2019s Encrypt client from its official repository. We will place the files in a specific directory to facilitate the update process when a new release is available.</p><p>Since \u201cLet\u2019s Encrypt\u201d client is still in beta, it\u2019s important to keep the client updated to correct bugs and obtain new functionality.</p><p>We will clone the Let\u2019s Encrypt repository under /opt using the following command:</p><p style=\"padding-left: 30px;\">&gt; sudo git clone https://github.com/letsencrypt/letsencrypt /opt/letsencrypt</p><p>The commands to update the repository are the following:</p><p style=\"padding-left: 30px;\">&gt; cd /opt/letsencrypt</p><p style=\"padding-left: 30px;\">&gt; sudo git pull</p><p>We recommend that you execute these commands often in order to keep the client always up to date.</p><p>Now that we have our Let\u2019s Encrypt client installed, the next step is to generate the SSL Certificate. The next steps are different depending on your web server. We will cover Apache first and but if you need tips for installing SSL on Nginx, go ahead and scroll down to the Nginx section.</p><p>APACHE</p><p>Access the letsencrypt directory with the following command:</p><p style=\"padding-left: 30px;\">&gt; cd /opt/letsencrypt</p><p>Assuming we are installing the certificate for the domain example.com, to execute the interactive installation and obtain a certificate run the letsencrypt-auto command:</p><p style=\"padding-left: 30px;\">&gt; sudo ./letsencrypt-auto \u2013apache -d example.com</p><p>If you want to install a single certificate that is valid for multiple domains or sub domains, you can pass them as additional parameters to the command. The first domain name is the base domain, so we recommend that you pass the bare top-level domain name as first in the list, followed by any additional sub domains or aliases:</p><p style=\"padding-left: 30px;\">&gt; sudo ./letsencrypt-auto \u2013apache -d example.com -d www.example.com</p><p>After the dependencies are installed, you will be asked for:</p><p>\u2013 An email address for lost key recovery and notices</p><p>\u2013 To Agree with the Terms of Service</p><p>\u2013 To choose between enabling both http and https access or forcing all requests to redirect to https</p><p>We do recommend that you enforce HTTPS, unless you have a specific need for unencrypted HTTP traffic. Once the installation is finished, you will find the generated certificate files in the following directory:</p><p style=\"padding-left: 30px;\">&gt; /etc/letsencrypt/live</p><p>You can verify the status of your SSL certificate with the following link replacing example.com with your base domain:</p><p>https://www.ssllabs.com/ssltest/analyze.html?d=example.com&amp;latest</p><p>You are now able to access your website using a HTTPS prefix, but there is one more step before finishing your installation. Since Let\u2019s Encrypt certificates are valid for 90 days, it is recommended to renew the certificates every 60 days to allow a margin of error. We can do this using the renew command:</p><p style=\"padding-left: 30px;\">&gt; sudo ./letsencrypt-auto renew</p><p>Since we recently installed the certificate, the command will only check for the expiration date and print a message informing that the certificate is not due to renewal yet.</p><p>NGINX</p><p>In order to install the certificate on Nginx, unlike the Apache software, we will need to manually configure the web server to use it once it will be generated. We will use the Webroot plugin to request an SSL certificate using the following command:</p><p style=\"padding-left: 30px;\">&gt; cd /opt/letsencrypt</p><p style=\"padding-left: 30px;\">&gt; sudo ./letsencrypt-auto certonly -a webroot \u2013webroot-path=/var/www/html -d example.com -d www.example.com</p><p>Make sure that you replace \u201c/var/www/html\u201d and \u201cexample.com\u201d with the appropriate webroot path and domain name(s).</p><p>Once you execute the second command, the dependencies will be installed and you will be asked for:</p><p>\u2013 An email address for lost key recovery and notices</p><p>\u2013 To Agree with the Terms of Service</p><p>Once the installation is finished, you will find the generated certificate files in the following directory:</p><p style=\"padding-left: 30px;\">&gt; /etc/letsencrypt/live</p><p>Let\u2019s now create a new Nginx configuration snippet in the /etc/nginx/snippets directory. Execute the following command (replace vim with your favorite editor):</p><p style=\"padding-left: 30px;\">&gt; sudo vim /etc/nginx/snippets/ssl-example.com.conf</p><p>And add the following lines in the file before saving and exiting (remember to replace example.com with your domain both in the name of the file and in the lines):</p><p>ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</p><p>ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</p><p>Once this is done, we will only need to change the default configuration of Nginx in order to add the certificate. We recommend that you create a backup of the default configuration using the following command, before starting to edit the main file:</p><p style=\"padding-left: 30px;\">&gt; sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak</p><p>Use your favorite editor to change the main configuration (/etc/nginx/sites-available/default) file as following:</p><p>server {</p><p>listen 80 default_server;</p><p>listen [::]:80 default_server;</p><p>server_name example.com www.example.com;</p><p>return 301 https://$server_name$request_uri;</p><p>}</p><p>server {</p><p>listen 443 ssl http2 default_server;</p><p>listen [::]:443 ssl http2 default_server;</p><p>include snippets/ssl-example.com.conf;</p><p>\u2026</p><p>}</p><p>In this example we are assuming that you do not want to allow any connections that are not SSL. If you want to keep both types of connections available, use the following configuration:</p><p>server {</p><p>listen 80 default_server;</p><p>listen [::]:80 default_server;</p><p>listen 443 ssl http2 default_server;</p><p>listen [::]:443 ssl http2 default_server;</p><p>&nbsp;</p><p>server_name example.com www.example.com;</p><p>include snippets/ssl-example.com.conf;</p><p>\u2026</p><p>}</p><p>We can now check if there are any syntax errors in our files using the following command:</p><p style=\"padding-left: 30px;\">&gt; sudo nginx -t</p><p>If everything is successful, we are now ready to reload the web server and start serving pages with SSL:</p><p style=\"padding-left: 30px;\">&gt; sudo systemctl restart nginx</p><p>RENEW</p><p>In order to ensure your certificates won\u2019t get outdated, it is a good practice to create a CRON job that will periodically execute the command. We recommend that you create a CRON job that runs at least every week. You can easily do that using the following command:</p><p style=\"padding-left: 30px;\">&gt; sudo crontab -e</p><p>You will also want to include the following line in your CRONTAB file:</p><p style=\"padding-left: 30px;\">&gt; 00 3 * * 1 /opt/letsencrypt/letsencrypt-auto renew &gt;&gt; /var/log/certificate-renew.log</p><p>This will execute the command every Monday at 3:00 AM appending the output produced to the following log file /var/log/certificate-renew.log, allowing you to check and track errors.</p><p>FIREWALL</p><p>In both cases remember to make sure that your firewall has the TCP port 443 open. In order to enable it you might have to use the following command:</p><p style=\"padding-left: 30px;\">&gt; sudo iptables -I INPUT -t tcp \u2013dport 443 -j ACCEPT</p><p>Save your configuration and you should be all set. With this tutorial on SSL for your website, you can begin using encrypted connections that will protect the personal data of your customers as it traverses over the internet.</p><p>&nbsp;</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fenabling-encryption-ssl-on-apache-and-nginx%2F&amp;t=Enabling%20Encryption%20%28SSL%29%20on%20Apache%20and%20Nginx\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Enabling%20Encryption%20%28SSL%29%20on%20Apache%20and%20Nginx&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fenabling-encryption-ssl-on-apache-and-nginx%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fenabling-encryption-ssl-on-apache-and-nginx%2F&amp;title=Enabling%20Encryption%20%28SSL%29%20on%20Apache%20and%20Nginx&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/sysadmin/\" title=\"All posts by SysAdmin\" rel=\"author\">SysAdmin</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/5643ecc712d8cfd7617ed9f0e45dc348?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/5643ecc712d8cfd7617ed9f0e45dc348?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"http://www.lowendbox.com\" class=\"bio-icon bio-icon-website\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}