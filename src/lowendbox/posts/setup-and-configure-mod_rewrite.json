{"id": "19991", "post": "<div class=\"post-19991 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-htaccess tag-apache tag-mod-rewrite tag-rewritecond tag-rewriterule tag-ubuntu-16-04\" id=\"post-19991\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/setup-and-configure-mod_rewrite/\" rel=\"bookmark\">Setup And Configure Mod_Rewrite on Ubuntu 16.04</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/htaccess/\" rel=\"tag\">.htaccess</a>, <a href=\"https://lowendbox.com/tag/apache/\" rel=\"tag\">apache</a>, <a href=\"https://lowendbox.com/tag/mod-rewrite/\" rel=\"tag\">Mod Rewrite</a>, <a href=\"https://lowendbox.com/tag/rewritecond/\" rel=\"tag\">RewriteCond</a>, <a href=\"https://lowendbox.com/tag/rewriterule/\" rel=\"tag\">RewriteRule</a>, <a href=\"https://lowendbox.com/tag/ubuntu-16-04/\" rel=\"tag\">Ubuntu 16.04</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> July 4, 2019 @ 5:39 pm, by Dusko Savic</div><div class=\"storycontent tablelook\"><p>In this tutorial, we will study <strong>Mod_Rewrite</strong>, one of the most important modules of the Apache server. It can change the incoming address from the browser into something else, on the fly. The most common usage is to improve SEO rankings. Google, Bing and other search engines are in the business of relevancy \u2013 the site they show in the rankings should be relevant to the keywords the searcher has typed in. One of the most important relevancy factors is to have the address of the page on the site mimic or show the keywords searched as closely as possible.</p><p><span id=\"more-19991\"></span></p><p>If the keyword was</p><pre><code>how to install apache on ubuntu\n</code></pre><p>search engines will rank higher a page that has the address such as</p><pre><code>https://example.com/how-to-install-apache-on-ubuntu\n</code></pre><p>In reality, such page may not even exist in a fixed form, the site may just use a call to a database of articles with an address such as:</p><pre><code>https://example.com/show.php?keyword1=install&amp;keyword2=apache&amp;keyword3=ubuntu\n</code></pre><p>This is what popular site frameworks such as WordPress, Joomla, Drupal and many others do behind the scenes all day long. In this tutorial, you\u2019ll see how you can achieve the same effect on your own site.</p><h2 id=\"whatwearegoingtocover\">What We Are Going To Cover</h2><ul><li>Installation of Apache</li><li>Activating Mod Rewrite from Apache</li><li>Permitting .htaccess files to change</li><li>Explain the structure of a Mod Rewrite command</li><li>Use Mod Rewrite to change the file served</li><li>Make an incoming parameter look like directory</li><li>Use RewriteCond to always serve site address without www.</li></ul><h2 id=\"prerequisites\">Prerequisites</h2><ul><li>We use Ubuntu 16.04 but the procedure is practically the same for all other servers on which Apache can be installed.</li><li>Root user privileges</li></ul><h2 id=\"step1installapache\">Step 1: Install Apache</h2><p>First, update your package manager\u2019s cache:</p><pre><code>sudo apt update -y\n</code></pre><p>Install the Apache web server:</p><pre><code>sudo apt install apache2 -y\n</code></pre><p>Next, enable its service to make it run on every system boot:</p><pre><code>sudo systemctl enable apache2\n</code></pre><p>Finally, start it:</p><pre><code>sudo systemctl start apache2\n</code></pre><p>To verify that Apache was installed successfully, access it from your local browser by navigating to http://SERVER_IP/. If that does not work, try adding :80 in the end, like this:</p><pre><code>http://SERVER_IP:80\n</code></pre><p>You should see a welcome page for Apache, which means that you now have Apache running.</p><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MTgiIGhlaWdodD0iNDQwIiB2aWV3Qm94PSIwIDAgNDE4IDQ0MCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NmZDRkYiIvPjwvc3ZnPg==\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/v90tWAj.png\" alt=\"\" width=\"418\" height=\"440\"></p><h2 id=\"step2enablemodrewrite\">Step 2: Enable Mod Rewrite</h2><p>Here is a command to enable Mod_Rewrite within Apache:</p><pre><code>sudo a2enmod rewrite\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0ODciIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA0ODcgNjAiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/WER6Rpq.png\" alt=\"\" width=\"487\" height=\"60\"></p><p>Activate it by running:</p><pre><code>sudo systemctl restart apache2\n</code></pre><h2 id=\"step3enablingaccesstohtaccessfile\">Step 3: Enabling Access to .htaccess File</h2><p>In theory, you can set everything up in the Apache configuration files while in real life, it is often not possible. Your site may be on shared hosting where you do not have access to Apache and the solution is to use files called <em>.htaccess</em>. (It starts with a dot so it is not readily visible with the usual server commands.)</p><p>Open Apache global configuration file for editing:</p><pre><code>sudo nano /etc/apache2/apache2.conf\n</code></pre><p>Under the <code>&lt;Directory /var/www/&gt;</code> block, you\u2019ll find the following line:</p><pre><code>AllowOverride None\n</code></pre><p>Change it to</p><pre><code>AllowOverride All\n</code></pre><p>When you are done, save the file.</p><p>Restart Apache so that it takes new configuration into account:</p><pre><code>sudo systemctl restart apache2\n</code></pre><p>We are now ready to use Mod_Rewrite.</p><h2 id=\"mod_rewriteexample1redirectingtoanothersite\">Mod_Rewrite Example 1: Redirecting To Another Site</h2><p><em>.htaccess</em> file can change Apache settings for the folder it is in as well as for all the folders beneath it. If you want a rule to hold for the entire site, you can create a .htaccess file and put it into root document folder. In Ubuntu, that would be /var/www/html. Let\u2019s create it:</p><pre><code>sudo nano /var/www/html/.htaccess\n</code></pre><p>If you want to run several sites, you will probably use this as the destination:</p><pre><code>sudo nano /var/www/example.com/html\n</code></pre><p>Put the following text into .htaccess file:</p><pre><code>Options +FollowSymLinks\nRewriteEngine On\nRewriteRule ^empty.html$ http://www.google.com/ [R=301]\n</code></pre><p>The first line should always be present in a .htaccess file. The second line turns rewriting on and off \u2013 it should always be turned on! The third line is the rewrite rule. Let\u2019s explain what it does:</p><ul><li><strong>RewriteRule</strong> is the command for rewriting. The rest of the line is <em>what</em>, to <em>where</em>, and <em>how</em> the redirection should be executed.</li><li><strong>^empty.html$</strong> is an example of a regular expression. Symbol <strong>^</strong> denotes start and symbol <strong>$</strong> denotes the end of the expression. Text in between them is the regular expression itself. Here it is <strong>empty.html</strong> and is unique in the sense that only if the address after the domain name contains <em>empty.html</em>, the rewrite rule will be obeyed.</li><li><strong>http://www.google.com/</strong> is the address to go to if text <strong>empty.html</strong> was found in the incoming address. In this case, we end up on Google main site but we could have pointed it to any other valid domain.</li><li><strong>[R=301]</strong> The parameters in square brackets change the way the transition is executed. Here R=301 means the a redirection of type 301 should take place. In this context, 301 is a permanent redirect and 301 is the HTTP status code that the page visited will return to the browser.</li></ul><p><strong>WARNING</strong> 301 redirection stays stored in your browser, so if it so happens that you wish to redirect <strong>empty.html</strong> to another destination in the future, it may still go to Google\u2019s site.</p><p>Now go to your browser and type in the following address:</p><pre><code>http://SERVER_IP/empty.html\n</code></pre><p>You will end up on google.com.</p><h2 id=\"mod_rewriteexample2redirectingaurltothesamesite\">Mod_Rewrite Example 2: Redirecting A URL To the Same Site</h2><p>Now create a new html page, <strong>write1.html</strong>, in root document folder:</p><pre><code>cd /var/www/html\nsudo nano write1.html\n</code></pre><p>and write the following to it:</p><pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;Welcome&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;Welcome to my page write1.html!&lt;/h1&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>This is what it would look like in the browser, with its normal address</p><pre><code>http://SERVER_IP/write1.html\n</code></pre><p><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NzgiIGhlaWdodD0iNjIiIHZpZXdCb3g9IjAgMCA0NzggNjIiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNjZmQ0ZGIiLz48L3N2Zz4=\" loading=\"lazy\" class=\"\" data-src=\"https://i.imgur.com/OfJ9fyb.png\" alt=\"\" width=\"478\" height=\"62\"></p><p>The next command redirects users from <strong>old.html</strong> to <strong>write1.html</strong>:</p><pre><code>RewriteRule ^old.html$ write1.html [R=301]\n</code></pre><p>The address in the browser would be</p><pre><code>http://SERVER_IP/old.html\n</code></pre><p>but still the contents of page <strong>write1.html</strong> would be shown, the same as in the image above.</p><h2 id=\"mod_rewriteexample3rewriteallhtmlfilestophpfilesinternally\">Mod_Rewrite Example 3: Rewrite All html Files To php Files, Internally</h2><p>We have redirected one file to another file on the same site and now we will redirect all files ending in .html to files ending in .php. Put this into .htaccess file:</p><pre><code>Options +FollowSymlinks\nRewriteEngine on\nRewriteRule ^(.*)\\.html$ $1.php [NC]\n</code></pre><p>Here is an explanation, character by character:</p><ul><li><strong>^</strong> starts the rule, while</li><li><strong>$</strong> ends it.</li><li><strong>.*</strong> in the parentheses accepts whatever text there is</li><li><strong>\\.</strong> after <strong>)</strong> must be there to represent the dot itself (where <strong>\\</strong> serves as an escape character)</li><li><strong>.html</strong> is the ending</li><li><strong>$1</strong> in the third part of the RewrireRule command takes everything in the parentheses from the second parameter and joins it with the <strong>.php</strong> ending</li><li><strong>[NC]</strong> is a flag meaning \u201cNo Case\u201d, standing for both upper-case and lower-case characters.</li></ul><p>The above rule will buy you some time to make a transition from a static, <em>html</em> based site, to a dynamic one, based on <em>php</em>. However, both visitors and the search engines will still use html page while they could use the php versions of the pages \u2013 if they knew they existed.</p><h2 id=\"mod_rewriteexample4rewriteallhtmlfilestophpfilesexternally\">Mod_Rewrite Example 4: Rewrite All html Files To php Files, Externally</h2><p>The following code will redirect to the same site, this time via proper HTTP requests:</p><pre><code>Options +FollowSymlinks\nRewriteEngine on\nRewriteRule ^(.+)\\.html$ http://example.com/$1.php [R,NC]\n</code></pre><p>These addresses will be seen in the browser so both the visitors and the search engines could bookmark them for further use.</p><p>Flag <strong>R</strong> in <strong>[R,NC]</strong> stands for temporary redirection, which has the official page code of 302.</p><h2 id=\"mod_rewriteexample5makeanincomingparameterlooklikedirectory\">Mod_Rewrite Example 5: Make an Incoming Parameter Look Like Directory</h2><p>Please note that the contents of the parentheses in the previous example, <strong>(.+)</strong> were taken verbatim by Mod_Rewrite and put into the new address via parameter <strong>$1</strong>. If there were a second pair of parentheses, it would go to <strong>$2</strong>, the third pair of parentheses would go to <strong>$3</strong> and so on. Instead of a link such as</p><pre><code>http://example.com/download.php?section=games&amp;file=mygame\n</code></pre><p>we can produce flat link like this:</p><pre><code>http://example.com/files/games/mygame.zip\n</code></pre><p>It is shorther, easier to remember and can be typed in directly into the browser. Here is the RewriteRule:</p><pre><code>Options +FollowSymlinks\nRewriteEngine on\nRewriteRule ^files/([^/]+)/([^/]+).zip /download.php?section=$1&amp;file=$2 [NC]\n</code></pre><h2 id=\"mod_rewriteexample6threeinputparameterswithregularexpressions\">Mod_Rewrite Example 6: Three Input Parameters With Regular Expressions</h2><p>The two most frequently used types of HTTP requests are GET and POST. The latter has several parameters and will look like this:</p><pre><code>http://example.com/edit.php?category=newspaper&amp;section=sports&amp;detail=tennis\n</code></pre><p>We want to transform it into this:</p><pre><code>http://example.com/newspaper/sports/tennis\n</code></pre><p>and here is the RewriteRule to do that:</p><p><code><br>\nRewriteRule ^(newspaper|magazine|site)/([^/.]+)/([^/.]+)$ edit.php?category=$1&amp;section=$2&amp;detail=$3<br>\n</code></p><ul><li>The first parentheses <strong>(newspaper|magazine|site)</strong> gives only three choices for category</li><li>The other two parentheses, <strong>([^/.]+)</strong> are translated as follows: <strong>+</strong> means that any characters and at any length can be served as input, while the brackets, <strong>[^/.]</strong>, tell us that that input may not start with characters <strong>/</strong> and <strong>.</strong>.</li></ul><h2 id=\"eliminatingwwwfromtheaddressusingrewritecond\">Eliminating www. from the Address \u2013 Using RewriteCond</h2><p>It is possible to perform rewrite rules only if certain conditions are met. It is a concept from programming languages: \u201cif this is true, execute this rewrite rule, if not true\u2026 then stop evaluating\u201d. This requires new keyword <strong>RewriteCond</strong>. Full explanation of <strong>RewriteCond</strong> is out of scope of this article, but we will illustrate how it works.</p><p>Sites can use <strong>www.example.com</strong> address or only <strong>example.com</strong>. The former stems from the early days of Internet, but for SEO purposes, these two addresses appear as two different sites. Here is the code to eliminate <strong>www.</strong> from the address in the browser.</p><pre><code>Options +FollowSymlinks\nRewriteEngine on\nRewriteCond %{HTTP_HOST} ^www\\.(.*) [NC]\nRewriteRule ^(.*)$ http://%1/$1 [R=301,NC,L]\n</code></pre><p>If the address <strong>%{HTTP_HOST}</strong> starts with <strong>www.</strong>, it will be evaluated in the RewriteCond command. If true, the second rewrite rule, here with the command <strong>RewriteRule</strong>, will be evaluated as the same address (parameter <strong>%1</strong>) and the same page (parameter <strong>$1</strong>). Pay attention to the flags here. <strong>R=301</strong> means the redirection is permanent, which is good for search engines to know and <strong>L</strong> states that this must be the last rewrite rule evaluated.</p><h2 id=\"whatelseyoucandonow\">What Else You Can Do Now</h2><p>There are many other uses of Mod_Rewrite, for instance:</p><ul><li>Protect your site from hotlinking and leeching images</li><li>Redirect your site to its /blog directory</li><li>Redirect nonexisting pages to your main site address</li><li>Add www. to every page of you site</li><li>Block specific IP addresses from your site</li><li>Use multiple domains in one root</li><li>Automatic translation of pages</li><li>Set up cookies and use them later for authentication purposes</li><li>Prevent user agents (bots) from eating bandwidth on your site</li></ul><p>Dusko Savic is a technical writer and programmer.</p><p><a href=\"https://duskosavic.com/blog/\">duskosavic.com</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-and-configure-mod_rewrite%2F&amp;t=Setup%20And%20Configure%20Mod_Rewrite%20on%20Ubuntu%2016.04\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=Setup%20And%20Configure%20Mod_Rewrite%20on%20Ubuntu%2016.04&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-and-configure-mod_rewrite%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fsetup-and-configure-mod_rewrite%2F&amp;title=Setup%20And%20Configure%20Mod_Rewrite%20on%20Ubuntu%2016.04&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-secure-apache-with-lets-encrypt-on-ubuntu-18-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Secure Apache with Let's Encrypt on Ubuntu 18.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Secure Apache with Let's Encrypt on Ubuntu 18.04</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-apache-virtual-hosts-on-centos-7/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Set Up Apache Virtual Hosts on CentOS 7\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Set Up Apache Virtual Hosts on CentOS 7</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/lemp-stack-installation-on-ubuntu-16-04/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LEMP Stack Installation on Ubuntu 16.04\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">LEMP Stack Installation on Ubuntu 16.04</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/dusko/\" title=\"All posts by Dusko Savic\" rel=\"author\">Dusko Savic</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/42872b609daecf21764ca315bcf13c04?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://duskosavic.com\" class=\"bio-icon bio-icon-website\"></a><a target=\"_blank\" rel=\"nofollow noopener noreferrer\" href=\"https://www.linkedin.com/in/dusko-savic-741487149/\" class=\"bio-icon bio-icon-linkedin\"></a><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}