{"id": "4647", "post": "<div class=\"post-4647 post type-post status-publish format-standard hentry category-tutorials tag-tutorials-2\" id=\"post-4647\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/ngnix-php-fpm-mariadb-stack-ubuntu/\" rel=\"bookmark\">How to Setup a Ngnix PHP-FPM MariaDB Stack Ubuntu</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/tutorials-2/\" rel=\"tag\">tutorials</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> November 23, 2013 @ 2:36 pm, by Maarten Kossen</div><div class=\"storycontent tablelook\"><p style=\"text-align: center;\"><a href=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png\"><img data-lazyloaded=\"1\" src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" loading=\"lazy\" class=\"alignnone size-full wp-image-3957 litespeed-loaded\" data-src=\"https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial.png.webp\" alt=\"lowendtutorial\" width=\"271\" height=\"70\" data-was-processed=\"true\"></a></p><p>A couple of years back, getting a web server up and running involved setting up Apache, mod_php and MySQL. Everything was owned by \u201ca user\u201d and if a script needed file access, you would just chmod 777 all the files that needed to be accessed. Over the past couple of years, that landscape has shifted. Nowadays, mod_php is the slowest option you could probably go with and MySQL isn\u2019t all hipster anymore since Oracle bought Sun. Apache is still at large, but requires more resources to accomplish what NGINX does with less.</p><p><span id=\"more-4647\"></span></p><p>So, let\u2019s go set up a web server that runs NGINX, PHP-FPM and MariaDB! MariaDB is a MySQL fork created by the original author of MySQL. It\u2019s slowly replacing MySQL as the database server on Linux distributions and I have to say, I\u2019m a big fan as well. PHP-FPM is a process manager for PHP that makes PHP run independently from the web server, which has multiple advantages over including PHP in the web server process (which is wrong to being with).</p><p>I\u2019ve written this guide for Ubuntu. The process should be the same on Debian or other Debian-based distributions. A CentOS version is to follow later.</p><h2>NGINX and PHP-FPM</h2><p>First, let\u2019s clean out any packages that may make you go \u201cwhy doesn\u2019t it work?\u201d:</p><blockquote><p>sudo apt-get purge apache2* libapache2*</p></blockquote><p>That\u2019s Apache out the door, including any libraries. The above may or may not be necessary, depending on what kind of VPS you have and what kind of template. It\u2019s safe to run it anyway.</p><p>Now, let\u2019s install NGINX and PHP-FPM:</p><blockquote><p>sudo apt-get install nginx php5-fpm</p></blockquote><p>When this is done and you visit your server\u2019s hostname or IP address, you should see the NGINX landing page. This means installation has succeeded.</p><p>On to the configuration. Open up /etc/nginx/sites-available/default. Look for a code block that looks like this:</p><blockquote><p># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000<br>\n#<br>\n#location ~ \\.php$ {<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_split_path_info ^(.+\\.php)(/.+)$;<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # NOTE: You should have \u201ccgi.fix_pathinfo = 0;\u201d in php.ini<br>\n#<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # With php5-cgi alone:<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_pass 127.0.0.1:9000;<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # With php5-fpm:<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_pass unix:/var/run/php5-fpm.sock;<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_index index.php;<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include fastcgi_params;<br>\n#}</p></blockquote><p>This snippet is from NGINX\u2019s default virtual host configuration file and enables us to run PHP-FPM with NGINX. We\u2019re going to change it to this:</p><blockquote><p># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000<br>\n#<br>\nlocation ~ \\.php$ {<br>\nfastcgi_split_path_info ^(.+\\.php)(/.+)$;<br>\n# NOTE: You should have \u201ccgi.fix_pathinfo = 0;\u201d in php.ini</p><p>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # With php5-cgi alone:<br>\n#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_pass 127.0.0.1:9000;<br>\n# With php5-fpm:<br>\nfastcgi_pass unix:/var/run/php5-fpm.sock;<br>\nfastcgi_index index.php;<br>\ninclude fastcgi_params;<br>\n}</p></blockquote><p>As you see, we\u2019ve commented out several lines. I\u2019m going to explain them line by line.</p><blockquote><p>location ~ \\.php$ {</p></blockquote><p>This matches any location ending in *.php, which make sure that such requests get into the following block of code.</p><blockquote><p>fastcgi_split_path_info ^(.+\\.php)(/.+)$;</p></blockquote><p>This matches the script\u2019s file name and any variables that may have been added after that. It splits it up into two variables for later use by NGINX.</p><blockquote><p>fastcgi_pass unix:/var/run/php5-fpm.sock;</p></blockquote><p>This line passes on the request to the PHP-FPM socket, which we\u2019ll configure in a bit. It basically sends the request there for it to be handled.</p><blockquote><p>fastcgi_index index.php;</p></blockquote><p>This is the name of the file NGINX should fall back to if no filename is given.</p><blockquote><p>include fastcgi_params;</p></blockquote><p>This includes any parameters made by the fastcgi module (like the ones we split before) and makes them available to NGINX.</p><p>That\u2019s it NGINX-wise, let\u2019s configure PHP-FPM. Open up /etc/php5/fpm/pool.d/www.conf. Look for the following line:</p><blockquote><p>listen = 127.0.0.1:9000</p></blockquote><p>And change it to:</p><blockquote><p>listen = /var/run/php5-fpm.sock</p></blockquote><p>This tells PHP-FPM to open a UNIX socket rather than listening on a port. This should speed things up as well.</p><p>Now, restart both PHP-FPM and NGINX:</p><blockquote><p>sudo service php5-fpm restart</p><p>sudo service nginx restart</p></blockquote><p>And you\u2019re good! NGINX now works with PHP files and passes those on to PHP-FPM. If you want to test this, create a file in&nbsp;/usr/share/nginx/www and put this in it:</p><blockquote><p>&lt;?php</p><p>phpinfo();</p></blockquote><p>If you surf to that file, it should display information about your PHP environment. Be sure to remove the file afterwards, as you probably don\u2019t want all those details lying around in the open.</p><h2>MariaDB</h2><p>The final step for this tutorial is installing MariaDB. This is usually trivially easy on Ubuntu, however, at the time of writing there is a version number conflict in Ubuntu 12.04 LTS. This could have been fixed meanwhile, so I\u2019m going to give you two commands so you have all the flexibility you need.</p><p>Anyway, let\u2019s first install a package required for this installation to succeed:</p><blockquote><p>sudo apt-get install python-software-properties</p></blockquote><p>Next, add MariaDB\u2019s repository key:</p><blockquote><p>sudo apt-key adv \u2013recv-keys \u2013keyserver hkp://keyserver.ubuntu.com:80 0xcbcb082a1bb943db</p></blockquote><p>And finally the repository:</p><blockquote><p>sudo add-apt-repository \u2018deb http://ftp.osuosl.org/pub/mariadb/repo/5.5/ubuntu precise main\u2019</p></blockquote><p><em>This repository should suit you fine. If you want something closer to home, go here: <a href=\"https://downloads.mariadb.org/mariadb/repositories/\">https://downloads.mariadb.org/mariadb/repositories/</a></em></p><p>Now, update APT\u2019s caches:</p><blockquote><p>sudo apt-get update</p></blockquote><p>And install MariaDB <em>and</em> php5-mysql, so we can use MariaDB with PHP later:</p><blockquote><p>sudo apt-get install mariadb-server php5-mysql</p></blockquote><p>If the above results in a situation of conflict, here is how to solve it:</p><blockquote><p>sudo apt-get install mariadb-server libmysqlclient18=5.5.33a+maria-1~precise mysql-common=5.5.33a+maria-1~precise php5-mysql</p></blockquote><p>The conflicting packages are usually libmysqlclient18 and mysql-common, which both MariaDB and MySQL provide. In order to install MariaDB, you need the MariaDB version of these packages. With the above command, I\u2019ve told APT to use the versions I gave for those packages. To see which versions a package has, run:</p><blockquote><p>apt-cache policy <em>packagename</em></p></blockquote><p>It should show you a list of versions with APT\u2019s preferred one top. For MariaDB, you need the latest version from the MariaDB repository.</p><p>For now, let\u2019s just assume you\u2019re not running into a conflict or you\u2019ve solved it. During the installation, you are being asked to fill out a root password for MariaDB. Like always, pick a strong one here. Once that\u2019s done, there\u2019s a final step:</p><blockquote><p>sudo service php5-fpm restart</p></blockquote><p>Restarting PHP-FPM so the MySQL plugin gets loaded.</p><p>That\u2019s it, you\u2019re good to go!</p><h2>What\u2019s Next</h2><p>You\u2019re ready to install a script or an application now, but there\u2019s a couple of things you should know. First, we\u2019ve only configured the default virtual host. This is not bad per se, but less suitable for a multi-user environment. Also, all files go into&nbsp;/usr/share/nginx/www and should be owned by www-data. This ensures everything keeps running smoothly. Finally, you need to set up a database by hand in case you need one. You could use a tool like PhpMyAdmin, but be sure to properly secure it.</p><p>As this guide was an introduction to installing a NGINX, PHP-FPM and MariaDB stack, there\u2019s a lot more to write about it. For example, the multi-user or multi-site environment I mentioned before. But also running this efficiently on a LowEndBox. Possibly even making the installation easier and configuring SSL. That\u2019s for the future, though ;-)</p><p><span style=\"text-decoration: underline;\">Up next time</span>: An introduction to <a href=\"https://lowendbox.com/blog/an-introduction-to-nginx-php-fpm-and-mariadb-on-centos/\">NGINX, PHP-FPM and MariaDB on CentOS</a></p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fngnix-php-fpm-mariadb-stack-ubuntu%2F&amp;t=How%20to%20Setup%20a%20Ngnix%20PHP-FPM%20MariaDB%20Stack%20Ubuntu\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=How%20to%20Setup%20a%20Ngnix%20PHP-FPM%20MariaDB%20Stack%20Ubuntu&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fngnix-php-fpm-mariadb-stack-ubuntu%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fngnix-php-fpm-mariadb-stack-ubuntu%2F&amp;title=How%20to%20Setup%20a%20Ngnix%20PHP-FPM%20MariaDB%20Stack%20Ubuntu&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">0</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/centos-6-end-of-life-is-coming-upgrade-to-a-new-centos-7-vps-now/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/centos-6-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">CentOS 6 End of Life is Coming! Upgrade to a new CentOS 7 VPS Now</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/best-web-hosting-control-panels-after-the-cpanel-price-hike/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Best Web Hosting Control Panels after the cPanel Price Hike\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/03/leb-banner-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Best Web Hosting Control Panels after the cPanel Price Hike</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-set-up-plex-media-server-on-your-vps/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Set Up Plex Media Server on Your Cheap VPS\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/how-to-set-up-plex-media-server-on-vps-2-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Set Up Plex Media Server on Your Cheap VPS</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-create-a-dns-server-on-debian-stretch/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How To Create a DNS Server On Debian Stretch\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/leb-centered-small.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How To Create a DNS Server On Debian Stretch</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/mpkossen/\" title=\"All posts by Maarten Kossen\" rel=\"author\">Maarten Kossen</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/67eeccea1ee5a1ce2f93adc061f69a5f?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\">Maarten Kossen was the administrator of LowEndBox from 2013 to 2015, and brought many ideas and improvements to the website during his leadership. Today he is member of our community and LowEndTalk.</p></div></div><div class=\"feedback\"></div></div>"}