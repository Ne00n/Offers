{"id": "19941", "post": "<div class=\"post-19941 post type-post status-publish format-standard hentry category-virtual-servers category-tutorials tag-apache tag-cerbot tag-lamp tag-lets-encrypt tag-linux tag-mariadb tag-mysql tag-php tag-php-7-3 tag-php-fpm tag-ssl tag-virtual-hosting\" id=\"post-19941\"><h2 class=\"storytitle\"><a href=\"https://lowendbox.com/blog/centos-7-lamp-server-tutorial-part-3-lets-encrypt-ssl/\" rel=\"bookmark\">CentOS 7 LAMP Server Tutorial Part 3: Let\u2019s Encrypt SSL</a></h2><div class=\"meta\"><img data-lazyloaded=\"1\" src=\"/media/icons/tag_green.png\" data-src=\"/media/icons/tag_green.png\" alt=\"Tags: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> <a href=\"https://lowendbox.com/tag/apache/\" rel=\"tag\">apache</a>, <a href=\"https://lowendbox.com/tag/cerbot/\" rel=\"tag\">cerbot</a>, <a href=\"https://lowendbox.com/tag/lamp/\" rel=\"tag\">LAMP</a>, <a href=\"https://lowendbox.com/tag/lets-encrypt/\" rel=\"tag\">Let's Encrypt</a>, <a href=\"https://lowendbox.com/tag/linux/\" rel=\"tag\">linux</a>, <a href=\"https://lowendbox.com/tag/mariadb/\" rel=\"tag\">mariadb</a>, <a href=\"https://lowendbox.com/tag/mysql/\" rel=\"tag\">mysql</a>, <a href=\"https://lowendbox.com/tag/php/\" rel=\"tag\">PHP</a>, <a href=\"https://lowendbox.com/tag/php-7-3/\" rel=\"tag\">php 7.3</a>, <a href=\"https://lowendbox.com/tag/php-fpm/\" rel=\"tag\">PHP-FPM</a>, <a href=\"https://lowendbox.com/tag/ssl/\" rel=\"tag\">ssl</a>, <a href=\"https://lowendbox.com/tag/virtual-hosting/\" rel=\"tag\">virtual hosting</a> <img data-lazyloaded=\"1\" src=\"https://lowendbox.com/media/icons/calendar.png\" data-src=\"https://lowendbox.com/media/icons/calendar.png\" alt=\"Date/Time: \" class=\"litespeed-loaded\" data-was-processed=\"true\"> June 13, 2019 @ 6:10 am, by Ryan Flowers</div><div class=\"storycontent tablelook\"><p><img data-lazyloaded=\"1\" src=\"http://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512-300x300.jpg.webp\" loading=\"lazy\" class=\"wp-image-19951 alignleft litespeed-loaded\" data-src=\"http://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512-300x300.jpg.webp\" alt=\"\" width=\"150\" height=\"150\" align=\"left\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512-300x300.jpg.webp 300w, https://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512-150x150.jpg.webp 150w, https://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512.jpg.webp 512w\" data-sizes=\"(max-width: 150px) 100vw, 150px\" sizes=\"(max-width: 150px) 100vw, 150px\" srcset=\"https://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512-300x300.jpg.webp 300w, https://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512-150x150.jpg.webp 150w, https://lowendbox.com/wp-content/uploads/2019/06/ssl-badge-5-512.jpg.webp 512w\" data-was-processed=\"true\"></p><p>Welcome to the third installment of the <a href=\"http://lowendbox.com/blog/centos-7-lamp-server-tutorial-modernized-and-explained-part-1/\">CentOS 7 LAMP Server Tutorial: Modernized and&nbsp;</a><a href=\"http://lowendbox.com/blog/centos-7-lamp-server-tutorial-modernized-and-explained-part-1/\">Explained</a> series. This tutorial builds on the work done in <a href=\"http://lowendbox.com/blog/centos-7-lamp-server-tutorial-modernized-and-explained-part-1/\" target=\"_blank\" rel=\"noopener\">Part 1</a> and <a href=\"http://lowendbox.com/blog/centos-7-lamp-server-tutorial-modernized-and-explained-part-2/\" target=\"_blank\" rel=\"noopener\">Part 2</a>, so if you haven\u2019t checked them out, now\u2019s a good time.</p><p>In this installment we\u2019re going to secure our new Virtual Host (lowend-tutorial.tld) with a Let\u2019s Encrypt SSL certificate. We\u2019ll be installing WordPress in Part 4. It\u2019ll be good to get a SSL certificate installed prior to installing WordPress.</p><p><span id=\"more-19941\"></span></p><h1>Let\u2019s Encrypt, Shall We?</h1><p>We\u2019re going to look at how the Let\u2019s Encrypt SSL certificate gets installed and how we can make use of the certificate. Let\u2019s get started!</p><p>If you\u2019re not familiar with Let\u2019s Encrypt, take a moment to browse on over to their website at <a href=\"https://letsencrypt.org/\" target=\"_blank\" rel=\"noopener\">https://letsencrypt.org/</a>. They are a Certificate Authority who offers free SSL certificates to anyone who can prove that they own the domain they are attempting to get a SSL certificate for.</p><p>The way they do this is via the ACME protocol. You can r<a href=\"https://letsencrypt.org/how-it-works/\" target=\"_blank\" rel=\"noopener\">ead more about it on their site</a>, but it works like so: A program on the server (we\u2019ll talk about Certbot in a moment) puts a code inside a file at http://lowend-tutorial.tld/somefilename. Then it tells Let\u2019s Encrypt\u2019s servers where that file is, and they go looking for it. If the URL exists and loads the coded message, then they know that the request came from the real lowend-tutorial.tld server, and they issue a certificate.</p><p>That means that http://lowend-tutorial.tld needs to be a working website before Let\u2019s Encrypt will issue a certificate. In the last installment we had a working site even though it had no content. That will work fine for this purpose. As mentioned, the program that controls all of this is called Certbot. It\u2019s an amazing bit of software that makes this entire process look incredibly simple. Let\u2019s install Certbot!</p><h1>Installing Certbot on CentOS 7</h1><p>For CentOS 7 we need to install both Certbot and the python module that Certbot uses for integrating with Apache. Use the following command:</p><pre>yum -y install certbot python2-certbot-apache</pre><p>Before we can run Certbot and get a Let\u2019s Encrypt SSL certificate, we need to do a little bit more configuration. HTTPS (SSL) connections happen on port 443 (vs port 80 for unsecured HTTP connections) and so we need to allow port 443 through the firewall. Firewalld knows about the association between port 443 and https, so we can just enable \u201chttps\u201d in Firewalld. Paste in the following commands:</p><pre>firewall-cmd --zone=public --add-service=https --permanent\nfirewall-cmd --reload</pre><p>Certbot is smart and knows that we\u2019re running the Apache web server, and what\u2019s more it\u2019s smart enough to know <em>how</em> we\u2019re running Apache. It actually reads the configuration files and reacts accordingly. You\u2019ll recall that we created a new Apache VirtualHost in <em>/etc/httpd/sites-enabled/lowend-tutorial.tld.conf</em>. This configuration file is responsible for mapping <strong>http</strong>://lowend-tutorial.tld to <em>/home/lowend/public_html</em> and making PHP work.</p><p>The first line of <em>/etc/httpd/sites-enabled/lowend-tutorial.tld.conf</em> looks like this:</p><pre>&lt;VirtualHost *:80&gt;</pre><p>This VirtualHost is specific to port 80. But SSL happens on port 443, so there will need to be a new VirtualHost for port 443. What do we need to do to configure it all? Let Certbot work its magic! At the command line, run certbot with the following command:</p><pre>certbot</pre><p>You\u2019re going to need to answer some questions. If you want your website to automatically redirect to https:// you can configure that here or you can manually do it later in the websites own configuration. Here\u2019s how it looked on our VPS:</p><p><img data-lazyloaded=\"1\" src=\"http://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1.jpg.webp\" loading=\"lazy\" class=\"aligncenter wp-image-19944 size-full litespeed-loaded\" data-src=\"http://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1.jpg.webp\" alt=\"\" width=\"812\" height=\"1217\" data-srcset=\"https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1.jpg.webp 812w, https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1-200x300.jpg.webp 200w, https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1-768x1151.jpg.webp 768w, https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1-683x1024.jpg.webp 683w\" data-sizes=\"(max-width: 812px) 100vw, 812px\" sizes=\"(max-width: 812px) 100vw, 812px\" srcset=\"https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1.jpg.webp 812w, https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1-200x300.jpg.webp 200w, https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1-768x1151.jpg.webp 768w, https://lowendbox.com/wp-content/uploads/2019/06/wpssl1-certbot1-683x1024.jpg.webp 683w\" data-was-processed=\"true\"></p><h1>What just Happened?</h1><p>If you look in<em> /etc/httpd/sites-enabled</em>, you\u2019ll see a new file, <em>lowend-tutorial.tld<strong>-le-ssl</strong>.conf</em>. An examination will show that the VirtualHost directive defines a&nbsp;VirtualHost on port 443 and that the entire VirtualHost file is wrapped in <em>&lt;IfModule mod_ssl.c&gt;</em> tags. At the bottom are some new lines pertaining to the SSL certificates. Here are the additions and changes:</p><pre>&lt;IfModule mod_ssl.c&gt;\n&lt;VirtualHost *:443&gt;\n... \n... skipping original VirtualHost content for brevity\n...\nInclude /etc/letsencrypt/options-ssl-apache.conf\nSSLCertificateFile /etc/letsencrypt/live/lowend-tutorial.cf/cert.pem\nSSLCertificateKeyFile /etc/letsencrypt/live/lowend-tutorial.cf/privkey.pem\nSSLCertificateChainFile /etc/letsencrypt/live/lowend-tutorial.cf/chain.pem\n&lt;/IfModule mod_ssl.c&gt;</pre><p>You can see how the configuration is SSL specific. The SSL configuration is loaded and the paths to the SSL certificate files are now included. Certbot did all of this for us, and it even restarted Apache to enact the changes. Thanks, Certbot!</p><p>Let\u2019s see if it all worked. Load your site in a browser, then change the URL to https://. It should still load. If it doesn\u2019t, then check carefully for ACME errors, and make sure the site loaded with http:// originally. Also be sure that DNS is pointing at the server correctly. These things account for most errors.</p><h1>Nothing Lasts Forever</h1><p>Like most good things, Let\u2019s Encrypt SSL certificates don\u2019t last forever. They last 90 days and need to be renewed. If we tell Certbot to run regularly, it\u2019ll automagically renew any SSL certificate that is less than 29 days away from expiration. For that, let\u2019s use a cron job.</p><p>Cron jobs are automated tasks that run on a schedule that we define. These schedules happen in a tabulated file called a \u201ccrontab\u201d. Linux has a built in feature for modifying crontabs, but it relies on using your own text editor. We prefer nano for its ease of use vs vim (feel free to disagree, we don\u2019t mind!) and so we\u2019re going to set that as our editor before we start editing things:</p><pre>echo \"export VISUAL=nano\"</pre><p>Since we want this to be the case every time we log in, lets go ahead and add it to <em>/root/.bash_profile</em>. the <em>.bash_profile</em> file is a script that gets ran every time its user logs in:</p><pre>echo \"export VISUAL=nano\" &gt;&gt; ~/.bash_profile</pre><p>Now let\u2019s edit the crontab and add a job that will run every 12 hours:</p><pre>crontab -e</pre><p>With nano open, paste in the following</p><pre>1 */12 * * * certbot renew</pre><p>That entry tells cron to run the \u201ccertbot renew\u201d command on the first minute of every 12th hour of every day. If there are any certificates that need renewing, it\u2019ll renew them for us as long as ACME is able to verify the domain again.</p><h1>Next up: WordPress</h1><p>And with that, we\u2019re done. You\u2019ve just installed Certbot, which installed a Let\u2019s Encrypt SSL certificate on your CentOS 7 LAMP server. For more information, go check out all of the official documentation for Let\u2019s Encrypt and Certbot. They are a treasure trove of information, especially if you need to troubleshoot things:</p><p><a href=\"https://letsencrypt.org/\" target=\"_blank\" rel=\"noopener\">https://letsencrypt.org/</a><br>\n<a href=\"https://certbot.eff.org/docs/\" target=\"_blank\" rel=\"noopener\">https://certbot.eff.org/docs/</a></p><p>In the next installment we\u2019re going to install WordPress on our new LAMP server and learn how to administer it without even leaving the command line. <a href=\"https://lowendbox.com/blog/centos-7-lamp-server-wordpress-wp-cli/\" target=\"_blank\" rel=\"noopener\">Click Here to go to Part 4</a>.</p><p class=\"dpsp-share-text\"></p><div id=\"dpsp-content-bottom\" class=\"dpsp-content-wrapper dpsp-shape-rounded dpsp-column-auto dpsp-has-spacing dpsp-no-labels dpsp-show-on-mobile dpsp-button-style-1 dpsp-has-icon-background dpsp-has-button-background dpsp-show-total-share-count dpsp-show-total-share-count-after\"><ul class=\"dpsp-networks-btns-wrapper dpsp-networks-btns-content dpsp-has-button-icon-animation\"><li><a rel=\"nofollow\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flowendbox.com%2Fblog%2Fcentos-7-lamp-server-tutorial-part-3-lets-encrypt-ssl%2F&amp;t=CentOS%207%20LAMP%20Server%20Tutorial%20Part%203%3A%20Let%27s%20Encrypt%20SSL\" class=\"dpsp-network-btn dpsp-facebook dpsp-no-label dpsp-first\" title=\"Share on Facebook\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://twitter.com/intent/tweet?text=CentOS%207%20LAMP%20Server%20Tutorial%20Part%203%3A%20Let%27s%20Encrypt%20SSL&amp;url=https%3A%2F%2Flowendbox.com%2Fblog%2Fcentos-7-lamp-server-tutorial-part-3-lets-encrypt-ssl%2F&amp;via=LowEndNetwork\" class=\"dpsp-network-btn dpsp-twitter dpsp-no-label\" title=\"Share on Twitter\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li><li><a rel=\"nofollow\" href=\"https://www.linkedin.com/shareArticle?url=https%3A%2F%2Flowendbox.com%2Fblog%2Fcentos-7-lamp-server-tutorial-part-3-lets-encrypt-ssl%2F&amp;title=CentOS%207%20LAMP%20Server%20Tutorial%20Part%203%3A%20Let%27s%20Encrypt%20SSL&amp;mini=true\" class=\"dpsp-network-btn dpsp-linkedin dpsp-no-label dpsp-last\" title=\"Share on LinkedIn\"><span class=\"dpsp-network-icon\"></span><span class=\"dpsp-network-label-wrapper\"></span></a></li></ul><div class=\"dpsp-total-share-wrapper\"><span class=\"dpsp-icon-total-share\"></span><span class=\"dpsp-total-share-count\">7</span><span>shares</span></div></div><div class=\"relpost-thumb-wrapper\"><div class=\"relpost-thumb-container\"><h3>Related posts:</h3><div style=\"clear: both\"></div><div style=\"clear: both\"></div><div class=\"relpost-block-container\"><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/lowendprotection-homemade-raspberry-pi-security-cloud-camera-setup/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/07/rpi_security1-150x150.jpg) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">LowEndProtection: Homemade Raspberry Pi Security Cloud Camera Setup</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/nginx-vs-openlitespeed-vs-apache/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Nginx vs. OpenLiteSpeed vs. Apache\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/04/nginx-vs-openlitespeed-vs-apache-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Nginx vs. OpenLiteSpeed vs. Apache</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/top-ten-things-that-should-be-in-your-dot-files/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"Top Ten Things That Should Be In Your Dot Files\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2013/05/lowendtutorial-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">Top Ten Things That Should Be In Your Dot Files</div></div></a><a class=\"relpost-block-single\" href=\"https://lowendbox.com/blog/how-to-setup-a-browser-based-desktop-with-a-single-script/\"><div style=\"width: 150px; height: 215px;\"><div class=\"relpost-block-single-image\" alt=\"How to Setup a Browser-Based Desktop with a Single Script\" style=\"background: transparent url(https://lowendbox.com/wp-content/uploads/2020/08/guac1-150x150.png) no-repeat scroll 0% 0%; width: 150px; height: 150px;\"></div><div class=\"relpost-block-single-text\" style=\"font-family: Arial;  font-size: 12px;  color: #333333;\">How to Setup a Browser-Based Desktop with a Single Script</div></div></a></div><div style=\"clear: both\"></div></div></div><div id=\"author-bio-box\" style=\"background: #f8f8f8; border-top: 2px solid #cccccc; border-bottom: 2px solid #cccccc; color: #333333\"><h3><a style=\"color: #555555;\" href=\"https://lowendbox.com/blog/author/ryan-flowers/\" title=\"All posts by Ryan Flowers\" rel=\"author\">Ryan Flowers</a></h3><div class=\"bio-gravatar\"><img data-lazyloaded=\"1\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDcwIDcwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2ZkNGRiIi8+PC9zdmc+\" alt=\"\" data-src=\"https://secure.gravatar.com/avatar/4a6ed635b6c3c112666487683cb7f8e8?s=70&amp;d=retro&amp;r=pg\" data-srcset=\"https://secure.gravatar.com/avatar/4a6ed635b6c3c112666487683cb7f8e8?s=140&amp;d=retro&amp;r=pg 2x\" class=\"avatar avatar-70 photo\" height=\"70\" width=\"70\" loading=\"lazy\"></div><p class=\"bio-description\"></p></div></div><div class=\"feedback\"></div></div>"}